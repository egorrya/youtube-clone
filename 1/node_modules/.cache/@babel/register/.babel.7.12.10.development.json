{
  "{\"sourceRoot\":\"/Users/egor/Dev/ytclone/server/src/\",\"caller\":{\"name\":\"@babel/register\"},\"cwd\":\"/Users/egor/Dev/ytclone\",\"filename\":\"/Users/egor/Dev/ytclone/server/src/index.js\",\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"/Users/egor/Dev/ytclone\",\"plugins\":[{\"key\":\"syntax-numeric-separator\",\"visitor\":{},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"proposal-logical-assignment-operators\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"AssignmentExpression\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-nullish-coalescing-operator\",\"visitor\":{},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-optional-chaining\",\"visitor\":{},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-json-strings\",\"visitor\":{},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-optional-catch-binding\",\"visitor\":{},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-async-generators\",\"visitor\":{},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-object-rest-spread\",\"visitor\":{},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"transform-modules-commonjs\",\"visitor\":{\"CallExpression\":{\"enter\":[null]},\"Program\":{\"exit\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"proposal-dynamic-import\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"Program\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"proposal-export-namespace-from\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"ExportNamedDeclaration\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}}],\"presets\":[]}:7.12.10": {
    "metadata": {},
    "options": {
      "sourceRoot": "/Users/egor/Dev/ytclone/server/src/",
      "caller": {
        "name": "@babel/register"
      },
      "cwd": "/Users/egor/Dev/ytclone",
      "filename": "/Users/egor/Dev/ytclone/server/src/index.js",
      "cloneInputAst": true,
      "babelrc": false,
      "configFile": false,
      "envName": "development",
      "root": "/Users/egor/Dev/ytclone",
      "sourceMaps": "both",
      "ast": false,
      "passPerPreset": false,
      "plugins": [
        {
          "key": "syntax-numeric-separator",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "proposal-logical-assignment-operators",
          "visitor": {
            "_exploded": {},
            "_verified": {},
            "AssignmentExpression": {
              "enter": [
                null
              ]
            }
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-nullish-coalescing-operator",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-optional-chaining",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-json-strings",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-optional-catch-binding",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-async-generators",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-object-rest-spread",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "transform-modules-commonjs",
          "visitor": {
            "CallExpression": {
              "enter": [
                null
              ]
            },
            "Program": {
              "exit": [
                null
              ]
            },
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "proposal-dynamic-import",
          "visitor": {
            "_exploded": {},
            "_verified": {},
            "Program": {
              "enter": [
                null
              ]
            }
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "proposal-export-namespace-from",
          "visitor": {
            "_exploded": {},
            "_verified": {},
            "ExportNamedDeclaration": {
              "enter": [
                null
              ]
            }
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        }
      ],
      "presets": [],
      "parserOpts": {
        "sourceType": "module",
        "sourceFileName": "/Users/egor/Dev/ytclone/server/src/index.js",
        "plugins": [
          "numericSeparator",
          "logicalAssignment",
          "nullishCoalescingOperator",
          "optionalChaining",
          "jsonStrings",
          "optionalCatchBinding",
          "asyncGenerators",
          "objectRestSpread",
          "dynamicImport",
          "exportNamespaceFrom"
        ]
      },
      "generatorOpts": {
        "filename": "/Users/egor/Dev/ytclone/server/src/index.js",
        "comments": true,
        "compact": "auto",
        "sourceMaps": "both",
        "sourceRoot": "/Users/egor/Dev/ytclone/server/src/",
        "sourceFileName": "index.js"
      }
    },
    "ast": null,
    "code": "\"use strict\";\n\nvar _loglevel = _interopRequireDefault(require(\"loglevel\"));\n\nvar _start = require(\"./start\");\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n_loglevel.default.setLevel(\"info\");\n\n(0, _start.startServer)();\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluZGV4LmpzIl0sIm5hbWVzIjpbImxvZ2dlciIsInNldExldmVsIl0sIm1hcHBpbmdzIjoiOztBQUFBOztBQUNBOzs7O0FBQ0FBLGtCQUFPQyxRQUFQLENBQWdCLE1BQWhCOztBQUNBIiwic291cmNlUm9vdCI6Ii9Vc2Vycy9lZ29yL0Rldi95dGNsb25lL3NlcnZlci9zcmMvIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGxvZ2dlciBmcm9tIFwibG9nbGV2ZWxcIjtcbmltcG9ydCB7IHN0YXJ0U2VydmVyIH0gZnJvbSBcIi4vc3RhcnRcIjtcbmxvZ2dlci5zZXRMZXZlbChcImluZm9cIik7XG5zdGFydFNlcnZlcigpO1xuIl19",
    "map": {
      "version": 3,
      "sources": [
        "index.js"
      ],
      "names": [
        "logger",
        "setLevel"
      ],
      "mappings": ";;AAAA;;AACA;;;;AACAA,kBAAOC,QAAP,CAAgB,MAAhB;;AACA",
      "sourceRoot": "/Users/egor/Dev/ytclone/server/src/",
      "sourcesContent": [
        "import logger from \"loglevel\";\nimport { startServer } from \"./start\";\nlogger.setLevel(\"info\");\nstartServer();\n"
      ]
    },
    "sourceType": "script",
    "mtime": 1611368296000
  },
  "{\"sourceRoot\":\"/Users/egor/Dev/ytclone/server/src/\",\"caller\":{\"name\":\"@babel/register\"},\"cwd\":\"/Users/egor/Dev/ytclone\",\"filename\":\"/Users/egor/Dev/ytclone/server/src/start.js\",\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"/Users/egor/Dev/ytclone\",\"plugins\":[{\"key\":\"syntax-numeric-separator\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"proposal-logical-assignment-operators\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"AssignmentExpression\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-nullish-coalescing-operator\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-optional-chaining\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-json-strings\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-optional-catch-binding\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-async-generators\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-object-rest-spread\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"transform-modules-commonjs\",\"visitor\":{\"CallExpression\":{\"enter\":[null]},\"Program\":{\"exit\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"proposal-dynamic-import\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"Program\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"proposal-export-namespace-from\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"ExportNamedDeclaration\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}}],\"presets\":[]}:7.12.10": {
    "metadata": {},
    "options": {
      "sourceRoot": "/Users/egor/Dev/ytclone/server/src/",
      "caller": {
        "name": "@babel/register"
      },
      "cwd": "/Users/egor/Dev/ytclone",
      "filename": "/Users/egor/Dev/ytclone/server/src/start.js",
      "cloneInputAst": true,
      "babelrc": false,
      "configFile": false,
      "envName": "development",
      "root": "/Users/egor/Dev/ytclone",
      "sourceMaps": "both",
      "ast": false,
      "passPerPreset": false,
      "plugins": [
        {
          "key": "syntax-numeric-separator",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "proposal-logical-assignment-operators",
          "visitor": {
            "_exploded": {},
            "_verified": {},
            "AssignmentExpression": {
              "enter": [
                null
              ]
            }
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-nullish-coalescing-operator",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-optional-chaining",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-json-strings",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-optional-catch-binding",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-async-generators",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-object-rest-spread",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "transform-modules-commonjs",
          "visitor": {
            "CallExpression": {
              "enter": [
                null
              ]
            },
            "Program": {
              "exit": [
                null
              ]
            },
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "proposal-dynamic-import",
          "visitor": {
            "_exploded": {},
            "_verified": {},
            "Program": {
              "enter": [
                null
              ]
            }
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "proposal-export-namespace-from",
          "visitor": {
            "_exploded": {},
            "_verified": {},
            "ExportNamedDeclaration": {
              "enter": [
                null
              ]
            }
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        }
      ],
      "presets": [],
      "parserOpts": {
        "sourceType": "module",
        "sourceFileName": "/Users/egor/Dev/ytclone/server/src/start.js",
        "plugins": [
          "numericSeparator",
          "logicalAssignment",
          "nullishCoalescingOperator",
          "optionalChaining",
          "jsonStrings",
          "optionalCatchBinding",
          "asyncGenerators",
          "objectRestSpread",
          "dynamicImport",
          "exportNamespaceFrom"
        ]
      },
      "generatorOpts": {
        "filename": "/Users/egor/Dev/ytclone/server/src/start.js",
        "comments": true,
        "compact": "auto",
        "sourceMaps": "both",
        "sourceRoot": "/Users/egor/Dev/ytclone/server/src/",
        "sourceFileName": "start.js"
      }
    },
    "ast": null,
    "code": "\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.startServer = startServer;\n\nvar _express = _interopRequireDefault(require(\"express\"));\n\nrequire(\"express-async-errors\");\n\nvar _path = _interopRequireDefault(require(\"path\"));\n\nvar _cors = _interopRequireDefault(require(\"cors\"));\n\nvar _loglevel = _interopRequireDefault(require(\"loglevel\"));\n\nvar _morgan = _interopRequireDefault(require(\"morgan\"));\n\nvar _dotenv = _interopRequireDefault(require(\"dotenv\"));\n\nvar _cookieParser = _interopRequireDefault(require(\"cookie-parser\"));\n\nvar _routes = require(\"./routes\");\n\nvar _error = require(\"./middleware/error\");\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n// Import this module to handle errors when using async functions for our route handlers\n_dotenv.default.config();\n\nfunction startServer({\n  port = process.env.PORT\n} = {}) {\n  const app = (0, _express.default)();\n  app.use((0, _morgan.default)(\"dev\"));\n  app.use((0, _cors.default)());\n  app.use((0, _cookieParser.default)());\n  app.use(_express.default.json()); // all API routes are prefixed with /api/v1\n\n  app.use(\"/api/v1\", (0, _routes.getRoutes)()); // Generic error handler if errors are missed by 'express-async-errors' middleware\n\n  app.use(_error.errorMiddleware); // When our project is pushed to production, we will serve // the react app using express.static() middleware\n\n  if (process.env.NODE_ENV === \"production\") {\n    app.use(_express.default.static(_path.default.resolve(__dirname, \"../client/build\"))); // Any request not caught by our API will be routed\n    // to our built react app\n\n    app.get(\"*\", function (req, res) {\n      res.sendFile(_path.default.resolve(__dirname, \"../client/build\", \"index.html\"));\n    });\n  } // This block of code is made to reliably start and close our express app\n  // It is written as a promise, which can be more easily tested\n\n\n  return new Promise(resolve => {\n    const server = app.listen(port, () => {\n      _loglevel.default.info(`Listening on port ${server.address().port}`);\n\n      const originalClose = server.close.bind(server);\n\n      server.close = () => {\n        return new Promise(resolveClose => {\n          originalClose(resolveClose);\n        });\n      }; // This function properly closes the server when the program exits\n\n\n      (0, _error.setupCloseOnExit)(server);\n      resolve(server);\n    });\n  });\n}\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInN0YXJ0LmpzIl0sIm5hbWVzIjpbImRvdGVudiIsImNvbmZpZyIsInN0YXJ0U2VydmVyIiwicG9ydCIsInByb2Nlc3MiLCJlbnYiLCJQT1JUIiwiYXBwIiwidXNlIiwiZXhwcmVzcyIsImpzb24iLCJlcnJvck1pZGRsZXdhcmUiLCJOT0RFX0VOViIsInN0YXRpYyIsInBhdGgiLCJyZXNvbHZlIiwiX19kaXJuYW1lIiwiZ2V0IiwicmVxIiwicmVzIiwic2VuZEZpbGUiLCJQcm9taXNlIiwic2VydmVyIiwibGlzdGVuIiwibG9nZ2VyIiwiaW5mbyIsImFkZHJlc3MiLCJvcmlnaW5hbENsb3NlIiwiY2xvc2UiLCJiaW5kIiwicmVzb2x2ZUNsb3NlIl0sIm1hcHBpbmdzIjoiOzs7Ozs7O0FBQUE7O0FBRUE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBRUE7O0FBQ0E7Ozs7QUFWQTtBQVlBQSxnQkFBT0MsTUFBUDs7QUFFQSxTQUFTQyxXQUFULENBQXFCO0FBQUVDLEVBQUFBLElBQUksR0FBR0MsT0FBTyxDQUFDQyxHQUFSLENBQVlDO0FBQXJCLElBQThCLEVBQW5ELEVBQXVEO0FBQ3JELFFBQU1DLEdBQUcsR0FBRyx1QkFBWjtBQUNBQSxFQUFBQSxHQUFHLENBQUNDLEdBQUosQ0FBUSxxQkFBTyxLQUFQLENBQVI7QUFDQUQsRUFBQUEsR0FBRyxDQUFDQyxHQUFKLENBQVEsb0JBQVI7QUFDQUQsRUFBQUEsR0FBRyxDQUFDQyxHQUFKLENBQVEsNEJBQVI7QUFDQUQsRUFBQUEsR0FBRyxDQUFDQyxHQUFKLENBQVFDLGlCQUFRQyxJQUFSLEVBQVIsRUFMcUQsQ0FNckQ7O0FBQ0FILEVBQUFBLEdBQUcsQ0FBQ0MsR0FBSixDQUFRLFNBQVIsRUFBbUIsd0JBQW5CLEVBUHFELENBU3JEOztBQUNBRCxFQUFBQSxHQUFHLENBQUNDLEdBQUosQ0FBUUcsc0JBQVIsRUFWcUQsQ0FZckQ7O0FBQ0EsTUFBSVAsT0FBTyxDQUFDQyxHQUFSLENBQVlPLFFBQVosS0FBeUIsWUFBN0IsRUFBMkM7QUFDekNMLElBQUFBLEdBQUcsQ0FBQ0MsR0FBSixDQUFRQyxpQkFBUUksTUFBUixDQUFlQyxjQUFLQyxPQUFMLENBQWFDLFNBQWIsRUFBd0IsaUJBQXhCLENBQWYsQ0FBUixFQUR5QyxDQUd6QztBQUNBOztBQUNBVCxJQUFBQSxHQUFHLENBQUNVLEdBQUosQ0FBUSxHQUFSLEVBQWEsVUFBVUMsR0FBVixFQUFlQyxHQUFmLEVBQW9CO0FBQy9CQSxNQUFBQSxHQUFHLENBQUNDLFFBQUosQ0FBYU4sY0FBS0MsT0FBTCxDQUFhQyxTQUFiLEVBQXdCLGlCQUF4QixFQUEyQyxZQUEzQyxDQUFiO0FBQ0QsS0FGRDtBQUdELEdBckJvRCxDQXVCckQ7QUFDQTs7O0FBQ0EsU0FBTyxJQUFJSyxPQUFKLENBQWFOLE9BQUQsSUFBYTtBQUM5QixVQUFNTyxNQUFNLEdBQUdmLEdBQUcsQ0FBQ2dCLE1BQUosQ0FBV3BCLElBQVgsRUFBaUIsTUFBTTtBQUNwQ3FCLHdCQUFPQyxJQUFQLENBQWEscUJBQW9CSCxNQUFNLENBQUNJLE9BQVAsR0FBaUJ2QixJQUFLLEVBQXZEOztBQUVBLFlBQU13QixhQUFhLEdBQUdMLE1BQU0sQ0FBQ00sS0FBUCxDQUFhQyxJQUFiLENBQWtCUCxNQUFsQixDQUF0Qjs7QUFDQUEsTUFBQUEsTUFBTSxDQUFDTSxLQUFQLEdBQWUsTUFBTTtBQUNuQixlQUFPLElBQUlQLE9BQUosQ0FBYVMsWUFBRCxJQUFrQjtBQUNuQ0gsVUFBQUEsYUFBYSxDQUFDRyxZQUFELENBQWI7QUFDRCxTQUZNLENBQVA7QUFHRCxPQUpELENBSm9DLENBU3BDOzs7QUFDQSxtQ0FBaUJSLE1BQWpCO0FBQ0FQLE1BQUFBLE9BQU8sQ0FBQ08sTUFBRCxDQUFQO0FBQ0QsS0FaYyxDQUFmO0FBYUQsR0FkTSxDQUFQO0FBZUQiLCJzb3VyY2VSb290IjoiL1VzZXJzL2Vnb3IvRGV2L3l0Y2xvbmUvc2VydmVyL3NyYy8iLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgZXhwcmVzcyBmcm9tIFwiZXhwcmVzc1wiO1xuLy8gSW1wb3J0IHRoaXMgbW9kdWxlIHRvIGhhbmRsZSBlcnJvcnMgd2hlbiB1c2luZyBhc3luYyBmdW5jdGlvbnMgZm9yIG91ciByb3V0ZSBoYW5kbGVyc1xuaW1wb3J0IFwiZXhwcmVzcy1hc3luYy1lcnJvcnNcIjtcbmltcG9ydCBwYXRoIGZyb20gXCJwYXRoXCI7XG5pbXBvcnQgY29ycyBmcm9tIFwiY29yc1wiO1xuaW1wb3J0IGxvZ2dlciBmcm9tIFwibG9nbGV2ZWxcIjtcbmltcG9ydCBtb3JnYW4gZnJvbSBcIm1vcmdhblwiO1xuaW1wb3J0IGRvdGVudiBmcm9tIFwiZG90ZW52XCI7XG5pbXBvcnQgY29va2llUGFyc2VyIGZyb20gXCJjb29raWUtcGFyc2VyXCI7XG5cbmltcG9ydCB7IGdldFJvdXRlcyB9IGZyb20gXCIuL3JvdXRlc1wiO1xuaW1wb3J0IHsgZXJyb3JNaWRkbGV3YXJlLCBzZXR1cENsb3NlT25FeGl0IH0gZnJvbSBcIi4vbWlkZGxld2FyZS9lcnJvclwiO1xuXG5kb3RlbnYuY29uZmlnKCk7XG5cbmZ1bmN0aW9uIHN0YXJ0U2VydmVyKHsgcG9ydCA9IHByb2Nlc3MuZW52LlBPUlQgfSA9IHt9KSB7XG4gIGNvbnN0IGFwcCA9IGV4cHJlc3MoKTtcbiAgYXBwLnVzZShtb3JnYW4oXCJkZXZcIikpO1xuICBhcHAudXNlKGNvcnMoKSk7XG4gIGFwcC51c2UoY29va2llUGFyc2VyKCkpO1xuICBhcHAudXNlKGV4cHJlc3MuanNvbigpKTtcbiAgLy8gYWxsIEFQSSByb3V0ZXMgYXJlIHByZWZpeGVkIHdpdGggL2FwaS92MVxuICBhcHAudXNlKFwiL2FwaS92MVwiLCBnZXRSb3V0ZXMoKSk7XG5cbiAgLy8gR2VuZXJpYyBlcnJvciBoYW5kbGVyIGlmIGVycm9ycyBhcmUgbWlzc2VkIGJ5ICdleHByZXNzLWFzeW5jLWVycm9ycycgbWlkZGxld2FyZVxuICBhcHAudXNlKGVycm9yTWlkZGxld2FyZSk7XG5cbiAgLy8gV2hlbiBvdXIgcHJvamVjdCBpcyBwdXNoZWQgdG8gcHJvZHVjdGlvbiwgd2Ugd2lsbCBzZXJ2ZSAvLyB0aGUgcmVhY3QgYXBwIHVzaW5nIGV4cHJlc3Muc3RhdGljKCkgbWlkZGxld2FyZVxuICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09IFwicHJvZHVjdGlvblwiKSB7XG4gICAgYXBwLnVzZShleHByZXNzLnN0YXRpYyhwYXRoLnJlc29sdmUoX19kaXJuYW1lLCBcIi4uL2NsaWVudC9idWlsZFwiKSkpO1xuXG4gICAgLy8gQW55IHJlcXVlc3Qgbm90IGNhdWdodCBieSBvdXIgQVBJIHdpbGwgYmUgcm91dGVkXG4gICAgLy8gdG8gb3VyIGJ1aWx0IHJlYWN0IGFwcFxuICAgIGFwcC5nZXQoXCIqXCIsIGZ1bmN0aW9uIChyZXEsIHJlcykge1xuICAgICAgcmVzLnNlbmRGaWxlKHBhdGgucmVzb2x2ZShfX2Rpcm5hbWUsIFwiLi4vY2xpZW50L2J1aWxkXCIsIFwiaW5kZXguaHRtbFwiKSk7XG4gICAgfSk7XG4gIH1cblxuICAvLyBUaGlzIGJsb2NrIG9mIGNvZGUgaXMgbWFkZSB0byByZWxpYWJseSBzdGFydCBhbmQgY2xvc2Ugb3VyIGV4cHJlc3MgYXBwXG4gIC8vIEl0IGlzIHdyaXR0ZW4gYXMgYSBwcm9taXNlLCB3aGljaCBjYW4gYmUgbW9yZSBlYXNpbHkgdGVzdGVkXG4gIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4ge1xuICAgIGNvbnN0IHNlcnZlciA9IGFwcC5saXN0ZW4ocG9ydCwgKCkgPT4ge1xuICAgICAgbG9nZ2VyLmluZm8oYExpc3RlbmluZyBvbiBwb3J0ICR7c2VydmVyLmFkZHJlc3MoKS5wb3J0fWApO1xuXG4gICAgICBjb25zdCBvcmlnaW5hbENsb3NlID0gc2VydmVyLmNsb3NlLmJpbmQoc2VydmVyKTtcbiAgICAgIHNlcnZlci5jbG9zZSA9ICgpID0+IHtcbiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlQ2xvc2UpID0+IHtcbiAgICAgICAgICBvcmlnaW5hbENsb3NlKHJlc29sdmVDbG9zZSk7XG4gICAgICAgIH0pO1xuICAgICAgfTtcbiAgICAgIC8vIFRoaXMgZnVuY3Rpb24gcHJvcGVybHkgY2xvc2VzIHRoZSBzZXJ2ZXIgd2hlbiB0aGUgcHJvZ3JhbSBleGl0c1xuICAgICAgc2V0dXBDbG9zZU9uRXhpdChzZXJ2ZXIpO1xuICAgICAgcmVzb2x2ZShzZXJ2ZXIpO1xuICAgIH0pO1xuICB9KTtcbn1cblxuZXhwb3J0IHsgc3RhcnRTZXJ2ZXIgfTtcbiJdfQ==",
    "map": {
      "version": 3,
      "sources": [
        "start.js"
      ],
      "names": [
        "dotenv",
        "config",
        "startServer",
        "port",
        "process",
        "env",
        "PORT",
        "app",
        "use",
        "express",
        "json",
        "errorMiddleware",
        "NODE_ENV",
        "static",
        "path",
        "resolve",
        "__dirname",
        "get",
        "req",
        "res",
        "sendFile",
        "Promise",
        "server",
        "listen",
        "logger",
        "info",
        "address",
        "originalClose",
        "close",
        "bind",
        "resolveClose"
      ],
      "mappings": ";;;;;;;AAAA;;AAEA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AAEA;;AACA;;;;AAVA;AAYAA,gBAAOC,MAAP;;AAEA,SAASC,WAAT,CAAqB;AAAEC,EAAAA,IAAI,GAAGC,OAAO,CAACC,GAAR,CAAYC;AAArB,IAA8B,EAAnD,EAAuD;AACrD,QAAMC,GAAG,GAAG,uBAAZ;AACAA,EAAAA,GAAG,CAACC,GAAJ,CAAQ,qBAAO,KAAP,CAAR;AACAD,EAAAA,GAAG,CAACC,GAAJ,CAAQ,oBAAR;AACAD,EAAAA,GAAG,CAACC,GAAJ,CAAQ,4BAAR;AACAD,EAAAA,GAAG,CAACC,GAAJ,CAAQC,iBAAQC,IAAR,EAAR,EALqD,CAMrD;;AACAH,EAAAA,GAAG,CAACC,GAAJ,CAAQ,SAAR,EAAmB,wBAAnB,EAPqD,CASrD;;AACAD,EAAAA,GAAG,CAACC,GAAJ,CAAQG,sBAAR,EAVqD,CAYrD;;AACA,MAAIP,OAAO,CAACC,GAAR,CAAYO,QAAZ,KAAyB,YAA7B,EAA2C;AACzCL,IAAAA,GAAG,CAACC,GAAJ,CAAQC,iBAAQI,MAAR,CAAeC,cAAKC,OAAL,CAAaC,SAAb,EAAwB,iBAAxB,CAAf,CAAR,EADyC,CAGzC;AACA;;AACAT,IAAAA,GAAG,CAACU,GAAJ,CAAQ,GAAR,EAAa,UAAUC,GAAV,EAAeC,GAAf,EAAoB;AAC/BA,MAAAA,GAAG,CAACC,QAAJ,CAAaN,cAAKC,OAAL,CAAaC,SAAb,EAAwB,iBAAxB,EAA2C,YAA3C,CAAb;AACD,KAFD;AAGD,GArBoD,CAuBrD;AACA;;;AACA,SAAO,IAAIK,OAAJ,CAAaN,OAAD,IAAa;AAC9B,UAAMO,MAAM,GAAGf,GAAG,CAACgB,MAAJ,CAAWpB,IAAX,EAAiB,MAAM;AACpCqB,wBAAOC,IAAP,CAAa,qBAAoBH,MAAM,CAACI,OAAP,GAAiBvB,IAAK,EAAvD;;AAEA,YAAMwB,aAAa,GAAGL,MAAM,CAACM,KAAP,CAAaC,IAAb,CAAkBP,MAAlB,CAAtB;;AACAA,MAAAA,MAAM,CAACM,KAAP,GAAe,MAAM;AACnB,eAAO,IAAIP,OAAJ,CAAaS,YAAD,IAAkB;AACnCH,UAAAA,aAAa,CAACG,YAAD,CAAb;AACD,SAFM,CAAP;AAGD,OAJD,CAJoC,CASpC;;;AACA,mCAAiBR,MAAjB;AACAP,MAAAA,OAAO,CAACO,MAAD,CAAP;AACD,KAZc,CAAf;AAaD,GAdM,CAAP;AAeD",
      "sourceRoot": "/Users/egor/Dev/ytclone/server/src/",
      "sourcesContent": [
        "import express from \"express\";\n// Import this module to handle errors when using async functions for our route handlers\nimport \"express-async-errors\";\nimport path from \"path\";\nimport cors from \"cors\";\nimport logger from \"loglevel\";\nimport morgan from \"morgan\";\nimport dotenv from \"dotenv\";\nimport cookieParser from \"cookie-parser\";\n\nimport { getRoutes } from \"./routes\";\nimport { errorMiddleware, setupCloseOnExit } from \"./middleware/error\";\n\ndotenv.config();\n\nfunction startServer({ port = process.env.PORT } = {}) {\n  const app = express();\n  app.use(morgan(\"dev\"));\n  app.use(cors());\n  app.use(cookieParser());\n  app.use(express.json());\n  // all API routes are prefixed with /api/v1\n  app.use(\"/api/v1\", getRoutes());\n\n  // Generic error handler if errors are missed by 'express-async-errors' middleware\n  app.use(errorMiddleware);\n\n  // When our project is pushed to production, we will serve // the react app using express.static() middleware\n  if (process.env.NODE_ENV === \"production\") {\n    app.use(express.static(path.resolve(__dirname, \"../client/build\")));\n\n    // Any request not caught by our API will be routed\n    // to our built react app\n    app.get(\"*\", function (req, res) {\n      res.sendFile(path.resolve(__dirname, \"../client/build\", \"index.html\"));\n    });\n  }\n\n  // This block of code is made to reliably start and close our express app\n  // It is written as a promise, which can be more easily tested\n  return new Promise((resolve) => {\n    const server = app.listen(port, () => {\n      logger.info(`Listening on port ${server.address().port}`);\n\n      const originalClose = server.close.bind(server);\n      server.close = () => {\n        return new Promise((resolveClose) => {\n          originalClose(resolveClose);\n        });\n      };\n      // This function properly closes the server when the program exits\n      setupCloseOnExit(server);\n      resolve(server);\n    });\n  });\n}\n\nexport { startServer };\n"
      ]
    },
    "sourceType": "script",
    "mtime": 1611368296000
  },
  "{\"sourceRoot\":\"/Users/egor/Dev/ytclone/server/src/routes/\",\"caller\":{\"name\":\"@babel/register\"},\"cwd\":\"/Users/egor/Dev/ytclone\",\"filename\":\"/Users/egor/Dev/ytclone/server/src/routes/index.js\",\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"/Users/egor/Dev/ytclone\",\"plugins\":[{\"key\":\"syntax-numeric-separator\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"proposal-logical-assignment-operators\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"AssignmentExpression\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-nullish-coalescing-operator\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-optional-chaining\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-json-strings\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-optional-catch-binding\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-async-generators\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-object-rest-spread\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"transform-modules-commonjs\",\"visitor\":{\"CallExpression\":{\"enter\":[null]},\"Program\":{\"exit\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"proposal-dynamic-import\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"Program\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"proposal-export-namespace-from\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"ExportNamedDeclaration\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}}],\"presets\":[]}:7.12.10": {
    "metadata": {},
    "options": {
      "sourceRoot": "/Users/egor/Dev/ytclone/server/src/routes/",
      "caller": {
        "name": "@babel/register"
      },
      "cwd": "/Users/egor/Dev/ytclone",
      "filename": "/Users/egor/Dev/ytclone/server/src/routes/index.js",
      "cloneInputAst": true,
      "babelrc": false,
      "configFile": false,
      "envName": "development",
      "root": "/Users/egor/Dev/ytclone",
      "sourceMaps": "both",
      "ast": false,
      "passPerPreset": false,
      "plugins": [
        {
          "key": "syntax-numeric-separator",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "proposal-logical-assignment-operators",
          "visitor": {
            "_exploded": {},
            "_verified": {},
            "AssignmentExpression": {
              "enter": [
                null
              ]
            }
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-nullish-coalescing-operator",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-optional-chaining",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-json-strings",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-optional-catch-binding",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-async-generators",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-object-rest-spread",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "transform-modules-commonjs",
          "visitor": {
            "CallExpression": {
              "enter": [
                null
              ]
            },
            "Program": {
              "exit": [
                null
              ]
            },
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "proposal-dynamic-import",
          "visitor": {
            "_exploded": {},
            "_verified": {},
            "Program": {
              "enter": [
                null
              ]
            }
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "proposal-export-namespace-from",
          "visitor": {
            "_exploded": {},
            "_verified": {},
            "ExportNamedDeclaration": {
              "enter": [
                null
              ]
            }
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        }
      ],
      "presets": [],
      "parserOpts": {
        "sourceType": "module",
        "sourceFileName": "/Users/egor/Dev/ytclone/server/src/routes/index.js",
        "plugins": [
          "numericSeparator",
          "logicalAssignment",
          "nullishCoalescingOperator",
          "optionalChaining",
          "jsonStrings",
          "optionalCatchBinding",
          "asyncGenerators",
          "objectRestSpread",
          "dynamicImport",
          "exportNamespaceFrom"
        ]
      },
      "generatorOpts": {
        "filename": "/Users/egor/Dev/ytclone/server/src/routes/index.js",
        "comments": true,
        "compact": "auto",
        "sourceMaps": "both",
        "sourceRoot": "/Users/egor/Dev/ytclone/server/src/routes/",
        "sourceFileName": "index.js"
      }
    },
    "ast": null,
    "code": "\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.getRoutes = getRoutes;\n\nvar _express = _interopRequireDefault(require(\"express\"));\n\nvar _auth = require(\"./auth\");\n\nvar _user = require(\"./user\");\n\nvar _video = require(\"./video\");\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction getRoutes() {\n  // All routes in our Node API are placed on this router\n  const router = _express.default.Router(); // router.use() prefixes our route (i.e. /api/v1/auth)\n\n\n  router.use(\"/auth\", (0, _auth.getAuthRoutes)());\n  router.use(\"/users\", (0, _user.getUserRoutes)());\n  router.use(\"/videos\", (0, _video.getVideoRoutes)());\n  return router;\n}\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluZGV4LmpzIl0sIm5hbWVzIjpbImdldFJvdXRlcyIsInJvdXRlciIsImV4cHJlc3MiLCJSb3V0ZXIiLCJ1c2UiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFBQTs7QUFFQTs7QUFDQTs7QUFDQTs7OztBQUVBLFNBQVNBLFNBQVQsR0FBcUI7QUFDbkI7QUFDQSxRQUFNQyxNQUFNLEdBQUdDLGlCQUFRQyxNQUFSLEVBQWYsQ0FGbUIsQ0FJbkI7OztBQUNBRixFQUFBQSxNQUFNLENBQUNHLEdBQVAsQ0FBVyxPQUFYLEVBQW9CLDBCQUFwQjtBQUNBSCxFQUFBQSxNQUFNLENBQUNHLEdBQVAsQ0FBVyxRQUFYLEVBQXFCLDBCQUFyQjtBQUNBSCxFQUFBQSxNQUFNLENBQUNHLEdBQVAsQ0FBVyxTQUFYLEVBQXNCLDRCQUF0QjtBQUVBLFNBQU9ILE1BQVA7QUFDRCIsInNvdXJjZVJvb3QiOiIvVXNlcnMvZWdvci9EZXYveXRjbG9uZS9zZXJ2ZXIvc3JjL3JvdXRlcy8iLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgZXhwcmVzcyBmcm9tIFwiZXhwcmVzc1wiO1xuXG5pbXBvcnQgeyBnZXRBdXRoUm91dGVzIH0gZnJvbSBcIi4vYXV0aFwiO1xuaW1wb3J0IHsgZ2V0VXNlclJvdXRlcyB9IGZyb20gXCIuL3VzZXJcIjtcbmltcG9ydCB7IGdldFZpZGVvUm91dGVzIH0gZnJvbSBcIi4vdmlkZW9cIjtcblxuZnVuY3Rpb24gZ2V0Um91dGVzKCkge1xuICAvLyBBbGwgcm91dGVzIGluIG91ciBOb2RlIEFQSSBhcmUgcGxhY2VkIG9uIHRoaXMgcm91dGVyXG4gIGNvbnN0IHJvdXRlciA9IGV4cHJlc3MuUm91dGVyKCk7XG5cbiAgLy8gcm91dGVyLnVzZSgpIHByZWZpeGVzIG91ciByb3V0ZSAoaS5lLiAvYXBpL3YxL2F1dGgpXG4gIHJvdXRlci51c2UoXCIvYXV0aFwiLCBnZXRBdXRoUm91dGVzKCkpO1xuICByb3V0ZXIudXNlKFwiL3VzZXJzXCIsIGdldFVzZXJSb3V0ZXMoKSk7XG4gIHJvdXRlci51c2UoXCIvdmlkZW9zXCIsIGdldFZpZGVvUm91dGVzKCkpO1xuXG4gIHJldHVybiByb3V0ZXI7XG59XG5cbmV4cG9ydCB7IGdldFJvdXRlcyB9O1xuIl19",
    "map": {
      "version": 3,
      "sources": [
        "index.js"
      ],
      "names": [
        "getRoutes",
        "router",
        "express",
        "Router",
        "use"
      ],
      "mappings": ";;;;;;;AAAA;;AAEA;;AACA;;AACA;;;;AAEA,SAASA,SAAT,GAAqB;AACnB;AACA,QAAMC,MAAM,GAAGC,iBAAQC,MAAR,EAAf,CAFmB,CAInB;;;AACAF,EAAAA,MAAM,CAACG,GAAP,CAAW,OAAX,EAAoB,0BAApB;AACAH,EAAAA,MAAM,CAACG,GAAP,CAAW,QAAX,EAAqB,0BAArB;AACAH,EAAAA,MAAM,CAACG,GAAP,CAAW,SAAX,EAAsB,4BAAtB;AAEA,SAAOH,MAAP;AACD",
      "sourceRoot": "/Users/egor/Dev/ytclone/server/src/routes/",
      "sourcesContent": [
        "import express from \"express\";\n\nimport { getAuthRoutes } from \"./auth\";\nimport { getUserRoutes } from \"./user\";\nimport { getVideoRoutes } from \"./video\";\n\nfunction getRoutes() {\n  // All routes in our Node API are placed on this router\n  const router = express.Router();\n\n  // router.use() prefixes our route (i.e. /api/v1/auth)\n  router.use(\"/auth\", getAuthRoutes());\n  router.use(\"/users\", getUserRoutes());\n  router.use(\"/videos\", getVideoRoutes());\n\n  return router;\n}\n\nexport { getRoutes };\n"
      ]
    },
    "sourceType": "script",
    "mtime": 1611368296000
  },
  "{\"sourceRoot\":\"/Users/egor/Dev/ytclone/server/src/routes/\",\"caller\":{\"name\":\"@babel/register\"},\"cwd\":\"/Users/egor/Dev/ytclone\",\"filename\":\"/Users/egor/Dev/ytclone/server/src/routes/auth.js\",\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"/Users/egor/Dev/ytclone\",\"plugins\":[{\"key\":\"syntax-numeric-separator\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"proposal-logical-assignment-operators\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"AssignmentExpression\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-nullish-coalescing-operator\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-optional-chaining\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-json-strings\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-optional-catch-binding\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-async-generators\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-object-rest-spread\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"transform-modules-commonjs\",\"visitor\":{\"CallExpression\":{\"enter\":[null]},\"Program\":{\"exit\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"proposal-dynamic-import\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"Program\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"proposal-export-namespace-from\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"ExportNamedDeclaration\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}}],\"presets\":[]}:7.12.10": {
    "metadata": {},
    "options": {
      "sourceRoot": "/Users/egor/Dev/ytclone/server/src/routes/",
      "caller": {
        "name": "@babel/register"
      },
      "cwd": "/Users/egor/Dev/ytclone",
      "filename": "/Users/egor/Dev/ytclone/server/src/routes/auth.js",
      "cloneInputAst": true,
      "babelrc": false,
      "configFile": false,
      "envName": "development",
      "root": "/Users/egor/Dev/ytclone",
      "sourceMaps": "both",
      "ast": false,
      "passPerPreset": false,
      "plugins": [
        {
          "key": "syntax-numeric-separator",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "proposal-logical-assignment-operators",
          "visitor": {
            "_exploded": {},
            "_verified": {},
            "AssignmentExpression": {
              "enter": [
                null
              ]
            }
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-nullish-coalescing-operator",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-optional-chaining",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-json-strings",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-optional-catch-binding",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-async-generators",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-object-rest-spread",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "transform-modules-commonjs",
          "visitor": {
            "CallExpression": {
              "enter": [
                null
              ]
            },
            "Program": {
              "exit": [
                null
              ]
            },
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "proposal-dynamic-import",
          "visitor": {
            "_exploded": {},
            "_verified": {},
            "Program": {
              "enter": [
                null
              ]
            }
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "proposal-export-namespace-from",
          "visitor": {
            "_exploded": {},
            "_verified": {},
            "ExportNamedDeclaration": {
              "enter": [
                null
              ]
            }
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        }
      ],
      "presets": [],
      "parserOpts": {
        "sourceType": "module",
        "sourceFileName": "/Users/egor/Dev/ytclone/server/src/routes/auth.js",
        "plugins": [
          "numericSeparator",
          "logicalAssignment",
          "nullishCoalescingOperator",
          "optionalChaining",
          "jsonStrings",
          "optionalCatchBinding",
          "asyncGenerators",
          "objectRestSpread",
          "dynamicImport",
          "exportNamespaceFrom"
        ]
      },
      "generatorOpts": {
        "filename": "/Users/egor/Dev/ytclone/server/src/routes/auth.js",
        "comments": true,
        "compact": "auto",
        "sourceMaps": "both",
        "sourceRoot": "/Users/egor/Dev/ytclone/server/src/routes/",
        "sourceFileName": "auth.js"
      }
    },
    "ast": null,
    "code": "\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.getAuthRoutes = getAuthRoutes;\n\nvar _client = require(\"@prisma/client\");\n\nvar _express = _interopRequireDefault(require(\"express\"));\n\nvar _jsonwebtoken = _interopRequireDefault(require(\"jsonwebtoken\"));\n\nvar _authorization = require(\"../middleware/authorization\");\n\nvar _googleAuthLibrary = require(\"google-auth-library\");\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nconst client = new _googleAuthLibrary.OAuth2Client(process.env.GOOGLE_CLIENT_ID);\nconst prisma = new _client.PrismaClient();\n\nfunction getAuthRoutes() {\n  const router = _express.default.Router();\n\n  router.post(\"/google-login\", googleLogin);\n  router.get(\"/me\", _authorization.protect, me);\n  router.get(\"/signout\", signout);\n  return router;\n} // All controllers/utility functions here\n\n\nasync function googleLogin(req, res) {\n  const {\n    idToken\n  } = req.body;\n  const ticket = await client.verifyIdToken({\n    idToken,\n    audience: process.env.GOOGLE_CLIENT_ID\n  });\n  const {\n    name,\n    picture,\n    email\n  } = ticket.getPayload();\n  let user = await prisma.user.findUnique({\n    where: {\n      email\n    }\n  });\n\n  if (!user) {\n    user = await prisma.user.create({\n      data: {\n        email,\n        username: name,\n        avatar: picture\n      }\n    });\n  }\n\n  const tokenPayload = {\n    id: user.id\n  };\n\n  const token = _jsonwebtoken.default.sign(tokenPayload, process.env.JWT_SECRET, {\n    expiresIn: process.env.JWT_EXPIRE\n  });\n\n  res.cookie(\"token\", token, {\n    httpOnly: true\n  });\n  res.status(200).send(token);\n}\n\nasync function me(req, res) {\n  const subscriptions = await prisma.subscription.findMany({\n    where: {\n      subscriberId: {\n        equals: req.user.id\n      }\n    }\n  });\n  const channelIds = subscriptions.map(sub => sub.subscribedToId);\n  const channels = await prisma.user.findMany({\n    where: {\n      id: {\n        in: channelIds\n      }\n    }\n  });\n  const user = req.user;\n  user.channels = channels;\n  res.status(200).json({\n    user\n  });\n}\n\nfunction signout(req, res) {\n  res.clearCookie(\"token\");\n  res.status(200).json({});\n}\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF1dGguanMiXSwibmFtZXMiOlsiY2xpZW50IiwiT0F1dGgyQ2xpZW50IiwicHJvY2VzcyIsImVudiIsIkdPT0dMRV9DTElFTlRfSUQiLCJwcmlzbWEiLCJQcmlzbWFDbGllbnQiLCJnZXRBdXRoUm91dGVzIiwicm91dGVyIiwiZXhwcmVzcyIsIlJvdXRlciIsInBvc3QiLCJnb29nbGVMb2dpbiIsImdldCIsInByb3RlY3QiLCJtZSIsInNpZ25vdXQiLCJyZXEiLCJyZXMiLCJpZFRva2VuIiwiYm9keSIsInRpY2tldCIsInZlcmlmeUlkVG9rZW4iLCJhdWRpZW5jZSIsIm5hbWUiLCJwaWN0dXJlIiwiZW1haWwiLCJnZXRQYXlsb2FkIiwidXNlciIsImZpbmRVbmlxdWUiLCJ3aGVyZSIsImNyZWF0ZSIsImRhdGEiLCJ1c2VybmFtZSIsImF2YXRhciIsInRva2VuUGF5bG9hZCIsImlkIiwidG9rZW4iLCJqd3QiLCJzaWduIiwiSldUX1NFQ1JFVCIsImV4cGlyZXNJbiIsIkpXVF9FWFBJUkUiLCJjb29raWUiLCJodHRwT25seSIsInN0YXR1cyIsInNlbmQiLCJzdWJzY3JpcHRpb25zIiwic3Vic2NyaXB0aW9uIiwiZmluZE1hbnkiLCJzdWJzY3JpYmVySWQiLCJlcXVhbHMiLCJjaGFubmVsSWRzIiwibWFwIiwic3ViIiwic3Vic2NyaWJlZFRvSWQiLCJjaGFubmVscyIsImluIiwianNvbiIsImNsZWFyQ29va2llIl0sIm1hcHBpbmdzIjoiOzs7Ozs7O0FBQUE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7Ozs7QUFFQSxNQUFNQSxNQUFNLEdBQUcsSUFBSUMsK0JBQUosQ0FBaUJDLE9BQU8sQ0FBQ0MsR0FBUixDQUFZQyxnQkFBN0IsQ0FBZjtBQUNBLE1BQU1DLE1BQU0sR0FBRyxJQUFJQyxvQkFBSixFQUFmOztBQUVBLFNBQVNDLGFBQVQsR0FBeUI7QUFDdkIsUUFBTUMsTUFBTSxHQUFHQyxpQkFBUUMsTUFBUixFQUFmOztBQUVBRixFQUFBQSxNQUFNLENBQUNH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TUFBSixDQUFXLEdBQVgsRUFBZ0JhLElBQWhCLENBQXFCO0FBQUU5QixJQUFBQTtBQUFGLEdBQXJCO0FBQ0Q7O0FBRUQsU0FBU1osT0FBVCxDQUFpQkMsR0FBakIsRUFBc0JDLEdBQXRCLEVBQTJCO0FBQ3pCQSxFQUFBQSxHQUFHLENBQUN5QyxXQUFKLENBQWdCLE9BQWhCO0FBQ0F6QyxFQUFBQSxHQUFHLENBQUMyQixNQUFKLENBQVcsR0FBWCxFQUFnQmEsSUFBaEIsQ0FBcUIsRUFBckI7QUFDRCIsInNvdXJjZVJvb3QiOiIvVXNlcnMvZWdvci9EZXYveXRjbG9uZS9zZXJ2ZXIvc3JjL3JvdXRlcy8iLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBQcmlzbWFDbGllbnQgfSBmcm9tIFwiQHByaXNtYS9jbGllbnRcIjtcbmltcG9ydCBleHByZXNzIGZyb20gXCJleHByZXNzXCI7XG5pbXBvcnQgand0IGZyb20gXCJqc29ud2VidG9rZW5cIjtcbmltcG9ydCB7IHByb3RlY3QgfSBmcm9tIFwiLi4vbWlkZGxld2FyZS9hdXRob3JpemF0aW9uXCI7XG5pbXBvcnQgeyBPQXV0aDJDbGllbnQgfSBmcm9tIFwiZ29vZ2xlLWF1dGgtbGlicmFyeVwiO1xuXG5jb25zdCBjbGllbnQgPSBuZXcgT0F1dGgyQ2xpZW50KHByb2Nlc3MuZW52LkdPT0dMRV9DTElFTlRfSUQpO1xuY29uc3QgcHJpc21hID0gbmV3IFByaXNtYUNsaWVudCgpO1xuXG5mdW5jdGlvbiBnZXRBdXRoUm91dGVzKCkge1xuICBjb25zdCByb3V0ZXIgPSBleHByZXNzLlJvdXRlcigpO1xuXG4gIHJvdXRlci5wb3N0KFwiL2dvb2dsZS1sb2dpblwiLCBnb29nbGVMb2dpbik7XG4gIHJvdXRlci5nZXQoXCIvbWVcIiwgcHJvdGVjdCwgbWUpO1xuICByb3V0ZXIuZ2V0KFwiL3NpZ25vdXRcIiwgc2lnbm91dCk7XG5cbiAgcmV0dXJuIHJvdXRlcjtcbn1cblxuLy8gQWxsIGNvbnRyb2xsZXJzL3V0aWxpdHkgZnVuY3Rpb25zIGhlcmVcbmFzeW5jIGZ1bmN0aW9uIGdvb2dsZUxvZ2luKHJlcSwgcmVzKSB7XG4gIGNvbnN0IHsgaWRUb2tlbiB9ID0gcmVxLmJvZHk7XG4gIGNvbnN0IHRpY2tldCA9IGF3YWl0IGNsaWVudC52ZXJpZnlJZFRva2VuKHtcbiAgICBpZFRva2VuLFxuICAgIGF1ZGllbmNlOiBwcm9jZXNzLmVudi5HT09HTEVfQ0xJRU5UX0lELFxuICB9KTtcbiAgY29uc3QgeyBuYW1lLCBwaWN0dXJlLCBlbWFpbCB9ID0gdGlja2V0LmdldFBheWxvYWQoKTtcblxuICBsZXQgdXNlciA9IGF3YWl0IHByaXNtYS51c2VyLmZpbmRVbmlxdWUoe1xuICAgIHdoZXJlOiB7XG4gICAgICBlbWFpbCxcbiAgICB9LFxuICB9KTtcblxuICBpZiAoIXVzZXIpIHtcbiAgICB1c2VyID0gYXdhaXQgcHJpc21hLnVzZXIuY3JlYXRlKHtcbiAgICAgIGRhdGE6IHtcbiAgICAgICAgZW1haWwsXG4gICAgICAgIHVzZXJuYW1lOiBuYW1lLFxuICAgICAgICBhdmF0YXI6IHBpY3R1cmUsXG4gICAgICB9LFxuICAgIH0pO1xuICB9XG5cbiAgY29uc3QgdG9rZW5QYXlsb2FkID0geyBpZDogdXNlci5pZCB9O1xuICBjb25zdCB0b2tlbiA9IGp3dC5zaWduKHRva2VuUGF5bG9hZCwgcHJvY2Vzcy5lbnYuSldUX1NFQ1JFVCwge1xuICAgIGV4cGlyZXNJbjogcHJvY2Vzcy5lbnYuSldUX0VYUElSRSxcbiAgfSk7XG5cbiAgcmVzLmNvb2tpZShcInRva2VuXCIsIHRva2VuLCB7IGh0dHBPbmx5OiB0cnVlIH0pO1xuICByZXMuc3RhdHVzKDIwMCkuc2VuZCh0b2tlbik7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIG1lKHJlcSwgcmVzKSB7XG4gIGNvbnN0IHN1YnNjcmlwdGlvbnMgPSBhd2FpdCBwcmlzbWEuc3Vic2NyaXB0aW9uLmZpbmRNYW55KHtcbiAgICB3aGVyZToge1xuICAgICAgc3Vic2NyaWJlcklkOiB7XG4gICAgICAgIGVxdWFsczogcmVxLnVzZXIuaWQsXG4gICAgICB9LFxuICAgIH0sXG4gIH0pO1xuXG4gIGNvbnN0IGNoYW5uZWxJZHMgPSBzdWJzY3JpcHRpb25zLm1hcCgoc3ViKSA9PiBzdWIuc3Vic2NyaWJlZFRvSWQpO1xuXG4gIGNvbnN0IGNoYW5uZWxzID0gYXdhaXQgcHJpc21hLnVzZXIuZmluZE1hbnkoe1xuICAgIHdoZXJlOiB7XG4gICAgICBpZDoge1xuICAgICAgICBpbjogY2hhbm5lbElkcyxcbiAgICAgIH0sXG4gICAgfSxcbiAgfSk7XG5cbiAgY29uc3QgdXNlciA9IHJlcS51c2VyO1xuICB1c2VyLmNoYW5uZWxzID0gY2hhbm5lbHM7XG5cbiAgcmVzLnN0YXR1cygyMDApLmpzb24oeyB1c2VyIH0pO1xufVxuXG5mdW5jdGlvbiBzaWdub3V0KHJlcSwgcmVzKSB7XG4gIHJlcy5jbGVhckNvb2tpZShcInRva2VuXCIpO1xuICByZXMuc3RhdHVzKDIwMCkuanNvbih7fSk7XG59XG5cbmV4cG9ydCB7IGdldEF1dGhSb3V0ZXMgfTtcbiJdfQ==",
    "map": {
      "version": 3,
      "sources": [
        "auth.js"
      ],
      "names": [
        "client",
        "OAuth2Client",
        "process",
        "env",
        "GOOGLE_CLIENT_ID",
        "prisma",
        "PrismaClient",
        "getAuthRoutes",
        "router",
        "express",
        "Router",
        "post",
        "googleLogin",
        "get",
        "protect",
        "me",
        "signout",
        "req",
        "res",
        "idToken",
        "body",
        "ticket",
        "verifyIdToken",
        "audience",
        "name",
        "picture",
        "email",
        "getPayload",
        "user",
        "findUnique",
        "where",
        "create",
        "data",
        "username",
        "avatar",
        "tokenPayload",
        "id",
        "token",
        "jwt",
        "sign",
        "JWT_SECRET",
        "expiresIn",
        "JWT_EXPIRE",
        "cookie",
        "httpOnly",
        "status",
        "send",
        "subscriptions",
        "subscription",
        "findMany",
        "subscriberId",
        "equals",
        "channelIds",
        "map",
        "sub",
        "subscribedToId",
        "channels",
        "in",
        "json",
        "clearCookie"
      ],
      "mappings": "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",
      "sourceRoot": "/Users/egor/Dev/ytclone/server/src/routes/",
      "sourcesContent": [
        "import { PrismaClient } from \"@prisma/client\";\nimport express from \"express\";\nimport jwt from \"jsonwebtoken\";\nimport { protect } from \"../middleware/authorization\";\nimport { OAuth2Client } from \"google-auth-library\";\n\nconst client = new OAuth2Client(process.env.GOOGLE_CLIENT_ID);\nconst prisma = new PrismaClient();\n\nfunction getAuthRoutes() {\n  const router = express.Router();\n\n  router.post(\"/google-login\", googleLogin);\n  router.get(\"/me\", protect, me);\n  router.get(\"/signout\", signout);\n\n  return router;\n}\n\n// All controllers/utility functions here\nasync function googleLogin(req, res) {\n  const { idToken } = req.body;\n  const ticket = await client.verifyIdToken({\n    idToken,\n    audience: process.env.GOOGLE_CLIENT_ID,\n  });\n  const { name, picture, email } = ticket.getPayload();\n\n  let user = await prisma.user.findUnique({\n    where: {\n      email,\n    },\n  });\n\n  if (!user) {\n    user = await prisma.user.create({\n      data: {\n        email,\n        username: name,\n        avatar: picture,\n      },\n    });\n  }\n\n  const tokenPayload = { id: user.id };\n  const token = jwt.sign(tokenPayload, process.env.JWT_SECRET, {\n    expiresIn: process.env.JWT_EXPIRE,\n  });\n\n  res.cookie(\"token\", token, { httpOnly: true });\n  res.status(200).send(token);\n}\n\nasync function me(req, res) {\n  const subscriptions = await prisma.subscription.findMany({\n    where: {\n      subscriberId: {\n        equals: req.user.id,\n      },\n    },\n  });\n\n  const channelIds = subscriptions.map((sub) => sub.subscribedToId);\n\n  const channels = await prisma.user.findMany({\n    where: {\n      id: {\n        in: channelIds,\n      },\n    },\n  });\n\n  const user = req.user;\n  user.channels = channels;\n\n  res.status(200).json({ user });\n}\n\nfunction signout(req, res) {\n  res.clearCookie(\"token\");\n  res.status(200).json({});\n}\n\nexport { getAuthRoutes };\n"
      ]
    },
    "sourceType": "script",
    "mtime": 1611452835000
  },
  "{\"sourceRoot\":\"/Users/egor/Dev/ytclone/server/src/middleware/\",\"caller\":{\"name\":\"@babel/register\"},\"cwd\":\"/Users/egor/Dev/ytclone\",\"filename\":\"/Users/egor/Dev/ytclone/server/src/middleware/authorization.js\",\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"/Users/egor/Dev/ytclone\",\"plugins\":[{\"key\":\"syntax-numeric-separator\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"proposal-logical-assignment-operators\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"AssignmentExpression\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-nullish-coalescing-operator\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-optional-chaining\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-json-strings\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-optional-catch-binding\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-async-generators\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-object-rest-spread\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"transform-modules-commonjs\",\"visitor\":{\"CallExpression\":{\"enter\":[null]},\"Program\":{\"exit\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"proposal-dynamic-import\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"Program\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"proposal-export-namespace-from\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"ExportNamedDeclaration\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}}],\"presets\":[]}:7.12.10": {
    "metadata": {},
    "options": {
      "sourceRoot": "/Users/egor/Dev/ytclone/server/src/middleware/",
      "caller": {
        "name": "@babel/register"
      },
      "cwd": "/Users/egor/Dev/ytclone",
      "filename": "/Users/egor/Dev/ytclone/server/src/middleware/authorization.js",
      "cloneInputAst": true,
      "babelrc": false,
      "configFile": false,
      "envName": "development",
      "root": "/Users/egor/Dev/ytclone",
      "sourceMaps": "both",
      "ast": false,
      "passPerPreset": false,
      "plugins": [
        {
          "key": "syntax-numeric-separator",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "proposal-logical-assignment-operators",
          "visitor": {
            "_exploded": {},
            "_verified": {},
            "AssignmentExpression": {
              "enter": [
                null
              ]
            }
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-nullish-coalescing-operator",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-optional-chaining",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-json-strings",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-optional-catch-binding",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-async-generators",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-object-rest-spread",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "transform-modules-commonjs",
          "visitor": {
            "CallExpression": {
              "enter": [
                null
              ]
            },
            "Program": {
              "exit": [
                null
              ]
            },
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "proposal-dynamic-import",
          "visitor": {
            "_exploded": {},
            "_verified": {},
            "Program": {
              "enter": [
                null
              ]
            }
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "proposal-export-namespace-from",
          "visitor": {
            "_exploded": {},
            "_verified": {},
            "ExportNamedDeclaration": {
              "enter": [
                null
              ]
            }
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        }
      ],
      "presets": [],
      "parserOpts": {
        "sourceType": "module",
        "sourceFileName": "/Users/egor/Dev/ytclone/server/src/middleware/authorization.js",
        "plugins": [
          "numericSeparator",
          "logicalAssignment",
          "nullishCoalescingOperator",
          "optionalChaining",
          "jsonStrings",
          "optionalCatchBinding",
          "asyncGenerators",
          "objectRestSpread",
          "dynamicImport",
          "exportNamespaceFrom"
        ]
      },
      "generatorOpts": {
        "filename": "/Users/egor/Dev/ytclone/server/src/middleware/authorization.js",
        "comments": true,
        "compact": "auto",
        "sourceMaps": "both",
        "sourceRoot": "/Users/egor/Dev/ytclone/server/src/middleware/",
        "sourceFileName": "authorization.js"
      }
    },
    "ast": null,
    "code": "\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.getAuthUser = getAuthUser;\nexports.protect = protect;\n\nvar _client = require(\"@prisma/client\");\n\nvar _jsonwebtoken = _interopRequireDefault(require(\"jsonwebtoken\"));\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nconst prisma = new _client.PrismaClient();\n\nasync function getAuthUser(req, res, next) {\n  if (!req.cookies.token) {\n    req.user = null;\n    return next();\n  }\n\n  const token = req.cookies.token;\n\n  const decoded = _jsonwebtoken.default.verify(token, process.env.JWT_SECRET);\n\n  const user = await prisma.user.findUnique({\n    where: {\n      id: decoded.id\n    },\n    include: {\n      videos: true\n    }\n  });\n  req.user = user;\n  next();\n}\n\nasync function protect(req, res, next) {\n  if (!req.cookies.token) {\n    return next({\n      message: \"You need to be logged in to visit this route\",\n      statusCode: 401\n    });\n  }\n\n  try {\n    const token = req.cookies.token;\n\n    const decoded = _jsonwebtoken.default.verify(token, process.env.JWT_SECRET);\n\n    const user = await prisma.user.findUnique({\n      where: {\n        id: decoded.id\n      },\n      include: {\n        videos: true\n      }\n    });\n    req.user = user;\n    next();\n  } catch (error) {\n    next({\n      message: \"You need to be logged in to visit this route\",\n      statusCode: 401\n    });\n  }\n}\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF1dGhvcml6YXRpb24uanMiXSwibmFtZXMiOlsicHJpc21hIiwiUHJpc21hQ2xpZW50IiwiZ2V0QXV0aFVzZXIiLCJyZXEiLCJyZXMiLCJuZXh0IiwiY29va2llcyIsInRva2VuIiwidXNlciIsImRlY29kZWQiLCJqd3QiLCJ2ZXJpZnkiLCJwcm9jZXNzIiwiZW52IiwiSldUX1NFQ1JFVCIsImZpbmRVbmlxdWUiLCJ3aGVyZSIsImlkIiwiaW5jbHVkZSIsInZpZGVvcyIsInByb3RlY3QiLCJtZXNzYWdlIiwic3RhdHVzQ29kZSIsImVycm9yIl0sIm1hcHBpbmdzIjoiOzs7Ozs7OztBQUFBOztBQUNBOzs7O0FBRUEsTUFBTUEsTUFBTSxHQUFHLElBQUlDLG9CQUFKLEVBQWY7O0FBRU8sZUFBZUMsV0FBZixDQUEyQkMsR0FBM0IsRUFBZ0NDLEdBQWhDLEVBQXFDQyxJQUFyQyxFQUEyQztBQUNoRCxNQUFJLENBQUNGLEdBQUcsQ0FBQ0csT0FBSixDQUFZQyxLQUFqQixFQUF3QjtBQUN0QkosSUFBQUEsR0FBRyxDQUFDSyxJQUFKLEdBQVcsSUFBWDtBQUNBLFdBQU9ILElBQUksRUFBWDtBQUNEOztBQUVELFFBQU1FLEtBQUssR0FBR0osR0FBRyxDQUFDRyxPQUFKLENBQVlDLEtBQTFCOztBQUNBLFFBQU1FLE9BQU8sR0FBR0Msc0JBQUlDLE1BQUosQ0FBV0osS0FBWCxFQUFrQkssT0FBTyxDQUFDQyxHQUFSLENBQVlDLFVBQTlCLENBQWhCOztBQUVBLFFBQU1OLElBQUksR0FBRyxNQUFNUixNQUFNLENBQUNRLElBQVAsQ0FBWU8sVUFBWixDQUF1QjtBQUN4Q0MsSUFBQUEsS0FBSyxFQUFFO0FBQ0xDLE1BQUFBLEVBQUUsRUFBRVIsT0FBTyxDQUFDUTtBQURQLEtBRGlDO0FBSXhDQyxJQUFBQSxPQUFPLEVBQUU7QUFDUEMsTUFBQUEsTUFBTSxFQUFFO0FBREQ7QUFKK0IsR0FBdkIsQ0FBbkI7QUFTQWhCLEVBQUFBLEdBQUcsQ0FBQ0ssSUFBSixHQUFXQSxJQUFYO0FBQ0FILEVBQUFBLElBQUk7QUFDTDs7QUFFTSxlQUFlZSxPQUFmLENBQXVCakIsR0FBdkIsRUFBNEJDLEdBQTVCLEVBQWlDQyxJQUFqQyxFQUF1QztBQUM1QyxNQUFJLENBQUNGLEdBQUcsQ0FBQ0csT0FBSixDQUFZQyxLQUFqQixFQUF3QjtBQUN0QixXQUFPRixJQUFJLENBQUM7QUFDVmdCLE1BQUFBLE9BQU8sRUFBRSw4Q0FEQztBQUVWQyxNQUFBQSxVQUFVLEVBQUU7QUFGRixLQUFELENBQVg7QUFJRDs7QUFFRCxNQUFJO0FBQ0YsVUFBTWYsS0FBSyxHQUFHSixHQUFHLENBQUNHLE9BQUosQ0FBWUMsS0FBMUI7O0FBQ0EsVUFBTUUsT0FBTyxHQUFHQyxzQkFBSUMsTUFBSixDQUFXSixLQUFYLEVBQWtCSyxPQUFPLENBQUNDLEdBQVIsQ0FBWUMsVUFBOUIsQ0FBaEI7O0FBRUEsVUFBTU4sSUFBSSxHQUFHLE1BQU1SLE1BQU0sQ0FBQ1EsSUFBUCxDQUFZTyxVQUFaLENBQXVCO0FBQ3hDQyxNQUFBQSxLQUFLLEVBQUU7QUFDTEMsUUFBQUEsRUFBRSxFQUFFUixPQUFPLENBQUNRO0FBRFAsT0FEaUM7QUFJeENDLE1BQUFBLE9BQU8sRUFBRTtBQUNQQyxRQUFBQSxNQUFNLEVBQUU7QUFERDtBQUorQixLQUF2QixDQUFuQjtBQVNBaEIsSUFBQUEsR0FBRyxDQUFDSyxJQUFKLEdBQVdBLElBQVg7QUFDQUgsSUFBQUEsSUFBSTtBQUNMLEdBZkQsQ0FlRSxPQUFPa0IsS0FBUCxFQUFjO0FBQ2RsQixJQUFBQSxJQUFJLENBQUM7QUFDSGdCLE1BQUFBLE9BQU8sRUFBRSw4Q0FETjtBQUVIQyxNQUFBQSxVQUFVLEVBQUU7QUFGVCxLQUFELENBQUo7QUFJRDtBQUNGIiwic291cmNlUm9vdCI6Ii9Vc2Vycy9lZ29yL0Rldi95dGNsb25lL3NlcnZlci9zcmMvbWlkZGxld2FyZS8iLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBQcmlzbWFDbGllbnQgfSBmcm9tIFwiQHByaXNtYS9jbGllbnRcIjtcbmltcG9ydCBqd3QgZnJvbSBcImpzb253ZWJ0b2tlblwiO1xuXG5jb25zdCBwcmlzbWEgPSBuZXcgUHJpc21hQ2xpZW50KCk7XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRBdXRoVXNlcihyZXEsIHJlcywgbmV4dCkge1xuICBpZiAoIXJlcS5jb29raWVzLnRva2VuKSB7XG4gICAgcmVxLnVzZXIgPSBudWxsO1xuICAgIHJldHVybiBuZXh0KCk7XG4gIH1cblxuICBjb25zdCB0b2tlbiA9IHJlcS5jb29raWVzLnRva2VuO1xuICBjb25zdCBkZWNvZGVkID0gand0LnZlcmlmeSh0b2tlbiwgcHJvY2Vzcy5lbnYuSldUX1NFQ1JFVCk7XG5cbiAgY29uc3QgdXNlciA9IGF3YWl0IHByaXNtYS51c2VyLmZpbmRVbmlxdWUoe1xuICAgIHdoZXJlOiB7XG4gICAgICBpZDogZGVjb2RlZC5pZCxcbiAgICB9LFxuICAgIGluY2x1ZGU6IHtcbiAgICAgIHZpZGVvczogdHJ1ZSxcbiAgICB9LFxuICB9KTtcblxuICByZXEudXNlciA9IHVzZXI7XG4gIG5leHQoKTtcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHByb3RlY3QocmVxLCByZXMsIG5leHQpIHtcbiAgaWYgKCFyZXEuY29va2llcy50b2tlbikge1xuICAgIHJldHVybiBuZXh0KHtcbiAgICAgIG1lc3NhZ2U6IFwiWW91IG5lZWQgdG8gYmUgbG9nZ2VkIGluIHRvIHZpc2l0IHRoaXMgcm91dGVcIixcbiAgICAgIHN0YXR1c0NvZGU6IDQwMSxcbiAgICB9KTtcbiAgfVxuXG4gIHRyeSB7XG4gICAgY29uc3QgdG9rZW4gPSByZXEuY29va2llcy50b2tlbjtcbiAgICBjb25zdCBkZWNvZGVkID0gand0LnZlcmlmeSh0b2tlbiwgcHJvY2Vzcy5lbnYuSldUX1NFQ1JFVCk7XG5cbiAgICBjb25zdCB1c2VyID0gYXdhaXQgcHJpc21hLnVzZXIuZmluZFVuaXF1ZSh7XG4gICAgICB3aGVyZToge1xuICAgICAgICBpZDogZGVjb2RlZC5pZCxcbiAgICAgIH0sXG4gICAgICBpbmNsdWRlOiB7XG4gICAgICAgIHZpZGVvczogdHJ1ZSxcbiAgICAgIH0sXG4gICAgfSk7XG5cbiAgICByZXEudXNlciA9IHVzZXI7XG4gICAgbmV4dCgpO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIG5leHQoe1xuICAgICAgbWVzc2FnZTogXCJZb3UgbmVlZCB0byBiZSBsb2dnZWQgaW4gdG8gdmlzaXQgdGhpcyByb3V0ZVwiLFxuICAgICAgc3RhdHVzQ29kZTogNDAxLFxuICAgIH0pO1xuICB9XG59XG4iXX0=",
    "map": {
      "version": 3,
      "sources": [
        "authorization.js"
      ],
      "names": [
        "prisma",
        "PrismaClient",
        "getAuthUser",
        "req",
        "res",
        "next",
        "cookies",
        "token",
        "user",
        "decoded",
        "jwt",
        "verify",
        "process",
        "env",
        "JWT_SECRET",
        "findUnique",
        "where",
        "id",
        "include",
        "videos",
        "protect",
        "message",
        "statusCode",
        "error"
      ],
      "mappings": ";;;;;;;;AAAA;;AACA;;;;AAEA,MAAMA,MAAM,GAAG,IAAIC,oBAAJ,EAAf;;AAEO,eAAeC,WAAf,CAA2BC,GAA3B,EAAgCC,GAAhC,EAAqCC,IAArC,EAA2C;AAChD,MAAI,CAACF,GAAG,CAACG,OAAJ,CAAYC,KAAjB,EAAwB;AACtBJ,IAAAA,GAAG,CAACK,IAAJ,GAAW,IAAX;AACA,WAAOH,IAAI,EAAX;AACD;;AAED,QAAME,KAAK,GAAGJ,GAAG,CAACG,OAAJ,CAAYC,KAA1B;;AACA,QAAME,OAAO,GAAGC,sBAAIC,MAAJ,CAAWJ,KAAX,EAAkBK,OAAO,CAACC,GAAR,CAAYC,UAA9B,CAAhB;;AAEA,QAAMN,IAAI,GAAG,MAAMR,MAAM,CAACQ,IAAP,CAAYO,UAAZ,CAAuB;AACxCC,IAAAA,KAAK,EAAE;AACLC,MAAAA,EAAE,EAAER,OAAO,CAACQ;AADP,KADiC;AAIxCC,IAAAA,OAAO,EAAE;AACPC,MAAAA,MAAM,EAAE;AADD;AAJ+B,GAAvB,CAAnB;AASAhB,EAAAA,GAAG,CAACK,IAAJ,GAAWA,IAAX;AACAH,EAAAA,IAAI;AACL;;AAEM,eAAee,OAAf,CAAuBjB,GAAvB,EAA4BC,GAA5B,EAAiCC,IAAjC,EAAuC;AAC5C,MAAI,CAACF,GAAG,CAACG,OAAJ,CAAYC,KAAjB,EAAwB;AACtB,WAAOF,IAAI,CAAC;AACVgB,MAAAA,OAAO,EAAE,8CADC;AAEVC,MAAAA,UAAU,EAAE;AAFF,KAAD,CAAX;AAID;;AAED,MAAI;AACF,UAAMf,KAAK,GAAGJ,GAAG,CAACG,OAAJ,CAAYC,KAA1B;;AACA,UAAME,OAAO,GAAGC,sBAAIC,MAAJ,CAAWJ,KAAX,EAAkBK,OAAO,CAACC,GAAR,CAAYC,UAA9B,CAAhB;;AAEA,UAAMN,IAAI,GAAG,MAAMR,MAAM,CAACQ,IAAP,CAAYO,UAAZ,CAAuB;AACxCC,MAAAA,KAAK,EAAE;AACLC,QAAAA,EAAE,EAAER,OAAO,CAACQ;AADP,OADiC;AAIxCC,MAAAA,OAAO,EAAE;AACPC,QAAAA,MAAM,EAAE;AADD;AAJ+B,KAAvB,CAAnB;AASAhB,IAAAA,GAAG,CAACK,IAAJ,GAAWA,IAAX;AACAH,IAAAA,IAAI;AACL,GAfD,CAeE,OAAOkB,KAAP,EAAc;AACdlB,IAAAA,IAAI,CAAC;AACHgB,MAAAA,OAAO,EAAE,8CADN;AAEHC,MAAAA,UAAU,EAAE;AAFT,KAAD,CAAJ;AAID;AACF",
      "sourceRoot": "/Users/egor/Dev/ytclone/server/src/middleware/",
      "sourcesContent": [
        "import { PrismaClient } from \"@prisma/client\";\nimport jwt from \"jsonwebtoken\";\n\nconst prisma = new PrismaClient();\n\nexport async function getAuthUser(req, res, next) {\n  if (!req.cookies.token) {\n    req.user = null;\n    return next();\n  }\n\n  const token = req.cookies.token;\n  const decoded = jwt.verify(token, process.env.JWT_SECRET);\n\n  const user = await prisma.user.findUnique({\n    where: {\n      id: decoded.id,\n    },\n    include: {\n      videos: true,\n    },\n  });\n\n  req.user = user;\n  next();\n}\n\nexport async function protect(req, res, next) {\n  if (!req.cookies.token) {\n    return next({\n      message: \"You need to be logged in to visit this route\",\n      statusCode: 401,\n    });\n  }\n\n  try {\n    const token = req.cookies.token;\n    const decoded = jwt.verify(token, process.env.JWT_SECRET);\n\n    const user = await prisma.user.findUnique({\n      where: {\n        id: decoded.id,\n      },\n      include: {\n        videos: true,\n      },\n    });\n\n    req.user = user;\n    next();\n  } catch (error) {\n    next({\n      message: \"You need to be logged in to visit this route\",\n      statusCode: 401,\n    });\n  }\n}\n"
      ]
    },
    "sourceType": "script",
    "mtime": 1611454252000
  },
  "{\"sourceRoot\":\"/Users/egor/Dev/ytclone/server/src/routes/\",\"caller\":{\"name\":\"@babel/register\"},\"cwd\":\"/Users/egor/Dev/ytclone\",\"filename\":\"/Users/egor/Dev/ytclone/server/src/routes/user.js\",\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"/Users/egor/Dev/ytclone\",\"plugins\":[{\"key\":\"syntax-numeric-separator\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"proposal-logical-assignment-operators\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"AssignmentExpression\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-nullish-coalescing-operator\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-optional-chaining\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-json-strings\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-optional-catch-binding\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-async-generators\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-object-rest-spread\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"transform-modules-commonjs\",\"visitor\":{\"CallExpression\":{\"enter\":[null]},\"Program\":{\"exit\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"proposal-dynamic-import\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"Program\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"proposal-export-namespace-from\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"ExportNamedDeclaration\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}}],\"presets\":[]}:7.12.10": {
    "metadata": {},
    "options": {
      "sourceRoot": "/Users/egor/Dev/ytclone/server/src/routes/",
      "caller": {
        "name": "@babel/register"
      },
      "cwd": "/Users/egor/Dev/ytclone",
      "filename": "/Users/egor/Dev/ytclone/server/src/routes/user.js",
      "cloneInputAst": true,
      "babelrc": false,
      "configFile": false,
      "envName": "development",
      "root": "/Users/egor/Dev/ytclone",
      "sourceMaps": "both",
      "ast": false,
      "passPerPreset": false,
      "plugins": [
        {
          "key": "syntax-numeric-separator",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "proposal-logical-assignment-operators",
          "visitor": {
            "_exploded": {},
            "_verified": {},
            "AssignmentExpression": {
              "enter": [
                null
              ]
            }
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-nullish-coalescing-operator",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-optional-chaining",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-json-strings",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-optional-catch-binding",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-async-generators",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-object-rest-spread",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "transform-modules-commonjs",
          "visitor": {
            "CallExpression": {
              "enter": [
                null
              ]
            },
            "Program": {
              "exit": [
                null
              ]
            },
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "proposal-dynamic-import",
          "visitor": {
            "_exploded": {},
            "_verified": {},
            "Program": {
              "enter": [
                null
              ]
            }
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "proposal-export-namespace-from",
          "visitor": {
            "_exploded": {},
            "_verified": {},
            "ExportNamedDeclaration": {
              "enter": [
                null
              ]
            }
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        }
      ],
      "presets": [],
      "parserOpts": {
        "sourceType": "module",
        "sourceFileName": "/Users/egor/Dev/ytclone/server/src/routes/user.js",
        "plugins": [
          "numericSeparator",
          "logicalAssignment",
          "nullishCoalescingOperator",
          "optionalChaining",
          "jsonStrings",
          "optionalCatchBinding",
          "asyncGenerators",
          "objectRestSpread",
          "dynamicImport",
          "exportNamespaceFrom"
        ]
      },
      "generatorOpts": {
        "filename": "/Users/egor/Dev/ytclone/server/src/routes/user.js",
        "comments": true,
        "compact": "auto",
        "sourceMaps": "both",
        "sourceRoot": "/Users/egor/Dev/ytclone/server/src/routes/",
        "sourceFileName": "user.js"
      }
    },
    "ast": null,
    "code": "\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.getUserRoutes = getUserRoutes;\n\nvar _client = require(\"@prisma/client\");\n\nvar _express = _interopRequireDefault(require(\"express\"));\n\nvar _authorization = require(\"../middleware/authorization\");\n\nvar _video = require(\"./video\");\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nconst prisma = new _client.PrismaClient();\n\nfunction getUserRoutes() {\n  const router = _express.default.Router();\n\n  router.get(\"/\", _authorization.protect, getRecommendedChannels);\n  router.put(\"/\", _authorization.protect, editUser);\n  router.get(\"/liked-videos\", _authorization.protect, getLikedVideos);\n  router.get(\"/history\", _authorization.protect, getHistory);\n  router.get(\"/subscriptions\", _authorization.protect, getFeed);\n  router.get(\"/search\", _authorization.getAuthUser, searchUser);\n  router.get(\"/:userId\", _authorization.getAuthUser, getProfile);\n  router.get(\"/:userId/toggle-subscribe\", _authorization.protect, toggleSubscribe);\n  return router;\n}\n\nasync function getLikedVideos(req, res) {\n  await getVideos(prisma.videoLike, req, res);\n}\n\nasync function getHistory(req, res) {\n  await getVideos(prisma.view, req, res);\n}\n\nasync function getVideos(model, req, res) {\n  const videoRelations = await model.findMany({\n    where: {\n      userId: req.user.id\n    },\n    orderBy: {\n      createdAt: \"desc\"\n    }\n  });\n  const videoIds = videoRelations.map(videoLike => videoLike.videoId);\n  let videos = await prisma.video.findMany({\n    where: {\n      id: {\n        in: videoIds\n      }\n    },\n    include: {\n      user: true\n    }\n  });\n\n  if (!videos.length) {\n    return res.status(200).json({\n      videos\n    });\n  }\n\n  videos = await (0, _video.getVideoViews)(videos);\n  res.status(200).json({\n    videos\n  });\n}\n\nasync function toggleSubscribe(req, res, next) {\n  if (req.user.id === req.params.userId) {\n    return next({\n      message: \"You cannot subscribe to your own channel\",\n      statusCode: 400\n    });\n  }\n\n  const user = await prisma.user.findUnique({\n    where: {\n      id: req.params.userId\n    }\n  });\n\n  if (!user) {\n    return next({\n      message: `No user found with id: \"${req.params.userId}\"`,\n      statusCode: 404\n    });\n  }\n\n  const isSubscribed = await prisma.subscription.findFirst({\n    where: {\n      subscriberId: {\n        equals: req.user.id\n      },\n      subscribedToId: {\n        equals: req.params.userId\n      }\n    }\n  });\n\n  if (isSubscribed) {\n    await prisma.subscription.delete({\n      where: {\n        id: isSubscribed.id\n      }\n    });\n  } else {\n    await prisma.subscription.create({\n      data: {\n        subscriber: {\n          connect: {\n            id: req.user.id\n          }\n        },\n        subscribedTo: {\n          connect: {\n            id: req.params.userId\n          }\n        }\n      }\n    });\n  }\n\n  res.status(200).json({});\n}\n\nasync function getFeed(req, res) {\n  const subscribedTo = await prisma.subscription.findMany({\n    where: {\n      subscriberId: {\n        equals: req.user.id\n      }\n    }\n  });\n  const subscriptions = subscribedTo.map(sub => sub.subscribedToId);\n  const feed = await prisma.video.findMany({\n    where: {\n      userId: {\n        in: subscriptions\n      }\n    },\n    include: {\n      user: true\n    },\n    orderBy: {\n      createdAt: \"desc\"\n    }\n  });\n\n  if (!feed.length) {\n    return res.status(200).json({\n      feed\n    });\n  }\n\n  const feedVideos = await (0, _video.getVideoViews)(feed);\n  res.status(200).json({\n    feed: feedVideos\n  });\n}\n\nasync function searchUser(req, res, next) {\n  if (!req.query.query) {\n    return next({\n      message: \"Please enter a search query\",\n      statusCode: 400\n    });\n  }\n\n  const users = await prisma.user.findMany({\n    where: {\n      username: {\n        contains: req.query.query,\n        mode: \"insensitive\"\n      }\n    }\n  });\n\n  if (!users.length) {\n    return res.status(200).json({\n      users\n    });\n  }\n\n  for (const user of users) {\n    const subscribersCount = await prisma.subscription.count({\n      where: {\n        subscribedToId: {\n          equals: user.id\n        }\n      }\n    });\n    const videosCount = await prisma.video.count({\n      where: {\n        userId: user.id\n      }\n    });\n    let isMe = false;\n    let isSubscribed = false;\n\n    if (req.user) {\n      isMe = req.user.id === user.id;\n      isSubscribed = await prisma.subscription.findFirst({\n        where: {\n          AND: {\n            subscriberId: {\n              equals: req.user.id\n            },\n            subscribedToId: {\n              equals: user.id\n            }\n          }\n        }\n      });\n    }\n\n    user.subscribersCount = subscribersCount;\n    user.videosCount = videosCount;\n    user.isSubscribed = Boolean(isSubscribed);\n    user.isMe = isMe;\n  }\n\n  res.status(200).json({\n    users\n  });\n}\n\nasync function getRecommendedChannels(req, res) {\n  const channels = await prisma.user.findMany({\n    where: {\n      id: {\n        not: req.user.id\n      }\n    },\n    take: 10\n  });\n\n  if (!channels.length) {\n    return res.status(200).json({\n      channels\n    });\n  }\n\n  for (const channel of channels) {\n    const subscribersCount = await prisma.subscription.count({\n      where: {\n        subscribedToId: {\n          equals: channel.id\n        }\n      }\n    });\n    const videosCount = await prisma.video.count({\n      where: {\n        userId: channel.id\n      }\n    });\n    const isSubscribed = await prisma.subscription.findFirst({\n      where: {\n        AND: {\n          subscriberId: {\n            equals: req.user.id\n          },\n          subscribedToId: {\n            equals: channel.id\n          }\n        }\n      }\n    });\n    channel.subscribersCount = subscribersCount;\n    channel.videosCount = videosCount;\n    channel.isSubscribed = Boolean(isSubscribed);\n  }\n\n  res.status(200).json({\n    channels\n  });\n}\n\nasync function getProfile(req, res, next) {\n  const user = await prisma.user.findUnique({\n    where: {\n      id: req.params.userId\n    }\n  });\n\n  if (!user) {\n    return next({\n      message: `No user found with id: \"${req.params.userId}\"`,\n      statusCode: 404\n    });\n  }\n\n  const subscribersCount = await prisma.subscription.count({\n    where: {\n      subscribedToId: {\n        equals: user.id\n      }\n    }\n  });\n  let isMe = false;\n  let isSubscribed = false;\n\n  if (req.user) {\n    isMe = req.user.id === user.id;\n    isSubscribed = await prisma.subscription.findFirst({\n      where: {\n        AND: {\n          subscriberId: {\n            equals: req.user.id\n          },\n          subscribedToId: {\n            equals: user.id\n          }\n        }\n      }\n    });\n  }\n\n  const subscribedTo = await prisma.subscription.findMany({\n    where: {\n      subscriberId: {\n        equals: user.id\n      }\n    }\n  });\n  const subscriptions = subscribedTo.map(sub => sub.subscribedToId);\n  const channels = await prisma.user.findMany({\n    where: {\n      id: {\n        in: subscriptions\n      }\n    }\n  });\n\n  for (const channel of channels) {\n    const subscribersCount = await prisma.subscription.count({\n      where: {\n        subscribedToId: {\n          equals: channel.id\n        }\n      }\n    });\n    channel.subscribersCount = subscribersCount;\n  }\n\n  const videos = await prisma.video.findMany({\n    where: {\n      userId: {\n        equals: user.id\n      }\n    },\n    orderBy: {\n      createdAt: \"desc\"\n    }\n  });\n  user.subscribersCount = subscribersCount;\n  user.isSubscribed = Boolean(isSubscribed);\n  user.isMe = isMe;\n  user.channels = channels;\n  user.videos = videos;\n\n  if (!videos.length) {\n    return res.status(200).json({\n      user\n    });\n  }\n\n  user.videos = await (0, _video.getVideoViews)(videos);\n  res.status(200).json({\n    user\n  });\n}\n\nasync function editUser(req, res) {\n  const {\n    username,\n    cover,\n    avatar,\n    about\n  } = req.body;\n  const user = await prisma.user.update({\n    where: {\n      id: req.user.id\n    },\n    data: {\n      username,\n      cover,\n      avatar,\n      about\n    }\n  });\n  res.status(200).json({\n    user\n  });\n}\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInVzZXIuanMiXSwibmFtZXMiOlsicHJpc21hIiwiUHJpc21hQ2xpZW50IiwiZ2V0VXNlclJvdXRlcyIsInJvdXRlciIsImV4cHJlc3MiLCJSb3V0ZXIiLCJnZXQiLCJwcm90ZWN0IiwiZ2V0UmVjb21tZW5kZWRDaGFubmVscyIsInB1dCIsImVkaXRVc2VyIiwiZ2V0TGlrZWRWaWRlb3MiLCJnZXRIaXN0b3J5IiwiZ2V0RmVlZCIsImdldEF1dGhVc2VyIiwic2VhcmNoVXNlciIsImdldFByb2ZpbGUiLCJ0b2dnbGVTdWJzY3JpYmUiLCJyZXEiLCJyZXMiLCJnZXRWaWRlb3MiLCJ2aWRlb0xpa2UiLCJ2aWV3IiwibW9kZWwiLCJ2aWRlb1JlbGF0aW9ucyIsImZpbmRNYW55Iiwid2hlcmUiLCJ1c2VySWQiLCJ1c2VyIiwiaWQiLCJvcmRlckJ5IiwiY3JlYXRlZEF0IiwidmlkZW9JZHMiLCJtYXAiLCJ2aWRlb0lkIiwidmlkZW9zIiwidmlkZW8iLCJpbiIsImluY2x1ZGUiLCJsZW5ndGgiLCJzdGF0dXMiLCJqc29uIiwibmV4dCIsInBhcmFtcyIsIm1lc3NhZ2UiLCJzdGF0dXNDb2RlIiwiZmluZFVuaXF1ZSIsImlzU3Vic2NyaWJlZCIsInN1YnNjcmlwdGlvbiIsImZpbmRGaXJzdCIsInN1YnNjcmliZXJJZCIsImVxdWFscyIsInN1YnNjcmliZWRUb0lkIiwiZGVsZXRlIiwiY3JlYXRlIiwiZGF0YSIsInN1YnNjcmliZXIiLCJjb25uZWN0Iiwic3Vic2NyaWJlZFRvIiwic3Vic2NyaXB0aW9ucyIsInN1YiIsImZlZWQiLCJmZWVkVmlkZW9zIiwicXVlcnkiLCJ1c2VycyIsInVzZXJuYW1lIiwiY29udGFpbnMiLCJtb2RlIiwic3Vic2NyaWJlcnNDb3VudCIsImNvdW50IiwidmlkZW9zQ291bnQiLCJpc01lIiwiQU5EIiwiQm9vbGVhbiIsImNoYW5uZWxzIiwibm90IiwidGFrZSIsImNoYW5uZWwiLCJjb3ZlciIsImF2YXRhciIsImFib3V0IiwiYm9keSIsInVw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ci9EZXYveXRjbG9uZS9zZXJ2ZXIvc3JjL3JvdXRlcy8iLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBQcmlzbWFDbGllbnQgfSBmcm9tIFwiQHByaXNtYS9jbGllbnRcIjtcbmltcG9ydCBleHByZXNzIGZyb20gXCJleHByZXNzXCI7XG5pbXBvcnQgeyBnZXRBdXRoVXNlciwgcHJvdGVjdCB9IGZyb20gXCIuLi9taWRkbGV3YXJlL2F1dGhvcml6YXRpb25cIjtcbmltcG9ydCB7IGdldFZpZGVvVmlld3MgfSBmcm9tIFwiLi92aWRlb1wiO1xuXG5jb25zdCBwcmlzbWEgPSBuZXcgUHJpc21hQ2xpZW50KCk7XG5cbmZ1bmN0aW9uIGdldFVzZXJSb3V0ZXMoKSB7XG4gIGNvbnN0IHJvdXRlciA9IGV4cHJlc3MuUm91dGVyKCk7XG5cbiAgcm91dGVyLmdldChcIi9cIiwgcHJvdGVjdCwgZ2V0UmVjb21tZW5kZWRDaGFubmVscyk7XG4gIHJvdXRlci5wdXQoXCIvXCIsIHByb3RlY3QsIGVkaXRVc2VyKTtcblxuICByb3V0ZXIuZ2V0KFwiL2xpa2VkLXZpZGVvc1wiLCBwcm90ZWN0LCBnZXRMaWtlZFZpZGVvcyk7XG4gIHJvdXRlci5nZXQoXCIvaGlzdG9yeVwiLCBwcm90ZWN0LCBnZXRIaXN0b3J5KTtcbiAgcm91dGVyLmdldChcIi9zdWJzY3JpcHRpb25zXCIsIHByb3RlY3QsIGdldEZlZWQpO1xuICByb3V0ZXIuZ2V0KFwiL3NlYXJjaFwiLCBnZXRBdXRoVXNlciwgc2VhcmNoVXNlcik7XG5cbiAgcm91dGVyLmdldChcIi86dXNlcklkXCIsIGdldEF1dGhVc2VyLCBnZXRQcm9maWxlKTtcbiAgcm91dGVyLmdldChcIi86dXNlcklkL3RvZ2dsZS1zdWJzY3JpYmVcIiwgcHJvdGVjdCwgdG9nZ2xlU3Vic2NyaWJlKTtcblxuICByZXR1cm4gcm91dGVyO1xufVxuXG5hc3luYyBmdW5jdGlvbiBnZXRMaWtlZFZpZGVvcyhyZXEsIHJlcykge1xuICBhd2FpdCBnZXRWaWRlb3MocHJpc21hLnZpZGVvTGlrZSwgcmVxLCByZXMpO1xufVxuXG5hc3luYyBmdW5jdGlvbiBnZXRIaXN0b3J5KHJlcSwgcmVzKSB7XG4gIGF3YWl0IGdldFZpZGVvcyhwcmlzbWEudmlldywgcmVxLCByZXMpO1xufVxuXG5hc3luYyBmdW5jdGlvbiBnZXRWaWRlb3MobW9kZWwsIHJlcSwgcmVzKSB7XG4gIGNvbnN0IHZpZGVvUmVsYXRpb25zID0gYXdhaXQgbW9kZWwuZmluZE1hbnkoe1xuICAgIHdoZXJlOiB7XG4gICAgICB1c2VySWQ6IHJlcS51c2VyLmlkLFxuICAgIH0sXG4gICAgb3JkZXJCeToge1xuICAgICAgY3JlYXRlZEF0OiBcImRlc2NcIixcbiAgICB9LFxuICB9KTtcblxuICBjb25zdCB2aWRlb0lkcyA9IHZpZGVvUmVsYXRpb25zLm1hcCgodmlkZW9MaWtlKSA9PiB2aWRlb0xpa2UudmlkZW9JZCk7XG5cbiAgbGV0IHZpZGVvcyA9IGF3YWl0IHByaXNtYS52aWRlby5maW5kTWFueSh7XG4gICAgd2hlcmU6IHtcbiAgICAgIGlkOiB7XG4gICAgICAgIGluOiB2aWRlb0lkcyxcbiAgICAgIH0sXG4gICAgfSxcbiAgICBpbmNsdWRlOiB7XG4gICAgICB1c2VyOiB0cnVlLFxuICAgIH0sXG4gIH0pO1xuXG4gIGlmICghdmlkZW9zLmxlbmd0aCkge1xuICAgIHJldHVybiByZXMuc3RhdHVzKDIwMCkuanNvbih7IHZpZGVvcyB9KTtcbiAgfVxuXG4gIHZpZGVvcyA9IGF3YWl0IGdldFZpZGVvVmlld3ModmlkZW9zKTtcblxuICByZXMuc3RhdHVzKDIwMCkuanNvbih7IHZpZGVvcyB9KTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gdG9nZ2xlU3Vic2NyaWJlKHJlcSwgcmVzLCBuZXh0KSB7XG4gIGlmIChyZXEudXNlci5pZCA9PT0gcmVxLnBhcmFtcy51c2VySWQpIHtcbiAgICByZXR1cm4gbmV4dCh7XG4gICAgICBtZXNzYWdlOiBcIllvdSBjYW5ub3Qgc3Vic2NyaWJlIHRvIHlvdXIgb3duIGNoYW5uZWxcIixcbiAgICAgIHN0YXR1c0NvZGU6IDQwMCxcbiAgICB9KTtcbiAgfVxuXG4gIGNvbnN0IHVzZXIgPSBhd2FpdCBwcmlzbWEudXNlci5maW5kVW5pcXVlKHtcbiAgICB3aGVyZToge1xuICAgICAgaWQ6IHJlcS5wYXJhbXMudXNlcklkLFxuICAgIH0sXG4gIH0pO1xuXG4gIGlmICghdXNlcikge1xuICAgIHJldHVybiBuZXh0KHtcbiAgICAgIG1lc3NhZ2U6IGBObyB1c2VyIGZvdW5kIHdpdGggaWQ6IFwiJHtyZXEucGFyYW1zLnVzZXJJZH1cImAsXG4gICAgICBzdGF0dXNDb2RlOiA0MDQsXG4gICAgfSk7XG4gIH1cblxuICBjb25zdCBpc1N1YnNjcmliZWQgPSBhd2FpdCBwcmlzbWEuc3Vic2NyaXB0aW9uLmZpbmRGaXJzdCh7XG4gICAgd2hlcmU6IHtcbiAgICAgIHN1YnNjcmliZXJJZDoge1xuICAgICAgICBlcXVhbHM6IHJlcS51c2VyLmlkLFxuICAgICAgfSxcbiAgICAgIHN1YnNjcmliZWRUb0lkOiB7XG4gICAgICAgIGVxdWFsczogcmVxLnBhcmFtcy51c2VySWQsXG4gICAgICB9LFxuICAgIH0sXG4gIH0pO1xuXG4gIGlmIChpc1N1YnNjcmliZWQpIHtcbiAgICBhd2FpdCBwcmlzbWEuc3Vic2NyaXB0aW9uLmRlbGV0ZSh7XG4gICAgICB3aGVyZToge1xuICAgICAgICBpZDogaXNTdWJzY3JpYmVkLmlkLFxuICAgICAgfSxcbiAgICB9KTtcbiAgfSBlbHNlIHtcbiAgICBhd2FpdCBwcmlzbWEuc3Vic2NyaXB0aW9uLmNyZWF0ZSh7XG4gICAgICBkYXRhOiB7XG4gICAgICAgIHN1YnNjcmliZXI6IHtcbiAgICAgICAgICBjb25uZWN0OiB7XG4gICAgICAgICAgICBpZDogcmVxLnVzZXIuaWQsXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAgc3Vic2NyaWJlZFRvOiB7XG4gICAgICAgICAgY29ubmVjdDoge1xuICAgICAgICAgICAgaWQ6IHJlcS5wYXJhbXMudXNlcklkLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgIH0pO1xuICB9XG5cbiAgcmVzLnN0YXR1cygyMDApLmpzb24oe30pO1xufVxuXG5hc3luYyBmdW5jdGlvbiBnZXRGZWVkKHJlcSwgcmVzKSB7XG4gIGNvbnN0IHN1YnNjcmliZWRUbyA9IGF3YWl0IHByaXNtYS5zdWJzY3JpcHRpb24uZmluZE1hbnkoe1xuICAgIHdoZXJlOiB7XG4gICAgICBzdWJzY3JpYmVySWQ6IHtcbiAgICAgICAgZXF1YWxzOiByZXEudXNlci5pZCxcbiAgICAgIH0sXG4gICAgfSxcbiAgfSk7XG5cbiAgY29uc3Qgc3Vic2NyaXB0aW9ucyA9IHN1YnNjcmliZWRUby5tYXAoKHN1YikgPT4gc3ViLnN1YnNjcmliZWRUb0lkKTtcblxuICBjb25zdCBmZWVkID0gYXdhaXQgcHJpc21hLnZpZGVvLmZpbmRNYW55KHtcbiAgICB3aGVyZToge1xuICAgICAgdXNlcklkOiB7XG4gICAgICAgIGluOiBzdWJzY3JpcHRpb25zLFxuICAgICAgfSxcbiAgICB9LFxuICAgIGluY2x1ZGU6IHtcbiAgICAgIHVzZXI6IHRydWUsXG4gICAgfSxcbiAgICBvcmRlckJ5OiB7XG4gICAgICBjcmVhdGVkQXQ6IFwiZGVzY1wiLFxuICAgIH0sXG4gIH0pO1xuXG4gIGlmICghZmVlZC5sZW5ndGgpIHtcbiAgICByZXR1cm4gcmVzLnN0YXR1cygyMDApLmpzb24oeyBmZWVkIH0pO1xuICB9XG5cbiAgY29uc3QgZmVlZFZpZGVvcyA9IGF3YWl0IGdldFZpZGVvVmlld3MoZmVlZCk7XG5cbiAgcmVzLnN0YXR1cygyMDApLmpzb24oeyBmZWVkOiBmZWVkVmlkZW9zIH0pO1xufVxuXG5hc3luYyBmdW5jdGlvbiBzZWFyY2hVc2VyKHJlcSwgcmVzLCBuZXh0KSB7XG4gIGlmICghcmVxLnF1ZXJ5LnF1ZXJ5KSB7XG4gICAgcmV0dXJuIG5leHQoe1xuICAgICAgbWVzc2FnZTogXCJQbGVhc2UgZW50ZXIgYSBzZWFyY2ggcXVlcnlcIixcbiAgICAgIHN0YXR1c0NvZGU6IDQwMCxcbiAgICB9KTtcbiAgfVxuXG4gIGNvbnN0IHVzZXJzID0gYXdhaXQgcHJpc21hLnVzZXIuZmluZE1hbnkoe1xuICAgIHdoZXJlOiB7XG4gICAgICB1c2VybmFtZToge1xuICAgICAgICBjb250YWluczogcmVxLnF1ZXJ5LnF1ZXJ5LFxuICAgICAgICBtb2RlOiBcImluc2Vuc2l0aXZlXCIsXG4gICAgICB9LFxuICAgIH0sXG4gIH0pO1xuXG4gIGlmICghdXNlcnMubGVuZ3RoKSB7XG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoMjAwKS5qc29uKHsgdXNlcnMgfSk7XG4gIH1cblxuICBmb3IgKGNvbnN0IHVzZXIgb2YgdXNlcnMpIHtcbiAgICBjb25zdCBzdWJzY3JpYmVyc0NvdW50ID0gYXdhaXQgcHJpc21hLnN1YnNjcmlwdGlvbi5jb3VudCh7XG4gICAgICB3aGVyZToge1xuICAgICAgICBzdWJzY3JpYmVkVG9JZDoge1xuICAgICAgICAgIGVxdWFsczogdXNlci5pZCxcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgfSk7XG5cbiAgICBjb25zdCB2aWRlb3NDb3VudCA9IGF3YWl0IHByaXNtYS52aWRlby5jb3VudCh7XG4gICAgICB3aGVyZToge1xuICAgICAgICB1c2VySWQ6IHVzZXIuaWQsXG4gICAgICB9LFxuICAgIH0pO1xuXG4gICAgbGV0IGlzTWUgPSBmYWxzZTtcbiAgICBsZXQgaXNTdWJzY3JpYmVkID0gZmFsc2U7XG5cbiAgICBpZiAocmVxLnVzZXIpIHtcbiAgICAgIGlzTWUgPSByZXEudXNlci5pZCA9PT0gdXNlci5pZDtcblxuICAgICAgaXNTdWJzY3JpYmVkID0gYXdhaXQgcHJpc21hLnN1YnNjcmlwdGlvbi5maW5kRmlyc3Qoe1xuICAgICAgICB3aGVyZToge1xuICAgICAgICAgIEFORDoge1xuICAgICAgICAgICAgc3Vic2NyaWJlcklkOiB7XG4gICAgICAgICAgICAgIGVxdWFsczogcmVxLnVzZXIuaWQsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgc3Vic2NyaWJlZFRvSWQ6IHtcbiAgICAgICAgICAgICAgZXF1YWxzOiB1c2VyLmlkLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgdXNlci5zdWJzY3JpYmVyc0NvdW50ID0gc3Vic2NyaWJlcnNDb3VudDtcbiAgICB1c2VyLnZpZGVvc0NvdW50ID0gdmlkZW9zQ291bnQ7XG4gICAgdXNlci5pc1N1YnNjcmliZWQgPSBCb29sZWFuKGlzU3Vic2NyaWJlZCk7XG4gICAgdXNlci5pc01lID0gaXNNZTtcbiAgfVxuXG4gIHJlcy5zdGF0dXMoMjAwKS5qc29uKHsgdXNlcnMgfSk7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGdldFJlY29tbWVuZGVkQ2hhbm5lbHMocmVxLCByZXMpIHtcbiAgY29uc3QgY2hhbm5lbHMgPSBhd2FpdCBwcmlzbWEudXNlci5maW5kTWFueSh7XG4gICAgd2hlcmU6IHtcbiAgICAgIGlkOiB7XG4gICAgICAgIG5vdDogcmVxLnVzZXIuaWQsXG4gICAgICB9LFxuICAgIH0sXG4gICAgdGFrZTogMTAsXG4gIH0pO1xuXG4gIGlmICghY2hhbm5lbHMubGVuZ3RoKSB7XG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoMjAwKS5qc29uKHsgY2hhbm5lbHMgfSk7XG4gIH1cblxuICBmb3IgKGNvbnN0IGNoYW5uZWwgb2YgY2hhbm5lbHMpIHtcbiAgICBjb25zdCBzdWJzY3JpYmVyc0NvdW50ID0gYXdhaXQgcHJpc21hLnN1YnNjcmlwdGlvbi5jb3VudCh7XG4gICAgICB3aGVyZToge1xuICAgICAgICBzdWJzY3JpYmVkVG9JZDoge1xuICAgICAgICAgIGVxdWFsczogY2hhbm5lbC5pZCxcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgfSk7XG5cbiAgICBjb25zdCB2aWRlb3NDb3VudCA9IGF3YWl0IHByaXNtYS52aWRlby5jb3VudCh7XG4gICAgICB3aGVyZToge1xuICAgICAgICB1c2VySWQ6IGNoYW5uZWwuaWQsXG4gICAgICB9LFxuICAgIH0pO1xuXG4gICAgY29uc3QgaXNTdWJzY3JpYmVkID0gYXdhaXQgcHJpc21hLnN1YnNjcmlwdGlvbi5maW5kRmlyc3Qoe1xuICAgICAgd2hlcmU6IHtcbiAgICAgICAgQU5EOiB7XG4gICAgICAgICAgc3Vic2NyaWJlcklkOiB7XG4gICAgICAgICAgICBlcXVhbHM6IHJlcS51c2VyLmlkLFxuICAgICAgICAgIH0sXG4gICAgICAgICAgc3Vic2NyaWJlZFRvSWQ6IHtcbiAgICAgICAgICAgIGVxdWFsczogY2hhbm5lbC5pZCxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgfSxcbiAgICB9KTtcblxuICAgIGNoYW5uZWwuc3Vic2NyaWJlcnNDb3VudCA9IHN1YnNjcmliZXJzQ291bnQ7XG4gICAgY2hhbm5lbC52aWRlb3NDb3VudCA9IHZpZGVvc0NvdW50O1xuICAgIGNoYW5uZWwuaXNTdWJzY3JpYmVkID0gQm9vbGVhbihpc1N1YnNjcmliZWQpO1xuICB9XG5cbiAgcmVzLnN0YXR1cygyMDApLmpzb24oeyBjaGFubmVscyB9KTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gZ2V0UHJvZmlsZShyZXEsIHJlcywgbmV4dCkge1xuICBjb25zdCB1c2VyID0gYXdhaXQgcHJpc21hLnVzZXIuZmluZFVuaXF1ZSh7XG4gICAgd2hlcmU6IHtcbiAgICAgIGlkOiByZXEucGFyYW1zLnVzZXJJZCxcbiAgICB9LFxuICB9KTtcblxuICBpZiAoIXVzZXIpIHtcbiAgICByZXR1cm4gbmV4dCh7XG4gICAgICBtZXNzYWdlOiBgTm8gdXNlciBmb3VuZCB3aXRoIGlkOiBcIiR7cmVxLnBhcmFtcy51c2VySWR9XCJgLFxuICAgICAgc3RhdHVzQ29kZTogNDA0LFxuICAgIH0pO1xuICB9XG5cbiAgY29uc3Qgc3Vic2NyaWJlcnNDb3VudCA9IGF3YWl0IHByaXNtYS5zdWJzY3JpcHRpb24uY291bnQoe1xuICAgIHdoZXJlOiB7XG4gICAgICBzdWJzY3JpYmVkVG9JZDoge1xuICAgICAgICBlcXVhbHM6IHVzZXIuaWQsXG4gICAgICB9LFxuICAgIH0sXG4gIH0pO1xuXG4gIGxldCBpc01lID0gZmFsc2U7XG4gIGxldCBpc1N1YnNjcmliZWQgPSBmYWxzZTtcblxuICBpZiAocmVxLnVzZXIpIHtcbiAgICBpc01lID0gcmVxLnVzZXIuaWQgPT09IHVzZXIuaWQ7XG5cbiAgICBpc1N1YnNjcmliZWQgPSBhd2FpdCBwcmlzbWEuc3Vic2NyaXB0aW9uLmZpbmRGaXJzdCh7XG4gICAgICB3aGVyZToge1xuICAgICAgICBBTkQ6IHtcbiAgICAgICAgICBzdWJzY3JpYmVySWQ6IHtcbiAgICAgICAgICAgIGVxdWFsczogcmVxLnVzZXIuaWQsXG4gICAgICAgICAgfSxcbiAgICAgICAgICBzdWJzY3JpYmVkVG9JZDoge1xuICAgICAgICAgICAgZXF1YWxzOiB1c2VyLmlkLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgIH0pO1xuICB9XG5cbiAgY29uc3Qgc3Vic2NyaWJlZFRvID0gYXdhaXQgcHJpc21hLnN1YnNjcmlwdGlvbi5maW5kTWFueSh7XG4gICAgd2hlcmU6IHtcbiAgICAgIHN1YnNjcmliZXJJZDoge1xuICAgICAgICBlcXVhbHM6IHVzZXIuaWQsXG4gICAgICB9LFxuICAgIH0sXG4gIH0pO1xuXG4gIGNvbnN0IHN1YnNjcmlwdGlvbnMgPSBzdWJzY3JpYmVkVG8ubWFwKChzdWIpID0+IHN1Yi5zdWJzY3JpYmVkVG9JZCk7XG5cbiAgY29uc3QgY2hhbm5lbHMgPSBhd2FpdCBwcmlzbWEudXNlci5maW5kTWFueSh7XG4gICAgd2hlcmU6IHtcbiAgICAgIGlkOiB7XG4gICAgICAgIGluOiBzdWJzY3JpcHRpb25zLFxuICAgICAgfSxcbiAgICB9LFxuICB9KTtcblxuICBmb3IgKGNvbnN0IGNoYW5uZWwgb2YgY2hhbm5lbHMpIHtcbiAgICBjb25zdCBzdWJzY3JpYmVyc0NvdW50ID0gYXdhaXQgcHJpc21hLnN1YnNjcmlwdGlvbi5jb3VudCh7XG4gICAgICB3aGVyZToge1xuICAgICAgICBzdWJzY3JpYmVkVG9JZDoge1xuICAgICAgICAgIGVxdWFsczogY2hhbm5lbC5pZCxcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgfSk7XG4gICAgY2hhbm5lbC5zdWJzY3JpYmVyc0NvdW50ID0gc3Vic2NyaWJlcnNDb3VudDtcbiAgfVxuXG4gIGNvbnN0IHZpZGVvcyA9IGF3YWl0IHByaXNtYS52aWRlby5maW5kTWFueSh7XG4gICAgd2hlcmU6IHtcbiAgICAgIHVzZXJJZDoge1xuICAgICAgICBlcXVhbHM6IHVzZXIuaWQsXG4gICAgICB9LFxuICAgIH0sXG4gICAgb3JkZXJCeToge1xuICAgICAgY3JlYXRlZEF0OiBcImRlc2NcIixcbiAgICB9LFxuICB9KTtcblxuICB1c2VyLnN1YnNjcmliZXJzQ291bnQgPSBzdWJzY3JpYmVyc0NvdW50O1xuICB1c2VyLmlzU3Vic2NyaWJlZCA9IEJvb2xlYW4oaXNTdWJzY3JpYmVkKTtcbiAgdXNlci5pc01lID0gaXNNZTtcbiAgdXNlci5jaGFubmVscyA9IGNoYW5uZWxzO1xuICB1c2VyLnZpZGVvcyA9IHZpZGVvcztcblxuICBpZiAoIXZpZGVvcy5sZW5ndGgpIHtcbiAgICByZXR1cm4gcmVzLnN0YXR1cygyMDApLmpzb24oeyB1c2VyIH0pO1xuICB9XG5cbiAgdXNlci52aWRlb3MgPSBhd2FpdCBnZXRWaWRlb1ZpZXdzKHZpZGVvcyk7XG5cbiAgcmVzLnN0YXR1cygyMDApLmpzb24oeyB1c2VyIH0pO1xufVxuXG5hc3luYyBmdW5jdGlvbiBlZGl0VXNlcihyZXEsIHJlcykge1xuICBjb25zdCB7IHVzZXJuYW1lLCBjb3ZlciwgYXZhdGFyLCBhYm91dCB9ID0gcmVxLmJvZHk7XG5cbiAgY29uc3QgdXNlciA9IGF3YWl0IHByaXNtYS51c2VyLnVwZGF0ZSh7XG4gICAgd2hlcmU6IHtcbiAgICAgIGlkOiByZXEudXNlci5pZCxcbiAgICB9LFxuICAgIGRhdGE6IHtcbiAgICAgIHVzZXJuYW1lLFxuICAgICAgY292ZXIsXG4gICAgICBhdmF0YXIsXG4gICAgICBhYm91dCxcbiAgICB9LFxuICB9KTtcblxuICByZXMuc3RhdHVzKDIwMCkuanNvbih7IHVzZXIgfSk7XG59XG5cbmV4cG9ydCB7IGdldFVzZXJSb3V0ZXMgfTtcbiJdfQ==",
    "map": {
      "version": 3,
      "sources": [
        "user.js"
      ],
      "names": [
        "prisma",
        "PrismaClient",
        "getUserRoutes",
        "router",
        "express",
        "Router",
        "get",
        "protect",
        "getRecommendedChannels",
        "put",
        "editUser",
        "getLikedVideos",
        "getHistory",
        "getFeed",
        "getAuthUser",
        "searchUser",
        "getProfile",
        "toggleSubscribe",
        "req",
        "res",
        "getVideos",
        "videoLike",
        "view",
        "model",
        "videoRelations",
        "findMany",
        "where",
        "userId",
        "user",
        "id",
        "orderBy",
        "createdAt",
        "videoIds",
        "map",
        "videoId",
        "videos",
        "video",
        "in",
        "include",
        "length",
        "status",
        "json",
        "next",
        "params",
        "message",
        "statusCode",
        "findUnique",
        "isSubscribed",
        "subscription",
        "findFirst",
        "subscriberId",
        "equals",
        "subscribedToId",
        "delete",
        "create",
        "data",
        "subscriber",
        "connect",
        "subscribedTo",
        "subscriptions",
        "sub",
        "feed",
        "feedVideos",
        "query",
        "users",
        "username",
        "contains",
        "mode",
        "subscribersCount",
        "count",
        "videosCount",
        "isMe",
        "AND",
        "Boolean",
        "channels",
        "not",
        "take",
        "channel",
        "cover",
        "avatar",
        "about",
        "body",
        "update"
      ],
      "mappings": "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",
      "sourceRoot": "/Users/egor/Dev/ytclone/server/src/routes/",
      "sourcesContent": [
        "import { PrismaClient } from \"@prisma/client\";\nimport express from \"express\";\nimport { getAuthUser, protect } from \"../middleware/authorization\";\nimport { getVideoViews } from \"./video\";\n\nconst prisma = new PrismaClient();\n\nfunction getUserRoutes() {\n  const router = express.Router();\n\n  router.get(\"/\", protect, getRecommendedChannels);\n  router.put(\"/\", protect, editUser);\n\n  router.get(\"/liked-videos\", protect, getLikedVideos);\n  router.get(\"/history\", protect, getHistory);\n  router.get(\"/subscriptions\", protect, getFeed);\n  router.get(\"/search\", getAuthUser, searchUser);\n\n  router.get(\"/:userId\", getAuthUser, getProfile);\n  router.get(\"/:userId/toggle-subscribe\", protect, toggleSubscribe);\n\n  return router;\n}\n\nasync function getLikedVideos(req, res) {\n  await getVideos(prisma.videoLike, req, res);\n}\n\nasync function getHistory(req, res) {\n  await getVideos(prisma.view, req, res);\n}\n\nasync function getVideos(model, req, res) {\n  const videoRelations = await model.findMany({\n    where: {\n      userId: req.user.id,\n    },\n    orderBy: {\n      createdAt: \"desc\",\n    },\n  });\n\n  const videoIds = videoRelations.map((videoLike) => videoLike.videoId);\n\n  let videos = await prisma.video.findMany({\n    where: {\n      id: {\n        in: videoIds,\n      },\n    },\n    include: {\n      user: true,\n    },\n  });\n\n  if (!videos.length) {\n    return res.status(200).json({ videos });\n  }\n\n  videos = await getVideoViews(videos);\n\n  res.status(200).json({ videos });\n}\n\nasync function toggleSubscribe(req, res, next) {\n  if (req.user.id === req.params.userId) {\n    return next({\n      message: \"You cannot subscribe to your own channel\",\n      statusCode: 400,\n    });\n  }\n\n  const user = await prisma.user.findUnique({\n    where: {\n      id: req.params.userId,\n    },\n  });\n\n  if (!user) {\n    return next({\n      message: `No user found with id: \"${req.params.userId}\"`,\n      statusCode: 404,\n    });\n  }\n\n  const isSubscribed = await prisma.subscription.findFirst({\n    where: {\n      subscriberId: {\n        equals: req.user.id,\n      },\n      subscribedToId: {\n        equals: req.params.userId,\n      },\n    },\n  });\n\n  if (isSubscribed) {\n    await prisma.subscription.delete({\n      where: {\n        id: isSubscribed.id,\n      },\n    });\n  } else {\n    await prisma.subscription.create({\n      data: {\n        subscriber: {\n          connect: {\n            id: req.user.id,\n          },\n        },\n        subscribedTo: {\n          connect: {\n            id: req.params.userId,\n          },\n        },\n      },\n    });\n  }\n\n  res.status(200).json({});\n}\n\nasync function getFeed(req, res) {\n  const subscribedTo = await prisma.subscription.findMany({\n    where: {\n      subscriberId: {\n        equals: req.user.id,\n      },\n    },\n  });\n\n  const subscriptions = subscribedTo.map((sub) => sub.subscribedToId);\n\n  const feed = await prisma.video.findMany({\n    where: {\n      userId: {\n        in: subscriptions,\n      },\n    },\n    include: {\n      user: true,\n    },\n    orderBy: {\n      createdAt: \"desc\",\n    },\n  });\n\n  if (!feed.length) {\n    return res.status(200).json({ feed });\n  }\n\n  const feedVideos = await getVideoViews(feed);\n\n  res.status(200).json({ feed: feedVideos });\n}\n\nasync function searchUser(req, res, next) {\n  if (!req.query.query) {\n    return next({\n      message: \"Please enter a search query\",\n      statusCode: 400,\n    });\n  }\n\n  const users = await prisma.user.findMany({\n    where: {\n      username: {\n        contains: req.query.query,\n        mode: \"insensitive\",\n      },\n    },\n  });\n\n  if (!users.length) {\n    return res.status(200).json({ users });\n  }\n\n  for (const user of users) {\n    const subscribersCount = await prisma.subscription.count({\n      where: {\n        subscribedToId: {\n          equals: user.id,\n        },\n      },\n    });\n\n    const videosCount = await prisma.video.count({\n      where: {\n        userId: user.id,\n      },\n    });\n\n    let isMe = false;\n    let isSubscribed = false;\n\n    if (req.user) {\n      isMe = req.user.id === user.id;\n\n      isSubscribed = await prisma.subscription.findFirst({\n        where: {\n          AND: {\n            subscriberId: {\n              equals: req.user.id,\n            },\n            subscribedToId: {\n              equals: user.id,\n            },\n          },\n        },\n      });\n    }\n\n    user.subscribersCount = subscribersCount;\n    user.videosCount = videosCount;\n    user.isSubscribed = Boolean(isSubscribed);\n    user.isMe = isMe;\n  }\n\n  res.status(200).json({ users });\n}\n\nasync function getRecommendedChannels(req, res) {\n  const channels = await prisma.user.findMany({\n    where: {\n      id: {\n        not: req.user.id,\n      },\n    },\n    take: 10,\n  });\n\n  if (!channels.length) {\n    return res.status(200).json({ channels });\n  }\n\n  for (const channel of channels) {\n    const subscribersCount = await prisma.subscription.count({\n      where: {\n        subscribedToId: {\n          equals: channel.id,\n        },\n      },\n    });\n\n    const videosCount = await prisma.video.count({\n      where: {\n        userId: channel.id,\n      },\n    });\n\n    const isSubscribed = await prisma.subscription.findFirst({\n      where: {\n        AND: {\n          subscriberId: {\n            equals: req.user.id,\n          },\n          subscribedToId: {\n            equals: channel.id,\n          },\n        },\n      },\n    });\n\n    channel.subscribersCount = subscribersCount;\n    channel.videosCount = videosCount;\n    channel.isSubscribed = Boolean(isSubscribed);\n  }\n\n  res.status(200).json({ channels });\n}\n\nasync function getProfile(req, res, next) {\n  const user = await prisma.user.findUnique({\n    where: {\n      id: req.params.userId,\n    },\n  });\n\n  if (!user) {\n    return next({\n      message: `No user found with id: \"${req.params.userId}\"`,\n      statusCode: 404,\n    });\n  }\n\n  const subscribersCount = await prisma.subscription.count({\n    where: {\n      subscribedToId: {\n        equals: user.id,\n      },\n    },\n  });\n\n  let isMe = false;\n  let isSubscribed = false;\n\n  if (req.user) {\n    isMe = req.user.id === user.id;\n\n    isSubscribed = await prisma.subscription.findFirst({\n      where: {\n        AND: {\n          subscriberId: {\n            equals: req.user.id,\n          },\n          subscribedToId: {\n            equals: user.id,\n          },\n        },\n      },\n    });\n  }\n\n  const subscribedTo = await prisma.subscription.findMany({\n    where: {\n      subscriberId: {\n        equals: user.id,\n      },\n    },\n  });\n\n  const subscriptions = subscribedTo.map((sub) => sub.subscribedToId);\n\n  const channels = await prisma.user.findMany({\n    where: {\n      id: {\n        in: subscriptions,\n      },\n    },\n  });\n\n  for (const channel of channels) {\n    const subscribersCount = await prisma.subscription.count({\n      where: {\n        subscribedToId: {\n          equals: channel.id,\n        },\n      },\n    });\n    channel.subscribersCount = subscribersCount;\n  }\n\n  const videos = await prisma.video.findMany({\n    where: {\n      userId: {\n        equals: user.id,\n      },\n    },\n    orderBy: {\n      createdAt: \"desc\",\n    },\n  });\n\n  user.subscribersCount = subscribersCount;\n  user.isSubscribed = Boolean(isSubscribed);\n  user.isMe = isMe;\n  user.channels = channels;\n  user.videos = videos;\n\n  if (!videos.length) {\n    return res.status(200).json({ user });\n  }\n\n  user.videos = await getVideoViews(videos);\n\n  res.status(200).json({ user });\n}\n\nasync function editUser(req, res) {\n  const { username, cover, avatar, about } = req.body;\n\n  const user = await prisma.user.update({\n    where: {\n      id: req.user.id,\n    },\n    data: {\n      username,\n      cover,\n      avatar,\n      about,\n    },\n  });\n\n  res.status(200).json({ user });\n}\n\nexport { getUserRoutes };\n"
      ]
    },
    "sourceType": "script",
    "mtime": 1611426347000
  },
  "{\"sourceRoot\":\"/Users/egor/Dev/ytclone/server/src/routes/\",\"caller\":{\"name\":\"@babel/register\"},\"cwd\":\"/Users/egor/Dev/ytclone\",\"filename\":\"/Users/egor/Dev/ytclone/server/src/routes/video.js\",\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"/Users/egor/Dev/ytclone\",\"plugins\":[{\"key\":\"syntax-numeric-separator\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"proposal-logical-assignment-operators\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"AssignmentExpression\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-nullish-coalescing-operator\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-optional-chaining\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-json-strings\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-optional-catch-binding\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-async-generators\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-object-rest-spread\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"transform-modules-commonjs\",\"visitor\":{\"CallExpression\":{\"enter\":[null]},\"Program\":{\"exit\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"proposal-dynamic-import\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"Program\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"proposal-export-namespace-from\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"ExportNamedDeclaration\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}}],\"presets\":[]}:7.12.10": {
    "metadata": {},
    "options": {
      "sourceRoot": "/Users/egor/Dev/ytclone/server/src/routes/",
      "caller": {
        "name": "@babel/register"
      },
      "cwd": "/Users/egor/Dev/ytclone",
      "filename": "/Users/egor/Dev/ytclone/server/src/routes/video.js",
      "cloneInputAst": true,
      "babelrc": false,
      "configFile": false,
      "envName": "development",
      "root": "/Users/egor/Dev/ytclone",
      "sourceMaps": "both",
      "ast": false,
      "passPerPreset": false,
      "plugins": [
        {
          "key": "syntax-numeric-separator",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "proposal-logical-assignment-operators",
          "visitor": {
            "_exploded": {},
            "_verified": {},
            "AssignmentExpression": {
              "enter": [
                null
              ]
            }
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-nullish-coalescing-operator",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-optional-chaining",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-json-strings",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-optional-catch-binding",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-async-generators",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-object-rest-spread",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "transform-modules-commonjs",
          "visitor": {
            "CallExpression": {
              "enter": [
                null
              ]
            },
            "Program": {
              "exit": [
                null
              ]
            },
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "proposal-dynamic-import",
          "visitor": {
            "_exploded": {},
            "_verified": {},
            "Program": {
              "enter": [
                null
              ]
            }
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "proposal-export-namespace-from",
          "visitor": {
            "_exploded": {},
            "_verified": {},
            "ExportNamedDeclaration": {
              "enter": [
                null
              ]
            }
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        }
      ],
      "presets": [],
      "parserOpts": {
        "sourceType": "module",
        "sourceFileName": "/Users/egor/Dev/ytclone/server/src/routes/video.js",
        "plugins": [
          "numericSeparator",
          "logicalAssignment",
          "nullishCoalescingOperator",
          "optionalChaining",
          "jsonStrings",
          "optionalCatchBinding",
          "asyncGenerators",
          "objectRestSpread",
          "dynamicImport",
          "exportNamespaceFrom"
        ]
      },
      "generatorOpts": {
        "filename": "/Users/egor/Dev/ytclone/server/src/routes/video.js",
        "comments": true,
        "compact": "auto",
        "sourceMaps": "both",
        "sourceRoot": "/Users/egor/Dev/ytclone/server/src/routes/",
        "sourceFileName": "video.js"
      }
    },
    "ast": null,
    "code": "\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.getVideoViews = getVideoViews;\nexports.getVideoRoutes = getVideoRoutes;\n\nvar _client = require(\"@prisma/client\");\n\nvar _express = _interopRequireDefault(require(\"express\"));\n\nvar _authorization = require(\"../middleware/authorization\");\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nconst prisma = new _client.PrismaClient();\n\nfunction getVideoRoutes() {\n  const router = _express.default.Router();\n\n  router.get(\"/\", getRecommendedVideos);\n  router.post(\"/\", _authorization.protect, addVideo);\n  router.get(\"/trending\", getTrendingVideos);\n  router.get(\"/search\", searchVideos);\n  router.get(\"/:videoId\", _authorization.getAuthUser, getVideo);\n  router.delete(\"/:videoId\", _authorization.protect, deleteVideo);\n  router.get(\"/:videoId/view\", _authorization.getAuthUser, addVideoView);\n  router.get(\"/:videoId/like\", _authorization.protect, likeVideo);\n  router.get(\"/:videoId/dislike\", _authorization.protect, dislikeVideo);\n  router.post(\"/:videoId/comments\", _authorization.protect, addComment);\n  router.delete(\"/:videoId/comments/:commentId\", _authorization.protect, deleteComment);\n  return router;\n}\n\nasync function getVideoViews(videos) {\n  for (const video of videos) {\n    const views = await prisma.view.count({\n      where: {\n        videoId: {\n          equals: video.id\n        }\n      }\n    });\n    video.views = views;\n  }\n\n  return videos;\n}\n\nasync function getRecommendedVideos(req, res) {\n  let videos = await prisma.video.findMany({\n    include: {\n      user: true\n    },\n    orderBy: {\n      createdAt: \"desc\"\n    }\n  });\n\n  if (!videos.length) {\n    return res.status(200).json({\n      videos\n    });\n  }\n\n  videos = await getVideoViews(videos);\n  res.status(200).json({\n    videos\n  });\n}\n\nasync function getTrendingVideos(req, res) {\n  let videos = await prisma.video.findMany({\n    include: {\n      user: true\n    },\n    orderBy: {\n      createdAt: \"desc\"\n    }\n  });\n\n  if (!videos.length) {\n    return res.status(200).json({\n      videos\n    });\n  }\n\n  videos = await getVideoViews(videos);\n  videos.sort((a, b) => b.views - a.views);\n  res.status(200).json({\n    videos\n  });\n}\n\nasync function searchVideos(req, res, next) {\n  if (!req.query.query) {\n    return next({\n      message: \"Please enter a search query\",\n      statusCode: 400\n    });\n  }\n\n  let videos = await prisma.video.findMany({\n    include: {\n      user: true\n    },\n    where: {\n      OR: [{\n        title: {\n          contains: req.query.query,\n          mode: \"insensitive\"\n        }\n      }, {\n        description: {\n          contains: req.query.query,\n          mode: \"insensitive\"\n        }\n      }]\n    }\n  });\n\n  if (!videos.length) {\n    return res.status(200).json({\n      videos\n    });\n  }\n\n  videos = await getVideoViews(videos);\n  res.status(200).json({\n    videos\n  });\n}\n\nasync function addVideo(req, res) {\n  const {\n    title,\n    description,\n    url,\n    thumbnail\n  } = req.body;\n  const video = await prisma.video.create({\n    data: {\n      title,\n      description,\n      url,\n      thumbnail,\n      user: {\n        connect: {\n          id: req.user.id\n        }\n      }\n    }\n  });\n  res.status(200).json({\n    video\n  });\n}\n\nasync function addComment(req, res, next) {\n  const video = await prisma.video.findUnique({\n    where: {\n      id: req.params.videoId\n    }\n  });\n\n  if (!video) {\n    return next({\n      message: `No video found with id: \"${req.params.videoId}\"`,\n      statusCode: 404\n    });\n  }\n\n  const comment = await prisma.comment.create({\n    data: {\n      text: req.body.text,\n      user: {\n        connect: {\n          id: req.user.id\n        }\n      },\n      video: {\n        connect: {\n          id: req.params.videoId\n        }\n      }\n    }\n  });\n  res.status(200).json({\n    comment\n  });\n}\n\nasync function deleteComment(req, res) {\n  const comment = await prisma.comment.findUnique({\n    where: {\n      id: req.params.commentId\n    },\n    select: {\n      userId: true\n    }\n  });\n\n  if (comment.userId !== req.user.id) {\n    return res.status(401).send(\"You are not authorized to delete this comment\");\n  }\n\n  await prisma.comment.delete({\n    where: {\n      id: req.params.commentId\n    }\n  });\n  res.status(200).json({});\n}\n\nasync function addVideoView(req, res, next) {\n  const video = await prisma.video.findUnique({\n    where: {\n      id: req.params.videoId\n    }\n  });\n\n  if (!video) {\n    return next({\n      message: `No video found with id: \"${req.params.videoId}\"`,\n      statusCode: 404\n    });\n  }\n\n  if (req.user) {\n    await prisma.view.create({\n      data: {\n        video: {\n          connect: {\n            id: req.params.videoId\n          }\n        },\n        user: {\n          connect: {\n            id: req.user.id\n          }\n        }\n      }\n    });\n  } else {\n    await prisma.view.create({\n      data: {\n        video: {\n          connect: {\n            id: req.params.videoId\n          }\n        }\n      }\n    });\n  }\n\n  res.status(200).json({});\n}\n\nasync function likeVideo(req, res, next) {\n  const video = await prisma.video.findUnique({\n    where: {\n      id: req.params.videoId\n    }\n  });\n\n  if (!video) {\n    return next({\n      message: `No video found with id: \"${req.params.videoId}\"`,\n      statusCode: 404\n    });\n  }\n\n  const isLiked = await prisma.videoLike.findFirst({\n    where: {\n      userId: {\n        equals: req.user.id\n      },\n      videoId: {\n        equals: req.params.videoId\n      },\n      like: {\n        equals: 1\n      }\n    }\n  });\n  const isDisliked = await prisma.videoLike.findFirst({\n    where: {\n      userId: {\n        equals: req.user.id\n      },\n      videoId: {\n        equals: req.params.videoId\n      },\n      like: {\n        equals: -1\n      }\n    }\n  });\n\n  if (isLiked) {\n    await prisma.videoLike.delete({\n      where: {\n        id: isLiked.id\n      }\n    });\n  } else if (isDisliked) {\n    await prisma.videoLike.update({\n      where: {\n        id: isDisliked.id\n      },\n      data: {\n        like: 1\n      }\n    });\n  } else {\n    await prisma.videoLike.create({\n      data: {\n        user: {\n          connect: {\n            id: req.user.id\n          }\n        },\n        video: {\n          connect: {\n            id: req.params.videoId\n          }\n        },\n        like: 1\n      }\n    });\n  }\n\n  res.status(200).json({});\n}\n\nasync function dislikeVideo(req, res, next) {\n  const video = await prisma.video.findUnique({\n    where: {\n      id: req.params.videoId\n    }\n  });\n\n  if (!video) {\n    return next({\n      message: `No video found with id: \"${req.params.videoId}\"`,\n      statusCode: 404\n    });\n  }\n\n  const isLiked = await prisma.videoLike.findFirst({\n    where: {\n      userId: {\n        equals: req.user.id\n      },\n      videoId: {\n        equals: req.params.videoId\n      },\n      like: {\n        equals: 1\n      }\n    }\n  });\n  const isDisliked = await prisma.videoLike.findFirst({\n    where: {\n      userId: {\n        equals: req.user.id\n      },\n      videoId: {\n        equals: req.params.videoId\n      },\n      like: {\n        equals: -1\n      }\n    }\n  });\n\n  if (isDisliked) {\n    await prisma.videoLike.delete({\n      where: {\n        id: isDisliked.id\n      }\n    });\n  } else if (isLiked) {\n    await prisma.videoLike.update({\n      where: {\n        id: isLiked.id\n      },\n      data: {\n        like: -1\n      }\n    });\n  } else {\n    await prisma.videoLike.create({\n      data: {\n        user: {\n          connect: {\n            id: req.user.id\n          }\n        },\n        video: {\n          connect: {\n            id: req.params.videoId\n          }\n        },\n        like: -1\n      }\n    });\n  }\n\n  res.status(200).json({});\n}\n\nasync function getVideo(req, res, next) {\n  const video = await prisma.video.findUnique({\n    where: {\n      id: req.params.videoId\n    },\n    include: {\n      user: true,\n      comments: {\n        include: {\n          user: true\n        },\n        orderBy: {\n          createdAt: \"desc\"\n        }\n      }\n    }\n  });\n\n  if (!video) {\n    return next({\n      message: `No video found with id: \"${req.params.videoId}\"`,\n      statusCode: 404\n    });\n  }\n\n  let isVideoMine = false;\n  let isLiked = false;\n  let isDisliked = false;\n  let isSubscribed = false;\n  let isViewed = false;\n\n  if (req.user) {\n    isVideoMine = req.user.id === video.userId;\n    isLiked = await prisma.videoLike.findFirst({\n      where: {\n        userId: {\n          equals: req.user.id\n        },\n        videoId: {\n          equals: req.params.videoId\n        },\n        like: {\n          equals: 1\n        }\n      }\n    });\n    isDisliked = await prisma.videoLike.findFirst({\n      where: {\n        userId: {\n          equals: req.user.id\n        },\n        videoId: {\n          equals: req.params.videoId\n        },\n        like: {\n          equals: -1\n        }\n      }\n    });\n    isViewed = await prisma.view.findFirst({\n      where: {\n        userId: {\n          equals: req.user.id\n        },\n        videoId: {\n          equals: video.id\n        }\n      }\n    });\n    isSubscribed = await prisma.subscription.findFirst({\n      where: {\n        subscriberId: {\n          equals: req.user.id\n        },\n        subscribedToId: {\n          equals: video.userId\n        }\n      }\n    });\n  }\n\n  const likesCount = await prisma.videoLike.count({\n    where: {\n      AND: {\n        videoId: {\n          equals: req.params.videoId\n        },\n        like: {\n          equals: 1\n        }\n      }\n    }\n  });\n  const dislikesCount = await prisma.videoLike.count({\n    where: {\n      AND: {\n        videoId: {\n          equals: req.params.videoId\n        },\n        like: {\n          equals: -1\n        }\n      }\n    }\n  });\n  const views = await prisma.view.count({\n    where: {\n      videoId: {\n        equals: video.id\n      }\n    }\n  });\n  const subscribersCount = await prisma.subscription.count({\n    where: {\n      subscribedToId: {\n        equals: video.userId\n      }\n    }\n  });\n  video.commentsCount = video.comments.length;\n  video.isLiked = Boolean(isLiked);\n  video.isDisliked = Boolean(isDisliked);\n  video.likesCount = likesCount;\n  video.dislikesCount = dislikesCount;\n  video.isVideoMine = isVideoMine;\n  video.views = views;\n  video.isSubscribed = Boolean(isSubscribed);\n  video.isViewed = Boolean(isViewed);\n  video.subscribersCount = subscribersCount;\n  res.status(200).json({\n    video\n  });\n}\n\nasync function deleteVideo(req, res) {\n  const video = await prisma.video.findUnique({\n    where: {\n      id: req.params.videoId\n    },\n    select: {\n      userId: true\n    }\n  });\n\n  if (req.user.id !== video.userId) {\n    return res.status(401).send(\"You are not authorized to delete this video\");\n  }\n\n  await prisma.view.deleteMany({\n    where: {\n      videoId: {\n        equals: req.params.videoId\n      }\n    }\n  });\n  await prisma.videoLike.deleteMany({\n    where: {\n      videoId: {\n        equals: req.params.videoId\n      }\n    }\n  });\n  await prisma.comment.deleteMany({\n    where: {\n      videoId: {\n        equals: req.params.videoId\n      }\n    }\n  });\n  await prisma.video.delete({\n    where: {\n      id: req.params.videoId\n    }\n  });\n  res.status(200).json({});\n}\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInZpZGVvLmpzIl0sIm5hbWVzIjpbInByaXNtYSIsIlByaXNtYUNsaWVudCIsImdldFZpZGVvUm91dGVzIiwicm91dGVyIiwiZXhwcmVzcyIsIlJvdXRlciIsImdldCIsImdldFJlY29tbWVuZGVkVmlkZW9zIiwicG9zdCIsInByb3RlY3QiLCJhZGRWaWRlbyIsImdldFRyZW5kaW5nVmlkZW9zIiwic2VhcmNoVmlkZW9zIiwiZ2V0QXV0aFVzZXIiLCJnZXRWaWRlbyIsImRlbGV0ZSIsImRlbGV0ZVZpZGVvIiwiYWRkVmlkZW9WaWV3IiwibGlrZVZpZGVvIiwiZGlzbGlrZVZpZGVvIiwiYWRkQ29tbWVudCIsImRlbGV0ZUNvbW1lbnQiLCJnZXRWaWRlb1ZpZXdzIiwidmlkZW9zIiwidmlkZW8iLCJ2aWV3cyIsInZpZXciLCJjb3VudCIsIndoZXJlIiwidmlkZW9JZCIsImVxdWFscyIsImlkIiwicmVxIiwicmVzIiwiZmluZE1hbnkiLCJpbmNsdWRlIiwidXNlciIsIm9yZGVyQnkiLCJjcmVhdGVkQXQiLCJsZW5ndGgiLCJzdGF0dXMiLCJqc29uIiwic29ydCIsImEiLCJiIiwibmV4dCIsInF1ZXJ5IiwibWVzc2FnZSIsInN0YXR1c0NvZGUiLCJPUiIsInRpdGxlIiwiY29udGFpbnMiLCJtb2RlIiwiZGVzY3JpcHRpb24iLCJ1cmwiLCJ0aHVtYm5haWwiLCJib2R5IiwiY3JlYXRlIiwiZGF0YSIsImNvbm5lY3QiLCJmaW5kVW5pcXVlIiwicGFyYW1zIiwiY29tbWVudCIsInRleHQiLCJjb21tZW50SWQiLCJzZWxlY3QiLCJ1c2VySWQiLCJzZW5kIiwiaXNMaWtlZCIsInZpZGVvTGlrZSIsImZpbmRGaXJzdCIsImxpa2UiLCJpc0Rpc2xpa2VkIiwidXBkYXRlIiwiY29tbWVudHMiLCJpc1ZpZGVvTWluZSIsImlzU3Vic2NyaWJlZCIsImlzVmlld2VkIiwic3Vic2NyaXB0aW9uIiwic3Vic2NyaWJlcklkIiwic3Vic2NyaWJlZFRvSWQiLCJsaWtlc0NvdW50IiwiQU5EIiwiZGlzbGlrZXNDb3VudCIsInN1YnNjcmliZXJzQ291bnQiLCJjb21tZW50c0NvdW50IiwiQm9vbGVhbiIsImRlbGV0ZU1hbnkiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBQUE7O0FBQ0E7O0FBQ0E7Ozs7QUFFQSxNQUFNQSxNQUFNLEdBQUcsSUFBSUMsb0JBQUosRUFBZjs7QUFFQSxTQUFTQyxjQUFULEdBQTBCO0FBQ3hCLFFBQU1DLE1BQU0sR0FBR0MsaUJBQVFDLE1BQVIsRUFBZjs7QUFFQUYsRUFBQUEsTUFBTSxDQUFDRyxHQUFQLENBQVcsR0FBWCxFQUFnQkMsb0JBQWhCO0FBQ0FKLEVBQUFBLE1BQU0sQ0FBQ0ssSUFBUCxDQUFZLEdBQVosRUFBaUJDLHNCQUFqQixFQUEwQkMsUUFBMUI7QUFFQVAsRUFBQUEsTUFBTSxDQUFDRyxHQUFQLENBQVcsV0FBWCxFQUF3QkssaUJBQXhCO0FBQ0FSLEVBQUFBLE1BQU0sQ0FBQ0csR0FBUCxDQUFXLFNBQVgsRUFBc0JNLFlBQXRCO0FBRUFULEVBQUFBLE1BQU0sQ0FBQ0csR0FBUCxDQUFXLFdBQVgsRUFBd0JPLDBCQUF4QixFQUFxQ0MsUUFBckM7QUFDQVgsRUFBQUEsTUFBTSxDQUFDWSxNQUFQLENBQWMsV0FBZCxFQUEyQk4sc0JBQTNCLEVBQW9DTyxXQUFwQztBQUVBYixFQUFBQSxNQUFNLENBQUNHLEdBQVAsQ0FBVyxnQkFBWCxFQUE2Qk8sMEJBQTdCLEVBQTBDSSxZQUExQztBQUNBZCxFQUFBQSxNQUFNLENBQUNHLEdBQVAsQ0FBVyxnQkFBWCxFQUE2Qkcsc0JBQTdCLEVBQXNDUyxTQUF0QztBQUNBZixFQUFBQSxNQUFNLENBQUNHLEdBQVAsQ0FBVyxtQkFBWCxFQUFnQ0csc0JBQWhDLEVBQXlDVSxZQUF6QztBQUNBaEIsRUFBQUEsTUFBTSxDQUFDSyxJQUFQLENBQVksb0JBQVosRUFBa0NDLHNCQUFsQyxFQUEyQ1csVUFBM0M7QUFDQWpCLEVBQUFBLE1BQU0sQ0FBQ1ksTUFBUCxDQUFjLCtCQUFkLEVBQStDTixzQkFBL0MsRUFBd0RZLGFB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QixHQUFwQixDQUFOO0FBTUFJLEVBQUFBLEdBQUcsQ0FBQ08sTUFBSixDQUFXLEdBQVgsRUFBZ0JDLElBQWhCLENBQXFCLEVBQXJCO0FBQ0QiLCJzb3VyY2VSb290IjoiL1VzZXJzL2Vnb3IvRGV2L3l0Y2xvbmUvc2VydmVyL3NyYy9yb3V0ZXMvIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgUHJpc21hQ2xpZW50IH0gZnJvbSBcIkBwcmlzbWEvY2xpZW50XCI7XG5pbXBvcnQgZXhwcmVzcyBmcm9tIFwiZXhwcmVzc1wiO1xuaW1wb3J0IHsgZ2V0QXV0aFVzZXIsIHByb3RlY3QgfSBmcm9tIFwiLi4vbWlkZGxld2FyZS9hdXRob3JpemF0aW9uXCI7XG5cbmNvbnN0IHByaXNtYSA9IG5ldyBQcmlzbWFDbGllbnQoKTtcblxuZnVuY3Rpb24gZ2V0VmlkZW9Sb3V0ZXMoKSB7XG4gIGNvbnN0IHJvdXRlciA9IGV4cHJlc3MuUm91dGVyKCk7XG5cbiAgcm91dGVyLmdldChcIi9cIiwgZ2V0UmVjb21tZW5kZWRWaWRlb3MpO1xuICByb3V0ZXIucG9zdChcIi9cIiwgcHJvdGVjdCwgYWRkVmlkZW8pO1xuXG4gIHJvdXRlci5nZXQoXCIvdHJlbmRpbmdcIiwgZ2V0VHJlbmRpbmdWaWRlb3MpO1xuICByb3V0ZXIuZ2V0KFwiL3NlYXJjaFwiLCBzZWFyY2hWaWRlb3MpO1xuXG4gIHJvdXRlci5nZXQoXCIvOnZpZGVvSWRcIiwgZ2V0QXV0aFVzZXIsIGdldFZpZGVvKTtcbiAgcm91dGVyLmRlbGV0ZShcIi86dmlkZW9JZFwiLCBwcm90ZWN0LCBkZWxldGVWaWRlbyk7XG5cbiAgcm91dGVyLmdldChcIi86dmlkZW9JZC92aWV3XCIsIGdldEF1dGhVc2VyLCBhZGRWaWRlb1ZpZXcpO1xuICByb3V0ZXIuZ2V0KFwiLzp2aWRlb0lkL2xpa2VcIiwgcHJvdGVjdCwgbGlrZVZpZGVvKTtcbiAgcm91dGVyLmdldChcIi86dmlkZW9JZC9kaXNsaWtlXCIsIHByb3RlY3QsIGRpc2xpa2VWaWRlbyk7XG4gIHJvdXRlci5wb3N0KFwiLzp2aWRlb0lkL2NvbW1lbnRzXCIsIHByb3RlY3QsIGFkZENvbW1lbnQpO1xuICByb3V0ZXIuZGVsZXRlKFwiLzp2aWRlb0lkL2NvbW1lbnRzLzpjb21tZW50SWRcIiwgcHJvdGVjdCwgZGVsZXRlQ29tbWVudCk7XG5cbiAgcmV0dXJuIHJvdXRlcjtcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldFZpZGVvVmlld3ModmlkZW9zKSB7XG4gIGZvciAoY29uc3QgdmlkZW8gb2YgdmlkZW9zKSB7XG4gICAgY29uc3Qgdmlld3MgPSBhd2FpdCBwcmlzbWEudmlldy5jb3VudCh7XG4gICAgICB3aGVyZToge1xuICAgICAgICB2aWRlb0lkOiB7XG4gICAgICAgICAgZXF1YWxzOiB2aWRlby5pZCxcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgfSk7XG4gICAgdmlkZW8udmlld3MgPSB2aWV3cztcbiAgfVxuICByZXR1cm4gdmlkZW9zO1xufVxuXG5hc3luYyBmdW5jdGlvbiBnZXRSZWNvbW1lbmRlZFZpZGVvcyhyZXEsIHJlcykge1xuICBsZXQgdmlkZW9zID0gYXdhaXQgcHJpc21hLnZpZGVvLmZpbmRNYW55KHtcbiAgICBpbmNsdWRlOiB7XG4gICAgICB1c2VyOiB0cnVlLFxuICAgIH0sXG4gICAgb3JkZXJCeToge1xuICAgICAgY3JlYXRlZEF0OiBcImRlc2NcIixcbiAgICB9LFxuICB9KTtcblxuICBpZiAoIXZpZGVvcy5sZW5ndGgpIHtcbiAgICByZXR1cm4gcmVzLnN0YXR1cygyMDApLmpzb24oeyB2aWRlb3MgfSk7XG4gIH1cblxuICB2aWRlb3MgPSBhd2FpdCBnZXRWaWRlb1ZpZXdzKHZpZGVvcyk7XG5cbiAgcmVzLnN0YXR1cygyMDApLmpzb24oeyB2aWRlb3MgfSk7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGdldFRyZW5kaW5nVmlkZW9zKHJlcSwgcmVzKSB7XG4gIGxldCB2aWRlb3MgPSBhd2FpdCBwcmlzbWEudmlkZW8uZmluZE1hbnkoe1xuICAgIGluY2x1ZGU6IHtcbiAgICAgIHVzZXI6IHRydWUsXG4gICAgfSxcbiAgICBvcmRlckJ5OiB7XG4gICAgICBjcmVhdGVkQXQ6IFwiZGVzY1wiLFxuICAgIH0sXG4gIH0pO1xuXG4gIGlmICghdmlkZW9zLmxlbmd0aCkge1xuICAgIHJldHVybiByZXMuc3RhdHVzKDIwMCkuanNvbih7IHZpZGVvcyB9KTtcbiAgfVxuXG4gIHZpZGVvcyA9IGF3YWl0IGdldFZpZGVvVmlld3ModmlkZW9zKTtcbiAgdmlkZW9zLnNvcnQoKGEsIGIpID0+IGIudmlld3MgLSBhLnZpZXdzKTtcblxuICByZXMuc3RhdHVzKDIwMCkuanNvbih7IHZpZGVvcyB9KTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gc2VhcmNoVmlkZW9zKHJlcSwgcmVzLCBuZXh0KSB7XG4gIGlmICghcmVxLnF1ZXJ5LnF1ZXJ5KSB7XG4gICAgcmV0dXJuIG5leHQoe1xuICAgICAgbWVzc2FnZTogXCJQbGVhc2UgZW50ZXIgYSBzZWFyY2ggcXVlcnlcIixcbiAgICAgIHN0YXR1c0NvZGU6IDQwMCxcbiAgICB9KTtcbiAgfVxuXG4gIGxldCB2aWRlb3MgPSBhd2FpdCBwcmlzbWEudmlkZW8uZmluZE1hbnkoe1xuICAgIGluY2x1ZGU6IHtcbiAgICAgIHVzZXI6IHRydWUsXG4gICAgfSxcbiAgICB3aGVyZToge1xuICAgICAgT1I6IFtcbiAgICAgICAge1xuICAgICAgICAgIHRpdGxlOiB7XG4gICAgICAgICAgICBjb250YWluczogcmVxLnF1ZXJ5LnF1ZXJ5LFxuICAgICAgICAgICAgbW9kZTogXCJpbnNlbnNpdGl2ZVwiLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICBkZXNjcmlwdGlvbjoge1xuICAgICAgICAgICAgY29udGFpbnM6IHJlcS5xdWVyeS5xdWVyeSxcbiAgICAgICAgICAgIG1vZGU6IFwiaW5zZW5zaXRpdmVcIixcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgXSxcbiAgICB9LFxuICB9KTtcblxuICBpZiAoIXZpZGVvcy5sZW5ndGgpIHtcbiAgICByZXR1cm4gcmVzLnN0YXR1cygyMDApLmpzb24oeyB2aWRlb3MgfSk7XG4gIH1cblxuICB2aWRlb3MgPSBhd2FpdCBnZXRWaWRlb1ZpZXdzKHZpZGVvcyk7XG5cbiAgcmVzLnN0YXR1cygyMDApLmpzb24oeyB2aWRlb3MgfSk7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGFkZFZpZGVvKHJlcSwgcmVzKSB7XG4gIGNvbnN0IHsgdGl0bGUsIGRlc2NyaXB0aW9uLCB1cmwsIHRodW1ibmFpbCB9ID0gcmVxLmJvZHk7XG5cbiAgY29uc3QgdmlkZW8gPSBhd2FpdCBwcmlzbWEudmlkZW8uY3JlYXRlKHtcbiAgICBkYXRhOiB7XG4gICAgICB0aXRsZSxcbiAgICAgIGRlc2NyaXB0aW9uLFxuICAgICAgdXJsLFxuICAgICAgdGh1bWJuYWlsLFxuICAgICAgdXNlcjoge1xuICAgICAgICBjb25uZWN0OiB7XG4gICAgICAgICAgaWQ6IHJlcS51c2VyLmlkLFxuICAgICAgICB9LFxuICAgICAgfSxcbiAgICB9LFxuICB9KTtcblxuICByZXMuc3RhdHVzKDIwMCkuanNvbih7IHZpZGVvIH0pO1xufVxuXG5hc3luYyBmdW5jdGlvbiBhZGRDb21tZW50KHJlcSwgcmVzLCBuZXh0KSB7XG4gIGNvbnN0IHZpZGVvID0gYXdhaXQgcHJpc21hLnZpZGVvLmZpbmRVbmlxdWUoe1xuICAgIHdoZXJlOiB7XG4gICAgICBpZDogcmVxLnBhcmFtcy52aWRlb0lkLFxuICAgIH0sXG4gIH0pO1xuXG4gIGlmICghdmlkZW8pIHtcbiAgICByZXR1cm4gbmV4dCh7XG4gICAgICBtZXNzYWdlOiBgTm8gdmlkZW8gZm91bmQgd2l0aCBpZDogXCIke3JlcS5wYXJhbXMudmlkZW9JZH1cImAsXG4gICAgICBzdGF0dXNDb2RlOiA0MDQsXG4gICAgfSk7XG4gIH1cblxuICBjb25zdCBjb21tZW50ID0gYXdhaXQgcHJpc21hLmNvbW1lbnQuY3JlYXRlKHtcbiAgICBkYXRhOiB7XG4gICAgICB0ZXh0OiByZXEuYm9keS50ZXh0LFxuICAgICAgdXNlcjoge1xuICAgICAgICBjb25uZWN0OiB7XG4gICAgICAgICAgaWQ6IHJlcS51c2VyLmlkLFxuICAgICAgICB9LFxuICAgICAgfSxcbiAgICAgIHZpZGVvOiB7XG4gICAgICAgIGNvbm5lY3Q6IHtcbiAgICAgICAgICBpZDogcmVxLnBhcmFtcy52aWRlb0lkLFxuICAgICAgICB9LFxuICAgICAgfSxcbiAgICB9LFxuICB9KTtcblxuICByZXMuc3RhdHVzKDIwMCkuanNvbih7IGNvbW1lbnQgfSk7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGRlbGV0ZUNvbW1lbnQocmVxLCByZXMpIHtcbiAgY29uc3QgY29tbWVudCA9IGF3YWl0IHByaXNtYS5jb21tZW50LmZpbmRVbmlxdWUoe1xuICAgIHdoZXJlOiB7XG4gICAgICBpZDogcmVxLnBhcmFtcy5jb21tZW50SWQsXG4gICAgfSxcbiAgICBzZWxlY3Q6IHtcbiAgICAgIHVzZXJJZDogdHJ1ZSxcbiAgICB9LFxuICB9KTtcblxuICBpZiAoY29tbWVudC51c2VySWQgIT09IHJlcS51c2VyLmlkKSB7XG4gICAgcmV0dXJuIHJlc1xuICAgICAgLnN0YXR1cyg0MDEpXG4gICAgICAuc2VuZChcIllvdSBhcmUgbm90IGF1dGhvcml6ZWQgdG8gZGVsZXRlIHRoaXMgY29tbWVudFwiKTtcbiAgfVxuXG4gIGF3YWl0IHByaXNtYS5jb21tZW50LmRlbGV0ZSh7XG4gICAgd2hlcmU6IHtcbiAgICAgIGlkOiByZXEucGFyYW1zLmNvbW1lbnRJZCxcbiAgICB9LFxuICB9KTtcblxuICByZXMuc3RhdHVzKDIwMCkuanNvbih7fSk7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGFkZFZpZGVvVmlldyhyZXEsIHJlcywgbmV4dCkge1xuICBjb25zdCB2aWRlbyA9IGF3YWl0IHByaXNtYS52aWRlby5maW5kVW5pcXVlKHtcbiAgICB3aGVyZToge1xuICAgICAgaWQ6IHJlcS5wYXJhbXMudmlkZW9JZCxcbiAgICB9LFxuICB9KTtcblxuICBpZiAoIXZpZGVvKSB7XG4gICAgcmV0dXJuIG5leHQoe1xuICAgICAgbWVzc2FnZTogYE5vIHZpZGVvIGZvdW5kIHdpdGggaWQ6IFwiJHtyZXEucGFyYW1zLnZpZGVvSWR9XCJgLFxuICAgICAgc3RhdHVzQ29kZTogNDA0LFxuICAgIH0pO1xuICB9XG5cbiAgaWYgKHJlcS51c2VyKSB7XG4gICAgYXdhaXQgcHJpc21hLnZpZXcuY3JlYXRlKHtcbiAgICAgIGRhdGE6IHtcbiAgICAgICAgdmlkZW86IHtcbiAgICAgICAgICBjb25uZWN0OiB7XG4gICAgICAgICAgICBpZDogcmVxLnBhcmFtcy52aWRlb0lkLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHVzZXI6IHtcbiAgICAgICAgICBjb25uZWN0OiB7XG4gICAgICAgICAgICBpZDogcmVxLnVzZXIuaWQsXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgfSk7XG4gIH0gZWxzZSB7XG4gICAgYXdhaXQgcHJpc21hLnZpZXcuY3JlYXRlKHtcbiAgICAgIGRhdGE6IHtcbiAgICAgICAgdmlkZW86IHtcbiAgICAgICAgICBjb25uZWN0OiB7XG4gICAgICAgICAgICBpZDogcmVxLnBhcmFtcy52aWRlb0lkLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgIH0pO1xuICB9XG5cbiAgcmVzLnN0YXR1cygyMDApLmpzb24oe30pO1xufVxuXG5hc3luYyBmdW5jdGlvbiBsaWtlVmlkZW8ocmVxLCByZXMsIG5leHQpIHtcbiAgY29uc3QgdmlkZW8gPSBhd2FpdCBwcmlzbWEudmlkZW8uZmluZFVuaXF1ZSh7XG4gICAgd2hlcmU6IHtcbiAgICAgIGlkOiByZXEucGFyYW1zLnZpZGVvSWQsXG4gICAgfSxcbiAgfSk7XG5cbiAgaWYgKCF2aWRlbykge1xuICAgIHJldHVybiBuZXh0KHtcbiAgICAgIG1lc3NhZ2U6IGBObyB2aWRlbyBmb3VuZCB3aXRoIGlkOiBcIiR7cmVxLnBhcmFtcy52aWRlb0lkfVwiYCxcbiAgICAgIHN0YXR1c0NvZGU6IDQwNCxcbiAgICB9KTtcbiAgfVxuXG4gIGNvbnN0IGlzTGlrZWQgPSBhd2FpdCBwcmlzbWEudmlkZW9MaWtlLmZpbmRGaXJzdCh7XG4gICAgd2hlcmU6IHtcbiAgICAgIHVzZXJJZDoge1xuICAgICAgICBlcXVhbHM6IHJlcS51c2VyLmlkLFxuICAgICAgfSxcbiAgICAgIHZpZGVvSWQ6IHtcbiAgICAgICAgZXF1YWxzOiByZXEucGFyYW1zLnZpZGVvSWQsXG4gICAgICB9LFxuICAgICAgbGlrZToge1xuICAgICAgICBlcXVhbHM6IDEsXG4gICAgICB9LFxuICAgIH0sXG4gIH0pO1xuXG4gIGNvbnN0IGlzRGlzbGlrZWQgPSBhd2FpdCBwcmlzbWEudmlkZW9MaWtlLmZpbmRGaXJzdCh7XG4gICAgd2hlcmU6IHtcbiAgICAgIHVzZXJJZDoge1xuICAgICAgICBlcXVhbHM6IHJlcS51c2VyLmlkLFxuICAgICAgfSxcbiAgICAgIHZpZGVvSWQ6IHtcbiAgICAgICAgZXF1YWxzOiByZXEucGFyYW1zLnZpZGVvSWQsXG4gICAgICB9LFxuICAgICAgbGlrZToge1xuICAgICAgICBlcXVhbHM6IC0xLFxuICAgICAgfSxcbiAgICB9LFxuICB9KTtcblxuICBpZiAoaXNMaWtlZCkge1xuICAgIGF3YWl0IHByaXNtYS52aWRlb0xpa2UuZGVsZXRlKHtcbiAgICAgIHdoZXJlOiB7XG4gICAgICAgIGlkOiBpc0xpa2VkLmlkLFxuICAgICAgfSxcbiAgICB9KTtcbiAgfSBlbHNlIGlmIChpc0Rpc2xpa2VkKSB7XG4gICAgYXdhaXQgcHJpc21hLnZpZGVvTGlrZS51cGRhdGUoe1xuICAgICAgd2hlcmU6IHtcbiAgICAgICAgaWQ6IGlzRGlzbGlrZWQuaWQsXG4gICAgICB9LFxuICAgICAgZGF0YToge1xuICAgICAgICBsaWtlOiAxLFxuICAgICAgfSxcbiAgICB9KTtcbiAgfSBlbHNlIHtcbiAgICBhd2FpdCBwcmlzbWEudmlkZW9MaWtlLmNyZWF0ZSh7XG4gICAgICBkYXRhOiB7XG4gICAgICAgIHVzZXI6IHtcbiAgICAgICAgICBjb25uZWN0OiB7XG4gICAgICAgICAgICBpZDogcmVxLnVzZXIuaWQsXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAgdmlkZW86IHtcbiAgICAgICAgICBjb25uZWN0OiB7XG4gICAgICAgICAgICBpZDogcmVxLnBhcmFtcy52aWRlb0lkLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIGxpa2U6IDEsXG4gICAgICB9LFxuICAgIH0pO1xuICB9XG5cbiAgcmVzLnN0YXR1cygyMDApLmpzb24oe30pO1xufVxuXG5hc3luYyBmdW5jdGlvbiBkaXNsaWtlVmlkZW8ocmVxLCByZXMsIG5leHQpIHtcbiAgY29uc3QgdmlkZW8gPSBhd2FpdCBwcmlzbWEudmlkZW8uZmluZFVuaXF1ZSh7XG4gICAgd2hlcmU6IHtcbiAgICAgIGlkOiByZXEucGFyYW1zLnZpZGVvSWQsXG4gICAgfSxcbiAgfSk7XG5cbiAgaWYgKCF2aWRlbykge1xuICAgIHJldHVybiBuZXh0KHtcbiAgICAgIG1lc3NhZ2U6IGBObyB2aWRlbyBmb3VuZCB3aXRoIGlkOiBcIiR7cmVxLnBhcmFtcy52aWRlb0lkfVwiYCxcbiAgICAgIHN0YXR1c0NvZGU6IDQwNCxcbiAgICB9KTtcbiAgfVxuXG4gIGNvbnN0IGlzTGlrZWQgPSBhd2FpdCBwcmlzbWEudmlkZW9MaWtlLmZpbmRGaXJzdCh7XG4gICAgd2hlcmU6IHtcbiAgICAgIHVzZXJJZDoge1xuICAgICAgICBlcXVhbHM6IHJlcS51c2VyLmlkLFxuICAgICAgfSxcbiAgICAgIHZpZGVvSWQ6IHtcbiAgICAgICAgZXF1YWxzOiByZXEucGFyYW1zLnZpZGVvSWQsXG4gICAgICB9LFxuICAgICAgbGlrZToge1xuICAgICAgICBlcXVhbHM6IDEsXG4gICAgICB9LFxuICAgIH0sXG4gIH0pO1xuXG4gIGNvbnN0IGlzRGlzbGlrZWQgPSBhd2FpdCBwcmlzbWEudmlkZW9MaWtlLmZpbmRGaXJzdCh7XG4gICAgd2hlcmU6IHtcbiAgICAgIHVzZXJJZDoge1xuICAgICAgICBlcXVhbHM6IHJlcS51c2VyLmlkLFxuICAgICAgfSxcbiAgICAgIHZpZGVvSWQ6IHtcbiAgICAgICAgZXF1YWxzOiByZXEucGFyYW1zLnZpZGVvSWQsXG4gICAgICB9LFxuICAgICAgbGlrZToge1xuICAgICAgICBlcXVhbHM6IC0xLFxuICAgICAgfSxcbiAgICB9LFxuICB9KTtcblxuICBpZiAoaXNEaXNsaWtlZCkge1xuICAgIGF3YWl0IHByaXNtYS52aWRlb0xpa2UuZGVsZXRlKHtcbiAgICAgIHdoZXJlOiB7XG4gICAgICAgIGlkOiBpc0Rpc2xpa2VkLmlkLFxuICAgICAgfSxcbiAgICB9KTtcbiAgfSBlbHNlIGlmIChpc0xpa2VkKSB7XG4gICAgYXdhaXQgcHJpc21hLnZpZGVvTGlrZS51cGRhdGUoe1xuICAgICAgd2hlcmU6IHtcbiAgICAgICAgaWQ6IGlzTGlrZWQuaWQsXG4gICAgICB9LFxuICAgICAgZGF0YToge1xuICAgICAgICBsaWtlOiAtMSxcbiAgICAgIH0sXG4gICAgfSk7XG4gIH0gZWxzZSB7XG4gICAgYXdhaXQgcHJpc21hLnZpZGVvTGlrZS5jcmVhdGUoe1xuICAgICAgZGF0YToge1xuICAgICAgICB1c2VyOiB7XG4gICAgICAgICAgY29ubmVjdDoge1xuICAgICAgICAgICAgaWQ6IHJlcS51c2VyLmlkLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHZpZGVvOiB7XG4gICAgICAgICAgY29ubmVjdDoge1xuICAgICAgICAgICAgaWQ6IHJlcS5wYXJhbXMudmlkZW9JZCxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICBsaWtlOiAtMSxcbiAgICAgIH0sXG4gICAgfSk7XG4gIH1cblxuICByZXMuc3RhdHVzKDIwMCkuanNvbih7fSk7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGdldFZpZGVvKHJlcSwgcmVzLCBuZXh0KSB7XG4gIGNvbnN0IHZpZGVvID0gYXdhaXQgcHJpc21hLnZpZGVvLmZpbmRVbmlxdWUoe1xuICAgIHdoZXJlOiB7XG4gICAgICBpZDogcmVxLnBhcmFtcy52aWRlb0lkLFxuICAgIH0sXG4gICAgaW5jbHVkZToge1xuICAgICAgdXNlcjogdHJ1ZSxcbiAgICAgIGNvbW1lbnRzOiB7XG4gICAgICAgIGluY2x1ZGU6IHtcbiAgICAgICAgICB1c2VyOiB0cnVlLFxuICAgICAgICB9LFxuICAgICAgICBvcmRlckJ5OiB7XG4gICAgICAgICAgY3JlYXRlZEF0OiBcImRlc2NcIixcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgfSxcbiAgfSk7XG5cbiAgaWYgKCF2aWRlbykge1xuICAgIHJldHVybiBuZXh0KHtcbiAgICAgIG1lc3NhZ2U6IGBObyB2aWRlbyBmb3VuZCB3aXRoIGlkOiBcIiR7cmVxLnBhcmFtcy52aWRlb0lkfVwiYCxcbiAgICAgIHN0YXR1c0NvZGU6IDQwNCxcbiAgICB9KTtcbiAgfVxuXG4gIGxldCBpc1ZpZGVvTWluZSA9IGZhbHNlO1xuICBsZXQgaXNMaWtlZCA9IGZhbHNlO1xuICBsZXQgaXNEaXNsaWtlZCA9IGZhbHNlO1xuICBsZXQgaXNTdWJzY3JpYmVkID0gZmFsc2U7XG4gIGxldCBpc1ZpZXdlZCA9IGZhbHNlO1xuXG4gIGlmIChyZXEudXNlcikge1xuICAgIGlzVmlkZW9NaW5lID0gcmVxLnVzZXIuaWQgPT09IHZpZGVvLnVzZXJJZDtcblxuICAgIGlzTGlrZWQgPSBhd2FpdCBwcmlzbWEudmlkZW9MaWtlLmZpbmRGaXJzdCh7XG4gICAgICB3aGVyZToge1xuICAgICAgICB1c2VySWQ6IHtcbiAgICAgICAgICBlcXVhbHM6IHJlcS51c2VyLmlkLFxuICAgICAgICB9LFxuICAgICAgICB2aWRlb0lkOiB7XG4gICAgICAgICAgZXF1YWxzOiByZXEucGFyYW1zLnZpZGVvSWQsXG4gICAgICAgIH0sXG4gICAgICAgIGxpa2U6IHtcbiAgICAgICAgICBlcXVhbHM6IDEsXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgIH0pO1xuXG4gICAgaXNEaXNsaWtlZCA9IGF3YWl0IHByaXNtYS52aWRlb0xpa2UuZmluZEZpcnN0KHtcbiAgICAgIHdoZXJlOiB7XG4gICAgICAgIHVzZXJJZDoge1xuICAgICAgICAgIGVxdWFsczogcmVxLnVzZXIuaWQsXG4gICAgICAgIH0sXG4gICAgICAgIHZpZGVvSWQ6IHtcbiAgICAgICAgICBlcXVhbHM6IHJlcS5wYXJhbXMudmlkZW9JZCxcbiAgICAgICAgfSxcbiAgICAgICAgbGlrZToge1xuICAgICAgICAgIGVxdWFsczogLTEsXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgIH0pO1xuXG4gICAgaXNWaWV3ZWQgPSBhd2FpdCBwcmlzbWEudmlldy5maW5kRmlyc3Qoe1xuICAgICAgd2hlcmU6IHtcbiAgICAgICAgdXNlcklkOiB7XG4gICAgICAgICAgZXF1YWxzOiByZXEudXNlci5pZCxcbiAgICAgICAgfSxcbiAgICAgICAgdmlkZW9JZDoge1xuICAgICAgICAgIGVxdWFsczogdmlkZW8uaWQsXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgIH0pO1xuXG4gICAgaXNTdWJzY3JpYmVkID0gYXdhaXQgcHJpc21hLnN1YnNjcmlwdGlvbi5maW5kRmlyc3Qoe1xuICAgICAgd2hlcmU6IHtcbiAgICAgICAgc3Vic2NyaWJlcklkOiB7XG4gICAgICAgICAgZXF1YWxzOiByZXEudXNlci5pZCxcbiAgICAgICAgfSxcbiAgICAgICAgc3Vic2NyaWJlZFRvSWQ6IHtcbiAgICAgICAgICBlcXVhbHM6IHZpZGVvLnVzZXJJZCxcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgfSk7XG4gIH1cblxuICBjb25zdCBsaWtlc0NvdW50ID0gYXdhaXQgcHJpc21hLnZpZGVvTGlrZS5jb3VudCh7XG4gICAgd2hlcmU6IHtcbiAgICAgIEFORDoge1xuICAgICAgICB2aWRlb0lkOiB7XG4gICAgICAgICAgZXF1YWxzOiByZXEucGFyYW1zLnZpZGVvSWQsXG4gICAgICAgIH0sXG4gICAgICAgIGxpa2U6IHtcbiAgICAgICAgICBlcXVhbHM6IDEsXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgIH0sXG4gIH0pO1xuXG4gIGNvbnN0IGRpc2xpa2VzQ291bnQgPSBhd2FpdCBwcmlzbWEudmlkZW9MaWtlLmNvdW50KHtcbiAgICB3aGVyZToge1xuICAgICAgQU5EOiB7XG4gICAgICAgIHZpZGVvSWQ6IHtcbiAgICAgICAgICBlcXVhbHM6IHJlcS5wYXJhbXMudmlkZW9JZCxcbiAgICAgICAgfSxcbiAgICAgICAgbGlrZToge1xuICAgICAgICAgIGVxdWFsczogLTEsXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgIH0sXG4gIH0pO1xuXG4gIGNvbnN0IHZpZXdzID0gYXdhaXQgcHJpc21hLnZpZXcuY291bnQoe1xuICAgIHdoZXJlOiB7XG4gICAgICB2aWRlb0lkOiB7XG4gICAgICAgIGVxdWFsczogdmlkZW8uaWQsXG4gICAgICB9LFxuICAgIH0sXG4gIH0pO1xuXG4gIGNvbnN0IHN1YnNjcmliZXJzQ291bnQgPSBhd2FpdCBwcmlzbWEuc3Vic2NyaXB0aW9uLmNvdW50KHtcbiAgICB3aGVyZToge1xuICAgICAgc3Vic2NyaWJlZFRvSWQ6IHtcbiAgICAgICAgZXF1YWxzOiB2aWRlby51c2VySWQsXG4gICAgICB9LFxuICAgIH0sXG4gIH0pO1xuXG4gIHZpZGVvLmNvbW1lbnRzQ291bnQgPSB2aWRlby5jb21tZW50cy5sZW5ndGg7XG4gIHZpZGVvLmlzTGlrZWQgPSBCb29sZWFuKGlzTGlrZWQpO1xuICB2aWRlby5pc0Rpc2xpa2VkID0gQm9vbGVhbihpc0Rpc2xpa2VkKTtcbiAgdmlkZW8ubGlrZXNDb3VudCA9IGxpa2VzQ291bnQ7XG4gIHZpZGVvLmRpc2xpa2VzQ291bnQgPSBkaXNsaWtlc0NvdW50O1xuICB2aWRlby5pc1ZpZGVvTWluZSA9IGlzVmlkZW9NaW5lO1xuICB2aWRlby52aWV3cyA9IHZpZXdzO1xuICB2aWRlby5pc1N1YnNjcmliZWQgPSBCb29sZWFuKGlzU3Vic2NyaWJlZCk7XG4gIHZpZGVvLmlzVmlld2VkID0gQm9vbGVhbihpc1ZpZXdlZCk7XG4gIHZpZGVvLnN1YnNjcmliZXJzQ291bnQgPSBzdWJzY3JpYmVyc0NvdW50O1xuXG4gIHJlcy5zdGF0dXMoMjAwKS5qc29uKHsgdmlkZW8gfSk7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGRlbGV0ZVZpZGVvKHJlcSwgcmVzKSB7XG4gIGNvbnN0IHZpZGVvID0gYXdhaXQgcHJpc21hLnZpZGVvLmZpbmRVbmlxdWUoe1xuICAgIHdoZXJlOiB7XG4gICAgICBpZDogcmVxLnBhcmFtcy52aWRlb0lkLFxuICAgIH0sXG4gICAgc2VsZWN0OiB7XG4gICAgICB1c2VySWQ6IHRydWUsXG4gICAgfSxcbiAgfSk7XG5cbiAgaWYgKHJlcS51c2VyLmlkICE9PSB2aWRlby51c2VySWQpIHtcbiAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDEpLnNlbmQoXCJZb3UgYXJlIG5vdCBhdXRob3JpemVkIHRvIGRlbGV0ZSB0aGlzIHZpZGVvXCIpO1xuICB9XG5cbiAgYXdhaXQgcHJpc21hLnZpZXcuZGVsZXRlTWFueSh7XG4gICAgd2hlcmU6IHtcbiAgICAgIHZpZGVvSWQ6IHtcbiAgICAgICAgZXF1YWxzOiByZXEucGFyYW1zLnZpZGVvSWQsXG4gICAgICB9LFxuICAgIH0sXG4gIH0pO1xuXG4gIGF3YWl0IHByaXNtYS52aWRlb0xpa2UuZGVsZXRlTWFueSh7XG4gICAgd2hlcmU6IHtcbiAgICAgIHZpZGVvSWQ6IHtcbiAgICAgICAgZXF1YWxzOiByZXEucGFyYW1zLnZpZGVvSWQsXG4gICAgICB9LFxuICAgIH0sXG4gIH0pO1xuXG4gIGF3YWl0IHByaXNtYS5jb21tZW50LmRlbGV0ZU1hbnkoe1xuICAgIHdoZXJlOiB7XG4gICAgICB2aWRlb0lkOiB7XG4gICAgICAgIGVxdWFsczogcmVxLnBhcmFtcy52aWRlb0lkLFxuICAgICAgfSxcbiAgICB9LFxuICB9KTtcblxuICBhd2FpdCBwcmlzbWEudmlkZW8uZGVsZXRlKHtcbiAgICB3aGVyZToge1xuICAgICAgaWQ6IHJlcS5wYXJhbXMudmlkZW9JZCxcbiAgICB9LFxuICB9KTtcblxuICByZXMuc3RhdHVzKDIwMCkuanNvbih7fSk7XG59XG5cbmV4cG9ydCB7IGdldFZpZGVvUm91dGVzIH07XG4iXX0=",
    "map": {
      "version": 3,
      "sources": [
        "video.js"
      ],
      "names": [
        "prisma",
        "PrismaClient",
        "getVideoRoutes",
        "router",
        "express",
        "Router",
        "get",
        "getRecommendedVideos",
        "post",
        "protect",
        "addVideo",
        "getTrendingVideos",
        "searchVideos",
        "getAuthUser",
        "getVideo",
        "delete",
        "deleteVideo",
        "addVideoView",
        "likeVideo",
        "dislikeVideo",
        "addComment",
        "deleteComment",
        "getVideoViews",
        "videos",
        "video",
        "views",
        "view",
        "count",
        "where",
        "videoId",
        "equals",
        "id",
        "req",
        "res",
        "findMany",
        "include",
        "user",
        "orderBy",
        "createdAt",
        "length",
        "status",
        "json",
        "sort",
        "a",
        "b",
        "next",
        "query",
        "message",
        "statusCode",
        "OR",
        "title",
        "contains",
        "mode",
        "description",
        "url",
        "thumbnail",
        "body",
        "create",
        "data",
        "connect",
        "findUnique",
        "params",
        "comment",
        "text",
        "commentId",
        "select",
        "userId",
        "send",
        "isLiked",
        "videoLike",
        "findFirst",
        "like",
        "isDisliked",
        "update",
        "comments",
        "isVideoMine",
        "isSubscribed",
        "isViewed",
        "subscription",
        "subscriberId",
        "subscribedToId",
        "likesCount",
        "AND",
        "dislikesCount",
        "subscribersCount",
        "commentsCount",
        "Boolean",
        "deleteMany"
      ],
      "mappings": "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",
      "sourceRoot": "/Users/egor/Dev/ytclone/server/src/routes/",
      "sourcesContent": [
        "import { PrismaClient } from \"@prisma/client\";\nimport express from \"express\";\nimport { getAuthUser, protect } from \"../middleware/authorization\";\n\nconst prisma = new PrismaClient();\n\nfunction getVideoRoutes() {\n  const router = express.Router();\n\n  router.get(\"/\", getRecommendedVideos);\n  router.post(\"/\", protect, addVideo);\n\n  router.get(\"/trending\", getTrendingVideos);\n  router.get(\"/search\", searchVideos);\n\n  router.get(\"/:videoId\", getAuthUser, getVideo);\n  router.delete(\"/:videoId\", protect, deleteVideo);\n\n  router.get(\"/:videoId/view\", getAuthUser, addVideoView);\n  router.get(\"/:videoId/like\", protect, likeVideo);\n  router.get(\"/:videoId/dislike\", protect, dislikeVideo);\n  router.post(\"/:videoId/comments\", protect, addComment);\n  router.delete(\"/:videoId/comments/:commentId\", protect, deleteComment);\n\n  return router;\n}\n\nexport async function getVideoViews(videos) {\n  for (const video of videos) {\n    const views = await prisma.view.count({\n      where: {\n        videoId: {\n          equals: video.id,\n        },\n      },\n    });\n    video.views = views;\n  }\n  return videos;\n}\n\nasync function getRecommendedVideos(req, res) {\n  let videos = await prisma.video.findMany({\n    include: {\n      user: true,\n    },\n    orderBy: {\n      createdAt: \"desc\",\n    },\n  });\n\n  if (!videos.length) {\n    return res.status(200).json({ videos });\n  }\n\n  videos = await getVideoViews(videos);\n\n  res.status(200).json({ videos });\n}\n\nasync function getTrendingVideos(req, res) {\n  let videos = await prisma.video.findMany({\n    include: {\n      user: true,\n    },\n    orderBy: {\n      createdAt: \"desc\",\n    },\n  });\n\n  if (!videos.length) {\n    return res.status(200).json({ videos });\n  }\n\n  videos = await getVideoViews(videos);\n  videos.sort((a, b) => b.views - a.views);\n\n  res.status(200).json({ videos });\n}\n\nasync function searchVideos(req, res, next) {\n  if (!req.query.query) {\n    return next({\n      message: \"Please enter a search query\",\n      statusCode: 400,\n    });\n  }\n\n  let videos = await prisma.video.findMany({\n    include: {\n      user: true,\n    },\n    where: {\n      OR: [\n        {\n          title: {\n            contains: req.query.query,\n            mode: \"insensitive\",\n          },\n        },\n        {\n          description: {\n            contains: req.query.query,\n            mode: \"insensitive\",\n          },\n        },\n      ],\n    },\n  });\n\n  if (!videos.length) {\n    return res.status(200).json({ videos });\n  }\n\n  videos = await getVideoViews(videos);\n\n  res.status(200).json({ videos });\n}\n\nasync function addVideo(req, res) {\n  const { title, description, url, thumbnail } = req.body;\n\n  const video = await prisma.video.create({\n    data: {\n      title,\n      description,\n      url,\n      thumbnail,\n      user: {\n        connect: {\n          id: req.user.id,\n        },\n      },\n    },\n  });\n\n  res.status(200).json({ video });\n}\n\nasync function addComment(req, res, next) {\n  const video = await prisma.video.findUnique({\n    where: {\n      id: req.params.videoId,\n    },\n  });\n\n  if (!video) {\n    return next({\n      message: `No video found with id: \"${req.params.videoId}\"`,\n      statusCode: 404,\n    });\n  }\n\n  const comment = await prisma.comment.create({\n    data: {\n      text: req.body.text,\n      user: {\n        connect: {\n          id: req.user.id,\n        },\n      },\n      video: {\n        connect: {\n          id: req.params.videoId,\n        },\n      },\n    },\n  });\n\n  res.status(200).json({ comment });\n}\n\nasync function deleteComment(req, res) {\n  const comment = await prisma.comment.findUnique({\n    where: {\n      id: req.params.commentId,\n    },\n    select: {\n      userId: true,\n    },\n  });\n\n  if (comment.userId !== req.user.id) {\n    return res\n      .status(401)\n      .send(\"You are not authorized to delete this comment\");\n  }\n\n  await prisma.comment.delete({\n    where: {\n      id: req.params.commentId,\n    },\n  });\n\n  res.status(200).json({});\n}\n\nasync function addVideoView(req, res, next) {\n  const video = await prisma.video.findUnique({\n    where: {\n      id: req.params.videoId,\n    },\n  });\n\n  if (!video) {\n    return next({\n      message: `No video found with id: \"${req.params.videoId}\"`,\n      statusCode: 404,\n    });\n  }\n\n  if (req.user) {\n    await prisma.view.create({\n      data: {\n        video: {\n          connect: {\n            id: req.params.videoId,\n          },\n        },\n        user: {\n          connect: {\n            id: req.user.id,\n          },\n        },\n      },\n    });\n  } else {\n    await prisma.view.create({\n      data: {\n        video: {\n          connect: {\n            id: req.params.videoId,\n          },\n        },\n      },\n    });\n  }\n\n  res.status(200).json({});\n}\n\nasync function likeVideo(req, res, next) {\n  const video = await prisma.video.findUnique({\n    where: {\n      id: req.params.videoId,\n    },\n  });\n\n  if (!video) {\n    return next({\n      message: `No video found with id: \"${req.params.videoId}\"`,\n      statusCode: 404,\n    });\n  }\n\n  const isLiked = await prisma.videoLike.findFirst({\n    where: {\n      userId: {\n        equals: req.user.id,\n      },\n      videoId: {\n        equals: req.params.videoId,\n      },\n      like: {\n        equals: 1,\n      },\n    },\n  });\n\n  const isDisliked = await prisma.videoLike.findFirst({\n    where: {\n      userId: {\n        equals: req.user.id,\n      },\n      videoId: {\n        equals: req.params.videoId,\n      },\n      like: {\n        equals: -1,\n      },\n    },\n  });\n\n  if (isLiked) {\n    await prisma.videoLike.delete({\n      where: {\n        id: isLiked.id,\n      },\n    });\n  } else if (isDisliked) {\n    await prisma.videoLike.update({\n      where: {\n        id: isDisliked.id,\n      },\n      data: {\n        like: 1,\n      },\n    });\n  } else {\n    await prisma.videoLike.create({\n      data: {\n        user: {\n          connect: {\n            id: req.user.id,\n          },\n        },\n        video: {\n          connect: {\n            id: req.params.videoId,\n          },\n        },\n        like: 1,\n      },\n    });\n  }\n\n  res.status(200).json({});\n}\n\nasync function dislikeVideo(req, res, next) {\n  const video = await prisma.video.findUnique({\n    where: {\n      id: req.params.videoId,\n    },\n  });\n\n  if (!video) {\n    return next({\n      message: `No video found with id: \"${req.params.videoId}\"`,\n      statusCode: 404,\n    });\n  }\n\n  const isLiked = await prisma.videoLike.findFirst({\n    where: {\n      userId: {\n        equals: req.user.id,\n      },\n      videoId: {\n        equals: req.params.videoId,\n      },\n      like: {\n        equals: 1,\n      },\n    },\n  });\n\n  const isDisliked = await prisma.videoLike.findFirst({\n    where: {\n      userId: {\n        equals: req.user.id,\n      },\n      videoId: {\n        equals: req.params.videoId,\n      },\n      like: {\n        equals: -1,\n      },\n    },\n  });\n\n  if (isDisliked) {\n    await prisma.videoLike.delete({\n      where: {\n        id: isDisliked.id,\n      },\n    });\n  } else if (isLiked) {\n    await prisma.videoLike.update({\n      where: {\n        id: isLiked.id,\n      },\n      data: {\n        like: -1,\n      },\n    });\n  } else {\n    await prisma.videoLike.create({\n      data: {\n        user: {\n          connect: {\n            id: req.user.id,\n          },\n        },\n        video: {\n          connect: {\n            id: req.params.videoId,\n          },\n        },\n        like: -1,\n      },\n    });\n  }\n\n  res.status(200).json({});\n}\n\nasync function getVideo(req, res, next) {\n  const video = await prisma.video.findUnique({\n    where: {\n      id: req.params.videoId,\n    },\n    include: {\n      user: true,\n      comments: {\n        include: {\n          user: true,\n        },\n        orderBy: {\n          createdAt: \"desc\",\n        },\n      },\n    },\n  });\n\n  if (!video) {\n    return next({\n      message: `No video found with id: \"${req.params.videoId}\"`,\n      statusCode: 404,\n    });\n  }\n\n  let isVideoMine = false;\n  let isLiked = false;\n  let isDisliked = false;\n  let isSubscribed = false;\n  let isViewed = false;\n\n  if (req.user) {\n    isVideoMine = req.user.id === video.userId;\n\n    isLiked = await prisma.videoLike.findFirst({\n      where: {\n        userId: {\n          equals: req.user.id,\n        },\n        videoId: {\n          equals: req.params.videoId,\n        },\n        like: {\n          equals: 1,\n        },\n      },\n    });\n\n    isDisliked = await prisma.videoLike.findFirst({\n      where: {\n        userId: {\n          equals: req.user.id,\n        },\n        videoId: {\n          equals: req.params.videoId,\n        },\n        like: {\n          equals: -1,\n        },\n      },\n    });\n\n    isViewed = await prisma.view.findFirst({\n      where: {\n        userId: {\n          equals: req.user.id,\n        },\n        videoId: {\n          equals: video.id,\n        },\n      },\n    });\n\n    isSubscribed = await prisma.subscription.findFirst({\n      where: {\n        subscriberId: {\n          equals: req.user.id,\n        },\n        subscribedToId: {\n          equals: video.userId,\n        },\n      },\n    });\n  }\n\n  const likesCount = await prisma.videoLike.count({\n    where: {\n      AND: {\n        videoId: {\n          equals: req.params.videoId,\n        },\n        like: {\n          equals: 1,\n        },\n      },\n    },\n  });\n\n  const dislikesCount = await prisma.videoLike.count({\n    where: {\n      AND: {\n        videoId: {\n          equals: req.params.videoId,\n        },\n        like: {\n          equals: -1,\n        },\n      },\n    },\n  });\n\n  const views = await prisma.view.count({\n    where: {\n      videoId: {\n        equals: video.id,\n      },\n    },\n  });\n\n  const subscribersCount = await prisma.subscription.count({\n    where: {\n      subscribedToId: {\n        equals: video.userId,\n      },\n    },\n  });\n\n  video.commentsCount = video.comments.length;\n  video.isLiked = Boolean(isLiked);\n  video.isDisliked = Boolean(isDisliked);\n  video.likesCount = likesCount;\n  video.dislikesCount = dislikesCount;\n  video.isVideoMine = isVideoMine;\n  video.views = views;\n  video.isSubscribed = Boolean(isSubscribed);\n  video.isViewed = Boolean(isViewed);\n  video.subscribersCount = subscribersCount;\n\n  res.status(200).json({ video });\n}\n\nasync function deleteVideo(req, res) {\n  const video = await prisma.video.findUnique({\n    where: {\n      id: req.params.videoId,\n    },\n    select: {\n      userId: true,\n    },\n  });\n\n  if (req.user.id !== video.userId) {\n    return res.status(401).send(\"You are not authorized to delete this video\");\n  }\n\n  await prisma.view.deleteMany({\n    where: {\n      videoId: {\n        equals: req.params.videoId,\n      },\n    },\n  });\n\n  await prisma.videoLike.deleteMany({\n    where: {\n      videoId: {\n        equals: req.params.videoId,\n      },\n    },\n  });\n\n  await prisma.comment.deleteMany({\n    where: {\n      videoId: {\n        equals: req.params.videoId,\n      },\n    },\n  });\n\n  await prisma.video.delete({\n    where: {\n      id: req.params.videoId,\n    },\n  });\n\n  res.status(200).json({});\n}\n\nexport { getVideoRoutes };\n"
      ]
    },
    "sourceType": "script",
    "mtime": 1611420432000
  },
  "{\"sourceRoot\":\"/Users/egor/Dev/ytclone/server/src/middleware/\",\"caller\":{\"name\":\"@babel/register\"},\"cwd\":\"/Users/egor/Dev/ytclone\",\"filename\":\"/Users/egor/Dev/ytclone/server/src/middleware/error.js\",\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"/Users/egor/Dev/ytclone\",\"plugins\":[{\"key\":\"syntax-numeric-separator\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"proposal-logical-assignment-operators\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"AssignmentExpression\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-nullish-coalescing-operator\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-optional-chaining\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-json-strings\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-optional-catch-binding\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-async-generators\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-object-rest-spread\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"transform-modules-commonjs\",\"visitor\":{\"CallExpression\":{\"enter\":[null]},\"Program\":{\"exit\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"proposal-dynamic-import\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"Program\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"proposal-export-namespace-from\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"ExportNamedDeclaration\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}}],\"presets\":[]}:7.12.10": {
    "metadata": {},
    "options": {
      "sourceRoot": "/Users/egor/Dev/ytclone/server/src/middleware/",
      "caller": {
        "name": "@babel/register"
      },
      "cwd": "/Users/egor/Dev/ytclone",
      "filename": "/Users/egor/Dev/ytclone/server/src/middleware/error.js",
      "cloneInputAst": true,
      "babelrc": false,
      "configFile": false,
      "envName": "development",
      "root": "/Users/egor/Dev/ytclone",
      "sourceMaps": "both",
      "ast": false,
      "passPerPreset": false,
      "plugins": [
        {
          "key": "syntax-numeric-separator",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "proposal-logical-assignment-operators",
          "visitor": {
            "_exploded": {},
            "_verified": {},
            "AssignmentExpression": {
              "enter": [
                null
              ]
            }
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-nullish-coalescing-operator",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-optional-chaining",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-json-strings",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-optional-catch-binding",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-async-generators",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-object-rest-spread",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "transform-modules-commonjs",
          "visitor": {
            "CallExpression": {
              "enter": [
                null
              ]
            },
            "Program": {
              "exit": [
                null
              ]
            },
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "proposal-dynamic-import",
          "visitor": {
            "_exploded": {},
            "_verified": {},
            "Program": {
              "enter": [
                null
              ]
            }
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "proposal-export-namespace-from",
          "visitor": {
            "_exploded": {},
            "_verified": {},
            "ExportNamedDeclaration": {
              "enter": [
                null
              ]
            }
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        }
      ],
      "presets": [],
      "parserOpts": {
        "sourceType": "module",
        "sourceFileName": "/Users/egor/Dev/ytclone/server/src/middleware/error.js",
        "plugins": [
          "numericSeparator",
          "logicalAssignment",
          "nullishCoalescingOperator",
          "optionalChaining",
          "jsonStrings",
          "optionalCatchBinding",
          "asyncGenerators",
          "objectRestSpread",
          "dynamicImport",
          "exportNamespaceFrom"
        ]
      },
      "generatorOpts": {
        "filename": "/Users/egor/Dev/ytclone/server/src/middleware/error.js",
        "comments": true,
        "compact": "auto",
        "sourceMaps": "both",
        "sourceRoot": "/Users/egor/Dev/ytclone/server/src/middleware/",
        "sourceFileName": "error.js"
      }
    },
    "ast": null,
    "code": "\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.errorMiddleware = errorMiddleware;\nexports.setupCloseOnExit = setupCloseOnExit;\n\nvar _loglevel = _interopRequireDefault(require(\"loglevel\"));\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n// Middleware that will help us catch generic express-related errors\nfunction errorMiddleware(error, req, res, next) {\n  if (res.headersSent) {\n    next(error);\n  } else {\n    _loglevel.default.error(error);\n\n    res.status(error.statusCode || 500);\n    res.json({\n      message: error.message,\n      ...(process.env.NODE_ENV === \"production\" ? null : {\n        stack: error.stack\n      })\n    });\n  }\n} // This closes the server in the event of an error so\n// that our requests do not hang\n\n\nfunction setupCloseOnExit(server) {\n  async function exitHandler(options = {}) {\n    await server.close().then(() => {\n      _loglevel.default.info(\"Server successfully closed\");\n    }).catch(error => {\n      _loglevel.default.warn(\"Something went wrong closing the server\", error.stack);\n    });\n    if (options.exit) process.exit();\n  } // Do something when app is closing\n\n\n  process.on(\"exit\", exitHandler); // Catches ctrl+c event\n\n  process.on(\"SIGINT\", exitHandler.bind(null, {\n    exit: true\n  })); // Catches \"kill pid\" (for example: nodemon restart)\n\n  process.on(\"SIGUSR1\", exitHandler.bind(null, {\n    exit: true\n  }));\n  process.on(\"SIGUSR2\", exitHandler.bind(null, {\n    exit: true\n  })); // Catches uncaught exceptions\n\n  process.on(\"uncaughtException\", exitHandler.bind(null, {\n    exit: true\n  }));\n}\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImVycm9yLmpzIl0sIm5hbWVzIjpbImVycm9yTWlkZGxld2FyZSIsImVycm9yIiwicmVxIiwicmVzIiwibmV4dCIsImhlYWRlcnNTZW50IiwibG9nZ2VyIiwic3RhdHVzIiwic3RhdHVzQ29kZSIsImpzb24iLCJtZXNzYWdlIiwicHJvY2VzcyIsImVudiIsIk5PREVfRU5WIiwic3RhY2siLCJzZXR1cENsb3NlT25FeGl0Iiwic2VydmVyIiwiZXhpdEhhbmRsZXIiLCJvcHRpb25zIiwiY2xvc2UiLCJ0aGVuIiwiaW5mbyIsImNhdGNoIiwid2FybiIsImV4aXQiLCJvbiIsImJpbmQiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBQUE7Ozs7QUFFQTtBQUNBLFNBQVNBLGVBQVQsQ0FBeUJDLEtBQXpCLEVBQWdDQyxHQUFoQyxFQUFxQ0MsR0FBckMsRUFBMENDLElBQTFDLEVBQWdEO0FBQzlDLE1BQUlELEdBQUcsQ0FBQ0UsV0FBUixFQUFxQjtBQUNuQkQsSUFBQUEsSUFBSSxDQUFDSCxLQUFELENBQUo7QUFDRCxHQUZELE1BRU87QUFDTEssc0JBQU9MLEtBQVAsQ0FBYUEsS0FBYjs7QUFDQUUsSUFBQUEsR0FBRyxDQUFDSSxNQUFKLENBQVdOLEtBQUssQ0FBQ08sVUFBTixJQUFvQixHQUEvQjtBQUNBTCxJQUFBQSxHQUFHLENBQUNNLElBQUosQ0FBUztBQUNQQyxNQUFBQSxPQUFPLEVBQUVULEtBQUssQ0FBQ1MsT0FEUjtBQUVQLFVBQUlDLE9BQU8sQ0FBQ0MsR0FBUixDQUFZQyxRQUFaLEtBQXlCLFlBQXpCLEdBQ0EsSUFEQSxHQUVBO0FBQUVDLFFBQUFBLEtBQUssRUFBRWIsS0FBSyxDQUFDYTtBQUFmLE9BRko7QUFGTyxLQUFUO0FBTUQ7QUFDRixDLENBRUQ7QUFDQTs7O0FBQ0EsU0FBU0MsZ0JBQVQsQ0FBMEJDLE1BQTFCLEVBQWtDO0FBQ2hDLGlCQUFlQyxXQUFmLENBQTJCQyxPQUFPLEdBQUcsRUFBckMsRUFBeUM7QUFDdkMsVUFBTUYsTUFBTSxDQUNURyxLQURHLEdBRUhDLElBRkcsQ0FFRSxNQUFNO0FBQ1ZkLHdCQUFPZSxJQUFQLENBQVksNEJBQVo7QUFDRCxLQUpHLEVBS0hDLEtBTEcsQ0FLSXJCLEtBQUQsSUFBVztBQUNoQkssd0JBQU9pQixJQUFQLENBQVkseUNBQVosRUFBdUR0QixLQUFLLENBQUNhLEtBQTdEO0FBQ0QsS0FQRyxDQUFOO0FBUUEsUUFBSUksT0FBTyxDQUFDTSxJQUFaLEVBQWtCYixPQUFPLENBQUNhLElBQVI7QUFDbkIsR0FYK0IsQ0FZaEM7OztBQUNBYixFQUFBQSxPQUFPLENBQUNjLEVBQVIsQ0FBVyxNQUFYLEVBQW1CUixXQUFuQixFQWJnQyxDQWNoQzs7QUFDQU4sRUFBQUEsT0FBTyxDQUFDYyxFQUFSLENBQVcsUUFBWCxFQUFxQlIsV0FBVyxDQUFDUyxJQUFaLENBQWlCLElBQWpCLEVBQXVCO0FBQUVGLElBQUFBLElBQUksRUFBRTtBQUFSLEdBQXZCLENBQXJCLEVBZmdDLENBZ0JoQzs7QUFDQWIsRUFBQUEsT0FBTyxDQUFDYyxFQUFSLENBQVcsU0FBWCxFQUFzQlIsV0FBVyxDQUFDUyxJQUFaLENBQWlCLElBQWpCLEVBQXVCO0FBQUVGLElBQUFBLElBQUksRUFBRTtBQUFSLEdBQXZCLENBQXRCO0FBQ0FiLEVBQUFBLE9BQU8sQ0FBQ2MsRUFBUixDQUFXLFNBQVgsRUFBc0JSLFdBQVcsQ0FBQ1MsSUFBWixDQUFpQixJQUFqQixFQUF1QjtBQUFFRixJQUFBQSxJQUFJLEVBQUU7QUFBUixHQUF2QixDQUF0QixFQWxCZ0MsQ0FtQmhDOztBQUNBYixFQUFBQSxPQUFPLENBQUNjLEVBQVIsQ0FBVyxtQkFBWCxFQUFnQ1IsV0FBVyxDQUFDUyxJQUFaLENBQWlCLElBQWpCLEVBQXVCO0FBQUVGLElBQUFBLElBQUksRUFBRTtBQUFSLEdBQXZCLENBQWhDO0FBQ0QiLCJzb3VyY2VSb290IjoiL1VzZXJzL2Vnb3IvRGV2L3l0Y2xvbmUvc2VydmVyL3NyYy9taWRkbGV3YXJlLyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBsb2dnZXIgZnJvbSBcImxvZ2xldmVsXCI7XG5cbi8vIE1pZGRsZXdhcmUgdGhhdCB3aWxsIGhlbHAgdXMgY2F0Y2ggZ2VuZXJpYyBleHByZXNzLXJlbGF0ZWQgZXJyb3JzXG5mdW5jdGlvbiBlcnJvck1pZGRsZXdhcmUoZXJyb3IsIHJlcSwgcmVzLCBuZXh0KSB7XG4gIGlmIChyZXMuaGVhZGVyc1NlbnQpIHtcbiAgICBuZXh0KGVycm9yKTtcbiAgfSBlbHNlIHtcbiAgICBsb2dnZXIuZXJyb3IoZXJyb3IpO1xuICAgIHJlcy5zdGF0dXMoZXJyb3Iuc3RhdHVzQ29kZSB8fCA1MDApO1xuICAgIHJlcy5qc29uKHtcbiAgICAgIG1lc3NhZ2U6IGVycm9yLm1lc3NhZ2UsXG4gICAgICAuLi4ocHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09IFwicHJvZHVjdGlvblwiXG4gICAgICAgID8gbnVsbFxuICAgICAgICA6IHsgc3RhY2s6IGVycm9yLnN0YWNrIH0pLFxuICAgIH0pO1xuICB9XG59XG5cbi8vIFRoaXMgY2xvc2VzIHRoZSBzZXJ2ZXIgaW4gdGhlIGV2ZW50IG9mIGFuIGVycm9yIHNvXG4vLyB0aGF0IG91ciByZXF1ZXN0cyBkbyBub3QgaGFuZ1xuZnVuY3Rpb24gc2V0dXBDbG9zZU9uRXhpdChzZXJ2ZXIpIHtcbiAgYXN5bmMgZnVuY3Rpb24gZXhpdEhhbmRsZXIob3B0aW9ucyA9IHt9KSB7XG4gICAgYXdhaXQgc2VydmVyXG4gICAgICAuY2xvc2UoKVxuICAgICAgLnRoZW4oKCkgPT4ge1xuICAgICAgICBsb2dnZXIuaW5mbyhcIlNlcnZlciBzdWNjZXNzZnVsbHkgY2xvc2VkXCIpO1xuICAgICAgfSlcbiAgICAgIC5jYXRjaCgoZXJyb3IpID0+IHtcbiAgICAgICAgbG9nZ2VyLndhcm4oXCJTb21ldGhpbmcgd2VudCB3cm9uZyBjbG9zaW5nIHRoZSBzZXJ2ZXJcIiwgZXJyb3Iuc3RhY2spO1xuICAgICAgfSk7XG4gICAgaWYgKG9wdGlvbnMuZXhpdCkgcHJvY2Vzcy5leGl0KCk7XG4gIH1cbiAgLy8gRG8gc29tZXRoaW5nIHdoZW4gYXBwIGlzIGNsb3NpbmdcbiAgcHJvY2Vzcy5vbihcImV4aXRcIiwgZXhpdEhhbmRsZXIpO1xuICAvLyBDYXRjaGVzIGN0cmwrYyBldmVudFxuICBwcm9jZXNzLm9uKFwiU0lHSU5UXCIsIGV4aXRIYW5kbGVyLmJpbmQobnVsbCwgeyBleGl0OiB0cnVlIH0pKTtcbiAgLy8gQ2F0Y2hlcyBcImtpbGwgcGlkXCIgKGZvciBleGFtcGxlOiBub2RlbW9uIHJlc3RhcnQpXG4gIHByb2Nlc3Mub24oXCJTSUdVU1IxXCIsIGV4aXRIYW5kbGVyLmJpbmQobnVsbCwgeyBleGl0OiB0cnVlIH0pKTtcbiAgcHJvY2Vzcy5vbihcIlNJR1VTUjJcIiwgZXhpdEhhbmRsZXIuYmluZChudWxsLCB7IGV4aXQ6IHRydWUgfSkpO1xuICAvLyBDYXRjaGVzIHVuY2F1Z2h0IGV4Y2VwdGlvbnNcbiAgcHJvY2Vzcy5vbihcInVuY2F1Z2h0RXhjZXB0aW9uXCIsIGV4aXRIYW5kbGVyLmJpbmQobnVsbCwgeyBleGl0OiB0cnVlIH0pKTtcbn1cblxuZXhwb3J0IHsgZXJyb3JNaWRkbGV3YXJlLCBzZXR1cENsb3NlT25FeGl0IH07XG4iXX0=",
    "map": {
      "version": 3,
      "sources": [
        "error.js"
      ],
      "names": [
        "errorMiddleware",
        "error",
        "req",
        "res",
        "next",
        "headersSent",
        "logger",
        "status",
        "statusCode",
        "json",
        "message",
        "process",
        "env",
        "NODE_ENV",
        "stack",
        "setupCloseOnExit",
        "server",
        "exitHandler",
        "options",
        "close",
        "then",
        "info",
        "catch",
        "warn",
        "exit",
        "on",
        "bind"
      ],
      "mappings": ";;;;;;;;AAAA;;;;AAEA;AACA,SAASA,eAAT,CAAyBC,KAAzB,EAAgCC,GAAhC,EAAqCC,GAArC,EAA0CC,IAA1C,EAAgD;AAC9C,MAAID,GAAG,CAACE,WAAR,EAAqB;AACnBD,IAAAA,IAAI,CAACH,KAAD,CAAJ;AACD,GAFD,MAEO;AACLK,sBAAOL,KAAP,CAAaA,KAAb;;AACAE,IAAAA,GAAG,CAACI,MAAJ,CAAWN,KAAK,CAACO,UAAN,IAAoB,GAA/B;AACAL,IAAAA,GAAG,CAACM,IAAJ,CAAS;AACPC,MAAAA,OAAO,EAAET,KAAK,CAACS,OADR;AAEP,UAAIC,OAAO,CAACC,GAAR,CAAYC,QAAZ,KAAyB,YAAzB,GACA,IADA,GAEA;AAAEC,QAAAA,KAAK,EAAEb,KAAK,CAACa;AAAf,OAFJ;AAFO,KAAT;AAMD;AACF,C,CAED;AACA;;;AACA,SAASC,gBAAT,CAA0BC,MAA1B,EAAkC;AAChC,iBAAeC,WAAf,CAA2BC,OAAO,GAAG,EAArC,EAAyC;AACvC,UAAMF,MAAM,CACTG,KADG,GAEHC,IAFG,CAEE,MAAM;AACVd,wBAAOe,IAAP,CAAY,4BAAZ;AACD,KAJG,EAKHC,KALG,CAKIrB,KAAD,IAAW;AAChBK,wBAAOiB,IAAP,CAAY,yCAAZ,EAAuDtB,KAAK,CAACa,KAA7D;AACD,KAPG,CAAN;AAQA,QAAII,OAAO,CAACM,IAAZ,EAAkBb,OAAO,CAACa,IAAR;AACnB,GAX+B,CAYhC;;;AACAb,EAAAA,OAAO,CAACc,EAAR,CAAW,MAAX,EAAmBR,WAAnB,EAbgC,CAchC;;AACAN,EAAAA,OAAO,CAACc,EAAR,CAAW,QAAX,EAAqBR,WAAW,CAACS,IAAZ,CAAiB,IAAjB,EAAuB;AAAEF,IAAAA,IAAI,EAAE;AAAR,GAAvB,CAArB,EAfgC,CAgBhC;;AACAb,EAAAA,OAAO,CAACc,EAAR,CAAW,SAAX,EAAsBR,WAAW,CAACS,IAAZ,CAAiB,IAAjB,EAAuB;AAAEF,IAAAA,IAAI,EAAE;AAAR,GAAvB,CAAtB;AACAb,EAAAA,OAAO,CAACc,EAAR,CAAW,SAAX,EAAsBR,WAAW,CAACS,IAAZ,CAAiB,IAAjB,EAAuB;AAAEF,IAAAA,IAAI,EAAE;AAAR,GAAvB,CAAtB,EAlBgC,CAmBhC;;AACAb,EAAAA,OAAO,CAACc,EAAR,CAAW,mBAAX,EAAgCR,WAAW,CAACS,IAAZ,CAAiB,IAAjB,EAAuB;AAAEF,IAAAA,IAAI,EAAE;AAAR,GAAvB,CAAhC;AACD",
      "sourceRoot": "/Users/egor/Dev/ytclone/server/src/middleware/",
      "sourcesContent": [
        "import logger from \"loglevel\";\n\n// Middleware that will help us catch generic express-related errors\nfunction errorMiddleware(error, req, res, next) {\n  if (res.headersSent) {\n    next(error);\n  } else {\n    logger.error(error);\n    res.status(error.statusCode || 500);\n    res.json({\n      message: error.message,\n      ...(process.env.NODE_ENV === \"production\"\n        ? null\n        : { stack: error.stack }),\n    });\n  }\n}\n\n// This closes the server in the event of an error so\n// that our requests do not hang\nfunction setupCloseOnExit(server) {\n  async function exitHandler(options = {}) {\n    await server\n      .close()\n      .then(() => {\n        logger.info(\"Server successfully closed\");\n      })\n      .catch((error) => {\n        logger.warn(\"Something went wrong closing the server\", error.stack);\n      });\n    if (options.exit) process.exit();\n  }\n  // Do something when app is closing\n  process.on(\"exit\", exitHandler);\n  // Catches ctrl+c event\n  process.on(\"SIGINT\", exitHandler.bind(null, { exit: true }));\n  // Catches \"kill pid\" (for example: nodemon restart)\n  process.on(\"SIGUSR1\", exitHandler.bind(null, { exit: true }));\n  process.on(\"SIGUSR2\", exitHandler.bind(null, { exit: true }));\n  // Catches uncaught exceptions\n  process.on(\"uncaughtException\", exitHandler.bind(null, { exit: true }));\n}\n\nexport { errorMiddleware, setupCloseOnExit };\n"
      ]
    },
    "sourceType": "script",
    "mtime": 1611368296000
  },
  "{\"sourceRoot\":\"/Users/egor/Dev/ytclone final/server/src/\",\"caller\":{\"name\":\"@babel/register\"},\"cwd\":\"/Users/egor/Dev/ytclone final\",\"filename\":\"/Users/egor/Dev/ytclone final/server/src/index.js\",\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"/Users/egor/Dev/ytclone final\",\"plugins\":[{\"key\":\"syntax-numeric-separator\",\"visitor\":{},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"proposal-logical-assignment-operators\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"AssignmentExpression\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-nullish-coalescing-operator\",\"visitor\":{},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-optional-chaining\",\"visitor\":{},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-json-strings\",\"visitor\":{},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-optional-catch-binding\",\"visitor\":{},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-async-generators\",\"visitor\":{},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-object-rest-spread\",\"visitor\":{},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"transform-modules-commonjs\",\"visitor\":{\"CallExpression\":{\"enter\":[null]},\"Program\":{\"exit\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"proposal-dynamic-import\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"Program\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"proposal-export-namespace-from\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"ExportNamedDeclaration\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}}],\"presets\":[]}:7.12.10": {
    "metadata": {},
    "options": {
      "sourceRoot": "/Users/egor/Dev/ytclone final/server/src/",
      "caller": {
        "name": "@babel/register"
      },
      "cwd": "/Users/egor/Dev/ytclone final",
      "filename": "/Users/egor/Dev/ytclone final/server/src/index.js",
      "cloneInputAst": true,
      "babelrc": false,
      "configFile": false,
      "envName": "development",
      "root": "/Users/egor/Dev/ytclone final",
      "sourceMaps": "both",
      "ast": false,
      "passPerPreset": false,
      "plugins": [
        {
          "key": "syntax-numeric-separator",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "proposal-logical-assignment-operators",
          "visitor": {
            "_exploded": {},
            "_verified": {},
            "AssignmentExpression": {
              "enter": [
                null
              ]
            }
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-nullish-coalescing-operator",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-optional-chaining",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-json-strings",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-optional-catch-binding",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-async-generators",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-object-rest-spread",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "transform-modules-commonjs",
          "visitor": {
            "CallExpression": {
              "enter": [
                null
              ]
            },
            "Program": {
              "exit": [
                null
              ]
            },
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "proposal-dynamic-import",
          "visitor": {
            "_exploded": {},
            "_verified": {},
            "Program": {
              "enter": [
                null
              ]
            }
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "proposal-export-namespace-from",
          "visitor": {
            "_exploded": {},
            "_verified": {},
            "ExportNamedDeclaration": {
              "enter": [
                null
              ]
            }
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        }
      ],
      "presets": [],
      "parserOpts": {
        "sourceType": "module",
        "sourceFileName": "/Users/egor/Dev/ytclone final/server/src/index.js",
        "plugins": [
          "numericSeparator",
          "logicalAssignment",
          "nullishCoalescingOperator",
          "optionalChaining",
          "jsonStrings",
          "optionalCatchBinding",
          "asyncGenerators",
          "objectRestSpread",
          "dynamicImport",
          "exportNamespaceFrom"
        ]
      },
      "generatorOpts": {
        "filename": "/Users/egor/Dev/ytclone final/server/src/index.js",
        "comments": true,
        "compact": "auto",
        "sourceMaps": "both",
        "sourceRoot": "/Users/egor/Dev/ytclone final/server/src/",
        "sourceFileName": "index.js"
      }
    },
    "ast": null,
    "code": "\"use strict\";\n\nvar _loglevel = _interopRequireDefault(require(\"loglevel\"));\n\nvar _start = require(\"./start\");\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n_loglevel.default.setLevel(\"info\");\n\n(0, _start.startServer)();\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluZGV4LmpzIl0sIm5hbWVzIjpbImxvZ2dlciIsInNldExldmVsIl0sIm1hcHBpbmdzIjoiOztBQUFBOztBQUNBOzs7O0FBQ0FBLGtCQUFPQyxRQUFQLENBQWdCLE1BQWhCOztBQUNBIiwic291cmNlUm9vdCI6Ii9Vc2Vycy9lZ29yL0Rldi95dGNsb25lIGZpbmFsL3NlcnZlci9zcmMvIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGxvZ2dlciBmcm9tIFwibG9nbGV2ZWxcIjtcbmltcG9ydCB7IHN0YXJ0U2VydmVyIH0gZnJvbSBcIi4vc3RhcnRcIjtcbmxvZ2dlci5zZXRMZXZlbChcImluZm9cIik7XG5zdGFydFNlcnZlcigpO1xuIl19",
    "map": {
      "version": 3,
      "sources": [
        "index.js"
      ],
      "names": [
        "logger",
        "setLevel"
      ],
      "mappings": ";;AAAA;;AACA;;;;AACAA,kBAAOC,QAAP,CAAgB,MAAhB;;AACA",
      "sourceRoot": "/Users/egor/Dev/ytclone final/server/src/",
      "sourcesContent": [
        "import logger from \"loglevel\";\nimport { startServer } from \"./start\";\nlogger.setLevel(\"info\");\nstartServer();\n"
      ]
    },
    "sourceType": "script",
    "mtime": 1611368296000
  },
  "{\"sourceRoot\":\"/Users/egor/Dev/ytclone final/server/src/\",\"caller\":{\"name\":\"@babel/register\"},\"cwd\":\"/Users/egor/Dev/ytclone final\",\"filename\":\"/Users/egor/Dev/ytclone final/server/src/start.js\",\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"/Users/egor/Dev/ytclone final\",\"plugins\":[{\"key\":\"syntax-numeric-separator\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"proposal-logical-assignment-operators\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"AssignmentExpression\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-nullish-coalescing-operator\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-optional-chaining\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-json-strings\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-optional-catch-binding\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-async-generators\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-object-rest-spread\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"transform-modules-commonjs\",\"visitor\":{\"CallExpression\":{\"enter\":[null]},\"Program\":{\"exit\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"proposal-dynamic-import\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"Program\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"proposal-export-namespace-from\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"ExportNamedDeclaration\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}}],\"presets\":[]}:7.12.10": {
    "metadata": {},
    "options": {
      "sourceRoot": "/Users/egor/Dev/ytclone final/server/src/",
      "caller": {
        "name": "@babel/register"
      },
      "cwd": "/Users/egor/Dev/ytclone final",
      "filename": "/Users/egor/Dev/ytclone final/server/src/start.js",
      "cloneInputAst": true,
      "babelrc": false,
      "configFile": false,
      "envName": "development",
      "root": "/Users/egor/Dev/ytclone final",
      "sourceMaps": "both",
      "ast": false,
      "passPerPreset": false,
      "plugins": [
        {
          "key": "syntax-numeric-separator",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "proposal-logical-assignment-operators",
          "visitor": {
            "_exploded": {},
            "_verified": {},
            "AssignmentExpression": {
              "enter": [
                null
              ]
            }
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-nullish-coalescing-operator",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-optional-chaining",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-json-strings",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-optional-catch-binding",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-async-generators",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-object-rest-spread",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "transform-modules-commonjs",
          "visitor": {
            "CallExpression": {
              "enter": [
                null
              ]
            },
            "Program": {
              "exit": [
                null
              ]
            },
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "proposal-dynamic-import",
          "visitor": {
            "_exploded": {},
            "_verified": {},
            "Program": {
              "enter": [
                null
              ]
            }
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "proposal-export-namespace-from",
          "visitor": {
            "_exploded": {},
            "_verified": {},
            "ExportNamedDeclaration": {
              "enter": [
                null
              ]
            }
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        }
      ],
      "presets": [],
      "parserOpts": {
        "sourceType": "module",
        "sourceFileName": "/Users/egor/Dev/ytclone final/server/src/start.js",
        "plugins": [
          "numericSeparator",
          "logicalAssignment",
          "nullishCoalescingOperator",
          "optionalChaining",
          "jsonStrings",
          "optionalCatchBinding",
          "asyncGenerators",
          "objectRestSpread",
          "dynamicImport",
          "exportNamespaceFrom"
        ]
      },
      "generatorOpts": {
        "filename": "/Users/egor/Dev/ytclone final/server/src/start.js",
        "comments": true,
        "compact": "auto",
        "sourceMaps": "both",
        "sourceRoot": "/Users/egor/Dev/ytclone final/server/src/",
        "sourceFileName": "start.js"
      }
    },
    "ast": null,
    "code": "\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.startServer = startServer;\n\nvar _express = _interopRequireDefault(require(\"express\"));\n\nrequire(\"express-async-errors\");\n\nvar _path = _interopRequireDefault(require(\"path\"));\n\nvar _cors = _interopRequireDefault(require(\"cors\"));\n\nvar _loglevel = _interopRequireDefault(require(\"loglevel\"));\n\nvar _morgan = _interopRequireDefault(require(\"morgan\"));\n\nvar _dotenv = _interopRequireDefault(require(\"dotenv\"));\n\nvar _cookieParser = _interopRequireDefault(require(\"cookie-parser\"));\n\nvar _routes = require(\"./routes\");\n\nvar _error = require(\"./middleware/error\");\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n// Import this module to handle errors when using async functions for our route handlers\n_dotenv.default.config();\n\nfunction startServer({\n  port = process.env.PORT\n} = {}) {\n  const app = (0, _express.default)();\n  app.use((0, _morgan.default)(\"dev\"));\n  app.use((0, _cors.default)());\n  app.use((0, _cookieParser.default)());\n  app.use(_express.default.json()); // all API routes are prefixed with /api/v1\n\n  app.use(\"/api/v1\", (0, _routes.getRoutes)()); // Generic error handler if errors are missed by 'express-async-errors' middleware\n\n  app.use(_error.errorMiddleware); // When our project is pushed to production, we will serve // the react app using express.static() middleware\n\n  if (process.env.NODE_ENV === \"production\") {\n    app.use(_express.default.static(_path.default.resolve(__dirname, \"../client/build\"))); // Any request not caught by our API will be routed\n    // to our built react app\n\n    app.get(\"*\", function (req, res) {\n      res.sendFile(_path.default.resolve(__dirname, \"../client/build\", \"index.html\"));\n    });\n  } // This block of code is made to reliably start and close our express app\n  // It is written as a promise, which can be more easily tested\n\n\n  return new Promise(resolve => {\n    const server = app.listen(port, () => {\n      _loglevel.default.info(`Listening on port ${server.address().port}`);\n\n      const originalClose = server.close.bind(server);\n\n      server.close = () => {\n        return new Promise(resolveClose => {\n          originalClose(resolveClose);\n        });\n      }; // This function properly closes the server when the program exits\n\n\n      (0, _error.setupCloseOnExit)(server);\n      resolve(server);\n    });\n  });\n}\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInN0YXJ0LmpzIl0sIm5hbWVzIjpbImRvdGVudiIsImNvbmZpZyIsInN0YXJ0U2VydmVyIiwicG9ydCIsInByb2Nlc3MiLCJlbnYiLCJQT1JUIiwiYXBwIiwidXNlIiwiZXhwcmVzcyIsImpzb24iLCJlcnJvck1pZGRsZXdhcmUiLCJOT0RFX0VOViIsInN0YXRpYyIsInBhdGgiLCJyZXNvbHZlIiwiX19kaXJuYW1lIiwiZ2V0IiwicmVxIiwicmVzIiwic2VuZEZpbGUiLCJQcm9taXNlIiwic2VydmVyIiwibGlzdGVuIiwibG9nZ2VyIiwiaW5mbyIsImFkZHJlc3MiLCJvcmlnaW5hbENsb3NlIiwiY2xvc2UiLCJiaW5kIiwicmVzb2x2ZUNsb3NlIl0sIm1hcHBpbmdzIjoiOzs7Ozs7O0FBQUE7O0FBRUE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBRUE7O0FBQ0E7Ozs7QUFWQTtBQVlBQSxnQkFBT0MsTUFBUDs7QUFFQSxTQUFTQyxXQUFULENBQXFCO0FBQUVDLEVBQUFBLElBQUksR0FBR0MsT0FBTyxDQUFDQyxHQUFSLENBQVlDO0FBQXJCLElBQThCLEVBQW5ELEVBQXVEO0FBQ3JELFFBQU1DLEdBQUcsR0FBRyx1QkFBWjtBQUNBQSxFQUFBQSxHQUFHLENBQUNDLEdBQUosQ0FBUSxxQkFBTyxLQUFQLENBQVI7QUFDQUQsRUFBQUEsR0FBRyxDQUFDQyxHQUFKLENBQVEsb0JBQVI7QUFDQUQsRUFBQUEsR0FBRyxDQUFDQyxHQUFKLENBQVEsNEJBQVI7QUFDQUQsRUFBQUEsR0FBRyxDQUFDQyxHQUFKLENBQVFDLGlCQUFRQyxJQUFSLEVBQVIsRUFMcUQsQ0FNckQ7O0FBQ0FILEVBQUFBLEdBQUcsQ0FBQ0MsR0FBSixDQUFRLFNBQVIsRUFBbUIsd0JBQW5CLEVBUHFELENBU3JEOztBQUNBRCxFQUFBQSxHQUFHLENBQUNDLEdBQUosQ0FBUUcsc0JBQVIsRUFWcUQsQ0FZckQ7O0FBQ0EsTUFBSVAsT0FBTyxDQUFDQyxHQUFSLENBQVlPLFFBQVosS0FBeUIsWUFBN0IsRUFBMkM7QUFDekNMLElBQUFBLEdBQUcsQ0FBQ0MsR0FBSixDQUFRQyxpQkFBUUksTUFBUixDQUFlQyxjQUFLQyxPQUFMLENBQWFDLFNBQWIsRUFBd0IsaUJBQXhCLENBQWYsQ0FBUixFQUR5QyxDQUd6QztBQUNBOztBQUNBVCxJQUFBQSxHQUFHLENBQUNVLEdBQUosQ0FBUSxHQUFSLEVBQWEsVUFBVUMsR0FBVixFQUFlQyxHQUFmLEVBQW9CO0FBQy9CQSxNQUFBQSxHQUFHLENBQUNDLFFBQUosQ0FBYU4sY0FBS0MsT0FBTCxDQUFhQyxTQUFiLEVBQXdCLGlCQUF4QixFQUEyQyxZQUEzQyxDQUFiO0FBQ0QsS0FGRDtBQUdELEdBckJvRCxDQXVCckQ7QUFDQTs7O0FBQ0EsU0FBTyxJQUFJSyxPQUFKLENBQWFOLE9BQUQsSUFBYTtBQUM5QixVQUFNTyxNQUFNLEdBQUdmLEdBQUcsQ0FBQ2dCLE1BQUosQ0FBV3BCLElBQVgsRUFBaUIsTUFBTTtBQUNwQ3FCLHdCQUFPQyxJQUFQLENBQWEscUJBQW9CSCxNQUFNLENBQUNJLE9BQVAsR0FBaUJ2QixJQUFLLEVBQXZEOztBQUVBLFlBQU13QixhQUFhLEdBQUdMLE1BQU0sQ0FBQ00sS0FBUCxDQUFhQyxJQUFiLENBQWtCUCxNQUFsQixDQUF0Qjs7QUFDQUEsTUFBQUEsTUFBTSxDQUFDTSxLQUFQLEdBQWUsTUFBTTtBQUNuQixlQUFPLElBQUlQLE9BQUosQ0FBYVMsWUFBRCxJQUFrQjtBQUNuQ0gsVUFBQUEsYUFBYSxDQUFDRyxZQUFELENBQWI7QUFDRCxTQUZNLENBQVA7QUFHRCxPQUpELENBSm9DLENBU3BDOzs7QUFDQSxtQ0FBaUJSLE1BQWpCO0FBQ0FQLE1BQUFBLE9BQU8sQ0FBQ08sTUFBRCxDQUFQO0FBQ0QsS0FaYyxDQUFmO0FBYUQsR0FkTSxDQUFQO0FBZUQiLCJzb3VyY2VSb290IjoiL1VzZXJzL2Vnb3IvRGV2L3l0Y2xvbmUgZmluYWwvc2VydmVyL3NyYy8iLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgZXhwcmVzcyBmcm9tIFwiZXhwcmVzc1wiO1xuLy8gSW1wb3J0IHRoaXMgbW9kdWxlIHRvIGhhbmRsZSBlcnJvcnMgd2hlbiB1c2luZyBhc3luYyBmdW5jdGlvbnMgZm9yIG91ciByb3V0ZSBoYW5kbGVyc1xuaW1wb3J0IFwiZXhwcmVzcy1hc3luYy1lcnJvcnNcIjtcbmltcG9ydCBwYXRoIGZyb20gXCJwYXRoXCI7XG5pbXBvcnQgY29ycyBmcm9tIFwiY29yc1wiO1xuaW1wb3J0IGxvZ2dlciBmcm9tIFwibG9nbGV2ZWxcIjtcbmltcG9ydCBtb3JnYW4gZnJvbSBcIm1vcmdhblwiO1xuaW1wb3J0IGRvdGVudiBmcm9tIFwiZG90ZW52XCI7XG5pbXBvcnQgY29va2llUGFyc2VyIGZyb20gXCJjb29raWUtcGFyc2VyXCI7XG5cbmltcG9ydCB7IGdldFJvdXRlcyB9IGZyb20gXCIuL3JvdXRlc1wiO1xuaW1wb3J0IHsgZXJyb3JNaWRkbGV3YXJlLCBzZXR1cENsb3NlT25FeGl0IH0gZnJvbSBcIi4vbWlkZGxld2FyZS9lcnJvclwiO1xuXG5kb3RlbnYuY29uZmlnKCk7XG5cbmZ1bmN0aW9uIHN0YXJ0U2VydmVyKHsgcG9ydCA9IHByb2Nlc3MuZW52LlBPUlQgfSA9IHt9KSB7XG4gIGNvbnN0IGFwcCA9IGV4cHJlc3MoKTtcbiAgYXBwLnVzZShtb3JnYW4oXCJkZXZcIikpO1xuICBhcHAudXNlKGNvcnMoKSk7XG4gIGFwcC51c2UoY29va2llUGFyc2VyKCkpO1xuICBhcHAudXNlKGV4cHJlc3MuanNvbigpKTtcbiAgLy8gYWxsIEFQSSByb3V0ZXMgYXJlIHByZWZpeGVkIHdpdGggL2FwaS92MVxuICBhcHAudXNlKFwiL2FwaS92MVwiLCBnZXRSb3V0ZXMoKSk7XG5cbiAgLy8gR2VuZXJpYyBlcnJvciBoYW5kbGVyIGlmIGVycm9ycyBhcmUgbWlzc2VkIGJ5ICdleHByZXNzLWFzeW5jLWVycm9ycycgbWlkZGxld2FyZVxuICBhcHAudXNlKGVycm9yTWlkZGxld2FyZSk7XG5cbiAgLy8gV2hlbiBvdXIgcHJvamVjdCBpcyBwdXNoZWQgdG8gcHJvZHVjdGlvbiwgd2Ugd2lsbCBzZXJ2ZSAvLyB0aGUgcmVhY3QgYXBwIHVzaW5nIGV4cHJlc3Muc3RhdGljKCkgbWlkZGxld2FyZVxuICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09IFwicHJvZHVjdGlvblwiKSB7XG4gICAgYXBwLnVzZShleHByZXNzLnN0YXRpYyhwYXRoLnJlc29sdmUoX19kaXJuYW1lLCBcIi4uL2NsaWVudC9idWlsZFwiKSkpO1xuXG4gICAgLy8gQW55IHJlcXVlc3Qgbm90IGNhdWdodCBieSBvdXIgQVBJIHdpbGwgYmUgcm91dGVkXG4gICAgLy8gdG8gb3VyIGJ1aWx0IHJlYWN0IGFwcFxuICAgIGFwcC5nZXQoXCIqXCIsIGZ1bmN0aW9uIChyZXEsIHJlcykge1xuICAgICAgcmVzLnNlbmRGaWxlKHBhdGgucmVzb2x2ZShfX2Rpcm5hbWUsIFwiLi4vY2xpZW50L2J1aWxkXCIsIFwiaW5kZXguaHRtbFwiKSk7XG4gICAgfSk7XG4gIH1cblxuICAvLyBUaGlzIGJsb2NrIG9mIGNvZGUgaXMgbWFkZSB0byByZWxpYWJseSBzdGFydCBhbmQgY2xvc2Ugb3VyIGV4cHJlc3MgYXBwXG4gIC8vIEl0IGlzIHdyaXR0ZW4gYXMgYSBwcm9taXNlLCB3aGljaCBjYW4gYmUgbW9yZSBlYXNpbHkgdGVzdGVkXG4gIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4ge1xuICAgIGNvbnN0IHNlcnZlciA9IGFwcC5saXN0ZW4ocG9ydCwgKCkgPT4ge1xuICAgICAgbG9nZ2VyLmluZm8oYExpc3RlbmluZyBvbiBwb3J0ICR7c2VydmVyLmFkZHJlc3MoKS5wb3J0fWApO1xuXG4gICAgICBjb25zdCBvcmlnaW5hbENsb3NlID0gc2VydmVyLmNsb3NlLmJpbmQoc2VydmVyKTtcbiAgICAgIHNlcnZlci5jbG9zZSA9ICgpID0+IHtcbiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlQ2xvc2UpID0+IHtcbiAgICAgICAgICBvcmlnaW5hbENsb3NlKHJlc29sdmVDbG9zZSk7XG4gICAgICAgIH0pO1xuICAgICAgfTtcbiAgICAgIC8vIFRoaXMgZnVuY3Rpb24gcHJvcGVybHkgY2xvc2VzIHRoZSBzZXJ2ZXIgd2hlbiB0aGUgcHJvZ3JhbSBleGl0c1xuICAgICAgc2V0dXBDbG9zZU9uRXhpdChzZXJ2ZXIpO1xuICAgICAgcmVzb2x2ZShzZXJ2ZXIpO1xuICAgIH0pO1xuICB9KTtcbn1cblxuZXhwb3J0IHsgc3RhcnRTZXJ2ZXIgfTtcbiJdfQ==",
    "map": {
      "version": 3,
      "sources": [
        "start.js"
      ],
      "names": [
        "dotenv",
        "config",
        "startServer",
        "port",
        "process",
        "env",
        "PORT",
        "app",
        "use",
        "express",
        "json",
        "errorMiddleware",
        "NODE_ENV",
        "static",
        "path",
        "resolve",
        "__dirname",
        "get",
        "req",
        "res",
        "sendFile",
        "Promise",
        "server",
        "listen",
        "logger",
        "info",
        "address",
        "originalClose",
        "close",
        "bind",
        "resolveClose"
      ],
      "mappings": ";;;;;;;AAAA;;AAEA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AAEA;;AACA;;;;AAVA;AAYAA,gBAAOC,MAAP;;AAEA,SAASC,WAAT,CAAqB;AAAEC,EAAAA,IAAI,GAAGC,OAAO,CAACC,GAAR,CAAYC;AAArB,IAA8B,EAAnD,EAAuD;AACrD,QAAMC,GAAG,GAAG,uBAAZ;AACAA,EAAAA,GAAG,CAACC,GAAJ,CAAQ,qBAAO,KAAP,CAAR;AACAD,EAAAA,GAAG,CAACC,GAAJ,CAAQ,oBAAR;AACAD,EAAAA,GAAG,CAACC,GAAJ,CAAQ,4BAAR;AACAD,EAAAA,GAAG,CAACC,GAAJ,CAAQC,iBAAQC,IAAR,EAAR,EALqD,CAMrD;;AACAH,EAAAA,GAAG,CAACC,GAAJ,CAAQ,SAAR,EAAmB,wBAAnB,EAPqD,CASrD;;AACAD,EAAAA,GAAG,CAACC,GAAJ,CAAQG,sBAAR,EAVqD,CAYrD;;AACA,MAAIP,OAAO,CAACC,GAAR,CAAYO,QAAZ,KAAyB,YAA7B,EAA2C;AACzCL,IAAAA,GAAG,CAACC,GAAJ,CAAQC,iBAAQI,MAAR,CAAeC,cAAKC,OAAL,CAAaC,SAAb,EAAwB,iBAAxB,CAAf,CAAR,EADyC,CAGzC;AACA;;AACAT,IAAAA,GAAG,CAACU,GAAJ,CAAQ,GAAR,EAAa,UAAUC,GAAV,EAAeC,GAAf,EAAoB;AAC/BA,MAAAA,GAAG,CAACC,QAAJ,CAAaN,cAAKC,OAAL,CAAaC,SAAb,EAAwB,iBAAxB,EAA2C,YAA3C,CAAb;AACD,KAFD;AAGD,GArBoD,CAuBrD;AACA;;;AACA,SAAO,IAAIK,OAAJ,CAAaN,OAAD,IAAa;AAC9B,UAAMO,MAAM,GAAGf,GAAG,CAACgB,MAAJ,CAAWpB,IAAX,EAAiB,MAAM;AACpCqB,wBAAOC,IAAP,CAAa,qBAAoBH,MAAM,CAACI,OAAP,GAAiBvB,IAAK,EAAvD;;AAEA,YAAMwB,aAAa,GAAGL,MAAM,CAACM,KAAP,CAAaC,IAAb,CAAkBP,MAAlB,CAAtB;;AACAA,MAAAA,MAAM,CAACM,KAAP,GAAe,MAAM;AACnB,eAAO,IAAIP,OAAJ,CAAaS,YAAD,IAAkB;AACnCH,UAAAA,aAAa,CAACG,YAAD,CAAb;AACD,SAFM,CAAP;AAGD,OAJD,CAJoC,CASpC;;;AACA,mCAAiBR,MAAjB;AACAP,MAAAA,OAAO,CAACO,MAAD,CAAP;AACD,KAZc,CAAf;AAaD,GAdM,CAAP;AAeD",
      "sourceRoot": "/Users/egor/Dev/ytclone final/server/src/",
      "sourcesContent": [
        "import express from \"express\";\n// Import this module to handle errors when using async functions for our route handlers\nimport \"express-async-errors\";\nimport path from \"path\";\nimport cors from \"cors\";\nimport logger from \"loglevel\";\nimport morgan from \"morgan\";\nimport dotenv from \"dotenv\";\nimport cookieParser from \"cookie-parser\";\n\nimport { getRoutes } from \"./routes\";\nimport { errorMiddleware, setupCloseOnExit } from \"./middleware/error\";\n\ndotenv.config();\n\nfunction startServer({ port = process.env.PORT } = {}) {\n  const app = express();\n  app.use(morgan(\"dev\"));\n  app.use(cors());\n  app.use(cookieParser());\n  app.use(express.json());\n  // all API routes are prefixed with /api/v1\n  app.use(\"/api/v1\", getRoutes());\n\n  // Generic error handler if errors are missed by 'express-async-errors' middleware\n  app.use(errorMiddleware);\n\n  // When our project is pushed to production, we will serve // the react app using express.static() middleware\n  if (process.env.NODE_ENV === \"production\") {\n    app.use(express.static(path.resolve(__dirname, \"../client/build\")));\n\n    // Any request not caught by our API will be routed\n    // to our built react app\n    app.get(\"*\", function (req, res) {\n      res.sendFile(path.resolve(__dirname, \"../client/build\", \"index.html\"));\n    });\n  }\n\n  // This block of code is made to reliably start and close our express app\n  // It is written as a promise, which can be more easily tested\n  return new Promise((resolve) => {\n    const server = app.listen(port, () => {\n      logger.info(`Listening on port ${server.address().port}`);\n\n      const originalClose = server.close.bind(server);\n      server.close = () => {\n        return new Promise((resolveClose) => {\n          originalClose(resolveClose);\n        });\n      };\n      // This function properly closes the server when the program exits\n      setupCloseOnExit(server);\n      resolve(server);\n    });\n  });\n}\n\nexport { startServer };\n"
      ]
    },
    "sourceType": "script",
    "mtime": 1611368296000
  },
  "{\"sourceRoot\":\"/Users/egor/Dev/ytclone final/server/src/routes/\",\"caller\":{\"name\":\"@babel/register\"},\"cwd\":\"/Users/egor/Dev/ytclone final\",\"filename\":\"/Users/egor/Dev/ytclone final/server/src/routes/index.js\",\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"/Users/egor/Dev/ytclone final\",\"plugins\":[{\"key\":\"syntax-numeric-separator\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"proposal-logical-assignment-operators\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"AssignmentExpression\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-nullish-coalescing-operator\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-optional-chaining\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-json-strings\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-optional-catch-binding\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-async-generators\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-object-rest-spread\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"transform-modules-commonjs\",\"visitor\":{\"CallExpression\":{\"enter\":[null]},\"Program\":{\"exit\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"proposal-dynamic-import\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"Program\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"proposal-export-namespace-from\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"ExportNamedDeclaration\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}}],\"presets\":[]}:7.12.10": {
    "metadata": {},
    "options": {
      "sourceRoot": "/Users/egor/Dev/ytclone final/server/src/routes/",
      "caller": {
        "name": "@babel/register"
      },
      "cwd": "/Users/egor/Dev/ytclone final",
      "filename": "/Users/egor/Dev/ytclone final/server/src/routes/index.js",
      "cloneInputAst": true,
      "babelrc": false,
      "configFile": false,
      "envName": "development",
      "root": "/Users/egor/Dev/ytclone final",
      "sourceMaps": "both",
      "ast": false,
      "passPerPreset": false,
      "plugins": [
        {
          "key": "syntax-numeric-separator",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "proposal-logical-assignment-operators",
          "visitor": {
            "_exploded": {},
            "_verified": {},
            "AssignmentExpression": {
              "enter": [
                null
              ]
            }
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-nullish-coalescing-operator",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-optional-chaining",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-json-strings",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-optional-catch-binding",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-async-generators",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-object-rest-spread",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "transform-modules-commonjs",
          "visitor": {
            "CallExpression": {
              "enter": [
                null
              ]
            },
            "Program": {
              "exit": [
                null
              ]
            },
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "proposal-dynamic-import",
          "visitor": {
            "_exploded": {},
            "_verified": {},
            "Program": {
              "enter": [
                null
              ]
            }
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "proposal-export-namespace-from",
          "visitor": {
            "_exploded": {},
            "_verified": {},
            "ExportNamedDeclaration": {
              "enter": [
                null
              ]
            }
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        }
      ],
      "presets": [],
      "parserOpts": {
        "sourceType": "module",
        "sourceFileName": "/Users/egor/Dev/ytclone final/server/src/routes/index.js",
        "plugins": [
          "numericSeparator",
          "logicalAssignment",
          "nullishCoalescingOperator",
          "optionalChaining",
          "jsonStrings",
          "optionalCatchBinding",
          "asyncGenerators",
          "objectRestSpread",
          "dynamicImport",
          "exportNamespaceFrom"
        ]
      },
      "generatorOpts": {
        "filename": "/Users/egor/Dev/ytclone final/server/src/routes/index.js",
        "comments": true,
        "compact": "auto",
        "sourceMaps": "both",
        "sourceRoot": "/Users/egor/Dev/ytclone final/server/src/routes/",
        "sourceFileName": "index.js"
      }
    },
    "ast": null,
    "code": "\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.getRoutes = getRoutes;\n\nvar _express = _interopRequireDefault(require(\"express\"));\n\nvar _auth = require(\"./auth\");\n\nvar _user = require(\"./user\");\n\nvar _video = require(\"./video\");\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction getRoutes() {\n  // All routes in our Node API are placed on this router\n  const router = _express.default.Router(); // router.use() prefixes our route (i.e. /api/v1/auth)\n\n\n  router.use(\"/auth\", (0, _auth.getAuthRoutes)());\n  router.use(\"/users\", (0, _user.getUserRoutes)());\n  router.use(\"/videos\", (0, _video.getVideoRoutes)());\n  return router;\n}\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluZGV4LmpzIl0sIm5hbWVzIjpbImdldFJvdXRlcyIsInJvdXRlciIsImV4cHJlc3MiLCJSb3V0ZXIiLCJ1c2UiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFBQTs7QUFFQTs7QUFDQTs7QUFDQTs7OztBQUVBLFNBQVNBLFNBQVQsR0FBcUI7QUFDbkI7QUFDQSxRQUFNQyxNQUFNLEdBQUdDLGlCQUFRQyxNQUFSLEVBQWYsQ0FGbUIsQ0FJbkI7OztBQUNBRixFQUFBQSxNQUFNLENBQUNHLEdBQVAsQ0FBVyxPQUFYLEVBQW9CLDBCQUFwQjtBQUNBSCxFQUFBQSxNQUFNLENBQUNHLEdBQVAsQ0FBVyxRQUFYLEVBQXFCLDBCQUFyQjtBQUNBSCxFQUFBQSxNQUFNLENBQUNHLEdBQVAsQ0FBVyxTQUFYLEVBQXNCLDRCQUF0QjtBQUVBLFNBQU9ILE1BQVA7QUFDRCIsInNvdXJjZVJvb3QiOiIvVXNlcnMvZWdvci9EZXYveXRjbG9uZSBmaW5hbC9zZXJ2ZXIvc3JjL3JvdXRlcy8iLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgZXhwcmVzcyBmcm9tIFwiZXhwcmVzc1wiO1xuXG5pbXBvcnQgeyBnZXRBdXRoUm91dGVzIH0gZnJvbSBcIi4vYXV0aFwiO1xuaW1wb3J0IHsgZ2V0VXNlclJvdXRlcyB9IGZyb20gXCIuL3VzZXJcIjtcbmltcG9ydCB7IGdldFZpZGVvUm91dGVzIH0gZnJvbSBcIi4vdmlkZW9cIjtcblxuZnVuY3Rpb24gZ2V0Um91dGVzKCkge1xuICAvLyBBbGwgcm91dGVzIGluIG91ciBOb2RlIEFQSSBhcmUgcGxhY2VkIG9uIHRoaXMgcm91dGVyXG4gIGNvbnN0IHJvdXRlciA9IGV4cHJlc3MuUm91dGVyKCk7XG5cbiAgLy8gcm91dGVyLnVzZSgpIHByZWZpeGVzIG91ciByb3V0ZSAoaS5lLiAvYXBpL3YxL2F1dGgpXG4gIHJvdXRlci51c2UoXCIvYXV0aFwiLCBnZXRBdXRoUm91dGVzKCkpO1xuICByb3V0ZXIudXNlKFwiL3VzZXJzXCIsIGdldFVzZXJSb3V0ZXMoKSk7XG4gIHJvdXRlci51c2UoXCIvdmlkZW9zXCIsIGdldFZpZGVvUm91dGVzKCkpO1xuXG4gIHJldHVybiByb3V0ZXI7XG59XG5cbmV4cG9ydCB7IGdldFJvdXRlcyB9O1xuIl19",
    "map": {
      "version": 3,
      "sources": [
        "index.js"
      ],
      "names": [
        "getRoutes",
        "router",
        "express",
        "Router",
        "use"
      ],
      "mappings": ";;;;;;;AAAA;;AAEA;;AACA;;AACA;;;;AAEA,SAASA,SAAT,GAAqB;AACnB;AACA,QAAMC,MAAM,GAAGC,iBAAQC,MAAR,EAAf,CAFmB,CAInB;;;AACAF,EAAAA,MAAM,CAACG,GAAP,CAAW,OAAX,EAAoB,0BAApB;AACAH,EAAAA,MAAM,CAACG,GAAP,CAAW,QAAX,EAAqB,0BAArB;AACAH,EAAAA,MAAM,CAACG,GAAP,CAAW,SAAX,EAAsB,4BAAtB;AAEA,SAAOH,MAAP;AACD",
      "sourceRoot": "/Users/egor/Dev/ytclone final/server/src/routes/",
      "sourcesContent": [
        "import express from \"express\";\n\nimport { getAuthRoutes } from \"./auth\";\nimport { getUserRoutes } from \"./user\";\nimport { getVideoRoutes } from \"./video\";\n\nfunction getRoutes() {\n  // All routes in our Node API are placed on this router\n  const router = express.Router();\n\n  // router.use() prefixes our route (i.e. /api/v1/auth)\n  router.use(\"/auth\", getAuthRoutes());\n  router.use(\"/users\", getUserRoutes());\n  router.use(\"/videos\", getVideoRoutes());\n\n  return router;\n}\n\nexport { getRoutes };\n"
      ]
    },
    "sourceType": "script",
    "mtime": 1611368296000
  },
  "{\"sourceRoot\":\"/Users/egor/Dev/ytclone final/server/src/routes/\",\"caller\":{\"name\":\"@babel/register\"},\"cwd\":\"/Users/egor/Dev/ytclone final\",\"filename\":\"/Users/egor/Dev/ytclone final/server/src/routes/auth.js\",\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"/Users/egor/Dev/ytclone final\",\"plugins\":[{\"key\":\"syntax-numeric-separator\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"proposal-logical-assignment-operators\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"AssignmentExpression\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-nullish-coalescing-operator\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-optional-chaining\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-json-strings\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-optional-catch-binding\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-async-generators\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-object-rest-spread\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"transform-modules-commonjs\",\"visitor\":{\"CallExpression\":{\"enter\":[null]},\"Program\":{\"exit\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"proposal-dynamic-import\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"Program\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"proposal-export-namespace-from\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"ExportNamedDeclaration\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}}],\"presets\":[]}:7.12.10": {
    "metadata": {},
    "options": {
      "sourceRoot": "/Users/egor/Dev/ytclone final/server/src/routes/",
      "caller": {
        "name": "@babel/register"
      },
      "cwd": "/Users/egor/Dev/ytclone final",
      "filename": "/Users/egor/Dev/ytclone final/server/src/routes/auth.js",
      "cloneInputAst": true,
      "babelrc": false,
      "configFile": false,
      "envName": "development",
      "root": "/Users/egor/Dev/ytclone final",
      "sourceMaps": "both",
      "ast": false,
      "passPerPreset": false,
      "plugins": [
        {
          "key": "syntax-numeric-separator",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "proposal-logical-assignment-operators",
          "visitor": {
            "_exploded": {},
            "_verified": {},
            "AssignmentExpression": {
              "enter": [
                null
              ]
            }
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-nullish-coalescing-operator",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-optional-chaining",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-json-strings",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-optional-catch-binding",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-async-generators",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-object-rest-spread",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "transform-modules-commonjs",
          "visitor": {
            "CallExpression": {
              "enter": [
                null
              ]
            },
            "Program": {
              "exit": [
                null
              ]
            },
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "proposal-dynamic-import",
          "visitor": {
            "_exploded": {},
            "_verified": {},
            "Program": {
              "enter": [
                null
              ]
            }
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "proposal-export-namespace-from",
          "visitor": {
            "_exploded": {},
            "_verified": {},
            "ExportNamedDeclaration": {
              "enter": [
                null
              ]
            }
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        }
      ],
      "presets": [],
      "parserOpts": {
        "sourceType": "module",
        "sourceFileName": "/Users/egor/Dev/ytclone final/server/src/routes/auth.js",
        "plugins": [
          "numericSeparator",
          "logicalAssignment",
          "nullishCoalescingOperator",
          "optionalChaining",
          "jsonStrings",
          "optionalCatchBinding",
          "asyncGenerators",
          "objectRestSpread",
          "dynamicImport",
          "exportNamespaceFrom"
        ]
      },
      "generatorOpts": {
        "filename": "/Users/egor/Dev/ytclone final/server/src/routes/auth.js",
        "comments": true,
        "compact": "auto",
        "sourceMaps": "both",
        "sourceRoot": "/Users/egor/Dev/ytclone final/server/src/routes/",
        "sourceFileName": "auth.js"
      }
    },
    "ast": null,
    "code": "\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.getAuthRoutes = getAuthRoutes;\n\nvar _client = require(\"@prisma/client\");\n\nvar _express = _interopRequireDefault(require(\"express\"));\n\nvar _jsonwebtoken = _interopRequireDefault(require(\"jsonwebtoken\"));\n\nvar _authorization = require(\"../middleware/authorization\");\n\nvar _googleAuthLibrary = require(\"google-auth-library\");\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nconst client = new _googleAuthLibrary.OAuth2Client(process.env.GOOGLE_CLIENT_ID);\nconst prisma = new _client.PrismaClient();\n\nfunction getAuthRoutes() {\n  const router = _express.default.Router();\n\n  router.post(\"/google-login\", googleLogin);\n  router.get(\"/me\", _authorization.protect, me);\n  router.get(\"/signout\", signout);\n  return router;\n} // All controllers/utility functions here\n\n\nasync function googleLogin(req, res) {\n  const {\n    idToken\n  } = req.body;\n  const ticket = await client.verifyIdToken({\n    idToken,\n    audience: process.env.GOOGLE_CLIENT_ID\n  });\n  const {\n    name,\n    picture,\n    email\n  } = ticket.getPayload();\n  let user = await prisma.user.findUnique({\n    where: {\n      email\n    }\n  });\n\n  if (!user) {\n    user = await prisma.user.create({\n      data: {\n        email,\n        username: name,\n        avatar: picture\n      }\n    });\n  }\n\n  const tokenPayload = {\n    id: user.id\n  };\n\n  const token = _jsonwebtoken.default.sign(tokenPayload, process.env.JWT_SECRET, {\n    expiresIn: process.env.JWT_EXPIRE\n  });\n\n  res.cookie(\"token\", token, {\n    httpOnly: true\n  });\n  res.status(200).send(token);\n}\n\nasync function me(req, res) {\n  const subscriptions = await prisma.subscription.findMany({\n    where: {\n      subscriberId: {\n        equals: req.user.id\n      }\n    }\n  });\n  const channelIds = subscriptions.map(sub => sub.subscribedToId);\n  const channels = await prisma.user.findMany({\n    where: {\n      id: {\n        in: channelIds\n      }\n    }\n  });\n  const user = req.user;\n  user.channels = channels;\n  res.status(200).json({\n    user\n  });\n}\n\nfunction signout(req, res) {\n  res.clearCookie(\"token\");\n  res.status(200).json({});\n}\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF1dGguanMiXSwibmFtZXMiOlsiY2xpZW50IiwiT0F1dGgyQ2xpZW50IiwicHJvY2VzcyIsImVudiIsIkdPT0dMRV9DTElFTlRfSUQiLCJwcmlzbWEiLCJQcmlzbWFDbGllbnQiLCJnZXRBdXRoUm91dGVzIiwicm91dGVyIiwiZXhwcmVzcyIsIlJvdXRlciIsInBvc3QiLCJnb29nbGVMb2dpbiIsImdldCIsInByb3RlY3QiLCJtZSIsInNpZ25vdXQiLCJyZXEiLCJyZXMiLCJpZFRva2VuIiwiYm9keSIsInRpY2tldCIsInZlcmlmeUlkVG9rZW4iLCJhdWRpZW5jZSIsIm5hbWUiLCJwaWN0dXJlIiwiZW1haWwiLCJnZXRQYXlsb2FkIiwidXNlciIsImZpbmRVbmlxdWUiLCJ3aGVyZSIsImNyZWF0ZSIsImRhdGEiLCJ1c2VybmFtZSIsImF2YXRhciIsInRva2VuUGF5bG9hZCIsImlkIiwidG9rZW4iLCJqd3QiLCJzaWduIiwiSldUX1NFQ1JFVCIsImV4cGlyZXNJbiIsIkpXVF9FWFBJUkUiLCJjb29raWUiLCJodHRwT25seSIsInN0YXR1cyIsInNlbmQiLCJzdWJzY3JpcHRpb25zIiwic3Vic2NyaXB0aW9uIiwiZmluZE1hbnkiLCJzdWJzY3JpYmVySWQiLCJlcXVhbHMiLCJjaGFubmVsSWRzIiwibWFwIiwic3ViIiwic3Vic2NyaWJlZFRvSWQiLCJjaGFubmVscyIsImluIiwianNvbiIsImNsZWFyQ29va2llIl0sIm1hcHBpbmdzIjoiOzs7Ozs7O0FBQUE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7Ozs7QUFFQSxNQUFNQSxNQUFNLEdBQUcsSUFBSUMsK0JBQUosQ0FBaUJDLE9BQU8sQ0FBQ0MsR0FBUixDQUFZQyxnQkFBN0IsQ0FBZjtBQUNBLE1BQU1DLE1BQU0sR0FBRyxJQUFJQyxvQkFBSixFQUFmOztBQUVBLFNBQVNDLGFBQVQsR0FBeUI7QUFDdkIsUUFBTUMsTUFBTSxHQUFHQyxpQkFBUUMsTUFBUixFQUFmOztBQUVBRixFQUFBQSxNQUFNLENBQUNH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TUFBSixDQUFXLEdBQVgsRUFBZ0JhLElBQWhCLENBQXFCO0FBQUU5QixJQUFBQTtBQUFGLEdBQXJCO0FBQ0Q7O0FBRUQsU0FBU1osT0FBVCxDQUFpQkMsR0FBakIsRUFBc0JDLEdBQXRCLEVBQTJCO0FBQ3pCQSxFQUFBQSxHQUFHLENBQUN5QyxXQUFKLENBQWdCLE9BQWhCO0FBQ0F6QyxFQUFBQSxHQUFHLENBQUMyQixNQUFKLENBQVcsR0FBWCxFQUFnQmEsSUFBaEIsQ0FBcUIsRUFBckI7QUFDRCIsInNvdXJjZVJvb3QiOiIvVXNlcnMvZWdvci9EZXYveXRjbG9uZSBmaW5hbC9zZXJ2ZXIvc3JjL3JvdXRlcy8iLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBQcmlzbWFDbGllbnQgfSBmcm9tIFwiQHByaXNtYS9jbGllbnRcIjtcbmltcG9ydCBleHByZXNzIGZyb20gXCJleHByZXNzXCI7XG5pbXBvcnQgand0IGZyb20gXCJqc29ud2VidG9rZW5cIjtcbmltcG9ydCB7IHByb3RlY3QgfSBmcm9tIFwiLi4vbWlkZGxld2FyZS9hdXRob3JpemF0aW9uXCI7XG5pbXBvcnQgeyBPQXV0aDJDbGllbnQgfSBmcm9tIFwiZ29vZ2xlLWF1dGgtbGlicmFyeVwiO1xuXG5jb25zdCBjbGllbnQgPSBuZXcgT0F1dGgyQ2xpZW50KHByb2Nlc3MuZW52LkdPT0dMRV9DTElFTlRfSUQpO1xuY29uc3QgcHJpc21hID0gbmV3IFByaXNtYUNsaWVudCgpO1xuXG5mdW5jdGlvbiBnZXRBdXRoUm91dGVzKCkge1xuICBjb25zdCByb3V0ZXIgPSBleHByZXNzLlJvdXRlcigpO1xuXG4gIHJvdXRlci5wb3N0KFwiL2dvb2dsZS1sb2dpblwiLCBnb29nbGVMb2dpbik7XG4gIHJvdXRlci5nZXQoXCIvbWVcIiwgcHJvdGVjdCwgbWUpO1xuICByb3V0ZXIuZ2V0KFwiL3NpZ25vdXRcIiwgc2lnbm91dCk7XG5cbiAgcmV0dXJuIHJvdXRlcjtcbn1cblxuLy8gQWxsIGNvbnRyb2xsZXJzL3V0aWxpdHkgZnVuY3Rpb25zIGhlcmVcbmFzeW5jIGZ1bmN0aW9uIGdvb2dsZUxvZ2luKHJlcSwgcmVzKSB7XG4gIGNvbnN0IHsgaWRUb2tlbiB9ID0gcmVxLmJvZHk7XG4gIGNvbnN0IHRpY2tldCA9IGF3YWl0IGNsaWVudC52ZXJpZnlJZFRva2VuKHtcbiAgICBpZFRva2VuLFxuICAgIGF1ZGllbmNlOiBwcm9jZXNzLmVudi5HT09HTEVfQ0xJRU5UX0lELFxuICB9KTtcbiAgY29uc3QgeyBuYW1lLCBwaWN0dXJlLCBlbWFpbCB9ID0gdGlja2V0LmdldFBheWxvYWQoKTtcblxuICBsZXQgdXNlciA9IGF3YWl0IHByaXNtYS51c2VyLmZpbmRVbmlxdWUoe1xuICAgIHdoZXJlOiB7XG4gICAgICBlbWFpbCxcbiAgICB9LFxuICB9KTtcblxuICBpZiAoIXVzZXIpIHtcbiAgICB1c2VyID0gYXdhaXQgcHJpc21hLnVzZXIuY3JlYXRlKHtcbiAgICAgIGRhdGE6IHtcbiAgICAgICAgZW1haWwsXG4gICAgICAgIHVzZXJuYW1lOiBuYW1lLFxuICAgICAgICBhdmF0YXI6IHBpY3R1cmUsXG4gICAgICB9LFxuICAgIH0pO1xuICB9XG5cbiAgY29uc3QgdG9rZW5QYXlsb2FkID0geyBpZDogdXNlci5pZCB9O1xuICBjb25zdCB0b2tlbiA9IGp3dC5zaWduKHRva2VuUGF5bG9hZCwgcHJvY2Vzcy5lbnYuSldUX1NFQ1JFVCwge1xuICAgIGV4cGlyZXNJbjogcHJvY2Vzcy5lbnYuSldUX0VYUElSRSxcbiAgfSk7XG5cbiAgcmVzLmNvb2tpZShcInRva2VuXCIsIHRva2VuLCB7IGh0dHBPbmx5OiB0cnVlIH0pO1xuICByZXMuc3RhdHVzKDIwMCkuc2VuZCh0b2tlbik7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIG1lKHJlcSwgcmVzKSB7XG4gIGNvbnN0IHN1YnNjcmlwdGlvbnMgPSBhd2FpdCBwcmlzbWEuc3Vic2NyaXB0aW9uLmZpbmRNYW55KHtcbiAgICB3aGVyZToge1xuICAgICAgc3Vic2NyaWJlcklkOiB7XG4gICAgICAgIGVxdWFsczogcmVxLnVzZXIuaWQsXG4gICAgICB9LFxuICAgIH0sXG4gIH0pO1xuXG4gIGNvbnN0IGNoYW5uZWxJZHMgPSBzdWJzY3JpcHRpb25zLm1hcCgoc3ViKSA9PiBzdWIuc3Vic2NyaWJlZFRvSWQpO1xuXG4gIGNvbnN0IGNoYW5uZWxzID0gYXdhaXQgcHJpc21hLnVzZXIuZmluZE1hbnkoe1xuICAgIHdoZXJlOiB7XG4gICAgICBpZDoge1xuICAgICAgICBpbjogY2hhbm5lbElkcyxcbiAgICAgIH0sXG4gICAgfSxcbiAgfSk7XG5cbiAgY29uc3QgdXNlciA9IHJlcS51c2VyO1xuICB1c2VyLmNoYW5uZWxzID0gY2hhbm5lbHM7XG5cbiAgcmVzLnN0YXR1cygyMDApLmpzb24oeyB1c2VyIH0pO1xufVxuXG5mdW5jdGlvbiBzaWdub3V0KHJlcSwgcmVzKSB7XG4gIHJlcy5jbGVhckNvb2tpZShcInRva2VuXCIpO1xuICByZXMuc3RhdHVzKDIwMCkuanNvbih7fSk7XG59XG5cbmV4cG9ydCB7IGdldEF1dGhSb3V0ZXMgfTtcbiJdfQ==",
    "map": {
      "version": 3,
      "sources": [
        "auth.js"
      ],
      "names": [
        "client",
        "OAuth2Client",
        "process",
        "env",
        "GOOGLE_CLIENT_ID",
        "prisma",
        "PrismaClient",
        "getAuthRoutes",
        "router",
        "express",
        "Router",
        "post",
        "googleLogin",
        "get",
        "protect",
        "me",
        "signout",
        "req",
        "res",
        "idToken",
        "body",
        "ticket",
        "verifyIdToken",
        "audience",
        "name",
        "picture",
        "email",
        "getPayload",
        "user",
        "findUnique",
        "where",
        "create",
        "data",
        "username",
        "avatar",
        "tokenPayload",
        "id",
        "token",
        "jwt",
        "sign",
        "JWT_SECRET",
        "expiresIn",
        "JWT_EXPIRE",
        "cookie",
        "httpOnly",
        "status",
        "send",
        "subscriptions",
        "subscription",
        "findMany",
        "subscriberId",
        "equals",
        "channelIds",
        "map",
        "sub",
        "subscribedToId",
        "channels",
        "in",
        "json",
        "clearCookie"
      ],
      "mappings": "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",
      "sourceRoot": "/Users/egor/Dev/ytclone final/server/src/routes/",
      "sourcesContent": [
        "import { PrismaClient } from \"@prisma/client\";\nimport express from \"express\";\nimport jwt from \"jsonwebtoken\";\nimport { protect } from \"../middleware/authorization\";\nimport { OAuth2Client } from \"google-auth-library\";\n\nconst client = new OAuth2Client(process.env.GOOGLE_CLIENT_ID);\nconst prisma = new PrismaClient();\n\nfunction getAuthRoutes() {\n  const router = express.Router();\n\n  router.post(\"/google-login\", googleLogin);\n  router.get(\"/me\", protect, me);\n  router.get(\"/signout\", signout);\n\n  return router;\n}\n\n// All controllers/utility functions here\nasync function googleLogin(req, res) {\n  const { idToken } = req.body;\n  const ticket = await client.verifyIdToken({\n    idToken,\n    audience: process.env.GOOGLE_CLIENT_ID,\n  });\n  const { name, picture, email } = ticket.getPayload();\n\n  let user = await prisma.user.findUnique({\n    where: {\n      email,\n    },\n  });\n\n  if (!user) {\n    user = await prisma.user.create({\n      data: {\n        email,\n        username: name,\n        avatar: picture,\n      },\n    });\n  }\n\n  const tokenPayload = { id: user.id };\n  const token = jwt.sign(tokenPayload, process.env.JWT_SECRET, {\n    expiresIn: process.env.JWT_EXPIRE,\n  });\n\n  res.cookie(\"token\", token, { httpOnly: true });\n  res.status(200).send(token);\n}\n\nasync function me(req, res) {\n  const subscriptions = await prisma.subscription.findMany({\n    where: {\n      subscriberId: {\n        equals: req.user.id,\n      },\n    },\n  });\n\n  const channelIds = subscriptions.map((sub) => sub.subscribedToId);\n\n  const channels = await prisma.user.findMany({\n    where: {\n      id: {\n        in: channelIds,\n      },\n    },\n  });\n\n  const user = req.user;\n  user.channels = channels;\n\n  res.status(200).json({ user });\n}\n\nfunction signout(req, res) {\n  res.clearCookie(\"token\");\n  res.status(200).json({});\n}\n\nexport { getAuthRoutes };\n"
      ]
    },
    "sourceType": "script",
    "mtime": 1611452835000
  },
  "{\"sourceRoot\":\"/Users/egor/Dev/ytclone final/server/src/middleware/\",\"caller\":{\"name\":\"@babel/register\"},\"cwd\":\"/Users/egor/Dev/ytclone final\",\"filename\":\"/Users/egor/Dev/ytclone final/server/src/middleware/authorization.js\",\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"/Users/egor/Dev/ytclone final\",\"plugins\":[{\"key\":\"syntax-numeric-separator\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"proposal-logical-assignment-operators\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"AssignmentExpression\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-nullish-coalescing-operator\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-optional-chaining\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-json-strings\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-optional-catch-binding\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-async-generators\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-object-rest-spread\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"transform-modules-commonjs\",\"visitor\":{\"CallExpression\":{\"enter\":[null]},\"Program\":{\"exit\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"proposal-dynamic-import\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"Program\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"proposal-export-namespace-from\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"ExportNamedDeclaration\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}}],\"presets\":[]}:7.12.10": {
    "metadata": {},
    "options": {
      "sourceRoot": "/Users/egor/Dev/ytclone final/server/src/middleware/",
      "caller": {
        "name": "@babel/register"
      },
      "cwd": "/Users/egor/Dev/ytclone final",
      "filename": "/Users/egor/Dev/ytclone final/server/src/middleware/authorization.js",
      "cloneInputAst": true,
      "babelrc": false,
      "configFile": false,
      "envName": "development",
      "root": "/Users/egor/Dev/ytclone final",
      "sourceMaps": "both",
      "ast": false,
      "passPerPreset": false,
      "plugins": [
        {
          "key": "syntax-numeric-separator",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "proposal-logical-assignment-operators",
          "visitor": {
            "_exploded": {},
            "_verified": {},
            "AssignmentExpression": {
              "enter": [
                null
              ]
            }
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-nullish-coalescing-operator",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-optional-chaining",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-json-strings",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-optional-catch-binding",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-async-generators",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-object-rest-spread",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "transform-modules-commonjs",
          "visitor": {
            "CallExpression": {
              "enter": [
                null
              ]
            },
            "Program": {
              "exit": [
                null
              ]
            },
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "proposal-dynamic-import",
          "visitor": {
            "_exploded": {},
            "_verified": {},
            "Program": {
              "enter": [
                null
              ]
            }
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "proposal-export-namespace-from",
          "visitor": {
            "_exploded": {},
            "_verified": {},
            "ExportNamedDeclaration": {
              "enter": [
                null
              ]
            }
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        }
      ],
      "presets": [],
      "parserOpts": {
        "sourceType": "module",
        "sourceFileName": "/Users/egor/Dev/ytclone final/server/src/middleware/authorization.js",
        "plugins": [
          "numericSeparator",
          "logicalAssignment",
          "nullishCoalescingOperator",
          "optionalChaining",
          "jsonStrings",
          "optionalCatchBinding",
          "asyncGenerators",
          "objectRestSpread",
          "dynamicImport",
          "exportNamespaceFrom"
        ]
      },
      "generatorOpts": {
        "filename": "/Users/egor/Dev/ytclone final/server/src/middleware/authorization.js",
        "comments": true,
        "compact": "auto",
        "sourceMaps": "both",
        "sourceRoot": "/Users/egor/Dev/ytclone final/server/src/middleware/",
        "sourceFileName": "authorization.js"
      }
    },
    "ast": null,
    "code": "\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.getAuthUser = getAuthUser;\nexports.protect = protect;\n\nvar _client = require(\"@prisma/client\");\n\nvar _jsonwebtoken = _interopRequireDefault(require(\"jsonwebtoken\"));\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nconst prisma = new _client.PrismaClient();\n\nasync function getAuthUser(req, res, next) {\n  if (!req.cookies.token) {\n    req.user = null;\n    return next();\n  }\n\n  const token = req.cookies.token;\n\n  const decoded = _jsonwebtoken.default.verify(token, process.env.JWT_SECRET);\n\n  const user = await prisma.user.findUnique({\n    where: {\n      id: decoded.id\n    },\n    include: {\n      videos: true\n    }\n  });\n  req.user = user;\n  next();\n}\n\nasync function protect(req, res, next) {\n  if (!req.cookies.token) {\n    return next({\n      message: \"You need to be logged in to visit this route\",\n      statusCode: 401\n    });\n  }\n\n  try {\n    const token = req.cookies.token;\n\n    const decoded = _jsonwebtoken.default.verify(token, process.env.JWT_SECRET);\n\n    const user = await prisma.user.findUnique({\n      where: {\n        id: decoded.id\n      },\n      include: {\n        videos: true\n      }\n    });\n    req.user = user;\n    next();\n  } catch (error) {\n    next({\n      message: \"You need to be logged in to visit this route\",\n      statusCode: 401\n    });\n  }\n}\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF1dGhvcml6YXRpb24uanMiXSwibmFtZXMiOlsicHJpc21hIiwiUHJpc21hQ2xpZW50IiwiZ2V0QXV0aFVzZXIiLCJyZXEiLCJyZXMiLCJuZXh0IiwiY29va2llcyIsInRva2VuIiwidXNlciIsImRlY29kZWQiLCJqd3QiLCJ2ZXJpZnkiLCJwcm9jZXNzIiwiZW52IiwiSldUX1NFQ1JFVCIsImZpbmRVbmlxdWUiLCJ3aGVyZSIsImlkIiwiaW5jbHVkZSIsInZpZGVvcyIsInByb3RlY3QiLCJtZXNzYWdlIiwic3RhdHVzQ29kZSIsImVycm9yIl0sIm1hcHBpbmdzIjoiOzs7Ozs7OztBQUFBOztBQUNBOzs7O0FBRUEsTUFBTUEsTUFBTSxHQUFHLElBQUlDLG9CQUFKLEVBQWY7O0FBRU8sZUFBZUMsV0FBZixDQUEyQkMsR0FBM0IsRUFBZ0NDLEdBQWhDLEVBQXFDQyxJQUFyQyxFQUEyQztBQUNoRCxNQUFJLENBQUNGLEdBQUcsQ0FBQ0csT0FBSixDQUFZQyxLQUFqQixFQUF3QjtBQUN0QkosSUFBQUEsR0FBRyxDQUFDSyxJQUFKLEdBQVcsSUFBWDtBQUNBLFdBQU9ILElBQUksRUFBWDtBQUNEOztBQUVELFFBQU1FLEtBQUssR0FBR0osR0FBRyxDQUFDRyxPQUFKLENBQVlDLEtBQTFCOztBQUNBLFFBQU1FLE9BQU8sR0FBR0Msc0JBQUlDLE1BQUosQ0FBV0osS0FBWCxFQUFrQkssT0FBTyxDQUFDQyxHQUFSLENBQVlDLFVBQTlCLENBQWhCOztBQUVBLFFBQU1OLElBQUksR0FBRyxNQUFNUixNQUFNLENBQUNRLElBQVAsQ0FBWU8sVUFBWixDQUF1QjtBQUN4Q0MsSUFBQUEsS0FBSyxFQUFFO0FBQ0xDLE1BQUFBLEVBQUUsRUFBRVIsT0FBTyxDQUFDUTtBQURQLEtBRGlDO0FBSXhDQyxJQUFBQSxPQUFPLEVBQUU7QUFDUEMsTUFBQUEsTUFBTSxFQUFFO0FBREQ7QUFKK0IsR0FBdkIsQ0FBbkI7QUFTQWhCLEVBQUFBLEdBQUcsQ0FBQ0ssSUFBSixHQUFXQSxJQUFYO0FBQ0FILEVBQUFBLElBQUk7QUFDTDs7QUFFTSxlQUFlZSxPQUFmLENBQXVCakIsR0FBdkIsRUFBNEJDLEdBQTVCLEVBQWlDQyxJQUFqQyxFQUF1QztBQUM1QyxNQUFJLENBQUNGLEdBQUcsQ0FBQ0csT0FBSixDQUFZQyxLQUFqQixFQUF3QjtBQUN0QixXQUFPRixJQUFJLENBQUM7QUFDVmdCLE1BQUFBLE9BQU8sRUFBRSw4Q0FEQztBQUVWQyxNQUFBQSxVQUFVLEVBQUU7QUFGRixLQUFELENBQVg7QUFJRDs7QUFFRCxNQUFJO0FBQ0YsVUFBTWYsS0FBSyxHQUFHSixHQUFHLENBQUNHLE9BQUosQ0FBWUMsS0FBMUI7O0FBQ0EsVUFBTUUsT0FBTyxHQUFHQyxzQkFBSUMsTUFBSixDQUFXSixLQUFYLEVBQWtCSyxPQUFPLENBQUNDLEdBQVIsQ0FBWUMsVUFBOUIsQ0FBaEI7O0FBRUEsVUFBTU4sSUFBSSxHQUFHLE1BQU1SLE1BQU0sQ0FBQ1EsSUFBUCxDQUFZTyxVQUFaLENBQXVCO0FBQ3hDQyxNQUFBQSxLQUFLLEVBQUU7QUFDTEMsUUFBQUEsRUFBRSxFQUFFUixPQUFPLENBQUNRO0FBRFAsT0FEaUM7QUFJeENDLE1BQUFBLE9BQU8sRUFBRTtBQUNQQyxRQUFBQSxNQUFNLEVBQUU7QUFERDtBQUorQixLQUF2QixDQUFuQjtBQVNBaEIsSUFBQUEsR0FBRyxDQUFDSyxJQUFKLEdBQVdBLElBQVg7QUFDQUgsSUFBQUEsSUFBSTtBQUNMLEdBZkQsQ0FlRSxPQUFPa0IsS0FBUCxFQUFjO0FBQ2RsQixJQUFBQSxJQUFJLENBQUM7QUFDSGdCLE1BQUFBLE9BQU8sRUFBRSw4Q0FETjtBQUVIQyxNQUFBQSxVQUFVLEVBQUU7QUFGVCxLQUFELENBQUo7QUFJRDtBQUNGIiwic291cmNlUm9vdCI6Ii9Vc2Vycy9lZ29yL0Rldi95dGNsb25lIGZpbmFsL3NlcnZlci9zcmMvbWlkZGxld2FyZS8iLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBQcmlzbWFDbGllbnQgfSBmcm9tIFwiQHByaXNtYS9jbGllbnRcIjtcbmltcG9ydCBqd3QgZnJvbSBcImpzb253ZWJ0b2tlblwiO1xuXG5jb25zdCBwcmlzbWEgPSBuZXcgUHJpc21hQ2xpZW50KCk7XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRBdXRoVXNlcihyZXEsIHJlcywgbmV4dCkge1xuICBpZiAoIXJlcS5jb29raWVzLnRva2VuKSB7XG4gICAgcmVxLnVzZXIgPSBudWxsO1xuICAgIHJldHVybiBuZXh0KCk7XG4gIH1cblxuICBjb25zdCB0b2tlbiA9IHJlcS5jb29raWVzLnRva2VuO1xuICBjb25zdCBkZWNvZGVkID0gand0LnZlcmlmeSh0b2tlbiwgcHJvY2Vzcy5lbnYuSldUX1NFQ1JFVCk7XG5cbiAgY29uc3QgdXNlciA9IGF3YWl0IHByaXNtYS51c2VyLmZpbmRVbmlxdWUoe1xuICAgIHdoZXJlOiB7XG4gICAgICBpZDogZGVjb2RlZC5pZCxcbiAgICB9LFxuICAgIGluY2x1ZGU6IHtcbiAgICAgIHZpZGVvczogdHJ1ZSxcbiAgICB9LFxuICB9KTtcblxuICByZXEudXNlciA9IHVzZXI7XG4gIG5leHQoKTtcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHByb3RlY3QocmVxLCByZXMsIG5leHQpIHtcbiAgaWYgKCFyZXEuY29va2llcy50b2tlbikge1xuICAgIHJldHVybiBuZXh0KHtcbiAgICAgIG1lc3NhZ2U6IFwiWW91IG5lZWQgdG8gYmUgbG9nZ2VkIGluIHRvIHZpc2l0IHRoaXMgcm91dGVcIixcbiAgICAgIHN0YXR1c0NvZGU6IDQwMSxcbiAgICB9KTtcbiAgfVxuXG4gIHRyeSB7XG4gICAgY29uc3QgdG9rZW4gPSByZXEuY29va2llcy50b2tlbjtcbiAgICBjb25zdCBkZWNvZGVkID0gand0LnZlcmlmeSh0b2tlbiwgcHJvY2Vzcy5lbnYuSldUX1NFQ1JFVCk7XG5cbiAgICBjb25zdCB1c2VyID0gYXdhaXQgcHJpc21hLnVzZXIuZmluZFVuaXF1ZSh7XG4gICAgICB3aGVyZToge1xuICAgICAgICBpZDogZGVjb2RlZC5pZCxcbiAgICAgIH0sXG4gICAgICBpbmNsdWRlOiB7XG4gICAgICAgIHZpZGVvczogdHJ1ZSxcbiAgICAgIH0sXG4gICAgfSk7XG5cbiAgICByZXEudXNlciA9IHVzZXI7XG4gICAgbmV4dCgpO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIG5leHQoe1xuICAgICAgbWVzc2FnZTogXCJZb3UgbmVlZCB0byBiZSBsb2dnZWQgaW4gdG8gdmlzaXQgdGhpcyByb3V0ZVwiLFxuICAgICAgc3RhdHVzQ29kZTogNDAxLFxuICAgIH0pO1xuICB9XG59XG4iXX0=",
    "map": {
      "version": 3,
      "sources": [
        "authorization.js"
      ],
      "names": [
        "prisma",
        "PrismaClient",
        "getAuthUser",
        "req",
        "res",
        "next",
        "cookies",
        "token",
        "user",
        "decoded",
        "jwt",
        "verify",
        "process",
        "env",
        "JWT_SECRET",
        "findUnique",
        "where",
        "id",
        "include",
        "videos",
        "protect",
        "message",
        "statusCode",
        "error"
      ],
      "mappings": ";;;;;;;;AAAA;;AACA;;;;AAEA,MAAMA,MAAM,GAAG,IAAIC,oBAAJ,EAAf;;AAEO,eAAeC,WAAf,CAA2BC,GAA3B,EAAgCC,GAAhC,EAAqCC,IAArC,EAA2C;AAChD,MAAI,CAACF,GAAG,CAACG,OAAJ,CAAYC,KAAjB,EAAwB;AACtBJ,IAAAA,GAAG,CAACK,IAAJ,GAAW,IAAX;AACA,WAAOH,IAAI,EAAX;AACD;;AAED,QAAME,KAAK,GAAGJ,GAAG,CAACG,OAAJ,CAAYC,KAA1B;;AACA,QAAME,OAAO,GAAGC,sBAAIC,MAAJ,CAAWJ,KAAX,EAAkBK,OAAO,CAACC,GAAR,CAAYC,UAA9B,CAAhB;;AAEA,QAAMN,IAAI,GAAG,MAAMR,MAAM,CAACQ,IAAP,CAAYO,UAAZ,CAAuB;AACxCC,IAAAA,KAAK,EAAE;AACLC,MAAAA,EAAE,EAAER,OAAO,CAACQ;AADP,KADiC;AAIxCC,IAAAA,OAAO,EAAE;AACPC,MAAAA,MAAM,EAAE;AADD;AAJ+B,GAAvB,CAAnB;AASAhB,EAAAA,GAAG,CAACK,IAAJ,GAAWA,IAAX;AACAH,EAAAA,IAAI;AACL;;AAEM,eAAee,OAAf,CAAuBjB,GAAvB,EAA4BC,GAA5B,EAAiCC,IAAjC,EAAuC;AAC5C,MAAI,CAACF,GAAG,CAACG,OAAJ,CAAYC,KAAjB,EAAwB;AACtB,WAAOF,IAAI,CAAC;AACVgB,MAAAA,OAAO,EAAE,8CADC;AAEVC,MAAAA,UAAU,EAAE;AAFF,KAAD,CAAX;AAID;;AAED,MAAI;AACF,UAAMf,KAAK,GAAGJ,GAAG,CAACG,OAAJ,CAAYC,KAA1B;;AACA,UAAME,OAAO,GAAGC,sBAAIC,MAAJ,CAAWJ,KAAX,EAAkBK,OAAO,CAACC,GAAR,CAAYC,UAA9B,CAAhB;;AAEA,UAAMN,IAAI,GAAG,MAAMR,MAAM,CAACQ,IAAP,CAAYO,UAAZ,CAAuB;AACxCC,MAAAA,KAAK,EAAE;AACLC,QAAAA,EAAE,EAAER,OAAO,CAACQ;AADP,OADiC;AAIxCC,MAAAA,OAAO,EAAE;AACPC,QAAAA,MAAM,EAAE;AADD;AAJ+B,KAAvB,CAAnB;AASAhB,IAAAA,GAAG,CAACK,IAAJ,GAAWA,IAAX;AACAH,IAAAA,IAAI;AACL,GAfD,CAeE,OAAOkB,KAAP,EAAc;AACdlB,IAAAA,IAAI,CAAC;AACHgB,MAAAA,OAAO,EAAE,8CADN;AAEHC,MAAAA,UAAU,EAAE;AAFT,KAAD,CAAJ;AAID;AACF",
      "sourceRoot": "/Users/egor/Dev/ytclone final/server/src/middleware/",
      "sourcesContent": [
        "import { PrismaClient } from \"@prisma/client\";\nimport jwt from \"jsonwebtoken\";\n\nconst prisma = new PrismaClient();\n\nexport async function getAuthUser(req, res, next) {\n  if (!req.cookies.token) {\n    req.user = null;\n    return next();\n  }\n\n  const token = req.cookies.token;\n  const decoded = jwt.verify(token, process.env.JWT_SECRET);\n\n  const user = await prisma.user.findUnique({\n    where: {\n      id: decoded.id,\n    },\n    include: {\n      videos: true,\n    },\n  });\n\n  req.user = user;\n  next();\n}\n\nexport async function protect(req, res, next) {\n  if (!req.cookies.token) {\n    return next({\n      message: \"You need to be logged in to visit this route\",\n      statusCode: 401,\n    });\n  }\n\n  try {\n    const token = req.cookies.token;\n    const decoded = jwt.verify(token, process.env.JWT_SECRET);\n\n    const user = await prisma.user.findUnique({\n      where: {\n        id: decoded.id,\n      },\n      include: {\n        videos: true,\n      },\n    });\n\n    req.user = user;\n    next();\n  } catch (error) {\n    next({\n      message: \"You need to be logged in to visit this route\",\n      statusCode: 401,\n    });\n  }\n}\n"
      ]
    },
    "sourceType": "script",
    "mtime": 1611454252000
  },
  "{\"sourceRoot\":\"/Users/egor/Dev/ytclone final/server/src/routes/\",\"caller\":{\"name\":\"@babel/register\"},\"cwd\":\"/Users/egor/Dev/ytclone final\",\"filename\":\"/Users/egor/Dev/ytclone final/server/src/routes/user.js\",\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"/Users/egor/Dev/ytclone final\",\"plugins\":[{\"key\":\"syntax-numeric-separator\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"proposal-logical-assignment-operators\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"AssignmentExpression\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-nullish-coalescing-operator\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-optional-chaining\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-json-strings\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-optional-catch-binding\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-async-generators\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-object-rest-spread\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"transform-modules-commonjs\",\"visitor\":{\"CallExpression\":{\"enter\":[null]},\"Program\":{\"exit\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"proposal-dynamic-import\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"Program\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"proposal-export-namespace-from\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"ExportNamedDeclaration\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}}],\"presets\":[]}:7.12.10": {
    "metadata": {},
    "options": {
      "sourceRoot": "/Users/egor/Dev/ytclone final/server/src/routes/",
      "caller": {
        "name": "@babel/register"
      },
      "cwd": "/Users/egor/Dev/ytclone final",
      "filename": "/Users/egor/Dev/ytclone final/server/src/routes/user.js",
      "cloneInputAst": true,
      "babelrc": false,
      "configFile": false,
      "envName": "development",
      "root": "/Users/egor/Dev/ytclone final",
      "sourceMaps": "both",
      "ast": false,
      "passPerPreset": false,
      "plugins": [
        {
          "key": "syntax-numeric-separator",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "proposal-logical-assignment-operators",
          "visitor": {
            "_exploded": {},
            "_verified": {},
            "AssignmentExpression": {
              "enter": [
                null
              ]
            }
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-nullish-coalescing-operator",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-optional-chaining",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-json-strings",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-optional-catch-binding",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-async-generators",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-object-rest-spread",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "transform-modules-commonjs",
          "visitor": {
            "CallExpression": {
              "enter": [
                null
              ]
            },
            "Program": {
              "exit": [
                null
              ]
            },
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "proposal-dynamic-import",
          "visitor": {
            "_exploded": {},
            "_verified": {},
            "Program": {
              "enter": [
                null
              ]
            }
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "proposal-export-namespace-from",
          "visitor": {
            "_exploded": {},
            "_verified": {},
            "ExportNamedDeclaration": {
              "enter": [
                null
              ]
            }
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        }
      ],
      "presets": [],
      "parserOpts": {
        "sourceType": "module",
        "sourceFileName": "/Users/egor/Dev/ytclone final/server/src/routes/user.js",
        "plugins": [
          "numericSeparator",
          "logicalAssignment",
          "nullishCoalescingOperator",
          "optionalChaining",
          "jsonStrings",
          "optionalCatchBinding",
          "asyncGenerators",
          "objectRestSpread",
          "dynamicImport",
          "exportNamespaceFrom"
        ]
      },
      "generatorOpts": {
        "filename": "/Users/egor/Dev/ytclone final/server/src/routes/user.js",
        "comments": true,
        "compact": "auto",
        "sourceMaps": "both",
        "sourceRoot": "/Users/egor/Dev/ytclone final/server/src/routes/",
        "sourceFileName": "user.js"
      }
    },
    "ast": null,
    "code": "\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.getUserRoutes = getUserRoutes;\n\nvar _client = require(\"@prisma/client\");\n\nvar _express = _interopRequireDefault(require(\"express\"));\n\nvar _authorization = require(\"../middleware/authorization\");\n\nvar _video = require(\"./video\");\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nconst prisma = new _client.PrismaClient();\n\nfunction getUserRoutes() {\n  const router = _express.default.Router();\n\n  router.get(\"/\", _authorization.protect, getRecommendedChannels);\n  router.put(\"/\", _authorization.protect, editUser);\n  router.get(\"/liked-videos\", _authorization.protect, getLikedVideos);\n  router.get(\"/history\", _authorization.protect, getHistory);\n  router.get(\"/subscriptions\", _authorization.protect, getFeed);\n  router.get(\"/search\", _authorization.getAuthUser, searchUser);\n  router.get(\"/:userId\", _authorization.getAuthUser, getProfile);\n  router.get(\"/:userId/toggle-subscribe\", _authorization.protect, toggleSubscribe);\n  return router;\n}\n\nasync function getLikedVideos(req, res) {\n  await getVideos(prisma.videoLike, req, res);\n}\n\nasync function getHistory(req, res) {\n  await getVideos(prisma.view, req, res);\n}\n\nasync function getVideos(model, req, res) {\n  const videoRelations = await model.findMany({\n    where: {\n      userId: req.user.id\n    },\n    orderBy: {\n      createdAt: \"desc\"\n    }\n  });\n  const videoIds = videoRelations.map(videoLike => videoLike.videoId);\n  let videos = await prisma.video.findMany({\n    where: {\n      id: {\n        in: videoIds\n      }\n    },\n    include: {\n      user: true\n    }\n  });\n\n  if (!videos.length) {\n    return res.status(200).json({\n      videos\n    });\n  }\n\n  videos = await (0, _video.getVideoViews)(videos);\n  res.status(200).json({\n    videos\n  });\n}\n\nasync function toggleSubscribe(req, res, next) {\n  if (req.user.id === req.params.userId) {\n    return next({\n      message: \"You cannot subscribe to your own channel\",\n      statusCode: 400\n    });\n  }\n\n  const user = await prisma.user.findUnique({\n    where: {\n      id: req.params.userId\n    }\n  });\n\n  if (!user) {\n    return next({\n      message: `No user found with id: \"${req.params.userId}\"`,\n      statusCode: 404\n    });\n  }\n\n  const isSubscribed = await prisma.subscription.findFirst({\n    where: {\n      subscriberId: {\n        equals: req.user.id\n      },\n      subscribedToId: {\n        equals: req.params.userId\n      }\n    }\n  });\n\n  if (isSubscribed) {\n    await prisma.subscription.delete({\n      where: {\n        id: isSubscribed.id\n      }\n    });\n  } else {\n    await prisma.subscription.create({\n      data: {\n        subscriber: {\n          connect: {\n            id: req.user.id\n          }\n        },\n        subscribedTo: {\n          connect: {\n            id: req.params.userId\n          }\n        }\n      }\n    });\n  }\n\n  res.status(200).json({});\n}\n\nasync function getFeed(req, res) {\n  const subscribedTo = await prisma.subscription.findMany({\n    where: {\n      subscriberId: {\n        equals: req.user.id\n      }\n    }\n  });\n  const subscriptions = subscribedTo.map(sub => sub.subscribedToId);\n  const feed = await prisma.video.findMany({\n    where: {\n      userId: {\n        in: subscriptions\n      }\n    },\n    include: {\n      user: true\n    },\n    orderBy: {\n      createdAt: \"desc\"\n    }\n  });\n\n  if (!feed.length) {\n    return res.status(200).json({\n      feed\n    });\n  }\n\n  const feedVideos = await (0, _video.getVideoViews)(feed);\n  res.status(200).json({\n    feed: feedVideos\n  });\n}\n\nasync function searchUser(req, res, next) {\n  if (!req.query.query) {\n    return next({\n      message: \"Please enter a search query\",\n      statusCode: 400\n    });\n  }\n\n  const users = await prisma.user.findMany({\n    where: {\n      username: {\n        contains: req.query.query,\n        mode: \"insensitive\"\n      }\n    }\n  });\n\n  if (!users.length) {\n    return res.status(200).json({\n      users\n    });\n  }\n\n  for (const user of users) {\n    const subscribersCount = await prisma.subscription.count({\n      where: {\n        subscribedToId: {\n          equals: user.id\n        }\n      }\n    });\n    const videosCount = await prisma.video.count({\n      where: {\n        userId: user.id\n      }\n    });\n    let isMe = false;\n    let isSubscribed = false;\n\n    if (req.user) {\n      isMe = req.user.id === user.id;\n      isSubscribed = await prisma.subscription.findFirst({\n        where: {\n          AND: {\n            subscriberId: {\n              equals: req.user.id\n            },\n            subscribedToId: {\n              equals: user.id\n            }\n          }\n        }\n      });\n    }\n\n    user.subscribersCount = subscribersCount;\n    user.videosCount = videosCount;\n    user.isSubscribed = Boolean(isSubscribed);\n    user.isMe = isMe;\n  }\n\n  res.status(200).json({\n    users\n  });\n}\n\nasync function getRecommendedChannels(req, res) {\n  const channels = await prisma.user.findMany({\n    where: {\n      id: {\n        not: req.user.id\n      }\n    },\n    take: 10\n  });\n\n  if (!channels.length) {\n    return res.status(200).json({\n      channels\n    });\n  }\n\n  for (const channel of channels) {\n    const subscribersCount = await prisma.subscription.count({\n      where: {\n        subscribedToId: {\n          equals: channel.id\n        }\n      }\n    });\n    const videosCount = await prisma.video.count({\n      where: {\n        userId: channel.id\n      }\n    });\n    const isSubscribed = await prisma.subscription.findFirst({\n      where: {\n        AND: {\n          subscriberId: {\n            equals: req.user.id\n          },\n          subscribedToId: {\n            equals: channel.id\n          }\n        }\n      }\n    });\n    channel.subscribersCount = subscribersCount;\n    channel.videosCount = videosCount;\n    channel.isSubscribed = Boolean(isSubscribed);\n  }\n\n  res.status(200).json({\n    channels\n  });\n}\n\nasync function getProfile(req, res, next) {\n  const user = await prisma.user.findUnique({\n    where: {\n      id: req.params.userId\n    }\n  });\n\n  if (!user) {\n    return next({\n      message: `No user found with id: \"${req.params.userId}\"`,\n      statusCode: 404\n    });\n  }\n\n  const subscribersCount = await prisma.subscription.count({\n    where: {\n      subscribedToId: {\n        equals: user.id\n      }\n    }\n  });\n  let isMe = false;\n  let isSubscribed = false;\n\n  if (req.user) {\n    isMe = req.user.id === user.id;\n    isSubscribed = await prisma.subscription.findFirst({\n      where: {\n        AND: {\n          subscriberId: {\n            equals: req.user.id\n          },\n          subscribedToId: {\n            equals: user.id\n          }\n        }\n      }\n    });\n  }\n\n  const subscribedTo = await prisma.subscription.findMany({\n    where: {\n      subscriberId: {\n        equals: user.id\n      }\n    }\n  });\n  const subscriptions = subscribedTo.map(sub => sub.subscribedToId);\n  const channels = await prisma.user.findMany({\n    where: {\n      id: {\n        in: subscriptions\n      }\n    }\n  });\n\n  for (const channel of channels) {\n    const subscribersCount = await prisma.subscription.count({\n      where: {\n        subscribedToId: {\n          equals: channel.id\n        }\n      }\n    });\n    channel.subscribersCount = subscribersCount;\n  }\n\n  const videos = await prisma.video.findMany({\n    where: {\n      userId: {\n        equals: user.id\n      }\n    },\n    orderBy: {\n      createdAt: \"desc\"\n    }\n  });\n  user.subscribersCount = subscribersCount;\n  user.isSubscribed = Boolean(isSubscribed);\n  user.isMe = isMe;\n  user.channels = channels;\n  user.videos = videos;\n\n  if (!videos.length) {\n    return res.status(200).json({\n      user\n    });\n  }\n\n  user.videos = await (0, _video.getVideoViews)(videos);\n  res.status(200).json({\n    user\n  });\n}\n\nasync function editUser(req, res) {\n  const {\n    username,\n    cover,\n    avatar,\n    about\n  } = req.body;\n  const user = await prisma.user.update({\n    where: {\n      id: req.user.id\n    },\n    data: {\n      username,\n      cover,\n      avatar,\n      about\n    }\n  });\n  res.status(200).json({\n    user\n  });\n}\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInVzZXIuanMiXSwibmFtZXMiOlsicHJpc21hIiwiUHJpc21hQ2xpZW50IiwiZ2V0VXNlclJvdXRlcyIsInJvdXRlciIsImV4cHJlc3MiLCJSb3V0ZXIiLCJnZXQiLCJwcm90ZWN0IiwiZ2V0UmVjb21tZW5kZWRDaGFubmVscyIsInB1dCIsImVkaXRVc2VyIiwiZ2V0TGlrZWRWaWRlb3MiLCJnZXRIaXN0b3J5IiwiZ2V0RmVlZCIsImdldEF1dGhVc2VyIiwic2VhcmNoVXNlciIsImdldFByb2ZpbGUiLCJ0b2dnbGVTdWJzY3JpYmUiLCJyZXEiLCJyZXMiLCJnZXRWaWRlb3MiLCJ2aWRlb0xpa2UiLCJ2aWV3IiwibW9kZWwiLCJ2aWRlb1JlbGF0aW9ucyIsImZpbmRNYW55Iiwid2hlcmUiLCJ1c2VySWQiLCJ1c2VyIiwiaWQiLCJvcmRlckJ5IiwiY3JlYXRlZEF0IiwidmlkZW9JZHMiLCJtYXAiLCJ2aWRlb0lkIiwidmlkZW9zIiwidmlkZW8iLCJpbiIsImluY2x1ZGUiLCJsZW5ndGgiLCJzdGF0dXMiLCJqc29uIiwibmV4dCIsInBhcmFtcyIsIm1lc3NhZ2UiLCJzdGF0dXNDb2RlIiwiZmluZFVuaXF1ZSIsImlzU3Vic2NyaWJlZCIsInN1YnNjcmlwdGlvbiIsImZpbmRGaXJzdCIsInN1YnNjcmliZXJJZCIsImVxdWFscyIsInN1YnNjcmliZWRUb0lkIiwiZGVsZXRlIiwiY3JlYXRlIiwiZGF0YSIsInN1YnNjcmliZXIiLCJjb25uZWN0Iiwic3Vic2NyaWJlZFRvIiwic3Vic2NyaXB0aW9ucyIsInN1YiIsImZlZWQiLCJmZWVkVmlkZW9zIiwicXVlcnkiLCJ1c2VycyIsInVzZXJuYW1lIiwiY29udGFpbnMiLCJtb2RlIiwic3Vic2NyaWJlcnNDb3VudCIsImNvdW50IiwidmlkZW9zQ291bnQiLCJpc01lIiwiQU5EIiwiQm9vbGVhbiIsImNoYW5uZWxzIiwibm90IiwidGFrZSIsImNoYW5uZWwiLCJjb3ZlciIsImF2YXRhciIsImFib3V0IiwiYm9keSIsInVw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ci9EZXYveXRjbG9uZSBmaW5hbC9zZXJ2ZXIvc3JjL3JvdXRlcy8iLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBQcmlzbWFDbGllbnQgfSBmcm9tIFwiQHByaXNtYS9jbGllbnRcIjtcbmltcG9ydCBleHByZXNzIGZyb20gXCJleHByZXNzXCI7XG5pbXBvcnQgeyBnZXRBdXRoVXNlciwgcHJvdGVjdCB9IGZyb20gXCIuLi9taWRkbGV3YXJlL2F1dGhvcml6YXRpb25cIjtcbmltcG9ydCB7IGdldFZpZGVvVmlld3MgfSBmcm9tIFwiLi92aWRlb1wiO1xuXG5jb25zdCBwcmlzbWEgPSBuZXcgUHJpc21hQ2xpZW50KCk7XG5cbmZ1bmN0aW9uIGdldFVzZXJSb3V0ZXMoKSB7XG4gIGNvbnN0IHJvdXRlciA9IGV4cHJlc3MuUm91dGVyKCk7XG5cbiAgcm91dGVyLmdldChcIi9cIiwgcHJvdGVjdCwgZ2V0UmVjb21tZW5kZWRDaGFubmVscyk7XG4gIHJvdXRlci5wdXQoXCIvXCIsIHByb3RlY3QsIGVkaXRVc2VyKTtcblxuICByb3V0ZXIuZ2V0KFwiL2xpa2VkLXZpZGVvc1wiLCBwcm90ZWN0LCBnZXRMaWtlZFZpZGVvcyk7XG4gIHJvdXRlci5nZXQoXCIvaGlzdG9yeVwiLCBwcm90ZWN0LCBnZXRIaXN0b3J5KTtcbiAgcm91dGVyLmdldChcIi9zdWJzY3JpcHRpb25zXCIsIHByb3RlY3QsIGdldEZlZWQpO1xuICByb3V0ZXIuZ2V0KFwiL3NlYXJjaFwiLCBnZXRBdXRoVXNlciwgc2VhcmNoVXNlcik7XG5cbiAgcm91dGVyLmdldChcIi86dXNlcklkXCIsIGdldEF1dGhVc2VyLCBnZXRQcm9maWxlKTtcbiAgcm91dGVyLmdldChcIi86dXNlcklkL3RvZ2dsZS1zdWJzY3JpYmVcIiwgcHJvdGVjdCwgdG9nZ2xlU3Vic2NyaWJlKTtcblxuICByZXR1cm4gcm91dGVyO1xufVxuXG5hc3luYyBmdW5jdGlvbiBnZXRMaWtlZFZpZGVvcyhyZXEsIHJlcykge1xuICBhd2FpdCBnZXRWaWRlb3MocHJpc21hLnZpZGVvTGlrZSwgcmVxLCByZXMpO1xufVxuXG5hc3luYyBmdW5jdGlvbiBnZXRIaXN0b3J5KHJlcSwgcmVzKSB7XG4gIGF3YWl0IGdldFZpZGVvcyhwcmlzbWEudmlldywgcmVxLCByZXMpO1xufVxuXG5hc3luYyBmdW5jdGlvbiBnZXRWaWRlb3MobW9kZWwsIHJlcSwgcmVzKSB7XG4gIGNvbnN0IHZpZGVvUmVsYXRpb25zID0gYXdhaXQgbW9kZWwuZmluZE1hbnkoe1xuICAgIHdoZXJlOiB7XG4gICAgICB1c2VySWQ6IHJlcS51c2VyLmlkLFxuICAgIH0sXG4gICAgb3JkZXJCeToge1xuICAgICAgY3JlYXRlZEF0OiBcImRlc2NcIixcbiAgICB9LFxuICB9KTtcblxuICBjb25zdCB2aWRlb0lkcyA9IHZpZGVvUmVsYXRpb25zLm1hcCgodmlkZW9MaWtlKSA9PiB2aWRlb0xpa2UudmlkZW9JZCk7XG5cbiAgbGV0IHZpZGVvcyA9IGF3YWl0IHByaXNtYS52aWRlby5maW5kTWFueSh7XG4gICAgd2hlcmU6IHtcbiAgICAgIGlkOiB7XG4gICAgICAgIGluOiB2aWRlb0lkcyxcbiAgICAgIH0sXG4gICAgfSxcbiAgICBpbmNsdWRlOiB7XG4gICAgICB1c2VyOiB0cnVlLFxuICAgIH0sXG4gIH0pO1xuXG4gIGlmICghdmlkZW9zLmxlbmd0aCkge1xuICAgIHJldHVybiByZXMuc3RhdHVzKDIwMCkuanNvbih7IHZpZGVvcyB9KTtcbiAgfVxuXG4gIHZpZGVvcyA9IGF3YWl0IGdldFZpZGVvVmlld3ModmlkZW9zKTtcblxuICByZXMuc3RhdHVzKDIwMCkuanNvbih7IHZpZGVvcyB9KTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gdG9nZ2xlU3Vic2NyaWJlKHJlcSwgcmVzLCBuZXh0KSB7XG4gIGlmIChyZXEudXNlci5pZCA9PT0gcmVxLnBhcmFtcy51c2VySWQpIHtcbiAgICByZXR1cm4gbmV4dCh7XG4gICAgICBtZXNzYWdlOiBcIllvdSBjYW5ub3Qgc3Vic2NyaWJlIHRvIHlvdXIgb3duIGNoYW5uZWxcIixcbiAgICAgIHN0YXR1c0NvZGU6IDQwMCxcbiAgICB9KTtcbiAgfVxuXG4gIGNvbnN0IHVzZXIgPSBhd2FpdCBwcmlzbWEudXNlci5maW5kVW5pcXVlKHtcbiAgICB3aGVyZToge1xuICAgICAgaWQ6IHJlcS5wYXJhbXMudXNlcklkLFxuICAgIH0sXG4gIH0pO1xuXG4gIGlmICghdXNlcikge1xuICAgIHJldHVybiBuZXh0KHtcbiAgICAgIG1lc3NhZ2U6IGBObyB1c2VyIGZvdW5kIHdpdGggaWQ6IFwiJHtyZXEucGFyYW1zLnVzZXJJZH1cImAsXG4gICAgICBzdGF0dXNDb2RlOiA0MDQsXG4gICAgfSk7XG4gIH1cblxuICBjb25zdCBpc1N1YnNjcmliZWQgPSBhd2FpdCBwcmlzbWEuc3Vic2NyaXB0aW9uLmZpbmRGaXJzdCh7XG4gICAgd2hlcmU6IHtcbiAgICAgIHN1YnNjcmliZXJJZDoge1xuICAgICAgICBlcXVhbHM6IHJlcS51c2VyLmlkLFxuICAgICAgfSxcbiAgICAgIHN1YnNjcmliZWRUb0lkOiB7XG4gICAgICAgIGVxdWFsczogcmVxLnBhcmFtcy51c2VySWQsXG4gICAgICB9LFxuICAgIH0sXG4gIH0pO1xuXG4gIGlmIChpc1N1YnNjcmliZWQpIHtcbiAgICBhd2FpdCBwcmlzbWEuc3Vic2NyaXB0aW9uLmRlbGV0ZSh7XG4gICAgICB3aGVyZToge1xuICAgICAgICBpZDogaXNTdWJzY3JpYmVkLmlkLFxuICAgICAgfSxcbiAgICB9KTtcbiAgfSBlbHNlIHtcbiAgICBhd2FpdCBwcmlzbWEuc3Vic2NyaXB0aW9uLmNyZWF0ZSh7XG4gICAgICBkYXRhOiB7XG4gICAgICAgIHN1YnNjcmliZXI6IHtcbiAgICAgICAgICBjb25uZWN0OiB7XG4gICAgICAgICAgICBpZDogcmVxLnVzZXIuaWQsXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAgc3Vic2NyaWJlZFRvOiB7XG4gICAgICAgICAgY29ubmVjdDoge1xuICAgICAgICAgICAgaWQ6IHJlcS5wYXJhbXMudXNlcklkLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgIH0pO1xuICB9XG5cbiAgcmVzLnN0YXR1cygyMDApLmpzb24oe30pO1xufVxuXG5hc3luYyBmdW5jdGlvbiBnZXRGZWVkKHJlcSwgcmVzKSB7XG4gIGNvbnN0IHN1YnNjcmliZWRUbyA9IGF3YWl0IHByaXNtYS5zdWJzY3JpcHRpb24uZmluZE1hbnkoe1xuICAgIHdoZXJlOiB7XG4gICAgICBzdWJzY3JpYmVySWQ6IHtcbiAgICAgICAgZXF1YWxzOiByZXEudXNlci5pZCxcbiAgICAgIH0sXG4gICAgfSxcbiAgfSk7XG5cbiAgY29uc3Qgc3Vic2NyaXB0aW9ucyA9IHN1YnNjcmliZWRUby5tYXAoKHN1YikgPT4gc3ViLnN1YnNjcmliZWRUb0lkKTtcblxuICBjb25zdCBmZWVkID0gYXdhaXQgcHJpc21hLnZpZGVvLmZpbmRNYW55KHtcbiAgICB3aGVyZToge1xuICAgICAgdXNlcklkOiB7XG4gICAgICAgIGluOiBzdWJzY3JpcHRpb25zLFxuICAgICAgfSxcbiAgICB9LFxuICAgIGluY2x1ZGU6IHtcbiAgICAgIHVzZXI6IHRydWUsXG4gICAgfSxcbiAgICBvcmRlckJ5OiB7XG4gICAgICBjcmVhdGVkQXQ6IFwiZGVzY1wiLFxuICAgIH0sXG4gIH0pO1xuXG4gIGlmICghZmVlZC5sZW5ndGgpIHtcbiAgICByZXR1cm4gcmVzLnN0YXR1cygyMDApLmpzb24oeyBmZWVkIH0pO1xuICB9XG5cbiAgY29uc3QgZmVlZFZpZGVvcyA9IGF3YWl0IGdldFZpZGVvVmlld3MoZmVlZCk7XG5cbiAgcmVzLnN0YXR1cygyMDApLmpzb24oeyBmZWVkOiBmZWVkVmlkZW9zIH0pO1xufVxuXG5hc3luYyBmdW5jdGlvbiBzZWFyY2hVc2VyKHJlcSwgcmVzLCBuZXh0KSB7XG4gIGlmICghcmVxLnF1ZXJ5LnF1ZXJ5KSB7XG4gICAgcmV0dXJuIG5leHQoe1xuICAgICAgbWVzc2FnZTogXCJQbGVhc2UgZW50ZXIgYSBzZWFyY2ggcXVlcnlcIixcbiAgICAgIHN0YXR1c0NvZGU6IDQwMCxcbiAgICB9KTtcbiAgfVxuXG4gIGNvbnN0IHVzZXJzID0gYXdhaXQgcHJpc21hLnVzZXIuZmluZE1hbnkoe1xuICAgIHdoZXJlOiB7XG4gICAgICB1c2VybmFtZToge1xuICAgICAgICBjb250YWluczogcmVxLnF1ZXJ5LnF1ZXJ5LFxuICAgICAgICBtb2RlOiBcImluc2Vuc2l0aXZlXCIsXG4gICAgICB9LFxuICAgIH0sXG4gIH0pO1xuXG4gIGlmICghdXNlcnMubGVuZ3RoKSB7XG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoMjAwKS5qc29uKHsgdXNlcnMgfSk7XG4gIH1cblxuICBmb3IgKGNvbnN0IHVzZXIgb2YgdXNlcnMpIHtcbiAgICBjb25zdCBzdWJzY3JpYmVyc0NvdW50ID0gYXdhaXQgcHJpc21hLnN1YnNjcmlwdGlvbi5jb3VudCh7XG4gICAgICB3aGVyZToge1xuICAgICAgICBzdWJzY3JpYmVkVG9JZDoge1xuICAgICAgICAgIGVxdWFsczogdXNlci5pZCxcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgfSk7XG5cbiAgICBjb25zdCB2aWRlb3NDb3VudCA9IGF3YWl0IHByaXNtYS52aWRlby5jb3VudCh7XG4gICAgICB3aGVyZToge1xuICAgICAgICB1c2VySWQ6IHVzZXIuaWQsXG4gICAgICB9LFxuICAgIH0pO1xuXG4gICAgbGV0IGlzTWUgPSBmYWxzZTtcbiAgICBsZXQgaXNTdWJzY3JpYmVkID0gZmFsc2U7XG5cbiAgICBpZiAocmVxLnVzZXIpIHtcbiAgICAgIGlzTWUgPSByZXEudXNlci5pZCA9PT0gdXNlci5pZDtcblxuICAgICAgaXNTdWJzY3JpYmVkID0gYXdhaXQgcHJpc21hLnN1YnNjcmlwdGlvbi5maW5kRmlyc3Qoe1xuICAgICAgICB3aGVyZToge1xuICAgICAgICAgIEFORDoge1xuICAgICAgICAgICAgc3Vic2NyaWJlcklkOiB7XG4gICAgICAgICAgICAgIGVxdWFsczogcmVxLnVzZXIuaWQsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgc3Vic2NyaWJlZFRvSWQ6IHtcbiAgICAgICAgICAgICAgZXF1YWxzOiB1c2VyLmlkLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgdXNlci5zdWJzY3JpYmVyc0NvdW50ID0gc3Vic2NyaWJlcnNDb3VudDtcbiAgICB1c2VyLnZpZGVvc0NvdW50ID0gdmlkZW9zQ291bnQ7XG4gICAgdXNlci5pc1N1YnNjcmliZWQgPSBCb29sZWFuKGlzU3Vic2NyaWJlZCk7XG4gICAgdXNlci5pc01lID0gaXNNZTtcbiAgfVxuXG4gIHJlcy5zdGF0dXMoMjAwKS5qc29uKHsgdXNlcnMgfSk7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGdldFJlY29tbWVuZGVkQ2hhbm5lbHMocmVxLCByZXMpIHtcbiAgY29uc3QgY2hhbm5lbHMgPSBhd2FpdCBwcmlzbWEudXNlci5maW5kTWFueSh7XG4gICAgd2hlcmU6IHtcbiAgICAgIGlkOiB7XG4gICAgICAgIG5vdDogcmVxLnVzZXIuaWQsXG4gICAgICB9LFxuICAgIH0sXG4gICAgdGFrZTogMTAsXG4gIH0pO1xuXG4gIGlmICghY2hhbm5lbHMubGVuZ3RoKSB7XG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoMjAwKS5qc29uKHsgY2hhbm5lbHMgfSk7XG4gIH1cblxuICBmb3IgKGNvbnN0IGNoYW5uZWwgb2YgY2hhbm5lbHMpIHtcbiAgICBjb25zdCBzdWJzY3JpYmVyc0NvdW50ID0gYXdhaXQgcHJpc21hLnN1YnNjcmlwdGlvbi5jb3VudCh7XG4gICAgICB3aGVyZToge1xuICAgICAgICBzdWJzY3JpYmVkVG9JZDoge1xuICAgICAgICAgIGVxdWFsczogY2hhbm5lbC5pZCxcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgfSk7XG5cbiAgICBjb25zdCB2aWRlb3NDb3VudCA9IGF3YWl0IHByaXNtYS52aWRlby5jb3VudCh7XG4gICAgICB3aGVyZToge1xuICAgICAgICB1c2VySWQ6IGNoYW5uZWwuaWQsXG4gICAgICB9LFxuICAgIH0pO1xuXG4gICAgY29uc3QgaXNTdWJzY3JpYmVkID0gYXdhaXQgcHJpc21hLnN1YnNjcmlwdGlvbi5maW5kRmlyc3Qoe1xuICAgICAgd2hlcmU6IHtcbiAgICAgICAgQU5EOiB7XG4gICAgICAgICAgc3Vic2NyaWJlcklkOiB7XG4gICAgICAgICAgICBlcXVhbHM6IHJlcS51c2VyLmlkLFxuICAgICAgICAgIH0sXG4gICAgICAgICAgc3Vic2NyaWJlZFRvSWQ6IHtcbiAgICAgICAgICAgIGVxdWFsczogY2hhbm5lbC5pZCxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgfSxcbiAgICB9KTtcblxuICAgIGNoYW5uZWwuc3Vic2NyaWJlcnNDb3VudCA9IHN1YnNjcmliZXJzQ291bnQ7XG4gICAgY2hhbm5lbC52aWRlb3NDb3VudCA9IHZpZGVvc0NvdW50O1xuICAgIGNoYW5uZWwuaXNTdWJzY3JpYmVkID0gQm9vbGVhbihpc1N1YnNjcmliZWQpO1xuICB9XG5cbiAgcmVzLnN0YXR1cygyMDApLmpzb24oeyBjaGFubmVscyB9KTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gZ2V0UHJvZmlsZShyZXEsIHJlcywgbmV4dCkge1xuICBjb25zdCB1c2VyID0gYXdhaXQgcHJpc21hLnVzZXIuZmluZFVuaXF1ZSh7XG4gICAgd2hlcmU6IHtcbiAgICAgIGlkOiByZXEucGFyYW1zLnVzZXJJZCxcbiAgICB9LFxuICB9KTtcblxuICBpZiAoIXVzZXIpIHtcbiAgICByZXR1cm4gbmV4dCh7XG4gICAgICBtZXNzYWdlOiBgTm8gdXNlciBmb3VuZCB3aXRoIGlkOiBcIiR7cmVxLnBhcmFtcy51c2VySWR9XCJgLFxuICAgICAgc3RhdHVzQ29kZTogNDA0LFxuICAgIH0pO1xuICB9XG5cbiAgY29uc3Qgc3Vic2NyaWJlcnNDb3VudCA9IGF3YWl0IHByaXNtYS5zdWJzY3JpcHRpb24uY291bnQoe1xuICAgIHdoZXJlOiB7XG4gICAgICBzdWJzY3JpYmVkVG9JZDoge1xuICAgICAgICBlcXVhbHM6IHVzZXIuaWQsXG4gICAgICB9LFxuICAgIH0sXG4gIH0pO1xuXG4gIGxldCBpc01lID0gZmFsc2U7XG4gIGxldCBpc1N1YnNjcmliZWQgPSBmYWxzZTtcblxuICBpZiAocmVxLnVzZXIpIHtcbiAgICBpc01lID0gcmVxLnVzZXIuaWQgPT09IHVzZXIuaWQ7XG5cbiAgICBpc1N1YnNjcmliZWQgPSBhd2FpdCBwcmlzbWEuc3Vic2NyaXB0aW9uLmZpbmRGaXJzdCh7XG4gICAgICB3aGVyZToge1xuICAgICAgICBBTkQ6IHtcbiAgICAgICAgICBzdWJzY3JpYmVySWQ6IHtcbiAgICAgICAgICAgIGVxdWFsczogcmVxLnVzZXIuaWQsXG4gICAgICAgICAgfSxcbiAgICAgICAgICBzdWJzY3JpYmVkVG9JZDoge1xuICAgICAgICAgICAgZXF1YWxzOiB1c2VyLmlkLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgIH0pO1xuICB9XG5cbiAgY29uc3Qgc3Vic2NyaWJlZFRvID0gYXdhaXQgcHJpc21hLnN1YnNjcmlwdGlvbi5maW5kTWFueSh7XG4gICAgd2hlcmU6IHtcbiAgICAgIHN1YnNjcmliZXJJZDoge1xuICAgICAgICBlcXVhbHM6IHVzZXIuaWQsXG4gICAgICB9LFxuICAgIH0sXG4gIH0pO1xuXG4gIGNvbnN0IHN1YnNjcmlwdGlvbnMgPSBzdWJzY3JpYmVkVG8ubWFwKChzdWIpID0+IHN1Yi5zdWJzY3JpYmVkVG9JZCk7XG5cbiAgY29uc3QgY2hhbm5lbHMgPSBhd2FpdCBwcmlzbWEudXNlci5maW5kTWFueSh7XG4gICAgd2hlcmU6IHtcbiAgICAgIGlkOiB7XG4gICAgICAgIGluOiBzdWJzY3JpcHRpb25zLFxuICAgICAgfSxcbiAgICB9LFxuICB9KTtcblxuICBmb3IgKGNvbnN0IGNoYW5uZWwgb2YgY2hhbm5lbHMpIHtcbiAgICBjb25zdCBzdWJzY3JpYmVyc0NvdW50ID0gYXdhaXQgcHJpc21hLnN1YnNjcmlwdGlvbi5jb3VudCh7XG4gICAgICB3aGVyZToge1xuICAgICAgICBzdWJzY3JpYmVkVG9JZDoge1xuICAgICAgICAgIGVxdWFsczogY2hhbm5lbC5pZCxcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgfSk7XG4gICAgY2hhbm5lbC5zdWJzY3JpYmVyc0NvdW50ID0gc3Vic2NyaWJlcnNDb3VudDtcbiAgfVxuXG4gIGNvbnN0IHZpZGVvcyA9IGF3YWl0IHByaXNtYS52aWRlby5maW5kTWFueSh7XG4gICAgd2hlcmU6IHtcbiAgICAgIHVzZXJJZDoge1xuICAgICAgICBlcXVhbHM6IHVzZXIuaWQsXG4gICAgICB9LFxuICAgIH0sXG4gICAgb3JkZXJCeToge1xuICAgICAgY3JlYXRlZEF0OiBcImRlc2NcIixcbiAgICB9LFxuICB9KTtcblxuICB1c2VyLnN1YnNjcmliZXJzQ291bnQgPSBzdWJzY3JpYmVyc0NvdW50O1xuICB1c2VyLmlzU3Vic2NyaWJlZCA9IEJvb2xlYW4oaXNTdWJzY3JpYmVkKTtcbiAgdXNlci5pc01lID0gaXNNZTtcbiAgdXNlci5jaGFubmVscyA9IGNoYW5uZWxzO1xuICB1c2VyLnZpZGVvcyA9IHZpZGVvcztcblxuICBpZiAoIXZpZGVvcy5sZW5ndGgpIHtcbiAgICByZXR1cm4gcmVzLnN0YXR1cygyMDApLmpzb24oeyB1c2VyIH0pO1xuICB9XG5cbiAgdXNlci52aWRlb3MgPSBhd2FpdCBnZXRWaWRlb1ZpZXdzKHZpZGVvcyk7XG5cbiAgcmVzLnN0YXR1cygyMDApLmpzb24oeyB1c2VyIH0pO1xufVxuXG5hc3luYyBmdW5jdGlvbiBlZGl0VXNlcihyZXEsIHJlcykge1xuICBjb25zdCB7IHVzZXJuYW1lLCBjb3ZlciwgYXZhdGFyLCBhYm91dCB9ID0gcmVxLmJvZHk7XG5cbiAgY29uc3QgdXNlciA9IGF3YWl0IHByaXNtYS51c2VyLnVwZGF0ZSh7XG4gICAgd2hlcmU6IHtcbiAgICAgIGlkOiByZXEudXNlci5pZCxcbiAgICB9LFxuICAgIGRhdGE6IHtcbiAgICAgIHVzZXJuYW1lLFxuICAgICAgY292ZXIsXG4gICAgICBhdmF0YXIsXG4gICAgICBhYm91dCxcbiAgICB9LFxuICB9KTtcblxuICByZXMuc3RhdHVzKDIwMCkuanNvbih7IHVzZXIgfSk7XG59XG5cbmV4cG9ydCB7IGdldFVzZXJSb3V0ZXMgfTtcbiJdfQ==",
    "map": {
      "version": 3,
      "sources": [
        "user.js"
      ],
      "names": [
        "prisma",
        "PrismaClient",
        "getUserRoutes",
        "router",
        "express",
        "Router",
        "get",
        "protect",
        "getRecommendedChannels",
        "put",
        "editUser",
        "getLikedVideos",
        "getHistory",
        "getFeed",
        "getAuthUser",
        "searchUser",
        "getProfile",
        "toggleSubscribe",
        "req",
        "res",
        "getVideos",
        "videoLike",
        "view",
        "model",
        "videoRelations",
        "findMany",
        "where",
        "userId",
        "user",
        "id",
        "orderBy",
        "createdAt",
        "videoIds",
        "map",
        "videoId",
        "videos",
        "video",
        "in",
        "include",
        "length",
        "status",
        "json",
        "next",
        "params",
        "message",
        "statusCode",
        "findUnique",
        "isSubscribed",
        "subscription",
        "findFirst",
        "subscriberId",
        "equals",
        "subscribedToId",
        "delete",
        "create",
        "data",
        "subscriber",
        "connect",
        "subscribedTo",
        "subscriptions",
        "sub",
        "feed",
        "feedVideos",
        "query",
        "users",
        "username",
        "contains",
        "mode",
        "subscribersCount",
        "count",
        "videosCount",
        "isMe",
        "AND",
        "Boolean",
        "channels",
        "not",
        "take",
        "channel",
        "cover",
        "avatar",
        "about",
        "body",
        "update"
      ],
      "mappings": "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",
      "sourceRoot": "/Users/egor/Dev/ytclone final/server/src/routes/",
      "sourcesContent": [
        "import { PrismaClient } from \"@prisma/client\";\nimport express from \"express\";\nimport { getAuthUser, protect } from \"../middleware/authorization\";\nimport { getVideoViews } from \"./video\";\n\nconst prisma = new PrismaClient();\n\nfunction getUserRoutes() {\n  const router = express.Router();\n\n  router.get(\"/\", protect, getRecommendedChannels);\n  router.put(\"/\", protect, editUser);\n\n  router.get(\"/liked-videos\", protect, getLikedVideos);\n  router.get(\"/history\", protect, getHistory);\n  router.get(\"/subscriptions\", protect, getFeed);\n  router.get(\"/search\", getAuthUser, searchUser);\n\n  router.get(\"/:userId\", getAuthUser, getProfile);\n  router.get(\"/:userId/toggle-subscribe\", protect, toggleSubscribe);\n\n  return router;\n}\n\nasync function getLikedVideos(req, res) {\n  await getVideos(prisma.videoLike, req, res);\n}\n\nasync function getHistory(req, res) {\n  await getVideos(prisma.view, req, res);\n}\n\nasync function getVideos(model, req, res) {\n  const videoRelations = await model.findMany({\n    where: {\n      userId: req.user.id,\n    },\n    orderBy: {\n      createdAt: \"desc\",\n    },\n  });\n\n  const videoIds = videoRelations.map((videoLike) => videoLike.videoId);\n\n  let videos = await prisma.video.findMany({\n    where: {\n      id: {\n        in: videoIds,\n      },\n    },\n    include: {\n      user: true,\n    },\n  });\n\n  if (!videos.length) {\n    return res.status(200).json({ videos });\n  }\n\n  videos = await getVideoViews(videos);\n\n  res.status(200).json({ videos });\n}\n\nasync function toggleSubscribe(req, res, next) {\n  if (req.user.id === req.params.userId) {\n    return next({\n      message: \"You cannot subscribe to your own channel\",\n      statusCode: 400,\n    });\n  }\n\n  const user = await prisma.user.findUnique({\n    where: {\n      id: req.params.userId,\n    },\n  });\n\n  if (!user) {\n    return next({\n      message: `No user found with id: \"${req.params.userId}\"`,\n      statusCode: 404,\n    });\n  }\n\n  const isSubscribed = await prisma.subscription.findFirst({\n    where: {\n      subscriberId: {\n        equals: req.user.id,\n      },\n      subscribedToId: {\n        equals: req.params.userId,\n      },\n    },\n  });\n\n  if (isSubscribed) {\n    await prisma.subscription.delete({\n      where: {\n        id: isSubscribed.id,\n      },\n    });\n  } else {\n    await prisma.subscription.create({\n      data: {\n        subscriber: {\n          connect: {\n            id: req.user.id,\n          },\n        },\n        subscribedTo: {\n          connect: {\n            id: req.params.userId,\n          },\n        },\n      },\n    });\n  }\n\n  res.status(200).json({});\n}\n\nasync function getFeed(req, res) {\n  const subscribedTo = await prisma.subscription.findMany({\n    where: {\n      subscriberId: {\n        equals: req.user.id,\n      },\n    },\n  });\n\n  const subscriptions = subscribedTo.map((sub) => sub.subscribedToId);\n\n  const feed = await prisma.video.findMany({\n    where: {\n      userId: {\n        in: subscriptions,\n      },\n    },\n    include: {\n      user: true,\n    },\n    orderBy: {\n      createdAt: \"desc\",\n    },\n  });\n\n  if (!feed.length) {\n    return res.status(200).json({ feed });\n  }\n\n  const feedVideos = await getVideoViews(feed);\n\n  res.status(200).json({ feed: feedVideos });\n}\n\nasync function searchUser(req, res, next) {\n  if (!req.query.query) {\n    return next({\n      message: \"Please enter a search query\",\n      statusCode: 400,\n    });\n  }\n\n  const users = await prisma.user.findMany({\n    where: {\n      username: {\n        contains: req.query.query,\n        mode: \"insensitive\",\n      },\n    },\n  });\n\n  if (!users.length) {\n    return res.status(200).json({ users });\n  }\n\n  for (const user of users) {\n    const subscribersCount = await prisma.subscription.count({\n      where: {\n        subscribedToId: {\n          equals: user.id,\n        },\n      },\n    });\n\n    const videosCount = await prisma.video.count({\n      where: {\n        userId: user.id,\n      },\n    });\n\n    let isMe = false;\n    let isSubscribed = false;\n\n    if (req.user) {\n      isMe = req.user.id === user.id;\n\n      isSubscribed = await prisma.subscription.findFirst({\n        where: {\n          AND: {\n            subscriberId: {\n              equals: req.user.id,\n            },\n            subscribedToId: {\n              equals: user.id,\n            },\n          },\n        },\n      });\n    }\n\n    user.subscribersCount = subscribersCount;\n    user.videosCount = videosCount;\n    user.isSubscribed = Boolean(isSubscribed);\n    user.isMe = isMe;\n  }\n\n  res.status(200).json({ users });\n}\n\nasync function getRecommendedChannels(req, res) {\n  const channels = await prisma.user.findMany({\n    where: {\n      id: {\n        not: req.user.id,\n      },\n    },\n    take: 10,\n  });\n\n  if (!channels.length) {\n    return res.status(200).json({ channels });\n  }\n\n  for (const channel of channels) {\n    const subscribersCount = await prisma.subscription.count({\n      where: {\n        subscribedToId: {\n          equals: channel.id,\n        },\n      },\n    });\n\n    const videosCount = await prisma.video.count({\n      where: {\n        userId: channel.id,\n      },\n    });\n\n    const isSubscribed = await prisma.subscription.findFirst({\n      where: {\n        AND: {\n          subscriberId: {\n            equals: req.user.id,\n          },\n          subscribedToId: {\n            equals: channel.id,\n          },\n        },\n      },\n    });\n\n    channel.subscribersCount = subscribersCount;\n    channel.videosCount = videosCount;\n    channel.isSubscribed = Boolean(isSubscribed);\n  }\n\n  res.status(200).json({ channels });\n}\n\nasync function getProfile(req, res, next) {\n  const user = await prisma.user.findUnique({\n    where: {\n      id: req.params.userId,\n    },\n  });\n\n  if (!user) {\n    return next({\n      message: `No user found with id: \"${req.params.userId}\"`,\n      statusCode: 404,\n    });\n  }\n\n  const subscribersCount = await prisma.subscription.count({\n    where: {\n      subscribedToId: {\n        equals: user.id,\n      },\n    },\n  });\n\n  let isMe = false;\n  let isSubscribed = false;\n\n  if (req.user) {\n    isMe = req.user.id === user.id;\n\n    isSubscribed = await prisma.subscription.findFirst({\n      where: {\n        AND: {\n          subscriberId: {\n            equals: req.user.id,\n          },\n          subscribedToId: {\n            equals: user.id,\n          },\n        },\n      },\n    });\n  }\n\n  const subscribedTo = await prisma.subscription.findMany({\n    where: {\n      subscriberId: {\n        equals: user.id,\n      },\n    },\n  });\n\n  const subscriptions = subscribedTo.map((sub) => sub.subscribedToId);\n\n  const channels = await prisma.user.findMany({\n    where: {\n      id: {\n        in: subscriptions,\n      },\n    },\n  });\n\n  for (const channel of channels) {\n    const subscribersCount = await prisma.subscription.count({\n      where: {\n        subscribedToId: {\n          equals: channel.id,\n        },\n      },\n    });\n    channel.subscribersCount = subscribersCount;\n  }\n\n  const videos = await prisma.video.findMany({\n    where: {\n      userId: {\n        equals: user.id,\n      },\n    },\n    orderBy: {\n      createdAt: \"desc\",\n    },\n  });\n\n  user.subscribersCount = subscribersCount;\n  user.isSubscribed = Boolean(isSubscribed);\n  user.isMe = isMe;\n  user.channels = channels;\n  user.videos = videos;\n\n  if (!videos.length) {\n    return res.status(200).json({ user });\n  }\n\n  user.videos = await getVideoViews(videos);\n\n  res.status(200).json({ user });\n}\n\nasync function editUser(req, res) {\n  const { username, cover, avatar, about } = req.body;\n\n  const user = await prisma.user.update({\n    where: {\n      id: req.user.id,\n    },\n    data: {\n      username,\n      cover,\n      avatar,\n      about,\n    },\n  });\n\n  res.status(200).json({ user });\n}\n\nexport { getUserRoutes };\n"
      ]
    },
    "sourceType": "script",
    "mtime": 1611426347000
  },
  "{\"sourceRoot\":\"/Users/egor/Dev/ytclone final/server/src/routes/\",\"caller\":{\"name\":\"@babel/register\"},\"cwd\":\"/Users/egor/Dev/ytclone final\",\"filename\":\"/Users/egor/Dev/ytclone final/server/src/routes/video.js\",\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"/Users/egor/Dev/ytclone final\",\"plugins\":[{\"key\":\"syntax-numeric-separator\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"proposal-logical-assignment-operators\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"AssignmentExpression\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-nullish-coalescing-operator\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-optional-chaining\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-json-strings\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-optional-catch-binding\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-async-generators\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-object-rest-spread\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"transform-modules-commonjs\",\"visitor\":{\"CallExpression\":{\"enter\":[null]},\"Program\":{\"exit\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"proposal-dynamic-import\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"Program\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"proposal-export-namespace-from\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"ExportNamedDeclaration\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}}],\"presets\":[]}:7.12.10": {
    "metadata": {},
    "options": {
      "sourceRoot": "/Users/egor/Dev/ytclone final/server/src/routes/",
      "caller": {
        "name": "@babel/register"
      },
      "cwd": "/Users/egor/Dev/ytclone final",
      "filename": "/Users/egor/Dev/ytclone final/server/src/routes/video.js",
      "cloneInputAst": true,
      "babelrc": false,
      "configFile": false,
      "envName": "development",
      "root": "/Users/egor/Dev/ytclone final",
      "sourceMaps": "both",
      "ast": false,
      "passPerPreset": false,
      "plugins": [
        {
          "key": "syntax-numeric-separator",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "proposal-logical-assignment-operators",
          "visitor": {
            "_exploded": {},
            "_verified": {},
            "AssignmentExpression": {
              "enter": [
                null
              ]
            }
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-nullish-coalescing-operator",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-optional-chaining",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-json-strings",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-optional-catch-binding",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-async-generators",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-object-rest-spread",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "transform-modules-commonjs",
          "visitor": {
            "CallExpression": {
              "enter": [
                null
              ]
            },
            "Program": {
              "exit": [
                null
              ]
            },
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "proposal-dynamic-import",
          "visitor": {
            "_exploded": {},
            "_verified": {},
            "Program": {
              "enter": [
                null
              ]
            }
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "proposal-export-namespace-from",
          "visitor": {
            "_exploded": {},
            "_verified": {},
            "ExportNamedDeclaration": {
              "enter": [
                null
              ]
            }
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        }
      ],
      "presets": [],
      "parserOpts": {
        "sourceType": "module",
        "sourceFileName": "/Users/egor/Dev/ytclone final/server/src/routes/video.js",
        "plugins": [
          "numericSeparator",
          "logicalAssignment",
          "nullishCoalescingOperator",
          "optionalChaining",
          "jsonStrings",
          "optionalCatchBinding",
          "asyncGenerators",
          "objectRestSpread",
          "dynamicImport",
          "exportNamespaceFrom"
        ]
      },
      "generatorOpts": {
        "filename": "/Users/egor/Dev/ytclone final/server/src/routes/video.js",
        "comments": true,
        "compact": "auto",
        "sourceMaps": "both",
        "sourceRoot": "/Users/egor/Dev/ytclone final/server/src/routes/",
        "sourceFileName": "video.js"
      }
    },
    "ast": null,
    "code": "\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.getVideoViews = getVideoViews;\nexports.getVideoRoutes = getVideoRoutes;\n\nvar _client = require(\"@prisma/client\");\n\nvar _express = _interopRequireDefault(require(\"express\"));\n\nvar _authorization = require(\"../middleware/authorization\");\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nconst prisma = new _client.PrismaClient();\n\nfunction getVideoRoutes() {\n  const router = _express.default.Router();\n\n  router.get(\"/\", getRecommendedVideos);\n  router.post(\"/\", _authorization.protect, addVideo);\n  router.get(\"/trending\", getTrendingVideos);\n  router.get(\"/search\", searchVideos);\n  router.get(\"/:videoId\", _authorization.getAuthUser, getVideo);\n  router.delete(\"/:videoId\", _authorization.protect, deleteVideo);\n  router.get(\"/:videoId/view\", _authorization.getAuthUser, addVideoView);\n  router.get(\"/:videoId/like\", _authorization.protect, likeVideo);\n  router.get(\"/:videoId/dislike\", _authorization.protect, dislikeVideo);\n  router.post(\"/:videoId/comments\", _authorization.protect, addComment);\n  router.delete(\"/:videoId/comments/:commentId\", _authorization.protect, deleteComment);\n  return router;\n}\n\nasync function getVideoViews(videos) {\n  for (const video of videos) {\n    const views = await prisma.view.count({\n      where: {\n        videoId: {\n          equals: video.id\n        }\n      }\n    });\n    video.views = views;\n  }\n\n  return videos;\n}\n\nasync function getRecommendedVideos(req, res) {\n  let videos = await prisma.video.findMany({\n    include: {\n      user: true\n    },\n    orderBy: {\n      createdAt: \"desc\"\n    }\n  });\n\n  if (!videos.length) {\n    return res.status(200).json({\n      videos\n    });\n  }\n\n  videos = await getVideoViews(videos);\n  res.status(200).json({\n    videos\n  });\n}\n\nasync function getTrendingVideos(req, res) {\n  let videos = await prisma.video.findMany({\n    include: {\n      user: true\n    },\n    orderBy: {\n      createdAt: \"desc\"\n    }\n  });\n\n  if (!videos.length) {\n    return res.status(200).json({\n      videos\n    });\n  }\n\n  videos = await getVideoViews(videos);\n  videos.sort((a, b) => b.views - a.views);\n  res.status(200).json({\n    videos\n  });\n}\n\nasync function searchVideos(req, res, next) {\n  if (!req.query.query) {\n    return next({\n      message: \"Please enter a search query\",\n      statusCode: 400\n    });\n  }\n\n  let videos = await prisma.video.findMany({\n    include: {\n      user: true\n    },\n    where: {\n      OR: [{\n        title: {\n          contains: req.query.query,\n          mode: \"insensitive\"\n        }\n      }, {\n        description: {\n          contains: req.query.query,\n          mode: \"insensitive\"\n        }\n      }]\n    }\n  });\n\n  if (!videos.length) {\n    return res.status(200).json({\n      videos\n    });\n  }\n\n  videos = await getVideoViews(videos);\n  res.status(200).json({\n    videos\n  });\n}\n\nasync function addVideo(req, res) {\n  const {\n    title,\n    description,\n    url,\n    thumbnail\n  } = req.body;\n  const video = await prisma.video.create({\n    data: {\n      title,\n      description,\n      url,\n      thumbnail,\n      user: {\n        connect: {\n          id: req.user.id\n        }\n      }\n    }\n  });\n  res.status(200).json({\n    video\n  });\n}\n\nasync function addComment(req, res, next) {\n  const video = await prisma.video.findUnique({\n    where: {\n      id: req.params.videoId\n    }\n  });\n\n  if (!video) {\n    return next({\n      message: `No video found with id: \"${req.params.videoId}\"`,\n      statusCode: 404\n    });\n  }\n\n  const comment = await prisma.comment.create({\n    data: {\n      text: req.body.text,\n      user: {\n        connect: {\n          id: req.user.id\n        }\n      },\n      video: {\n        connect: {\n          id: req.params.videoId\n        }\n      }\n    }\n  });\n  res.status(200).json({\n    comment\n  });\n}\n\nasync function deleteComment(req, res) {\n  const comment = await prisma.comment.findUnique({\n    where: {\n      id: req.params.commentId\n    },\n    select: {\n      userId: true\n    }\n  });\n\n  if (comment.userId !== req.user.id) {\n    return res.status(401).send(\"You are not authorized to delete this comment\");\n  }\n\n  await prisma.comment.delete({\n    where: {\n      id: req.params.commentId\n    }\n  });\n  res.status(200).json({});\n}\n\nasync function addVideoView(req, res, next) {\n  const video = await prisma.video.findUnique({\n    where: {\n      id: req.params.videoId\n    }\n  });\n\n  if (!video) {\n    return next({\n      message: `No video found with id: \"${req.params.videoId}\"`,\n      statusCode: 404\n    });\n  }\n\n  if (req.user) {\n    await prisma.view.create({\n      data: {\n        video: {\n          connect: {\n            id: req.params.videoId\n          }\n        },\n        user: {\n          connect: {\n            id: req.user.id\n          }\n        }\n      }\n    });\n  } else {\n    await prisma.view.create({\n      data: {\n        video: {\n          connect: {\n            id: req.params.videoId\n          }\n        }\n      }\n    });\n  }\n\n  res.status(200).json({});\n}\n\nasync function likeVideo(req, res, next) {\n  const video = await prisma.video.findUnique({\n    where: {\n      id: req.params.videoId\n    }\n  });\n\n  if (!video) {\n    return next({\n      message: `No video found with id: \"${req.params.videoId}\"`,\n      statusCode: 404\n    });\n  }\n\n  const isLiked = await prisma.videoLike.findFirst({\n    where: {\n      userId: {\n        equals: req.user.id\n      },\n      videoId: {\n        equals: req.params.videoId\n      },\n      like: {\n        equals: 1\n      }\n    }\n  });\n  const isDisliked = await prisma.videoLike.findFirst({\n    where: {\n      userId: {\n        equals: req.user.id\n      },\n      videoId: {\n        equals: req.params.videoId\n      },\n      like: {\n        equals: -1\n      }\n    }\n  });\n\n  if (isLiked) {\n    await prisma.videoLike.delete({\n      where: {\n        id: isLiked.id\n      }\n    });\n  } else if (isDisliked) {\n    await prisma.videoLike.update({\n      where: {\n        id: isDisliked.id\n      },\n      data: {\n        like: 1\n      }\n    });\n  } else {\n    await prisma.videoLike.create({\n      data: {\n        user: {\n          connect: {\n            id: req.user.id\n          }\n        },\n        video: {\n          connect: {\n            id: req.params.videoId\n          }\n        },\n        like: 1\n      }\n    });\n  }\n\n  res.status(200).json({});\n}\n\nasync function dislikeVideo(req, res, next) {\n  const video = await prisma.video.findUnique({\n    where: {\n      id: req.params.videoId\n    }\n  });\n\n  if (!video) {\n    return next({\n      message: `No video found with id: \"${req.params.videoId}\"`,\n      statusCode: 404\n    });\n  }\n\n  const isLiked = await prisma.videoLike.findFirst({\n    where: {\n      userId: {\n        equals: req.user.id\n      },\n      videoId: {\n        equals: req.params.videoId\n      },\n      like: {\n        equals: 1\n      }\n    }\n  });\n  const isDisliked = await prisma.videoLike.findFirst({\n    where: {\n      userId: {\n        equals: req.user.id\n      },\n      videoId: {\n        equals: req.params.videoId\n      },\n      like: {\n        equals: -1\n      }\n    }\n  });\n\n  if (isDisliked) {\n    await prisma.videoLike.delete({\n      where: {\n        id: isDisliked.id\n      }\n    });\n  } else if (isLiked) {\n    await prisma.videoLike.update({\n      where: {\n        id: isLiked.id\n      },\n      data: {\n        like: -1\n      }\n    });\n  } else {\n    await prisma.videoLike.create({\n      data: {\n        user: {\n          connect: {\n            id: req.user.id\n          }\n        },\n        video: {\n          connect: {\n            id: req.params.videoId\n          }\n        },\n        like: -1\n      }\n    });\n  }\n\n  res.status(200).json({});\n}\n\nasync function getVideo(req, res, next) {\n  const video = await prisma.video.findUnique({\n    where: {\n      id: req.params.videoId\n    },\n    include: {\n      user: true,\n      comments: {\n        include: {\n          user: true\n        },\n        orderBy: {\n          createdAt: \"desc\"\n        }\n      }\n    }\n  });\n\n  if (!video) {\n    return next({\n      message: `No video found with id: \"${req.params.videoId}\"`,\n      statusCode: 404\n    });\n  }\n\n  let isVideoMine = false;\n  let isLiked = false;\n  let isDisliked = false;\n  let isSubscribed = false;\n  let isViewed = false;\n\n  if (req.user) {\n    isVideoMine = req.user.id === video.userId;\n    isLiked = await prisma.videoLike.findFirst({\n      where: {\n        userId: {\n          equals: req.user.id\n        },\n        videoId: {\n          equals: req.params.videoId\n        },\n        like: {\n          equals: 1\n        }\n      }\n    });\n    isDisliked = await prisma.videoLike.findFirst({\n      where: {\n        userId: {\n          equals: req.user.id\n        },\n        videoId: {\n          equals: req.params.videoId\n        },\n        like: {\n          equals: -1\n        }\n      }\n    });\n    isViewed = await prisma.view.findFirst({\n      where: {\n        userId: {\n          equals: req.user.id\n        },\n        videoId: {\n          equals: video.id\n        }\n      }\n    });\n    isSubscribed = await prisma.subscription.findFirst({\n      where: {\n        subscriberId: {\n          equals: req.user.id\n        },\n        subscribedToId: {\n          equals: video.userId\n        }\n      }\n    });\n  }\n\n  const likesCount = await prisma.videoLike.count({\n    where: {\n      AND: {\n        videoId: {\n          equals: req.params.videoId\n        },\n        like: {\n          equals: 1\n        }\n      }\n    }\n  });\n  const dislikesCount = await prisma.videoLike.count({\n    where: {\n      AND: {\n        videoId: {\n          equals: req.params.videoId\n        },\n        like: {\n          equals: -1\n        }\n      }\n    }\n  });\n  const views = await prisma.view.count({\n    where: {\n      videoId: {\n        equals: video.id\n      }\n    }\n  });\n  const subscribersCount = await prisma.subscription.count({\n    where: {\n      subscribedToId: {\n        equals: video.userId\n      }\n    }\n  });\n  video.commentsCount = video.comments.length;\n  video.isLiked = Boolean(isLiked);\n  video.isDisliked = Boolean(isDisliked);\n  video.likesCount = likesCount;\n  video.dislikesCount = dislikesCount;\n  video.isVideoMine = isVideoMine;\n  video.views = views;\n  video.isSubscribed = Boolean(isSubscribed);\n  video.isViewed = Boolean(isViewed);\n  video.subscribersCount = subscribersCount;\n  res.status(200).json({\n    video\n  });\n}\n\nasync function deleteVideo(req, res) {\n  const video = await prisma.video.findUnique({\n    where: {\n      id: req.params.videoId\n    },\n    select: {\n      userId: true\n    }\n  });\n\n  if (req.user.id !== video.userId) {\n    return res.status(401).send(\"You are not authorized to delete this video\");\n  }\n\n  await prisma.view.deleteMany({\n    where: {\n      videoId: {\n        equals: req.params.videoId\n      }\n    }\n  });\n  await prisma.videoLike.deleteMany({\n    where: {\n      videoId: {\n        equals: req.params.videoId\n      }\n    }\n  });\n  await prisma.comment.deleteMany({\n    where: {\n      videoId: {\n        equals: req.params.videoId\n      }\n    }\n  });\n  await prisma.video.delete({\n    where: {\n      id: req.params.videoId\n    }\n  });\n  res.status(200).json({});\n}\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInZpZGVvLmpzIl0sIm5hbWVzIjpbInByaXNtYSIsIlByaXNtYUNsaWVudCIsImdldFZpZGVvUm91dGVzIiwicm91dGVyIiwiZXhwcmVzcyIsIlJvdXRlciIsImdldCIsImdldFJlY29tbWVuZGVkVmlkZW9zIiwicG9zdCIsInByb3RlY3QiLCJhZGRWaWRlbyIsImdldFRyZW5kaW5nVmlkZW9zIiwic2VhcmNoVmlkZW9zIiwiZ2V0QXV0aFVzZXIiLCJnZXRWaWRlbyIsImRlbGV0ZSIsImRlbGV0ZVZpZGVvIiwiYWRkVmlkZW9WaWV3IiwibGlrZVZpZGVvIiwiZGlzbGlrZVZpZGVvIiwiYWRkQ29tbWVudCIsImRlbGV0ZUNvbW1lbnQiLCJnZXRWaWRlb1ZpZXdzIiwidmlkZW9zIiwidmlkZW8iLCJ2aWV3cyIsInZpZXciLCJjb3VudCIsIndoZXJlIiwidmlkZW9JZCIsImVxdWFscyIsImlkIiwicmVxIiwicmVzIiwiZmluZE1hbnkiLCJpbmNsdWRlIiwidXNlciIsIm9yZGVyQnkiLCJjcmVhdGVkQXQiLCJsZW5ndGgiLCJzdGF0dXMiLCJqc29uIiwic29ydCIsImEiLCJiIiwibmV4dCIsInF1ZXJ5IiwibWVzc2FnZSIsInN0YXR1c0NvZGUiLCJPUiIsInRpdGxlIiwiY29udGFpbnMiLCJtb2RlIiwiZGVzY3JpcHRpb24iLCJ1cmwiLCJ0aHVtYm5haWwiLCJib2R5IiwiY3JlYXRlIiwiZGF0YSIsImNvbm5lY3QiLCJmaW5kVW5pcXVlIiwicGFyYW1zIiwiY29tbWVudCIsInRleHQiLCJjb21tZW50SWQiLCJzZWxlY3QiLCJ1c2VySWQiLCJzZW5kIiwiaXNMaWtlZCIsInZpZGVvTGlrZSIsImZpbmRGaXJzdCIsImxpa2UiLCJpc0Rpc2xpa2VkIiwidXBkYXRlIiwiY29tbWVudHMiLCJpc1ZpZGVvTWluZSIsImlzU3Vic2NyaWJlZCIsImlzVmlld2VkIiwic3Vic2NyaXB0aW9uIiwic3Vic2NyaWJlcklkIiwic3Vic2NyaWJlZFRvSWQiLCJsaWtlc0NvdW50IiwiQU5EIiwiZGlzbGlrZXNDb3VudCIsInN1YnNjcmliZXJzQ291bnQiLCJjb21tZW50c0NvdW50IiwiQm9vbGVhbiIsImRlbGV0ZU1hbnkiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBQUE7O0FBQ0E7O0FBQ0E7Ozs7QUFFQSxNQUFNQSxNQUFNLEdBQUcsSUFBSUMsb0JBQUosRUFBZjs7QUFFQSxTQUFTQyxjQUFULEdBQTBCO0FBQ3hCLFFBQU1DLE1BQU0sR0FBR0MsaUJBQVFDLE1BQVIsRUFBZjs7QUFFQUYsRUFBQUEsTUFBTSxDQUFDRyxHQUFQLENBQVcsR0FBWCxFQUFnQkMsb0JBQWhCO0FBQ0FKLEVBQUFBLE1BQU0sQ0FBQ0ssSUFBUCxDQUFZLEdBQVosRUFBaUJDLHNCQUFqQixFQUEwQkMsUUFBMUI7QUFFQVAsRUFBQUEsTUFBTSxDQUFDRyxHQUFQLENBQVcsV0FBWCxFQUF3QkssaUJBQXhCO0FBQ0FSLEVBQUFBLE1BQU0sQ0FBQ0csR0FBUCxDQUFXLFNBQVgsRUFBc0JNLFlBQXRCO0FBRUFULEVBQUFBLE1BQU0sQ0FBQ0csR0FBUCxDQUFXLFdBQVgsRUFBd0JPLDBCQUF4QixFQUFxQ0MsUUFBckM7QUFDQVgsRUFBQUEsTUFBTSxDQUFDWSxNQUFQLENBQWMsV0FBZCxFQUEyQk4sc0JBQTNCLEVBQW9DTyxXQUFwQztBQUVBYixFQUFBQSxNQUFNLENBQUNHLEdBQVAsQ0FBVyxnQkFBWCxFQUE2Qk8sMEJBQTdCLEVBQTBDSSxZQUExQztBQUNBZCxFQUFBQSxNQUFNLENBQUNHLEdBQVAsQ0FBVyxnQkFBWCxFQUE2Qkcsc0JBQTdCLEVBQXNDUyxTQUF0QztBQUNBZixFQUFBQSxNQUFNLENBQUNHLEdBQVAsQ0FBVyxtQkFBWCxFQUFnQ0csc0JBQWhDLEVBQXlDVSxZQUF6QztBQUNBaEIsRUFBQUEsTUFBTSxDQUFDSyxJQUFQLENBQVksb0JBQVosRUFBa0NDLHNCQUFsQyxFQUEyQ1csVUFBM0M7QUFDQWpCLEVBQUFBLE1BQU0sQ0FBQ1ksTUFBUCxDQUFjLCtCQUFkLEVBQStDTixzQkFBL0MsRUFBd0RZLGFB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QixHQUFwQixDQUFOO0FBTUFJLEVBQUFBLEdBQUcsQ0FBQ08sTUFBSixDQUFXLEdBQVgsRUFBZ0JDLElBQWhCLENBQXFCLEVBQXJCO0FBQ0QiLCJzb3VyY2VSb290IjoiL1VzZXJzL2Vnb3IvRGV2L3l0Y2xvbmUgZmluYWwvc2VydmVyL3NyYy9yb3V0ZXMvIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgUHJpc21hQ2xpZW50IH0gZnJvbSBcIkBwcmlzbWEvY2xpZW50XCI7XG5pbXBvcnQgZXhwcmVzcyBmcm9tIFwiZXhwcmVzc1wiO1xuaW1wb3J0IHsgZ2V0QXV0aFVzZXIsIHByb3RlY3QgfSBmcm9tIFwiLi4vbWlkZGxld2FyZS9hdXRob3JpemF0aW9uXCI7XG5cbmNvbnN0IHByaXNtYSA9IG5ldyBQcmlzbWFDbGllbnQoKTtcblxuZnVuY3Rpb24gZ2V0VmlkZW9Sb3V0ZXMoKSB7XG4gIGNvbnN0IHJvdXRlciA9IGV4cHJlc3MuUm91dGVyKCk7XG5cbiAgcm91dGVyLmdldChcIi9cIiwgZ2V0UmVjb21tZW5kZWRWaWRlb3MpO1xuICByb3V0ZXIucG9zdChcIi9cIiwgcHJvdGVjdCwgYWRkVmlkZW8pO1xuXG4gIHJvdXRlci5nZXQoXCIvdHJlbmRpbmdcIiwgZ2V0VHJlbmRpbmdWaWRlb3MpO1xuICByb3V0ZXIuZ2V0KFwiL3NlYXJjaFwiLCBzZWFyY2hWaWRlb3MpO1xuXG4gIHJvdXRlci5nZXQoXCIvOnZpZGVvSWRcIiwgZ2V0QXV0aFVzZXIsIGdldFZpZGVvKTtcbiAgcm91dGVyLmRlbGV0ZShcIi86dmlkZW9JZFwiLCBwcm90ZWN0LCBkZWxldGVWaWRlbyk7XG5cbiAgcm91dGVyLmdldChcIi86dmlkZW9JZC92aWV3XCIsIGdldEF1dGhVc2VyLCBhZGRWaWRlb1ZpZXcpO1xuICByb3V0ZXIuZ2V0KFwiLzp2aWRlb0lkL2xpa2VcIiwgcHJvdGVjdCwgbGlrZVZpZGVvKTtcbiAgcm91dGVyLmdldChcIi86dmlkZW9JZC9kaXNsaWtlXCIsIHByb3RlY3QsIGRpc2xpa2VWaWRlbyk7XG4gIHJvdXRlci5wb3N0KFwiLzp2aWRlb0lkL2NvbW1lbnRzXCIsIHByb3RlY3QsIGFkZENvbW1lbnQpO1xuICByb3V0ZXIuZGVsZXRlKFwiLzp2aWRlb0lkL2NvbW1lbnRzLzpjb21tZW50SWRcIiwgcHJvdGVjdCwgZGVsZXRlQ29tbWVudCk7XG5cbiAgcmV0dXJuIHJvdXRlcjtcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldFZpZGVvVmlld3ModmlkZW9zKSB7XG4gIGZvciAoY29uc3QgdmlkZW8gb2YgdmlkZW9zKSB7XG4gICAgY29uc3Qgdmlld3MgPSBhd2FpdCBwcmlzbWEudmlldy5jb3VudCh7XG4gICAgICB3aGVyZToge1xuICAgICAgICB2aWRlb0lkOiB7XG4gICAgICAgICAgZXF1YWxzOiB2aWRlby5pZCxcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgfSk7XG4gICAgdmlkZW8udmlld3MgPSB2aWV3cztcbiAgfVxuICByZXR1cm4gdmlkZW9zO1xufVxuXG5hc3luYyBmdW5jdGlvbiBnZXRSZWNvbW1lbmRlZFZpZGVvcyhyZXEsIHJlcykge1xuICBsZXQgdmlkZW9zID0gYXdhaXQgcHJpc21hLnZpZGVvLmZpbmRNYW55KHtcbiAgICBpbmNsdWRlOiB7XG4gICAgICB1c2VyOiB0cnVlLFxuICAgIH0sXG4gICAgb3JkZXJCeToge1xuICAgICAgY3JlYXRlZEF0OiBcImRlc2NcIixcbiAgICB9LFxuICB9KTtcblxuICBpZiAoIXZpZGVvcy5sZW5ndGgpIHtcbiAgICByZXR1cm4gcmVzLnN0YXR1cygyMDApLmpzb24oeyB2aWRlb3MgfSk7XG4gIH1cblxuICB2aWRlb3MgPSBhd2FpdCBnZXRWaWRlb1ZpZXdzKHZpZGVvcyk7XG5cbiAgcmVzLnN0YXR1cygyMDApLmpzb24oeyB2aWRlb3MgfSk7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGdldFRyZW5kaW5nVmlkZW9zKHJlcSwgcmVzKSB7XG4gIGxldCB2aWRlb3MgPSBhd2FpdCBwcmlzbWEudmlkZW8uZmluZE1hbnkoe1xuICAgIGluY2x1ZGU6IHtcbiAgICAgIHVzZXI6IHRydWUsXG4gICAgfSxcbiAgICBvcmRlckJ5OiB7XG4gICAgICBjcmVhdGVkQXQ6IFwiZGVzY1wiLFxuICAgIH0sXG4gIH0pO1xuXG4gIGlmICghdmlkZW9zLmxlbmd0aCkge1xuICAgIHJldHVybiByZXMuc3RhdHVzKDIwMCkuanNvbih7IHZpZGVvcyB9KTtcbiAgfVxuXG4gIHZpZGVvcyA9IGF3YWl0IGdldFZpZGVvVmlld3ModmlkZW9zKTtcbiAgdmlkZW9zLnNvcnQoKGEsIGIpID0+IGIudmlld3MgLSBhLnZpZXdzKTtcblxuICByZXMuc3RhdHVzKDIwMCkuanNvbih7IHZpZGVvcyB9KTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gc2VhcmNoVmlkZW9zKHJlcSwgcmVzLCBuZXh0KSB7XG4gIGlmICghcmVxLnF1ZXJ5LnF1ZXJ5KSB7XG4gICAgcmV0dXJuIG5leHQoe1xuICAgICAgbWVzc2FnZTogXCJQbGVhc2UgZW50ZXIgYSBzZWFyY2ggcXVlcnlcIixcbiAgICAgIHN0YXR1c0NvZGU6IDQwMCxcbiAgICB9KTtcbiAgfVxuXG4gIGxldCB2aWRlb3MgPSBhd2FpdCBwcmlzbWEudmlkZW8uZmluZE1hbnkoe1xuICAgIGluY2x1ZGU6IHtcbiAgICAgIHVzZXI6IHRydWUsXG4gICAgfSxcbiAgICB3aGVyZToge1xuICAgICAgT1I6IFtcbiAgICAgICAge1xuICAgICAgICAgIHRpdGxlOiB7XG4gICAgICAgICAgICBjb250YWluczogcmVxLnF1ZXJ5LnF1ZXJ5LFxuICAgICAgICAgICAgbW9kZTogXCJpbnNlbnNpdGl2ZVwiLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICBkZXNjcmlwdGlvbjoge1xuICAgICAgICAgICAgY29udGFpbnM6IHJlcS5xdWVyeS5xdWVyeSxcbiAgICAgICAgICAgIG1vZGU6IFwiaW5zZW5zaXRpdmVcIixcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgXSxcbiAgICB9LFxuICB9KTtcblxuICBpZiAoIXZpZGVvcy5sZW5ndGgpIHtcbiAgICByZXR1cm4gcmVzLnN0YXR1cygyMDApLmpzb24oeyB2aWRlb3MgfSk7XG4gIH1cblxuICB2aWRlb3MgPSBhd2FpdCBnZXRWaWRlb1ZpZXdzKHZpZGVvcyk7XG5cbiAgcmVzLnN0YXR1cygyMDApLmpzb24oeyB2aWRlb3MgfSk7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGFkZFZpZGVvKHJlcSwgcmVzKSB7XG4gIGNvbnN0IHsgdGl0bGUsIGRlc2NyaXB0aW9uLCB1cmwsIHRodW1ibmFpbCB9ID0gcmVxLmJvZHk7XG5cbiAgY29uc3QgdmlkZW8gPSBhd2FpdCBwcmlzbWEudmlkZW8uY3JlYXRlKHtcbiAgICBkYXRhOiB7XG4gICAgICB0aXRsZSxcbiAgICAgIGRlc2NyaXB0aW9uLFxuICAgICAgdXJsLFxuICAgICAgdGh1bWJuYWlsLFxuICAgICAgdXNlcjoge1xuICAgICAgICBjb25uZWN0OiB7XG4gICAgICAgICAgaWQ6IHJlcS51c2VyLmlkLFxuICAgICAgICB9LFxuICAgICAgfSxcbiAgICB9LFxuICB9KTtcblxuICByZXMuc3RhdHVzKDIwMCkuanNvbih7IHZpZGVvIH0pO1xufVxuXG5hc3luYyBmdW5jdGlvbiBhZGRDb21tZW50KHJlcSwgcmVzLCBuZXh0KSB7XG4gIGNvbnN0IHZpZGVvID0gYXdhaXQgcHJpc21hLnZpZGVvLmZpbmRVbmlxdWUoe1xuICAgIHdoZXJlOiB7XG4gICAgICBpZDogcmVxLnBhcmFtcy52aWRlb0lkLFxuICAgIH0sXG4gIH0pO1xuXG4gIGlmICghdmlkZW8pIHtcbiAgICByZXR1cm4gbmV4dCh7XG4gICAgICBtZXNzYWdlOiBgTm8gdmlkZW8gZm91bmQgd2l0aCBpZDogXCIke3JlcS5wYXJhbXMudmlkZW9JZH1cImAsXG4gICAgICBzdGF0dXNDb2RlOiA0MDQsXG4gICAgfSk7XG4gIH1cblxuICBjb25zdCBjb21tZW50ID0gYXdhaXQgcHJpc21hLmNvbW1lbnQuY3JlYXRlKHtcbiAgICBkYXRhOiB7XG4gICAgICB0ZXh0OiByZXEuYm9keS50ZXh0LFxuICAgICAgdXNlcjoge1xuICAgICAgICBjb25uZWN0OiB7XG4gICAgICAgICAgaWQ6IHJlcS51c2VyLmlkLFxuICAgICAgICB9LFxuICAgICAgfSxcbiAgICAgIHZpZGVvOiB7XG4gICAgICAgIGNvbm5lY3Q6IHtcbiAgICAgICAgICBpZDogcmVxLnBhcmFtcy52aWRlb0lkLFxuICAgICAgICB9LFxuICAgICAgfSxcbiAgICB9LFxuICB9KTtcblxuICByZXMuc3RhdHVzKDIwMCkuanNvbih7IGNvbW1lbnQgfSk7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGRlbGV0ZUNvbW1lbnQocmVxLCByZXMpIHtcbiAgY29uc3QgY29tbWVudCA9IGF3YWl0IHByaXNtYS5jb21tZW50LmZpbmRVbmlxdWUoe1xuICAgIHdoZXJlOiB7XG4gICAgICBpZDogcmVxLnBhcmFtcy5jb21tZW50SWQsXG4gICAgfSxcbiAgICBzZWxlY3Q6IHtcbiAgICAgIHVzZXJJZDogdHJ1ZSxcbiAgICB9LFxuICB9KTtcblxuICBpZiAoY29tbWVudC51c2VySWQgIT09IHJlcS51c2VyLmlkKSB7XG4gICAgcmV0dXJuIHJlc1xuICAgICAgLnN0YXR1cyg0MDEpXG4gICAgICAuc2VuZChcIllvdSBhcmUgbm90IGF1dGhvcml6ZWQgdG8gZGVsZXRlIHRoaXMgY29tbWVudFwiKTtcbiAgfVxuXG4gIGF3YWl0IHByaXNtYS5jb21tZW50LmRlbGV0ZSh7XG4gICAgd2hlcmU6IHtcbiAgICAgIGlkOiByZXEucGFyYW1zLmNvbW1lbnRJZCxcbiAgICB9LFxuICB9KTtcblxuICByZXMuc3RhdHVzKDIwMCkuanNvbih7fSk7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGFkZFZpZGVvVmlldyhyZXEsIHJlcywgbmV4dCkge1xuICBjb25zdCB2aWRlbyA9IGF3YWl0IHByaXNtYS52aWRlby5maW5kVW5pcXVlKHtcbiAgICB3aGVyZToge1xuICAgICAgaWQ6IHJlcS5wYXJhbXMudmlkZW9JZCxcbiAgICB9LFxuICB9KTtcblxuICBpZiAoIXZpZGVvKSB7XG4gICAgcmV0dXJuIG5leHQoe1xuICAgICAgbWVzc2FnZTogYE5vIHZpZGVvIGZvdW5kIHdpdGggaWQ6IFwiJHtyZXEucGFyYW1zLnZpZGVvSWR9XCJgLFxuICAgICAgc3RhdHVzQ29kZTogNDA0LFxuICAgIH0pO1xuICB9XG5cbiAgaWYgKHJlcS51c2VyKSB7XG4gICAgYXdhaXQgcHJpc21hLnZpZXcuY3JlYXRlKHtcbiAgICAgIGRhdGE6IHtcbiAgICAgICAgdmlkZW86IHtcbiAgICAgICAgICBjb25uZWN0OiB7XG4gICAgICAgICAgICBpZDogcmVxLnBhcmFtcy52aWRlb0lkLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHVzZXI6IHtcbiAgICAgICAgICBjb25uZWN0OiB7XG4gICAgICAgICAgICBpZDogcmVxLnVzZXIuaWQsXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgfSk7XG4gIH0gZWxzZSB7XG4gICAgYXdhaXQgcHJpc21hLnZpZXcuY3JlYXRlKHtcbiAgICAgIGRhdGE6IHtcbiAgICAgICAgdmlkZW86IHtcbiAgICAgICAgICBjb25uZWN0OiB7XG4gICAgICAgICAgICBpZDogcmVxLnBhcmFtcy52aWRlb0lkLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgIH0pO1xuICB9XG5cbiAgcmVzLnN0YXR1cygyMDApLmpzb24oe30pO1xufVxuXG5hc3luYyBmdW5jdGlvbiBsaWtlVmlkZW8ocmVxLCByZXMsIG5leHQpIHtcbiAgY29uc3QgdmlkZW8gPSBhd2FpdCBwcmlzbWEudmlkZW8uZmluZFVuaXF1ZSh7XG4gICAgd2hlcmU6IHtcbiAgICAgIGlkOiByZXEucGFyYW1zLnZpZGVvSWQsXG4gICAgfSxcbiAgfSk7XG5cbiAgaWYgKCF2aWRlbykge1xuICAgIHJldHVybiBuZXh0KHtcbiAgICAgIG1lc3NhZ2U6IGBObyB2aWRlbyBmb3VuZCB3aXRoIGlkOiBcIiR7cmVxLnBhcmFtcy52aWRlb0lkfVwiYCxcbiAgICAgIHN0YXR1c0NvZGU6IDQwNCxcbiAgICB9KTtcbiAgfVxuXG4gIGNvbnN0IGlzTGlrZWQgPSBhd2FpdCBwcmlzbWEudmlkZW9MaWtlLmZpbmRGaXJzdCh7XG4gICAgd2hlcmU6IHtcbiAgICAgIHVzZXJJZDoge1xuICAgICAgICBlcXVhbHM6IHJlcS51c2VyLmlkLFxuICAgICAgfSxcbiAgICAgIHZpZGVvSWQ6IHtcbiAgICAgICAgZXF1YWxzOiByZXEucGFyYW1zLnZpZGVvSWQsXG4gICAgICB9LFxuICAgICAgbGlrZToge1xuICAgICAgICBlcXVhbHM6IDEsXG4gICAgICB9LFxuICAgIH0sXG4gIH0pO1xuXG4gIGNvbnN0IGlzRGlzbGlrZWQgPSBhd2FpdCBwcmlzbWEudmlkZW9MaWtlLmZpbmRGaXJzdCh7XG4gICAgd2hlcmU6IHtcbiAgICAgIHVzZXJJZDoge1xuICAgICAgICBlcXVhbHM6IHJlcS51c2VyLmlkLFxuICAgICAgfSxcbiAgICAgIHZpZGVvSWQ6IHtcbiAgICAgICAgZXF1YWxzOiByZXEucGFyYW1zLnZpZGVvSWQsXG4gICAgICB9LFxuICAgICAgbGlrZToge1xuICAgICAgICBlcXVhbHM6IC0xLFxuICAgICAgfSxcbiAgICB9LFxuICB9KTtcblxuICBpZiAoaXNMaWtlZCkge1xuICAgIGF3YWl0IHByaXNtYS52aWRlb0xpa2UuZGVsZXRlKHtcbiAgICAgIHdoZXJlOiB7XG4gICAgICAgIGlkOiBpc0xpa2VkLmlkLFxuICAgICAgfSxcbiAgICB9KTtcbiAgfSBlbHNlIGlmIChpc0Rpc2xpa2VkKSB7XG4gICAgYXdhaXQgcHJpc21hLnZpZGVvTGlrZS51cGRhdGUoe1xuICAgICAgd2hlcmU6IHtcbiAgICAgICAgaWQ6IGlzRGlzbGlrZWQuaWQsXG4gICAgICB9LFxuICAgICAgZGF0YToge1xuICAgICAgICBsaWtlOiAxLFxuICAgICAgfSxcbiAgICB9KTtcbiAgfSBlbHNlIHtcbiAgICBhd2FpdCBwcmlzbWEudmlkZW9MaWtlLmNyZWF0ZSh7XG4gICAgICBkYXRhOiB7XG4gICAgICAgIHVzZXI6IHtcbiAgICAgICAgICBjb25uZWN0OiB7XG4gICAgICAgICAgICBpZDogcmVxLnVzZXIuaWQsXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAgdmlkZW86IHtcbiAgICAgICAgICBjb25uZWN0OiB7XG4gICAgICAgICAgICBpZDogcmVxLnBhcmFtcy52aWRlb0lkLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIGxpa2U6IDEsXG4gICAgICB9LFxuICAgIH0pO1xuICB9XG5cbiAgcmVzLnN0YXR1cygyMDApLmpzb24oe30pO1xufVxuXG5hc3luYyBmdW5jdGlvbiBkaXNsaWtlVmlkZW8ocmVxLCByZXMsIG5leHQpIHtcbiAgY29uc3QgdmlkZW8gPSBhd2FpdCBwcmlzbWEudmlkZW8uZmluZFVuaXF1ZSh7XG4gICAgd2hlcmU6IHtcbiAgICAgIGlkOiByZXEucGFyYW1zLnZpZGVvSWQsXG4gICAgfSxcbiAgfSk7XG5cbiAgaWYgKCF2aWRlbykge1xuICAgIHJldHVybiBuZXh0KHtcbiAgICAgIG1lc3NhZ2U6IGBObyB2aWRlbyBmb3VuZCB3aXRoIGlkOiBcIiR7cmVxLnBhcmFtcy52aWRlb0lkfVwiYCxcbiAgICAgIHN0YXR1c0NvZGU6IDQwNCxcbiAgICB9KTtcbiAgfVxuXG4gIGNvbnN0IGlzTGlrZWQgPSBhd2FpdCBwcmlzbWEudmlkZW9MaWtlLmZpbmRGaXJzdCh7XG4gICAgd2hlcmU6IHtcbiAgICAgIHVzZXJJZDoge1xuICAgICAgICBlcXVhbHM6IHJlcS51c2VyLmlkLFxuICAgICAgfSxcbiAgICAgIHZpZGVvSWQ6IHtcbiAgICAgICAgZXF1YWxzOiByZXEucGFyYW1zLnZpZGVvSWQsXG4gICAgICB9LFxuICAgICAgbGlrZToge1xuICAgICAgICBlcXVhbHM6IDEsXG4gICAgICB9LFxuICAgIH0sXG4gIH0pO1xuXG4gIGNvbnN0IGlzRGlzbGlrZWQgPSBhd2FpdCBwcmlzbWEudmlkZW9MaWtlLmZpbmRGaXJzdCh7XG4gICAgd2hlcmU6IHtcbiAgICAgIHVzZXJJZDoge1xuICAgICAgICBlcXVhbHM6IHJlcS51c2VyLmlkLFxuICAgICAgfSxcbiAgICAgIHZpZGVvSWQ6IHtcbiAgICAgICAgZXF1YWxzOiByZXEucGFyYW1zLnZpZGVvSWQsXG4gICAgICB9LFxuICAgICAgbGlrZToge1xuICAgICAgICBlcXVhbHM6IC0xLFxuICAgICAgfSxcbiAgICB9LFxuICB9KTtcblxuICBpZiAoaXNEaXNsaWtlZCkge1xuICAgIGF3YWl0IHByaXNtYS52aWRlb0xpa2UuZGVsZXRlKHtcbiAgICAgIHdoZXJlOiB7XG4gICAgICAgIGlkOiBpc0Rpc2xpa2VkLmlkLFxuICAgICAgfSxcbiAgICB9KTtcbiAgfSBlbHNlIGlmIChpc0xpa2VkKSB7XG4gICAgYXdhaXQgcHJpc21hLnZpZGVvTGlrZS51cGRhdGUoe1xuICAgICAgd2hlcmU6IHtcbiAgICAgICAgaWQ6IGlzTGlrZWQuaWQsXG4gICAgICB9LFxuICAgICAgZGF0YToge1xuICAgICAgICBsaWtlOiAtMSxcbiAgICAgIH0sXG4gICAgfSk7XG4gIH0gZWxzZSB7XG4gICAgYXdhaXQgcHJpc21hLnZpZGVvTGlrZS5jcmVhdGUoe1xuICAgICAgZGF0YToge1xuICAgICAgICB1c2VyOiB7XG4gICAgICAgICAgY29ubmVjdDoge1xuICAgICAgICAgICAgaWQ6IHJlcS51c2VyLmlkLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHZpZGVvOiB7XG4gICAgICAgICAgY29ubmVjdDoge1xuICAgICAgICAgICAgaWQ6IHJlcS5wYXJhbXMudmlkZW9JZCxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICBsaWtlOiAtMSxcbiAgICAgIH0sXG4gICAgfSk7XG4gIH1cblxuICByZXMuc3RhdHVzKDIwMCkuanNvbih7fSk7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGdldFZpZGVvKHJlcSwgcmVzLCBuZXh0KSB7XG4gIGNvbnN0IHZpZGVvID0gYXdhaXQgcHJpc21hLnZpZGVvLmZpbmRVbmlxdWUoe1xuICAgIHdoZXJlOiB7XG4gICAgICBpZDogcmVxLnBhcmFtcy52aWRlb0lkLFxuICAgIH0sXG4gICAgaW5jbHVkZToge1xuICAgICAgdXNlcjogdHJ1ZSxcbiAgICAgIGNvbW1lbnRzOiB7XG4gICAgICAgIGluY2x1ZGU6IHtcbiAgICAgICAgICB1c2VyOiB0cnVlLFxuICAgICAgICB9LFxuICAgICAgICBvcmRlckJ5OiB7XG4gICAgICAgICAgY3JlYXRlZEF0OiBcImRlc2NcIixcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgfSxcbiAgfSk7XG5cbiAgaWYgKCF2aWRlbykge1xuICAgIHJldHVybiBuZXh0KHtcbiAgICAgIG1lc3NhZ2U6IGBObyB2aWRlbyBmb3VuZCB3aXRoIGlkOiBcIiR7cmVxLnBhcmFtcy52aWRlb0lkfVwiYCxcbiAgICAgIHN0YXR1c0NvZGU6IDQwNCxcbiAgICB9KTtcbiAgfVxuXG4gIGxldCBpc1ZpZGVvTWluZSA9IGZhbHNlO1xuICBsZXQgaXNMaWtlZCA9IGZhbHNlO1xuICBsZXQgaXNEaXNsaWtlZCA9IGZhbHNlO1xuICBsZXQgaXNTdWJzY3JpYmVkID0gZmFsc2U7XG4gIGxldCBpc1ZpZXdlZCA9IGZhbHNlO1xuXG4gIGlmIChyZXEudXNlcikge1xuICAgIGlzVmlkZW9NaW5lID0gcmVxLnVzZXIuaWQgPT09IHZpZGVvLnVzZXJJZDtcblxuICAgIGlzTGlrZWQgPSBhd2FpdCBwcmlzbWEudmlkZW9MaWtlLmZpbmRGaXJzdCh7XG4gICAgICB3aGVyZToge1xuICAgICAgICB1c2VySWQ6IHtcbiAgICAgICAgICBlcXVhbHM6IHJlcS51c2VyLmlkLFxuICAgICAgICB9LFxuICAgICAgICB2aWRlb0lkOiB7XG4gICAgICAgICAgZXF1YWxzOiByZXEucGFyYW1zLnZpZGVvSWQsXG4gICAgICAgIH0sXG4gICAgICAgIGxpa2U6IHtcbiAgICAgICAgICBlcXVhbHM6IDEsXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgIH0pO1xuXG4gICAgaXNEaXNsaWtlZCA9IGF3YWl0IHByaXNtYS52aWRlb0xpa2UuZmluZEZpcnN0KHtcbiAgICAgIHdoZXJlOiB7XG4gICAgICAgIHVzZXJJZDoge1xuICAgICAgICAgIGVxdWFsczogcmVxLnVzZXIuaWQsXG4gICAgICAgIH0sXG4gICAgICAgIHZpZGVvSWQ6IHtcbiAgICAgICAgICBlcXVhbHM6IHJlcS5wYXJhbXMudmlkZW9JZCxcbiAgICAgICAgfSxcbiAgICAgICAgbGlrZToge1xuICAgICAgICAgIGVxdWFsczogLTEsXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgIH0pO1xuXG4gICAgaXNWaWV3ZWQgPSBhd2FpdCBwcmlzbWEudmlldy5maW5kRmlyc3Qoe1xuICAgICAgd2hlcmU6IHtcbiAgICAgICAgdXNlcklkOiB7XG4gICAgICAgICAgZXF1YWxzOiByZXEudXNlci5pZCxcbiAgICAgICAgfSxcbiAgICAgICAgdmlkZW9JZDoge1xuICAgICAgICAgIGVxdWFsczogdmlkZW8uaWQsXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgIH0pO1xuXG4gICAgaXNTdWJzY3JpYmVkID0gYXdhaXQgcHJpc21hLnN1YnNjcmlwdGlvbi5maW5kRmlyc3Qoe1xuICAgICAgd2hlcmU6IHtcbiAgICAgICAgc3Vic2NyaWJlcklkOiB7XG4gICAgICAgICAgZXF1YWxzOiByZXEudXNlci5pZCxcbiAgICAgICAgfSxcbiAgICAgICAgc3Vic2NyaWJlZFRvSWQ6IHtcbiAgICAgICAgICBlcXVhbHM6IHZpZGVvLnVzZXJJZCxcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgfSk7XG4gIH1cblxuICBjb25zdCBsaWtlc0NvdW50ID0gYXdhaXQgcHJpc21hLnZpZGVvTGlrZS5jb3VudCh7XG4gICAgd2hlcmU6IHtcbiAgICAgIEFORDoge1xuICAgICAgICB2aWRlb0lkOiB7XG4gICAgICAgICAgZXF1YWxzOiByZXEucGFyYW1zLnZpZGVvSWQsXG4gICAgICAgIH0sXG4gICAgICAgIGxpa2U6IHtcbiAgICAgICAgICBlcXVhbHM6IDEsXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgIH0sXG4gIH0pO1xuXG4gIGNvbnN0IGRpc2xpa2VzQ291bnQgPSBhd2FpdCBwcmlzbWEudmlkZW9MaWtlLmNvdW50KHtcbiAgICB3aGVyZToge1xuICAgICAgQU5EOiB7XG4gICAgICAgIHZpZGVvSWQ6IHtcbiAgICAgICAgICBlcXVhbHM6IHJlcS5wYXJhbXMudmlkZW9JZCxcbiAgICAgICAgfSxcbiAgICAgICAgbGlrZToge1xuICAgICAgICAgIGVxdWFsczogLTEsXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgIH0sXG4gIH0pO1xuXG4gIGNvbnN0IHZpZXdzID0gYXdhaXQgcHJpc21hLnZpZXcuY291bnQoe1xuICAgIHdoZXJlOiB7XG4gICAgICB2aWRlb0lkOiB7XG4gICAgICAgIGVxdWFsczogdmlkZW8uaWQsXG4gICAgICB9LFxuICAgIH0sXG4gIH0pO1xuXG4gIGNvbnN0IHN1YnNjcmliZXJzQ291bnQgPSBhd2FpdCBwcmlzbWEuc3Vic2NyaXB0aW9uLmNvdW50KHtcbiAgICB3aGVyZToge1xuICAgICAgc3Vic2NyaWJlZFRvSWQ6IHtcbiAgICAgICAgZXF1YWxzOiB2aWRlby51c2VySWQsXG4gICAgICB9LFxuICAgIH0sXG4gIH0pO1xuXG4gIHZpZGVvLmNvbW1lbnRzQ291bnQgPSB2aWRlby5jb21tZW50cy5sZW5ndGg7XG4gIHZpZGVvLmlzTGlrZWQgPSBCb29sZWFuKGlzTGlrZWQpO1xuICB2aWRlby5pc0Rpc2xpa2VkID0gQm9vbGVhbihpc0Rpc2xpa2VkKTtcbiAgdmlkZW8ubGlrZXNDb3VudCA9IGxpa2VzQ291bnQ7XG4gIHZpZGVvLmRpc2xpa2VzQ291bnQgPSBkaXNsaWtlc0NvdW50O1xuICB2aWRlby5pc1ZpZGVvTWluZSA9IGlzVmlkZW9NaW5lO1xuICB2aWRlby52aWV3cyA9IHZpZXdzO1xuICB2aWRlby5pc1N1YnNjcmliZWQgPSBCb29sZWFuKGlzU3Vic2NyaWJlZCk7XG4gIHZpZGVvLmlzVmlld2VkID0gQm9vbGVhbihpc1ZpZXdlZCk7XG4gIHZpZGVvLnN1YnNjcmliZXJzQ291bnQgPSBzdWJzY3JpYmVyc0NvdW50O1xuXG4gIHJlcy5zdGF0dXMoMjAwKS5qc29uKHsgdmlkZW8gfSk7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGRlbGV0ZVZpZGVvKHJlcSwgcmVzKSB7XG4gIGNvbnN0IHZpZGVvID0gYXdhaXQgcHJpc21hLnZpZGVvLmZpbmRVbmlxdWUoe1xuICAgIHdoZXJlOiB7XG4gICAgICBpZDogcmVxLnBhcmFtcy52aWRlb0lkLFxuICAgIH0sXG4gICAgc2VsZWN0OiB7XG4gICAgICB1c2VySWQ6IHRydWUsXG4gICAgfSxcbiAgfSk7XG5cbiAgaWYgKHJlcS51c2VyLmlkICE9PSB2aWRlby51c2VySWQpIHtcbiAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDEpLnNlbmQoXCJZb3UgYXJlIG5vdCBhdXRob3JpemVkIHRvIGRlbGV0ZSB0aGlzIHZpZGVvXCIpO1xuICB9XG5cbiAgYXdhaXQgcHJpc21hLnZpZXcuZGVsZXRlTWFueSh7XG4gICAgd2hlcmU6IHtcbiAgICAgIHZpZGVvSWQ6IHtcbiAgICAgICAgZXF1YWxzOiByZXEucGFyYW1zLnZpZGVvSWQsXG4gICAgICB9LFxuICAgIH0sXG4gIH0pO1xuXG4gIGF3YWl0IHByaXNtYS52aWRlb0xpa2UuZGVsZXRlTWFueSh7XG4gICAgd2hlcmU6IHtcbiAgICAgIHZpZGVvSWQ6IHtcbiAgICAgICAgZXF1YWxzOiByZXEucGFyYW1zLnZpZGVvSWQsXG4gICAgICB9LFxuICAgIH0sXG4gIH0pO1xuXG4gIGF3YWl0IHByaXNtYS5jb21tZW50LmRlbGV0ZU1hbnkoe1xuICAgIHdoZXJlOiB7XG4gICAgICB2aWRlb0lkOiB7XG4gICAgICAgIGVxdWFsczogcmVxLnBhcmFtcy52aWRlb0lkLFxuICAgICAgfSxcbiAgICB9LFxuICB9KTtcblxuICBhd2FpdCBwcmlzbWEudmlkZW8uZGVsZXRlKHtcbiAgICB3aGVyZToge1xuICAgICAgaWQ6IHJlcS5wYXJhbXMudmlkZW9JZCxcbiAgICB9LFxuICB9KTtcblxuICByZXMuc3RhdHVzKDIwMCkuanNvbih7fSk7XG59XG5cbmV4cG9ydCB7IGdldFZpZGVvUm91dGVzIH07XG4iXX0=",
    "map": {
      "version": 3,
      "sources": [
        "video.js"
      ],
      "names": [
        "prisma",
        "PrismaClient",
        "getVideoRoutes",
        "router",
        "express",
        "Router",
        "get",
        "getRecommendedVideos",
        "post",
        "protect",
        "addVideo",
        "getTrendingVideos",
        "searchVideos",
        "getAuthUser",
        "getVideo",
        "delete",
        "deleteVideo",
        "addVideoView",
        "likeVideo",
        "dislikeVideo",
        "addComment",
        "deleteComment",
        "getVideoViews",
        "videos",
        "video",
        "views",
        "view",
        "count",
        "where",
        "videoId",
        "equals",
        "id",
        "req",
        "res",
        "findMany",
        "include",
        "user",
        "orderBy",
        "createdAt",
        "length",
        "status",
        "json",
        "sort",
        "a",
        "b",
        "next",
        "query",
        "message",
        "statusCode",
        "OR",
        "title",
        "contains",
        "mode",
        "description",
        "url",
        "thumbnail",
        "body",
        "create",
        "data",
        "connect",
        "findUnique",
        "params",
        "comment",
        "text",
        "commentId",
        "select",
        "userId",
        "send",
        "isLiked",
        "videoLike",
        "findFirst",
        "like",
        "isDisliked",
        "update",
        "comments",
        "isVideoMine",
        "isSubscribed",
        "isViewed",
        "subscription",
        "subscriberId",
        "subscribedToId",
        "likesCount",
        "AND",
        "dislikesCount",
        "subscribersCount",
        "commentsCount",
        "Boolean",
        "deleteMany"
      ],
      "mappings": "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",
      "sourceRoot": "/Users/egor/Dev/ytclone final/server/src/routes/",
      "sourcesContent": [
        "import { PrismaClient } from \"@prisma/client\";\nimport express from \"express\";\nimport { getAuthUser, protect } from \"../middleware/authorization\";\n\nconst prisma = new PrismaClient();\n\nfunction getVideoRoutes() {\n  const router = express.Router();\n\n  router.get(\"/\", getRecommendedVideos);\n  router.post(\"/\", protect, addVideo);\n\n  router.get(\"/trending\", getTrendingVideos);\n  router.get(\"/search\", searchVideos);\n\n  router.get(\"/:videoId\", getAuthUser, getVideo);\n  router.delete(\"/:videoId\", protect, deleteVideo);\n\n  router.get(\"/:videoId/view\", getAuthUser, addVideoView);\n  router.get(\"/:videoId/like\", protect, likeVideo);\n  router.get(\"/:videoId/dislike\", protect, dislikeVideo);\n  router.post(\"/:videoId/comments\", protect, addComment);\n  router.delete(\"/:videoId/comments/:commentId\", protect, deleteComment);\n\n  return router;\n}\n\nexport async function getVideoViews(videos) {\n  for (const video of videos) {\n    const views = await prisma.view.count({\n      where: {\n        videoId: {\n          equals: video.id,\n        },\n      },\n    });\n    video.views = views;\n  }\n  return videos;\n}\n\nasync function getRecommendedVideos(req, res) {\n  let videos = await prisma.video.findMany({\n    include: {\n      user: true,\n    },\n    orderBy: {\n      createdAt: \"desc\",\n    },\n  });\n\n  if (!videos.length) {\n    return res.status(200).json({ videos });\n  }\n\n  videos = await getVideoViews(videos);\n\n  res.status(200).json({ videos });\n}\n\nasync function getTrendingVideos(req, res) {\n  let videos = await prisma.video.findMany({\n    include: {\n      user: true,\n    },\n    orderBy: {\n      createdAt: \"desc\",\n    },\n  });\n\n  if (!videos.length) {\n    return res.status(200).json({ videos });\n  }\n\n  videos = await getVideoViews(videos);\n  videos.sort((a, b) => b.views - a.views);\n\n  res.status(200).json({ videos });\n}\n\nasync function searchVideos(req, res, next) {\n  if (!req.query.query) {\n    return next({\n      message: \"Please enter a search query\",\n      statusCode: 400,\n    });\n  }\n\n  let videos = await prisma.video.findMany({\n    include: {\n      user: true,\n    },\n    where: {\n      OR: [\n        {\n          title: {\n            contains: req.query.query,\n            mode: \"insensitive\",\n          },\n        },\n        {\n          description: {\n            contains: req.query.query,\n            mode: \"insensitive\",\n          },\n        },\n      ],\n    },\n  });\n\n  if (!videos.length) {\n    return res.status(200).json({ videos });\n  }\n\n  videos = await getVideoViews(videos);\n\n  res.status(200).json({ videos });\n}\n\nasync function addVideo(req, res) {\n  const { title, description, url, thumbnail } = req.body;\n\n  const video = await prisma.video.create({\n    data: {\n      title,\n      description,\n      url,\n      thumbnail,\n      user: {\n        connect: {\n          id: req.user.id,\n        },\n      },\n    },\n  });\n\n  res.status(200).json({ video });\n}\n\nasync function addComment(req, res, next) {\n  const video = await prisma.video.findUnique({\n    where: {\n      id: req.params.videoId,\n    },\n  });\n\n  if (!video) {\n    return next({\n      message: `No video found with id: \"${req.params.videoId}\"`,\n      statusCode: 404,\n    });\n  }\n\n  const comment = await prisma.comment.create({\n    data: {\n      text: req.body.text,\n      user: {\n        connect: {\n          id: req.user.id,\n        },\n      },\n      video: {\n        connect: {\n          id: req.params.videoId,\n        },\n      },\n    },\n  });\n\n  res.status(200).json({ comment });\n}\n\nasync function deleteComment(req, res) {\n  const comment = await prisma.comment.findUnique({\n    where: {\n      id: req.params.commentId,\n    },\n    select: {\n      userId: true,\n    },\n  });\n\n  if (comment.userId !== req.user.id) {\n    return res\n      .status(401)\n      .send(\"You are not authorized to delete this comment\");\n  }\n\n  await prisma.comment.delete({\n    where: {\n      id: req.params.commentId,\n    },\n  });\n\n  res.status(200).json({});\n}\n\nasync function addVideoView(req, res, next) {\n  const video = await prisma.video.findUnique({\n    where: {\n      id: req.params.videoId,\n    },\n  });\n\n  if (!video) {\n    return next({\n      message: `No video found with id: \"${req.params.videoId}\"`,\n      statusCode: 404,\n    });\n  }\n\n  if (req.user) {\n    await prisma.view.create({\n      data: {\n        video: {\n          connect: {\n            id: req.params.videoId,\n          },\n        },\n        user: {\n          connect: {\n            id: req.user.id,\n          },\n        },\n      },\n    });\n  } else {\n    await prisma.view.create({\n      data: {\n        video: {\n          connect: {\n            id: req.params.videoId,\n          },\n        },\n      },\n    });\n  }\n\n  res.status(200).json({});\n}\n\nasync function likeVideo(req, res, next) {\n  const video = await prisma.video.findUnique({\n    where: {\n      id: req.params.videoId,\n    },\n  });\n\n  if (!video) {\n    return next({\n      message: `No video found with id: \"${req.params.videoId}\"`,\n      statusCode: 404,\n    });\n  }\n\n  const isLiked = await prisma.videoLike.findFirst({\n    where: {\n      userId: {\n        equals: req.user.id,\n      },\n      videoId: {\n        equals: req.params.videoId,\n      },\n      like: {\n        equals: 1,\n      },\n    },\n  });\n\n  const isDisliked = await prisma.videoLike.findFirst({\n    where: {\n      userId: {\n        equals: req.user.id,\n      },\n      videoId: {\n        equals: req.params.videoId,\n      },\n      like: {\n        equals: -1,\n      },\n    },\n  });\n\n  if (isLiked) {\n    await prisma.videoLike.delete({\n      where: {\n        id: isLiked.id,\n      },\n    });\n  } else if (isDisliked) {\n    await prisma.videoLike.update({\n      where: {\n        id: isDisliked.id,\n      },\n      data: {\n        like: 1,\n      },\n    });\n  } else {\n    await prisma.videoLike.create({\n      data: {\n        user: {\n          connect: {\n            id: req.user.id,\n          },\n        },\n        video: {\n          connect: {\n            id: req.params.videoId,\n          },\n        },\n        like: 1,\n      },\n    });\n  }\n\n  res.status(200).json({});\n}\n\nasync function dislikeVideo(req, res, next) {\n  const video = await prisma.video.findUnique({\n    where: {\n      id: req.params.videoId,\n    },\n  });\n\n  if (!video) {\n    return next({\n      message: `No video found with id: \"${req.params.videoId}\"`,\n      statusCode: 404,\n    });\n  }\n\n  const isLiked = await prisma.videoLike.findFirst({\n    where: {\n      userId: {\n        equals: req.user.id,\n      },\n      videoId: {\n        equals: req.params.videoId,\n      },\n      like: {\n        equals: 1,\n      },\n    },\n  });\n\n  const isDisliked = await prisma.videoLike.findFirst({\n    where: {\n      userId: {\n        equals: req.user.id,\n      },\n      videoId: {\n        equals: req.params.videoId,\n      },\n      like: {\n        equals: -1,\n      },\n    },\n  });\n\n  if (isDisliked) {\n    await prisma.videoLike.delete({\n      where: {\n        id: isDisliked.id,\n      },\n    });\n  } else if (isLiked) {\n    await prisma.videoLike.update({\n      where: {\n        id: isLiked.id,\n      },\n      data: {\n        like: -1,\n      },\n    });\n  } else {\n    await prisma.videoLike.create({\n      data: {\n        user: {\n          connect: {\n            id: req.user.id,\n          },\n        },\n        video: {\n          connect: {\n            id: req.params.videoId,\n          },\n        },\n        like: -1,\n      },\n    });\n  }\n\n  res.status(200).json({});\n}\n\nasync function getVideo(req, res, next) {\n  const video = await prisma.video.findUnique({\n    where: {\n      id: req.params.videoId,\n    },\n    include: {\n      user: true,\n      comments: {\n        include: {\n          user: true,\n        },\n        orderBy: {\n          createdAt: \"desc\",\n        },\n      },\n    },\n  });\n\n  if (!video) {\n    return next({\n      message: `No video found with id: \"${req.params.videoId}\"`,\n      statusCode: 404,\n    });\n  }\n\n  let isVideoMine = false;\n  let isLiked = false;\n  let isDisliked = false;\n  let isSubscribed = false;\n  let isViewed = false;\n\n  if (req.user) {\n    isVideoMine = req.user.id === video.userId;\n\n    isLiked = await prisma.videoLike.findFirst({\n      where: {\n        userId: {\n          equals: req.user.id,\n        },\n        videoId: {\n          equals: req.params.videoId,\n        },\n        like: {\n          equals: 1,\n        },\n      },\n    });\n\n    isDisliked = await prisma.videoLike.findFirst({\n      where: {\n        userId: {\n          equals: req.user.id,\n        },\n        videoId: {\n          equals: req.params.videoId,\n        },\n        like: {\n          equals: -1,\n        },\n      },\n    });\n\n    isViewed = await prisma.view.findFirst({\n      where: {\n        userId: {\n          equals: req.user.id,\n        },\n        videoId: {\n          equals: video.id,\n        },\n      },\n    });\n\n    isSubscribed = await prisma.subscription.findFirst({\n      where: {\n        subscriberId: {\n          equals: req.user.id,\n        },\n        subscribedToId: {\n          equals: video.userId,\n        },\n      },\n    });\n  }\n\n  const likesCount = await prisma.videoLike.count({\n    where: {\n      AND: {\n        videoId: {\n          equals: req.params.videoId,\n        },\n        like: {\n          equals: 1,\n        },\n      },\n    },\n  });\n\n  const dislikesCount = await prisma.videoLike.count({\n    where: {\n      AND: {\n        videoId: {\n          equals: req.params.videoId,\n        },\n        like: {\n          equals: -1,\n        },\n      },\n    },\n  });\n\n  const views = await prisma.view.count({\n    where: {\n      videoId: {\n        equals: video.id,\n      },\n    },\n  });\n\n  const subscribersCount = await prisma.subscription.count({\n    where: {\n      subscribedToId: {\n        equals: video.userId,\n      },\n    },\n  });\n\n  video.commentsCount = video.comments.length;\n  video.isLiked = Boolean(isLiked);\n  video.isDisliked = Boolean(isDisliked);\n  video.likesCount = likesCount;\n  video.dislikesCount = dislikesCount;\n  video.isVideoMine = isVideoMine;\n  video.views = views;\n  video.isSubscribed = Boolean(isSubscribed);\n  video.isViewed = Boolean(isViewed);\n  video.subscribersCount = subscribersCount;\n\n  res.status(200).json({ video });\n}\n\nasync function deleteVideo(req, res) {\n  const video = await prisma.video.findUnique({\n    where: {\n      id: req.params.videoId,\n    },\n    select: {\n      userId: true,\n    },\n  });\n\n  if (req.user.id !== video.userId) {\n    return res.status(401).send(\"You are not authorized to delete this video\");\n  }\n\n  await prisma.view.deleteMany({\n    where: {\n      videoId: {\n        equals: req.params.videoId,\n      },\n    },\n  });\n\n  await prisma.videoLike.deleteMany({\n    where: {\n      videoId: {\n        equals: req.params.videoId,\n      },\n    },\n  });\n\n  await prisma.comment.deleteMany({\n    where: {\n      videoId: {\n        equals: req.params.videoId,\n      },\n    },\n  });\n\n  await prisma.video.delete({\n    where: {\n      id: req.params.videoId,\n    },\n  });\n\n  res.status(200).json({});\n}\n\nexport { getVideoRoutes };\n"
      ]
    },
    "sourceType": "script",
    "mtime": 1611420432000
  },
  "{\"sourceRoot\":\"/Users/egor/Dev/ytclone final/server/src/middleware/\",\"caller\":{\"name\":\"@babel/register\"},\"cwd\":\"/Users/egor/Dev/ytclone final\",\"filename\":\"/Users/egor/Dev/ytclone final/server/src/middleware/error.js\",\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"/Users/egor/Dev/ytclone final\",\"plugins\":[{\"key\":\"syntax-numeric-separator\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"proposal-logical-assignment-operators\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"AssignmentExpression\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-nullish-coalescing-operator\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-optional-chaining\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-json-strings\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-optional-catch-binding\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-async-generators\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-object-rest-spread\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"transform-modules-commonjs\",\"visitor\":{\"CallExpression\":{\"enter\":[null]},\"Program\":{\"exit\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"proposal-dynamic-import\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"Program\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"proposal-export-namespace-from\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"ExportNamedDeclaration\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}}],\"presets\":[]}:7.12.10": {
    "metadata": {},
    "options": {
      "sourceRoot": "/Users/egor/Dev/ytclone final/server/src/middleware/",
      "caller": {
        "name": "@babel/register"
      },
      "cwd": "/Users/egor/Dev/ytclone final",
      "filename": "/Users/egor/Dev/ytclone final/server/src/middleware/error.js",
      "cloneInputAst": true,
      "babelrc": false,
      "configFile": false,
      "envName": "development",
      "root": "/Users/egor/Dev/ytclone final",
      "sourceMaps": "both",
      "ast": false,
      "passPerPreset": false,
      "plugins": [
        {
          "key": "syntax-numeric-separator",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "proposal-logical-assignment-operators",
          "visitor": {
            "_exploded": {},
            "_verified": {},
            "AssignmentExpression": {
              "enter": [
                null
              ]
            }
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-nullish-coalescing-operator",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-optional-chaining",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-json-strings",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-optional-catch-binding",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-async-generators",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-object-rest-spread",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "transform-modules-commonjs",
          "visitor": {
            "CallExpression": {
              "enter": [
                null
              ]
            },
            "Program": {
              "exit": [
                null
              ]
            },
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "proposal-dynamic-import",
          "visitor": {
            "_exploded": {},
            "_verified": {},
            "Program": {
              "enter": [
                null
              ]
            }
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "proposal-export-namespace-from",
          "visitor": {
            "_exploded": {},
            "_verified": {},
            "ExportNamedDeclaration": {
              "enter": [
                null
              ]
            }
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        }
      ],
      "presets": [],
      "parserOpts": {
        "sourceType": "module",
        "sourceFileName": "/Users/egor/Dev/ytclone final/server/src/middleware/error.js",
        "plugins": [
          "numericSeparator",
          "logicalAssignment",
          "nullishCoalescingOperator",
          "optionalChaining",
          "jsonStrings",
          "optionalCatchBinding",
          "asyncGenerators",
          "objectRestSpread",
          "dynamicImport",
          "exportNamespaceFrom"
        ]
      },
      "generatorOpts": {
        "filename": "/Users/egor/Dev/ytclone final/server/src/middleware/error.js",
        "comments": true,
        "compact": "auto",
        "sourceMaps": "both",
        "sourceRoot": "/Users/egor/Dev/ytclone final/server/src/middleware/",
        "sourceFileName": "error.js"
      }
    },
    "ast": null,
    "code": "\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.errorMiddleware = errorMiddleware;\nexports.setupCloseOnExit = setupCloseOnExit;\n\nvar _loglevel = _interopRequireDefault(require(\"loglevel\"));\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n// Middleware that will help us catch generic express-related errors\nfunction errorMiddleware(error, req, res, next) {\n  if (res.headersSent) {\n    next(error);\n  } else {\n    _loglevel.default.error(error);\n\n    res.status(error.statusCode || 500);\n    res.json({\n      message: error.message,\n      ...(process.env.NODE_ENV === \"production\" ? null : {\n        stack: error.stack\n      })\n    });\n  }\n} // This closes the server in the event of an error so\n// that our requests do not hang\n\n\nfunction setupCloseOnExit(server) {\n  async function exitHandler(options = {}) {\n    await server.close().then(() => {\n      _loglevel.default.info(\"Server successfully closed\");\n    }).catch(error => {\n      _loglevel.default.warn(\"Something went wrong closing the server\", error.stack);\n    });\n    if (options.exit) process.exit();\n  } // Do something when app is closing\n\n\n  process.on(\"exit\", exitHandler); // Catches ctrl+c event\n\n  process.on(\"SIGINT\", exitHandler.bind(null, {\n    exit: true\n  })); // Catches \"kill pid\" (for example: nodemon restart)\n\n  process.on(\"SIGUSR1\", exitHandler.bind(null, {\n    exit: true\n  }));\n  process.on(\"SIGUSR2\", exitHandler.bind(null, {\n    exit: true\n  })); // Catches uncaught exceptions\n\n  process.on(\"uncaughtException\", exitHandler.bind(null, {\n    exit: true\n  }));\n}\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImVycm9yLmpzIl0sIm5hbWVzIjpbImVycm9yTWlkZGxld2FyZSIsImVycm9yIiwicmVxIiwicmVzIiwibmV4dCIsImhlYWRlcnNTZW50IiwibG9nZ2VyIiwic3RhdHVzIiwic3RhdHVzQ29kZSIsImpzb24iLCJtZXNzYWdlIiwicHJvY2VzcyIsImVudiIsIk5PREVfRU5WIiwic3RhY2siLCJzZXR1cENsb3NlT25FeGl0Iiwic2VydmVyIiwiZXhpdEhhbmRsZXIiLCJvcHRpb25zIiwiY2xvc2UiLCJ0aGVuIiwiaW5mbyIsImNhdGNoIiwid2FybiIsImV4aXQiLCJvbiIsImJpbmQiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBQUE7Ozs7QUFFQTtBQUNBLFNBQVNBLGVBQVQsQ0FBeUJDLEtBQXpCLEVBQWdDQyxHQUFoQyxFQUFxQ0MsR0FBckMsRUFBMENDLElBQTFDLEVBQWdEO0FBQzlDLE1BQUlELEdBQUcsQ0FBQ0UsV0FBUixFQUFxQjtBQUNuQkQsSUFBQUEsSUFBSSxDQUFDSCxLQUFELENBQUo7QUFDRCxHQUZELE1BRU87QUFDTEssc0JBQU9MLEtBQVAsQ0FBYUEsS0FBYjs7QUFDQUUsSUFBQUEsR0FBRyxDQUFDSSxNQUFKLENBQVdOLEtBQUssQ0FBQ08sVUFBTixJQUFvQixHQUEvQjtBQUNBTCxJQUFBQSxHQUFHLENBQUNNLElBQUosQ0FBUztBQUNQQyxNQUFBQSxPQUFPLEVBQUVULEtBQUssQ0FBQ1MsT0FEUjtBQUVQLFVBQUlDLE9BQU8sQ0FBQ0MsR0FBUixDQUFZQyxRQUFaLEtBQXlCLFlBQXpCLEdBQ0EsSUFEQSxHQUVBO0FBQUVDLFFBQUFBLEtBQUssRUFBRWIsS0FBSyxDQUFDYTtBQUFmLE9BRko7QUFGTyxLQUFUO0FBTUQ7QUFDRixDLENBRUQ7QUFDQTs7O0FBQ0EsU0FBU0MsZ0JBQVQsQ0FBMEJDLE1BQTFCLEVBQWtDO0FBQ2hDLGlCQUFlQyxXQUFmLENBQTJCQyxPQUFPLEdBQUcsRUFBckMsRUFBeUM7QUFDdkMsVUFBTUYsTUFBTSxDQUNURyxLQURHLEdBRUhDLElBRkcsQ0FFRSxNQUFNO0FBQ1ZkLHdCQUFPZSxJQUFQLENBQVksNEJBQVo7QUFDRCxLQUpHLEVBS0hDLEtBTEcsQ0FLSXJCLEtBQUQsSUFBVztBQUNoQkssd0JBQU9pQixJQUFQLENBQVkseUNBQVosRUFBdUR0QixLQUFLLENBQUNhLEtBQTdEO0FBQ0QsS0FQRyxDQUFOO0FBUUEsUUFBSUksT0FBTyxDQUFDTSxJQUFaLEVBQWtCYixPQUFPLENBQUNhLElBQVI7QUFDbkIsR0FYK0IsQ0FZaEM7OztBQUNBYixFQUFBQSxPQUFPLENBQUNjLEVBQVIsQ0FBVyxNQUFYLEVBQW1CUixXQUFuQixFQWJnQyxDQWNoQzs7QUFDQU4sRUFBQUEsT0FBTyxDQUFDYyxFQUFSLENBQVcsUUFBWCxFQUFxQlIsV0FBVyxDQUFDUyxJQUFaLENBQWlCLElBQWpCLEVBQXVCO0FBQUVGLElBQUFBLElBQUksRUFBRTtBQUFSLEdBQXZCLENBQXJCLEVBZmdDLENBZ0JoQzs7QUFDQWIsRUFBQUEsT0FBTyxDQUFDYyxFQUFSLENBQVcsU0FBWCxFQUFzQlIsV0FBVyxDQUFDUyxJQUFaLENBQWlCLElBQWpCLEVBQXVCO0FBQUVGLElBQUFBLElBQUksRUFBRTtBQUFSLEdBQXZCLENBQXRCO0FBQ0FiLEVBQUFBLE9BQU8sQ0FBQ2MsRUFBUixDQUFXLFNBQVgsRUFBc0JSLFdBQVcsQ0FBQ1MsSUFBWixDQUFpQixJQUFqQixFQUF1QjtBQUFFRixJQUFBQSxJQUFJLEVBQUU7QUFBUixHQUF2QixDQUF0QixFQWxCZ0MsQ0FtQmhDOztBQUNBYixFQUFBQSxPQUFPLENBQUNjLEVBQVIsQ0FBVyxtQkFBWCxFQUFnQ1IsV0FBVyxDQUFDUyxJQUFaLENBQWlCLElBQWpCLEVBQXVCO0FBQUVGLElBQUFBLElBQUksRUFBRTtBQUFSLEdBQXZCLENBQWhDO0FBQ0QiLCJzb3VyY2VSb290IjoiL1VzZXJzL2Vnb3IvRGV2L3l0Y2xvbmUgZmluYWwvc2VydmVyL3NyYy9taWRkbGV3YXJlLyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBsb2dnZXIgZnJvbSBcImxvZ2xldmVsXCI7XG5cbi8vIE1pZGRsZXdhcmUgdGhhdCB3aWxsIGhlbHAgdXMgY2F0Y2ggZ2VuZXJpYyBleHByZXNzLXJlbGF0ZWQgZXJyb3JzXG5mdW5jdGlvbiBlcnJvck1pZGRsZXdhcmUoZXJyb3IsIHJlcSwgcmVzLCBuZXh0KSB7XG4gIGlmIChyZXMuaGVhZGVyc1NlbnQpIHtcbiAgICBuZXh0KGVycm9yKTtcbiAgfSBlbHNlIHtcbiAgICBsb2dnZXIuZXJyb3IoZXJyb3IpO1xuICAgIHJlcy5zdGF0dXMoZXJyb3Iuc3RhdHVzQ29kZSB8fCA1MDApO1xuICAgIHJlcy5qc29uKHtcbiAgICAgIG1lc3NhZ2U6IGVycm9yLm1lc3NhZ2UsXG4gICAgICAuLi4ocHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09IFwicHJvZHVjdGlvblwiXG4gICAgICAgID8gbnVsbFxuICAgICAgICA6IHsgc3RhY2s6IGVycm9yLnN0YWNrIH0pLFxuICAgIH0pO1xuICB9XG59XG5cbi8vIFRoaXMgY2xvc2VzIHRoZSBzZXJ2ZXIgaW4gdGhlIGV2ZW50IG9mIGFuIGVycm9yIHNvXG4vLyB0aGF0IG91ciByZXF1ZXN0cyBkbyBub3QgaGFuZ1xuZnVuY3Rpb24gc2V0dXBDbG9zZU9uRXhpdChzZXJ2ZXIpIHtcbiAgYXN5bmMgZnVuY3Rpb24gZXhpdEhhbmRsZXIob3B0aW9ucyA9IHt9KSB7XG4gICAgYXdhaXQgc2VydmVyXG4gICAgICAuY2xvc2UoKVxuICAgICAgLnRoZW4oKCkgPT4ge1xuICAgICAgICBsb2dnZXIuaW5mbyhcIlNlcnZlciBzdWNjZXNzZnVsbHkgY2xvc2VkXCIpO1xuICAgICAgfSlcbiAgICAgIC5jYXRjaCgoZXJyb3IpID0+IHtcbiAgICAgICAgbG9nZ2VyLndhcm4oXCJTb21ldGhpbmcgd2VudCB3cm9uZyBjbG9zaW5nIHRoZSBzZXJ2ZXJcIiwgZXJyb3Iuc3RhY2spO1xuICAgICAgfSk7XG4gICAgaWYgKG9wdGlvbnMuZXhpdCkgcHJvY2Vzcy5leGl0KCk7XG4gIH1cbiAgLy8gRG8gc29tZXRoaW5nIHdoZW4gYXBwIGlzIGNsb3NpbmdcbiAgcHJvY2Vzcy5vbihcImV4aXRcIiwgZXhpdEhhbmRsZXIpO1xuICAvLyBDYXRjaGVzIGN0cmwrYyBldmVudFxuICBwcm9jZXNzLm9uKFwiU0lHSU5UXCIsIGV4aXRIYW5kbGVyLmJpbmQobnVsbCwgeyBleGl0OiB0cnVlIH0pKTtcbiAgLy8gQ2F0Y2hlcyBcImtpbGwgcGlkXCIgKGZvciBleGFtcGxlOiBub2RlbW9uIHJlc3RhcnQpXG4gIHByb2Nlc3Mub24oXCJTSUdVU1IxXCIsIGV4aXRIYW5kbGVyLmJpbmQobnVsbCwgeyBleGl0OiB0cnVlIH0pKTtcbiAgcHJvY2Vzcy5vbihcIlNJR1VTUjJcIiwgZXhpdEhhbmRsZXIuYmluZChudWxsLCB7IGV4aXQ6IHRydWUgfSkpO1xuICAvLyBDYXRjaGVzIHVuY2F1Z2h0IGV4Y2VwdGlvbnNcbiAgcHJvY2Vzcy5vbihcInVuY2F1Z2h0RXhjZXB0aW9uXCIsIGV4aXRIYW5kbGVyLmJpbmQobnVsbCwgeyBleGl0OiB0cnVlIH0pKTtcbn1cblxuZXhwb3J0IHsgZXJyb3JNaWRkbGV3YXJlLCBzZXR1cENsb3NlT25FeGl0IH07XG4iXX0=",
    "map": {
      "version": 3,
      "sources": [
        "error.js"
      ],
      "names": [
        "errorMiddleware",
        "error",
        "req",
        "res",
        "next",
        "headersSent",
        "logger",
        "status",
        "statusCode",
        "json",
        "message",
        "process",
        "env",
        "NODE_ENV",
        "stack",
        "setupCloseOnExit",
        "server",
        "exitHandler",
        "options",
        "close",
        "then",
        "info",
        "catch",
        "warn",
        "exit",
        "on",
        "bind"
      ],
      "mappings": ";;;;;;;;AAAA;;;;AAEA;AACA,SAASA,eAAT,CAAyBC,KAAzB,EAAgCC,GAAhC,EAAqCC,GAArC,EAA0CC,IAA1C,EAAgD;AAC9C,MAAID,GAAG,CAACE,WAAR,EAAqB;AACnBD,IAAAA,IAAI,CAACH,KAAD,CAAJ;AACD,GAFD,MAEO;AACLK,sBAAOL,KAAP,CAAaA,KAAb;;AACAE,IAAAA,GAAG,CAACI,MAAJ,CAAWN,KAAK,CAACO,UAAN,IAAoB,GAA/B;AACAL,IAAAA,GAAG,CAACM,IAAJ,CAAS;AACPC,MAAAA,OAAO,EAAET,KAAK,CAACS,OADR;AAEP,UAAIC,OAAO,CAACC,GAAR,CAAYC,QAAZ,KAAyB,YAAzB,GACA,IADA,GAEA;AAAEC,QAAAA,KAAK,EAAEb,KAAK,CAACa;AAAf,OAFJ;AAFO,KAAT;AAMD;AACF,C,CAED;AACA;;;AACA,SAASC,gBAAT,CAA0BC,MAA1B,EAAkC;AAChC,iBAAeC,WAAf,CAA2BC,OAAO,GAAG,EAArC,EAAyC;AACvC,UAAMF,MAAM,CACTG,KADG,GAEHC,IAFG,CAEE,MAAM;AACVd,wBAAOe,IAAP,CAAY,4BAAZ;AACD,KAJG,EAKHC,KALG,CAKIrB,KAAD,IAAW;AAChBK,wBAAOiB,IAAP,CAAY,yCAAZ,EAAuDtB,KAAK,CAACa,KAA7D;AACD,KAPG,CAAN;AAQA,QAAII,OAAO,CAACM,IAAZ,EAAkBb,OAAO,CAACa,IAAR;AACnB,GAX+B,CAYhC;;;AACAb,EAAAA,OAAO,CAACc,EAAR,CAAW,MAAX,EAAmBR,WAAnB,EAbgC,CAchC;;AACAN,EAAAA,OAAO,CAACc,EAAR,CAAW,QAAX,EAAqBR,WAAW,CAACS,IAAZ,CAAiB,IAAjB,EAAuB;AAAEF,IAAAA,IAAI,EAAE;AAAR,GAAvB,CAArB,EAfgC,CAgBhC;;AACAb,EAAAA,OAAO,CAACc,EAAR,CAAW,SAAX,EAAsBR,WAAW,CAACS,IAAZ,CAAiB,IAAjB,EAAuB;AAAEF,IAAAA,IAAI,EAAE;AAAR,GAAvB,CAAtB;AACAb,EAAAA,OAAO,CAACc,EAAR,CAAW,SAAX,EAAsBR,WAAW,CAACS,IAAZ,CAAiB,IAAjB,EAAuB;AAAEF,IAAAA,IAAI,EAAE;AAAR,GAAvB,CAAtB,EAlBgC,CAmBhC;;AACAb,EAAAA,OAAO,CAACc,EAAR,CAAW,mBAAX,EAAgCR,WAAW,CAACS,IAAZ,CAAiB,IAAjB,EAAuB;AAAEF,IAAAA,IAAI,EAAE;AAAR,GAAvB,CAAhC;AACD",
      "sourceRoot": "/Users/egor/Dev/ytclone final/server/src/middleware/",
      "sourcesContent": [
        "import logger from \"loglevel\";\n\n// Middleware that will help us catch generic express-related errors\nfunction errorMiddleware(error, req, res, next) {\n  if (res.headersSent) {\n    next(error);\n  } else {\n    logger.error(error);\n    res.status(error.statusCode || 500);\n    res.json({\n      message: error.message,\n      ...(process.env.NODE_ENV === \"production\"\n        ? null\n        : { stack: error.stack }),\n    });\n  }\n}\n\n// This closes the server in the event of an error so\n// that our requests do not hang\nfunction setupCloseOnExit(server) {\n  async function exitHandler(options = {}) {\n    await server\n      .close()\n      .then(() => {\n        logger.info(\"Server successfully closed\");\n      })\n      .catch((error) => {\n        logger.warn(\"Something went wrong closing the server\", error.stack);\n      });\n    if (options.exit) process.exit();\n  }\n  // Do something when app is closing\n  process.on(\"exit\", exitHandler);\n  // Catches ctrl+c event\n  process.on(\"SIGINT\", exitHandler.bind(null, { exit: true }));\n  // Catches \"kill pid\" (for example: nodemon restart)\n  process.on(\"SIGUSR1\", exitHandler.bind(null, { exit: true }));\n  process.on(\"SIGUSR2\", exitHandler.bind(null, { exit: true }));\n  // Catches uncaught exceptions\n  process.on(\"uncaughtException\", exitHandler.bind(null, { exit: true }));\n}\n\nexport { errorMiddleware, setupCloseOnExit };\n"
      ]
    },
    "sourceType": "script",
    "mtime": 1611368296000
  },
  "{\"sourceRoot\":\"/Users/egor/Dev/ytclone final/server/src/\",\"caller\":{\"name\":\"@babel/register\"},\"cwd\":\"/Users/egor/Dev/ytclone final\",\"filename\":\"/Users/egor/Dev/ytclone final/server/src/start.js\",\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"/Users/egor/Dev/ytclone final\",\"plugins\":[{\"key\":\"syntax-numeric-separator\",\"visitor\":{},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"proposal-logical-assignment-operators\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"AssignmentExpression\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-nullish-coalescing-operator\",\"visitor\":{},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-optional-chaining\",\"visitor\":{},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-json-strings\",\"visitor\":{},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-optional-catch-binding\",\"visitor\":{},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-async-generators\",\"visitor\":{},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-object-rest-spread\",\"visitor\":{},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"transform-modules-commonjs\",\"visitor\":{\"CallExpression\":{\"enter\":[null]},\"Program\":{\"exit\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"proposal-dynamic-import\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"Program\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"proposal-export-namespace-from\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"ExportNamedDeclaration\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}}],\"presets\":[]}:7.12.10": {
    "metadata": {},
    "options": {
      "sourceRoot": "/Users/egor/Dev/ytclone final/server/src/",
      "caller": {
        "name": "@babel/register"
      },
      "cwd": "/Users/egor/Dev/ytclone final",
      "filename": "/Users/egor/Dev/ytclone final/server/src/start.js",
      "cloneInputAst": true,
      "babelrc": false,
      "configFile": false,
      "envName": "development",
      "root": "/Users/egor/Dev/ytclone final",
      "sourceMaps": "both",
      "ast": false,
      "passPerPreset": false,
      "plugins": [
        {
          "key": "syntax-numeric-separator",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "proposal-logical-assignment-operators",
          "visitor": {
            "_exploded": {},
            "_verified": {},
            "AssignmentExpression": {
              "enter": [
                null
              ]
            }
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-nullish-coalescing-operator",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-optional-chaining",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-json-strings",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-optional-catch-binding",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-async-generators",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-object-rest-spread",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "transform-modules-commonjs",
          "visitor": {
            "CallExpression": {
              "enter": [
                null
              ]
            },
            "Program": {
              "exit": [
                null
              ]
            },
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "proposal-dynamic-import",
          "visitor": {
            "_exploded": {},
            "_verified": {},
            "Program": {
              "enter": [
                null
              ]
            }
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "proposal-export-namespace-from",
          "visitor": {
            "_exploded": {},
            "_verified": {},
            "ExportNamedDeclaration": {
              "enter": [
                null
              ]
            }
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        }
      ],
      "presets": [],
      "parserOpts": {
        "sourceType": "module",
        "sourceFileName": "/Users/egor/Dev/ytclone final/server/src/start.js",
        "plugins": [
          "numericSeparator",
          "logicalAssignment",
          "nullishCoalescingOperator",
          "optionalChaining",
          "jsonStrings",
          "optionalCatchBinding",
          "asyncGenerators",
          "objectRestSpread",
          "dynamicImport",
          "exportNamespaceFrom"
        ]
      },
      "generatorOpts": {
        "filename": "/Users/egor/Dev/ytclone final/server/src/start.js",
        "comments": true,
        "compact": "auto",
        "sourceMaps": "both",
        "sourceRoot": "/Users/egor/Dev/ytclone final/server/src/",
        "sourceFileName": "start.js"
      }
    },
    "ast": null,
    "code": "\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.startServer = startServer;\n\nvar _express = _interopRequireDefault(require(\"express\"));\n\nrequire(\"express-async-errors\");\n\nvar _path = _interopRequireDefault(require(\"path\"));\n\nvar _cors = _interopRequireDefault(require(\"cors\"));\n\nvar _loglevel = _interopRequireDefault(require(\"loglevel\"));\n\nvar _morgan = _interopRequireDefault(require(\"morgan\"));\n\nvar _dotenv = _interopRequireDefault(require(\"dotenv\"));\n\nvar _cookieParser = _interopRequireDefault(require(\"cookie-parser\"));\n\nvar _routes = require(\"./routes\");\n\nvar _error = require(\"./middleware/error\");\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n// Import this module to handle errors when using async functions for our route handlers\n_dotenv.default.config();\n\nfunction startServer({\n  port = process.env.PORT\n} = {}) {\n  const app = (0, _express.default)();\n  app.use((0, _morgan.default)(\"dev\"));\n  app.use((0, _cors.default)());\n  app.use((0, _cookieParser.default)());\n  app.use(_express.default.json()); // all API routes are prefixed with /api/v1\n\n  app.use(\"/api/v1\", (0, _routes.getRoutes)()); // Generic error handler if errors are missed by 'express-async-errors' middleware\n\n  app.use(_error.errorMiddleware); // When our project is pushed to production, we will serve // the react app using express.static() middleware\n\n  if (process.env.NODE_ENV === \"production\") {\n    app.use(_express.default.static(_path.default.resolve(__dirname, \"../client/build\"))); // Any request not caught by our API will be routed\n    // to our built react app\n\n    app.get(\"*\", function (req, res) {\n      res.sendFile(_path.default.resolve(__dirname, \"../client/build\", \"index.html\"));\n    });\n  } // This block of code is made to reliably start and close our express app\n  // It is written as a promise, which can be more easily tested\n\n\n  return new Promise(resolve => {\n    const server = app.listen(port, () => {\n      _loglevel.default.info(`Listening on port ${server.address().port}`);\n\n      const originalClose = server.close.bind(server);\n\n      server.close = () => {\n        return new Promise(resolveClose => {\n          originalClose(resolveClose);\n        });\n      }; // This function properly closes the server when the program exits\n\n\n      (0, _error.setupCloseOnExit)(server);\n      resolve(server);\n    });\n  });\n}\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInN0YXJ0LmpzIl0sIm5hbWVzIjpbImRvdGVudiIsImNvbmZpZyIsInN0YXJ0U2VydmVyIiwicG9ydCIsInByb2Nlc3MiLCJlbnYiLCJQT1JUIiwiYXBwIiwidXNlIiwiZXhwcmVzcyIsImpzb24iLCJlcnJvck1pZGRsZXdhcmUiLCJOT0RFX0VOViIsInN0YXRpYyIsInBhdGgiLCJyZXNvbHZlIiwiX19kaXJuYW1lIiwiZ2V0IiwicmVxIiwicmVzIiwic2VuZEZpbGUiLCJQcm9taXNlIiwic2VydmVyIiwibGlzdGVuIiwibG9nZ2VyIiwiaW5mbyIsImFkZHJlc3MiLCJvcmlnaW5hbENsb3NlIiwiY2xvc2UiLCJiaW5kIiwicmVzb2x2ZUNsb3NlIl0sIm1hcHBpbmdzIjoiOzs7Ozs7O0FBQUE7O0FBRUE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBRUE7O0FBQ0E7Ozs7QUFWQTtBQVlBQSxnQkFBT0MsTUFBUDs7QUFFQSxTQUFTQyxXQUFULENBQXFCO0FBQUVDLEVBQUFBLElBQUksR0FBR0MsT0FBTyxDQUFDQyxHQUFSLENBQVlDO0FBQXJCLElBQThCLEVBQW5ELEVBQXVEO0FBQ3JELFFBQU1DLEdBQUcsR0FBRyx1QkFBWjtBQUNBQSxFQUFBQSxHQUFHLENBQUNDLEdBQUosQ0FBUSxxQkFBTyxLQUFQLENBQVI7QUFDQUQsRUFBQUEsR0FBRyxDQUFDQyxHQUFKLENBQVEsb0JBQVI7QUFDQUQsRUFBQUEsR0FBRyxDQUFDQyxHQUFKLENBQVEsNEJBQVI7QUFDQUQsRUFBQUEsR0FBRyxDQUFDQyxHQUFKLENBQVFDLGlCQUFRQyxJQUFSLEVBQVIsRUFMcUQsQ0FNckQ7O0FBQ0FILEVBQUFBLEdBQUcsQ0FBQ0MsR0FBSixDQUFRLFNBQVIsRUFBbUIsd0JBQW5CLEVBUHFELENBU3JEOztBQUNBRCxFQUFBQSxHQUFHLENBQUNDLEdBQUosQ0FBUUcsc0JBQVIsRUFWcUQsQ0FZckQ7O0FBQ0EsTUFBSVAsT0FBTyxDQUFDQyxHQUFSLENBQVlPLFFBQVosS0FBeUIsWUFBN0IsRUFBMkM7QUFDekNMLElBQUFBLEdBQUcsQ0FBQ0MsR0FBSixDQUFRQyxpQkFBUUksTUFBUixDQUFlQyxjQUFLQyxPQUFMLENBQWFDLFNBQWIsRUFBd0IsaUJBQXhCLENBQWYsQ0FBUixFQUR5QyxDQUd6QztBQUNBOztBQUNBVCxJQUFBQSxHQUFHLENBQUNVLEdBQUosQ0FBUSxHQUFSLEVBQWEsVUFBVUMsR0FBVixFQUFlQyxHQUFmLEVBQW9CO0FBQy9CQSxNQUFBQSxHQUFHLENBQUNDLFFBQUosQ0FBYU4sY0FBS0MsT0FBTCxDQUFhQyxTQUFiLEVBQXdCLGlCQUF4QixFQUEyQyxZQUEzQyxDQUFiO0FBQ0QsS0FGRDtBQUdELEdBckJvRCxDQXVCckQ7QUFDQTs7O0FBQ0EsU0FBTyxJQUFJSyxPQUFKLENBQWFOLE9BQUQsSUFBYTtBQUM5QixVQUFNTyxNQUFNLEdBQUdmLEdBQUcsQ0FBQ2dCLE1BQUosQ0FBV3BCLElBQVgsRUFBaUIsTUFBTTtBQUNwQ3FCLHdCQUFPQyxJQUFQLENBQWEscUJBQW9CSCxNQUFNLENBQUNJLE9BQVAsR0FBaUJ2QixJQUFLLEVBQXZEOztBQUVBLFlBQU13QixhQUFhLEdBQUdMLE1BQU0sQ0FBQ00sS0FBUCxDQUFhQyxJQUFiLENBQWtCUCxNQUFsQixDQUF0Qjs7QUFDQUEsTUFBQUEsTUFBTSxDQUFDTSxLQUFQLEdBQWUsTUFBTTtBQUNuQixlQUFPLElBQUlQLE9BQUosQ0FBYVMsWUFBRCxJQUFrQjtBQUNuQ0gsVUFBQUEsYUFBYSxDQUFDRyxZQUFELENBQWI7QUFDRCxTQUZNLENBQVA7QUFHRCxPQUpELENBSm9DLENBU3BDOzs7QUFDQSxtQ0FBaUJSLE1BQWpCO0FBQ0FQLE1BQUFBLE9BQU8sQ0FBQ08sTUFBRCxDQUFQO0FBQ0QsS0FaYyxDQUFmO0FBYUQsR0FkTSxDQUFQO0FBZUQiLCJzb3VyY2VSb290IjoiL1VzZXJzL2Vnb3IvRGV2L3l0Y2xvbmUgZmluYWwvc2VydmVyL3NyYy8iLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgZXhwcmVzcyBmcm9tIFwiZXhwcmVzc1wiO1xuLy8gSW1wb3J0IHRoaXMgbW9kdWxlIHRvIGhhbmRsZSBlcnJvcnMgd2hlbiB1c2luZyBhc3luYyBmdW5jdGlvbnMgZm9yIG91ciByb3V0ZSBoYW5kbGVyc1xuaW1wb3J0IFwiZXhwcmVzcy1hc3luYy1lcnJvcnNcIjtcbmltcG9ydCBwYXRoIGZyb20gXCJwYXRoXCI7XG5pbXBvcnQgY29ycyBmcm9tIFwiY29yc1wiO1xuaW1wb3J0IGxvZ2dlciBmcm9tIFwibG9nbGV2ZWxcIjtcbmltcG9ydCBtb3JnYW4gZnJvbSBcIm1vcmdhblwiO1xuaW1wb3J0IGRvdGVudiBmcm9tIFwiZG90ZW52XCI7XG5pbXBvcnQgY29va2llUGFyc2VyIGZyb20gXCJjb29raWUtcGFyc2VyXCI7XG5cbmltcG9ydCB7IGdldFJvdXRlcyB9IGZyb20gXCIuL3JvdXRlc1wiO1xuaW1wb3J0IHsgZXJyb3JNaWRkbGV3YXJlLCBzZXR1cENsb3NlT25FeGl0IH0gZnJvbSBcIi4vbWlkZGxld2FyZS9lcnJvclwiO1xuXG5kb3RlbnYuY29uZmlnKCk7XG5cbmZ1bmN0aW9uIHN0YXJ0U2VydmVyKHsgcG9ydCA9IHByb2Nlc3MuZW52LlBPUlQgfSA9IHt9KSB7XG4gIGNvbnN0IGFwcCA9IGV4cHJlc3MoKTtcbiAgYXBwLnVzZShtb3JnYW4oXCJkZXZcIikpO1xuICBhcHAudXNlKGNvcnMoKSk7XG4gIGFwcC51c2UoY29va2llUGFyc2VyKCkpO1xuICBhcHAudXNlKGV4cHJlc3MuanNvbigpKTtcbiAgLy8gYWxsIEFQSSByb3V0ZXMgYXJlIHByZWZpeGVkIHdpdGggL2FwaS92MVxuICBhcHAudXNlKFwiL2FwaS92MVwiLCBnZXRSb3V0ZXMoKSk7XG5cbiAgLy8gR2VuZXJpYyBlcnJvciBoYW5kbGVyIGlmIGVycm9ycyBhcmUgbWlzc2VkIGJ5ICdleHByZXNzLWFzeW5jLWVycm9ycycgbWlkZGxld2FyZVxuICBhcHAudXNlKGVycm9yTWlkZGxld2FyZSk7XG5cbiAgLy8gV2hlbiBvdXIgcHJvamVjdCBpcyBwdXNoZWQgdG8gcHJvZHVjdGlvbiwgd2Ugd2lsbCBzZXJ2ZSAvLyB0aGUgcmVhY3QgYXBwIHVzaW5nIGV4cHJlc3Muc3RhdGljKCkgbWlkZGxld2FyZVxuICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09IFwicHJvZHVjdGlvblwiKSB7XG4gICAgYXBwLnVzZShleHByZXNzLnN0YXRpYyhwYXRoLnJlc29sdmUoX19kaXJuYW1lLCBcIi4uL2NsaWVudC9idWlsZFwiKSkpO1xuXG4gICAgLy8gQW55IHJlcXVlc3Qgbm90IGNhdWdodCBieSBvdXIgQVBJIHdpbGwgYmUgcm91dGVkXG4gICAgLy8gdG8gb3VyIGJ1aWx0IHJlYWN0IGFwcFxuICAgIGFwcC5nZXQoXCIqXCIsIGZ1bmN0aW9uIChyZXEsIHJlcykge1xuICAgICAgcmVzLnNlbmRGaWxlKHBhdGgucmVzb2x2ZShfX2Rpcm5hbWUsIFwiLi4vY2xpZW50L2J1aWxkXCIsIFwiaW5kZXguaHRtbFwiKSk7XG4gICAgfSk7XG4gIH1cblxuICAvLyBUaGlzIGJsb2NrIG9mIGNvZGUgaXMgbWFkZSB0byByZWxpYWJseSBzdGFydCBhbmQgY2xvc2Ugb3VyIGV4cHJlc3MgYXBwXG4gIC8vIEl0IGlzIHdyaXR0ZW4gYXMgYSBwcm9taXNlLCB3aGljaCBjYW4gYmUgbW9yZSBlYXNpbHkgdGVzdGVkXG4gIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4ge1xuICAgIGNvbnN0IHNlcnZlciA9IGFwcC5saXN0ZW4ocG9ydCwgKCkgPT4ge1xuICAgICAgbG9nZ2VyLmluZm8oYExpc3RlbmluZyBvbiBwb3J0ICR7c2VydmVyLmFkZHJlc3MoKS5wb3J0fWApO1xuXG4gICAgICBjb25zdCBvcmlnaW5hbENsb3NlID0gc2VydmVyLmNsb3NlLmJpbmQoc2VydmVyKTtcbiAgICAgIHNlcnZlci5jbG9zZSA9ICgpID0+IHtcbiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlQ2xvc2UpID0+IHtcbiAgICAgICAgICBvcmlnaW5hbENsb3NlKHJlc29sdmVDbG9zZSk7XG4gICAgICAgIH0pO1xuICAgICAgfTtcbiAgICAgIC8vIFRoaXMgZnVuY3Rpb24gcHJvcGVybHkgY2xvc2VzIHRoZSBzZXJ2ZXIgd2hlbiB0aGUgcHJvZ3JhbSBleGl0c1xuICAgICAgc2V0dXBDbG9zZU9uRXhpdChzZXJ2ZXIpO1xuICAgICAgcmVzb2x2ZShzZXJ2ZXIpO1xuICAgIH0pO1xuICB9KTtcbn1cblxuZXhwb3J0IHsgc3RhcnRTZXJ2ZXIgfTtcbiJdfQ==",
    "map": {
      "version": 3,
      "sources": [
        "start.js"
      ],
      "names": [
        "dotenv",
        "config",
        "startServer",
        "port",
        "process",
        "env",
        "PORT",
        "app",
        "use",
        "express",
        "json",
        "errorMiddleware",
        "NODE_ENV",
        "static",
        "path",
        "resolve",
        "__dirname",
        "get",
        "req",
        "res",
        "sendFile",
        "Promise",
        "server",
        "listen",
        "logger",
        "info",
        "address",
        "originalClose",
        "close",
        "bind",
        "resolveClose"
      ],
      "mappings": ";;;;;;;AAAA;;AAEA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AAEA;;AACA;;;;AAVA;AAYAA,gBAAOC,MAAP;;AAEA,SAASC,WAAT,CAAqB;AAAEC,EAAAA,IAAI,GAAGC,OAAO,CAACC,GAAR,CAAYC;AAArB,IAA8B,EAAnD,EAAuD;AACrD,QAAMC,GAAG,GAAG,uBAAZ;AACAA,EAAAA,GAAG,CAACC,GAAJ,CAAQ,qBAAO,KAAP,CAAR;AACAD,EAAAA,GAAG,CAACC,GAAJ,CAAQ,oBAAR;AACAD,EAAAA,GAAG,CAACC,GAAJ,CAAQ,4BAAR;AACAD,EAAAA,GAAG,CAACC,GAAJ,CAAQC,iBAAQC,IAAR,EAAR,EALqD,CAMrD;;AACAH,EAAAA,GAAG,CAACC,GAAJ,CAAQ,SAAR,EAAmB,wBAAnB,EAPqD,CASrD;;AACAD,EAAAA,GAAG,CAACC,GAAJ,CAAQG,sBAAR,EAVqD,CAYrD;;AACA,MAAIP,OAAO,CAACC,GAAR,CAAYO,QAAZ,KAAyB,YAA7B,EAA2C;AACzCL,IAAAA,GAAG,CAACC,GAAJ,CAAQC,iBAAQI,MAAR,CAAeC,cAAKC,OAAL,CAAaC,SAAb,EAAwB,iBAAxB,CAAf,CAAR,EADyC,CAGzC;AACA;;AACAT,IAAAA,GAAG,CAACU,GAAJ,CAAQ,GAAR,EAAa,UAAUC,GAAV,EAAeC,GAAf,EAAoB;AAC/BA,MAAAA,GAAG,CAACC,QAAJ,CAAaN,cAAKC,OAAL,CAAaC,SAAb,EAAwB,iBAAxB,EAA2C,YAA3C,CAAb;AACD,KAFD;AAGD,GArBoD,CAuBrD;AACA;;;AACA,SAAO,IAAIK,OAAJ,CAAaN,OAAD,IAAa;AAC9B,UAAMO,MAAM,GAAGf,GAAG,CAACgB,MAAJ,CAAWpB,IAAX,EAAiB,MAAM;AACpCqB,wBAAOC,IAAP,CAAa,qBAAoBH,MAAM,CAACI,OAAP,GAAiBvB,IAAK,EAAvD;;AAEA,YAAMwB,aAAa,GAAGL,MAAM,CAACM,KAAP,CAAaC,IAAb,CAAkBP,MAAlB,CAAtB;;AACAA,MAAAA,MAAM,CAACM,KAAP,GAAe,MAAM;AACnB,eAAO,IAAIP,OAAJ,CAAaS,YAAD,IAAkB;AACnCH,UAAAA,aAAa,CAACG,YAAD,CAAb;AACD,SAFM,CAAP;AAGD,OAJD,CAJoC,CASpC;;;AACA,mCAAiBR,MAAjB;AACAP,MAAAA,OAAO,CAACO,MAAD,CAAP;AACD,KAZc,CAAf;AAaD,GAdM,CAAP;AAeD",
      "sourceRoot": "/Users/egor/Dev/ytclone final/server/src/",
      "sourcesContent": [
        "import express from \"express\";\n// Import this module to handle errors when using async functions for our route handlers\nimport \"express-async-errors\";\nimport path from \"path\";\nimport cors from \"cors\";\nimport logger from \"loglevel\";\nimport morgan from \"morgan\";\nimport dotenv from \"dotenv\";\nimport cookieParser from \"cookie-parser\";\n\nimport { getRoutes } from \"./routes\";\nimport { errorMiddleware, setupCloseOnExit } from \"./middleware/error\";\n\ndotenv.config();\n\nfunction startServer({ port = process.env.PORT } = {}) {\n  const app = express();\n  app.use(morgan(\"dev\"));\n  app.use(cors());\n  app.use(cookieParser());\n  app.use(express.json());\n  // all API routes are prefixed with /api/v1\n  app.use(\"/api/v1\", getRoutes());\n\n  // Generic error handler if errors are missed by 'express-async-errors' middleware\n  app.use(errorMiddleware);\n\n  // When our project is pushed to production, we will serve // the react app using express.static() middleware\n  if (process.env.NODE_ENV === \"production\") {\n    app.use(express.static(path.resolve(__dirname, \"../client/build\")));\n\n    // Any request not caught by our API will be routed\n    // to our built react app\n    app.get(\"*\", function (req, res) {\n      res.sendFile(path.resolve(__dirname, \"../client/build\", \"index.html\"));\n    });\n  }\n\n  // This block of code is made to reliably start and close our express app\n  // It is written as a promise, which can be more easily tested\n  return new Promise((resolve) => {\n    const server = app.listen(port, () => {\n      logger.info(`Listening on port ${server.address().port}`);\n\n      const originalClose = server.close.bind(server);\n      server.close = () => {\n        return new Promise((resolveClose) => {\n          originalClose(resolveClose);\n        });\n      };\n      // This function properly closes the server when the program exits\n      setupCloseOnExit(server);\n      resolve(server);\n    });\n  });\n}\n\nexport { startServer };\n"
      ]
    },
    "sourceType": "script",
    "mtime": 1611368296000
  },
  "{\"sourceRoot\":\"/Users/egor/Dev/ytclone/fin/server/src/\",\"caller\":{\"name\":\"@babel/register\"},\"cwd\":\"/Users/egor/Dev/ytclone/fin\",\"filename\":\"/Users/egor/Dev/ytclone/fin/server/src/index.js\",\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"/Users/egor/Dev/ytclone/fin\",\"plugins\":[{\"key\":\"syntax-numeric-separator\",\"visitor\":{},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"proposal-logical-assignment-operators\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"AssignmentExpression\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-nullish-coalescing-operator\",\"visitor\":{},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-optional-chaining\",\"visitor\":{},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-json-strings\",\"visitor\":{},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-optional-catch-binding\",\"visitor\":{},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-async-generators\",\"visitor\":{},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-object-rest-spread\",\"visitor\":{},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"transform-modules-commonjs\",\"visitor\":{\"CallExpression\":{\"enter\":[null]},\"Program\":{\"exit\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"proposal-dynamic-import\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"Program\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"proposal-export-namespace-from\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"ExportNamedDeclaration\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}}],\"presets\":[]}:7.12.10": {
    "metadata": {},
    "options": {
      "sourceRoot": "/Users/egor/Dev/ytclone/fin/server/src/",
      "caller": {
        "name": "@babel/register"
      },
      "cwd": "/Users/egor/Dev/ytclone/fin",
      "filename": "/Users/egor/Dev/ytclone/fin/server/src/index.js",
      "cloneInputAst": true,
      "babelrc": false,
      "configFile": false,
      "envName": "development",
      "root": "/Users/egor/Dev/ytclone/fin",
      "sourceMaps": "both",
      "ast": false,
      "passPerPreset": false,
      "plugins": [
        {
          "key": "syntax-numeric-separator",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "proposal-logical-assignment-operators",
          "visitor": {
            "_exploded": {},
            "_verified": {},
            "AssignmentExpression": {
              "enter": [
                null
              ]
            }
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-nullish-coalescing-operator",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-optional-chaining",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-json-strings",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-optional-catch-binding",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-async-generators",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-object-rest-spread",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "transform-modules-commonjs",
          "visitor": {
            "CallExpression": {
              "enter": [
                null
              ]
            },
            "Program": {
              "exit": [
                null
              ]
            },
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "proposal-dynamic-import",
          "visitor": {
            "_exploded": {},
            "_verified": {},
            "Program": {
              "enter": [
                null
              ]
            }
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "proposal-export-namespace-from",
          "visitor": {
            "_exploded": {},
            "_verified": {},
            "ExportNamedDeclaration": {
              "enter": [
                null
              ]
            }
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        }
      ],
      "presets": [],
      "parserOpts": {
        "sourceType": "module",
        "sourceFileName": "/Users/egor/Dev/ytclone/fin/server/src/index.js",
        "plugins": [
          "numericSeparator",
          "logicalAssignment",
          "nullishCoalescingOperator",
          "optionalChaining",
          "jsonStrings",
          "optionalCatchBinding",
          "asyncGenerators",
          "objectRestSpread",
          "dynamicImport",
          "exportNamespaceFrom"
        ]
      },
      "generatorOpts": {
        "filename": "/Users/egor/Dev/ytclone/fin/server/src/index.js",
        "comments": true,
        "compact": "auto",
        "sourceMaps": "both",
        "sourceRoot": "/Users/egor/Dev/ytclone/fin/server/src/",
        "sourceFileName": "index.js"
      }
    },
    "ast": null,
    "code": "\"use strict\";\n\nvar _loglevel = _interopRequireDefault(require(\"loglevel\"));\n\nvar _start = require(\"./start\");\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n_loglevel.default.setLevel(\"info\");\n\n(0, _start.startServer)();\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluZGV4LmpzIl0sIm5hbWVzIjpbImxvZ2dlciIsInNldExldmVsIl0sIm1hcHBpbmdzIjoiOztBQUFBOztBQUNBOzs7O0FBQ0FBLGtCQUFPQyxRQUFQLENBQWdCLE1BQWhCOztBQUNBIiwic291cmNlUm9vdCI6Ii9Vc2Vycy9lZ29yL0Rldi95dGNsb25lL2Zpbi9zZXJ2ZXIvc3JjLyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBsb2dnZXIgZnJvbSBcImxvZ2xldmVsXCI7XG5pbXBvcnQgeyBzdGFydFNlcnZlciB9IGZyb20gXCIuL3N0YXJ0XCI7XG5sb2dnZXIuc2V0TGV2ZWwoXCJpbmZvXCIpO1xuc3RhcnRTZXJ2ZXIoKTtcbiJdfQ==",
    "map": {
      "version": 3,
      "sources": [
        "index.js"
      ],
      "names": [
        "logger",
        "setLevel"
      ],
      "mappings": ";;AAAA;;AACA;;;;AACAA,kBAAOC,QAAP,CAAgB,MAAhB;;AACA",
      "sourceRoot": "/Users/egor/Dev/ytclone/fin/server/src/",
      "sourcesContent": [
        "import logger from \"loglevel\";\nimport { startServer } from \"./start\";\nlogger.setLevel(\"info\");\nstartServer();\n"
      ]
    },
    "sourceType": "script",
    "mtime": 1611368296000
  },
  "{\"sourceRoot\":\"/Users/egor/Dev/ytclone/fin/server/src/\",\"caller\":{\"name\":\"@babel/register\"},\"cwd\":\"/Users/egor/Dev/ytclone/fin\",\"filename\":\"/Users/egor/Dev/ytclone/fin/server/src/start.js\",\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"/Users/egor/Dev/ytclone/fin\",\"plugins\":[{\"key\":\"syntax-numeric-separator\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"proposal-logical-assignment-operators\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"AssignmentExpression\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-nullish-coalescing-operator\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-optional-chaining\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-json-strings\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-optional-catch-binding\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-async-generators\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-object-rest-spread\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"transform-modules-commonjs\",\"visitor\":{\"CallExpression\":{\"enter\":[null]},\"Program\":{\"exit\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"proposal-dynamic-import\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"Program\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"proposal-export-namespace-from\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"ExportNamedDeclaration\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}}],\"presets\":[]}:7.12.10": {
    "metadata": {},
    "options": {
      "sourceRoot": "/Users/egor/Dev/ytclone/fin/server/src/",
      "caller": {
        "name": "@babel/register"
      },
      "cwd": "/Users/egor/Dev/ytclone/fin",
      "filename": "/Users/egor/Dev/ytclone/fin/server/src/start.js",
      "cloneInputAst": true,
      "babelrc": false,
      "configFile": false,
      "envName": "development",
      "root": "/Users/egor/Dev/ytclone/fin",
      "sourceMaps": "both",
      "ast": false,
      "passPerPreset": false,
      "plugins": [
        {
          "key": "syntax-numeric-separator",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "proposal-logical-assignment-operators",
          "visitor": {
            "_exploded": {},
            "_verified": {},
            "AssignmentExpression": {
              "enter": [
                null
              ]
            }
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-nullish-coalescing-operator",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-optional-chaining",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-json-strings",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-optional-catch-binding",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-async-generators",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-object-rest-spread",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "transform-modules-commonjs",
          "visitor": {
            "CallExpression": {
              "enter": [
                null
              ]
            },
            "Program": {
              "exit": [
                null
              ]
            },
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "proposal-dynamic-import",
          "visitor": {
            "_exploded": {},
            "_verified": {},
            "Program": {
              "enter": [
                null
              ]
            }
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "proposal-export-namespace-from",
          "visitor": {
            "_exploded": {},
            "_verified": {},
            "ExportNamedDeclaration": {
              "enter": [
                null
              ]
            }
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        }
      ],
      "presets": [],
      "parserOpts": {
        "sourceType": "module",
        "sourceFileName": "/Users/egor/Dev/ytclone/fin/server/src/start.js",
        "plugins": [
          "numericSeparator",
          "logicalAssignment",
          "nullishCoalescingOperator",
          "optionalChaining",
          "jsonStrings",
          "optionalCatchBinding",
          "asyncGenerators",
          "objectRestSpread",
          "dynamicImport",
          "exportNamespaceFrom"
        ]
      },
      "generatorOpts": {
        "filename": "/Users/egor/Dev/ytclone/fin/server/src/start.js",
        "comments": true,
        "compact": "auto",
        "sourceMaps": "both",
        "sourceRoot": "/Users/egor/Dev/ytclone/fin/server/src/",
        "sourceFileName": "start.js"
      }
    },
    "ast": null,
    "code": "\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.startServer = startServer;\n\nvar _express = _interopRequireDefault(require(\"express\"));\n\nrequire(\"express-async-errors\");\n\nvar _path = _interopRequireDefault(require(\"path\"));\n\nvar _cors = _interopRequireDefault(require(\"cors\"));\n\nvar _loglevel = _interopRequireDefault(require(\"loglevel\"));\n\nvar _morgan = _interopRequireDefault(require(\"morgan\"));\n\nvar _dotenv = _interopRequireDefault(require(\"dotenv\"));\n\nvar _cookieParser = _interopRequireDefault(require(\"cookie-parser\"));\n\nvar _routes = require(\"./routes\");\n\nvar _error = require(\"./middleware/error\");\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n// Import this module to handle errors when using async functions for our route handlers\n_dotenv.default.config();\n\nfunction startServer({\n  port = process.env.PORT\n} = {}) {\n  const app = (0, _express.default)();\n  app.use((0, _morgan.default)(\"dev\"));\n  app.use((0, _cors.default)());\n  app.use((0, _cookieParser.default)());\n  app.use(_express.default.json()); // all API routes are prefixed with /api/v1\n\n  app.use(\"/api/v1\", (0, _routes.getRoutes)()); // Generic error handler if errors are missed by 'express-async-errors' middleware\n\n  app.use(_error.errorMiddleware); // When our project is pushed to production, we will serve // the react app using express.static() middleware\n\n  if (process.env.NODE_ENV === \"production\") {\n    app.use(_express.default.static(_path.default.resolve(__dirname, \"../client/build\"))); // Any request not caught by our API will be routed\n    // to our built react app\n\n    app.get(\"*\", function (req, res) {\n      res.sendFile(_path.default.resolve(__dirname, \"../client/build\", \"index.html\"));\n    });\n  } // This block of code is made to reliably start and close our express app\n  // It is written as a promise, which can be more easily tested\n\n\n  return new Promise(resolve => {\n    const server = app.listen(port, () => {\n      _loglevel.default.info(`Listening on port ${server.address().port}`);\n\n      const originalClose = server.close.bind(server);\n\n      server.close = () => {\n        return new Promise(resolveClose => {\n          originalClose(resolveClose);\n        });\n      }; // This function properly closes the server when the program exits\n\n\n      (0, _error.setupCloseOnExit)(server);\n      resolve(server);\n    });\n  });\n}\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInN0YXJ0LmpzIl0sIm5hbWVzIjpbImRvdGVudiIsImNvbmZpZyIsInN0YXJ0U2VydmVyIiwicG9ydCIsInByb2Nlc3MiLCJlbnYiLCJQT1JUIiwiYXBwIiwidXNlIiwiZXhwcmVzcyIsImpzb24iLCJlcnJvck1pZGRsZXdhcmUiLCJOT0RFX0VOViIsInN0YXRpYyIsInBhdGgiLCJyZXNvbHZlIiwiX19kaXJuYW1lIiwiZ2V0IiwicmVxIiwicmVzIiwic2VuZEZpbGUiLCJQcm9taXNlIiwic2VydmVyIiwibGlzdGVuIiwibG9nZ2VyIiwiaW5mbyIsImFkZHJlc3MiLCJvcmlnaW5hbENsb3NlIiwiY2xvc2UiLCJiaW5kIiwicmVzb2x2ZUNsb3NlIl0sIm1hcHBpbmdzIjoiOzs7Ozs7O0FBQUE7O0FBRUE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBRUE7O0FBQ0E7Ozs7QUFWQTtBQVlBQSxnQkFBT0MsTUFBUDs7QUFFQSxTQUFTQyxXQUFULENBQXFCO0FBQUVDLEVBQUFBLElBQUksR0FBR0MsT0FBTyxDQUFDQyxHQUFSLENBQVlDO0FBQXJCLElBQThCLEVBQW5ELEVBQXVEO0FBQ3JELFFBQU1DLEdBQUcsR0FBRyx1QkFBWjtBQUNBQSxFQUFBQSxHQUFHLENBQUNDLEdBQUosQ0FBUSxxQkFBTyxLQUFQLENBQVI7QUFDQUQsRUFBQUEsR0FBRyxDQUFDQyxHQUFKLENBQVEsb0JBQVI7QUFDQUQsRUFBQUEsR0FBRyxDQUFDQyxHQUFKLENBQVEsNEJBQVI7QUFDQUQsRUFBQUEsR0FBRyxDQUFDQyxHQUFKLENBQVFDLGlCQUFRQyxJQUFSLEVBQVIsRUFMcUQsQ0FNckQ7O0FBQ0FILEVBQUFBLEdBQUcsQ0FBQ0MsR0FBSixDQUFRLFNBQVIsRUFBbUIsd0JBQW5CLEVBUHFELENBU3JEOztBQUNBRCxFQUFBQSxHQUFHLENBQUNDLEdBQUosQ0FBUUcsc0JBQVIsRUFWcUQsQ0FZckQ7O0FBQ0EsTUFBSVAsT0FBTyxDQUFDQyxHQUFSLENBQVlPLFFBQVosS0FBeUIsWUFBN0IsRUFBMkM7QUFDekNMLElBQUFBLEdBQUcsQ0FBQ0MsR0FBSixDQUFRQyxpQkFBUUksTUFBUixDQUFlQyxjQUFLQyxPQUFMLENBQWFDLFNBQWIsRUFBd0IsaUJBQXhCLENBQWYsQ0FBUixFQUR5QyxDQUd6QztBQUNBOztBQUNBVCxJQUFBQSxHQUFHLENBQUNVLEdBQUosQ0FBUSxHQUFSLEVBQWEsVUFBVUMsR0FBVixFQUFlQyxHQUFmLEVBQW9CO0FBQy9CQSxNQUFBQSxHQUFHLENBQUNDLFFBQUosQ0FBYU4sY0FBS0MsT0FBTCxDQUFhQyxTQUFiLEVBQXdCLGlCQUF4QixFQUEyQyxZQUEzQyxDQUFiO0FBQ0QsS0FGRDtBQUdELEdBckJvRCxDQXVCckQ7QUFDQTs7O0FBQ0EsU0FBTyxJQUFJSyxPQUFKLENBQWFOLE9BQUQsSUFBYTtBQUM5QixVQUFNTyxNQUFNLEdBQUdmLEdBQUcsQ0FBQ2dCLE1BQUosQ0FBV3BCLElBQVgsRUFBaUIsTUFBTTtBQUNwQ3FCLHdCQUFPQyxJQUFQLENBQWEscUJBQW9CSCxNQUFNLENBQUNJLE9BQVAsR0FBaUJ2QixJQUFLLEVBQXZEOztBQUVBLFlBQU13QixhQUFhLEdBQUdMLE1BQU0sQ0FBQ00sS0FBUCxDQUFhQyxJQUFiLENBQWtCUCxNQUFsQixDQUF0Qjs7QUFDQUEsTUFBQUEsTUFBTSxDQUFDTSxLQUFQLEdBQWUsTUFBTTtBQUNuQixlQUFPLElBQUlQLE9BQUosQ0FBYVMsWUFBRCxJQUFrQjtBQUNuQ0gsVUFBQUEsYUFBYSxDQUFDRyxZQUFELENBQWI7QUFDRCxTQUZNLENBQVA7QUFHRCxPQUpELENBSm9DLENBU3BDOzs7QUFDQSxtQ0FBaUJSLE1BQWpCO0FBQ0FQLE1BQUFBLE9BQU8sQ0FBQ08sTUFBRCxDQUFQO0FBQ0QsS0FaYyxDQUFmO0FBYUQsR0FkTSxDQUFQO0FBZUQiLCJzb3VyY2VSb290IjoiL1VzZXJzL2Vnb3IvRGV2L3l0Y2xvbmUvZmluL3NlcnZlci9zcmMvIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGV4cHJlc3MgZnJvbSBcImV4cHJlc3NcIjtcbi8vIEltcG9ydCB0aGlzIG1vZHVsZSB0byBoYW5kbGUgZXJyb3JzIHdoZW4gdXNpbmcgYXN5bmMgZnVuY3Rpb25zIGZvciBvdXIgcm91dGUgaGFuZGxlcnNcbmltcG9ydCBcImV4cHJlc3MtYXN5bmMtZXJyb3JzXCI7XG5pbXBvcnQgcGF0aCBmcm9tIFwicGF0aFwiO1xuaW1wb3J0IGNvcnMgZnJvbSBcImNvcnNcIjtcbmltcG9ydCBsb2dnZXIgZnJvbSBcImxvZ2xldmVsXCI7XG5pbXBvcnQgbW9yZ2FuIGZyb20gXCJtb3JnYW5cIjtcbmltcG9ydCBkb3RlbnYgZnJvbSBcImRvdGVudlwiO1xuaW1wb3J0IGNvb2tpZVBhcnNlciBmcm9tIFwiY29va2llLXBhcnNlclwiO1xuXG5pbXBvcnQgeyBnZXRSb3V0ZXMgfSBmcm9tIFwiLi9yb3V0ZXNcIjtcbmltcG9ydCB7IGVycm9yTWlkZGxld2FyZSwgc2V0dXBDbG9zZU9uRXhpdCB9IGZyb20gXCIuL21pZGRsZXdhcmUvZXJyb3JcIjtcblxuZG90ZW52LmNvbmZpZygpO1xuXG5mdW5jdGlvbiBzdGFydFNlcnZlcih7IHBvcnQgPSBwcm9jZXNzLmVudi5QT1JUIH0gPSB7fSkge1xuICBjb25zdCBhcHAgPSBleHByZXNzKCk7XG4gIGFwcC51c2UobW9yZ2FuKFwiZGV2XCIpKTtcbiAgYXBwLnVzZShjb3JzKCkpO1xuICBhcHAudXNlKGNvb2tpZVBhcnNlcigpKTtcbiAgYXBwLnVzZShleHByZXNzLmpzb24oKSk7XG4gIC8vIGFsbCBBUEkgcm91dGVzIGFyZSBwcmVmaXhlZCB3aXRoIC9hcGkvdjFcbiAgYXBwLnVzZShcIi9hcGkvdjFcIiwgZ2V0Um91dGVzKCkpO1xuXG4gIC8vIEdlbmVyaWMgZXJyb3IgaGFuZGxlciBpZiBlcnJvcnMgYXJlIG1pc3NlZCBieSAnZXhwcmVzcy1hc3luYy1lcnJvcnMnIG1pZGRsZXdhcmVcbiAgYXBwLnVzZShlcnJvck1pZGRsZXdhcmUpO1xuXG4gIC8vIFdoZW4gb3VyIHByb2plY3QgaXMgcHVzaGVkIHRvIHByb2R1Y3Rpb24sIHdlIHdpbGwgc2VydmUgLy8gdGhlIHJlYWN0IGFwcCB1c2luZyBleHByZXNzLnN0YXRpYygpIG1pZGRsZXdhcmVcbiAgaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WID09PSBcInByb2R1Y3Rpb25cIikge1xuICAgIGFwcC51c2UoZXhwcmVzcy5zdGF0aWMocGF0aC5yZXNvbHZlKF9fZGlybmFtZSwgXCIuLi9jbGllbnQvYnVpbGRcIikpKTtcblxuICAgIC8vIEFueSByZXF1ZXN0IG5vdCBjYXVnaHQgYnkgb3VyIEFQSSB3aWxsIGJlIHJvdXRlZFxuICAgIC8vIHRvIG91ciBidWlsdCByZWFjdCBhcHBcbiAgICBhcHAuZ2V0KFwiKlwiLCBmdW5jdGlvbiAocmVxLCByZXMpIHtcbiAgICAgIHJlcy5zZW5kRmlsZShwYXRoLnJlc29sdmUoX19kaXJuYW1lLCBcIi4uL2NsaWVudC9idWlsZFwiLCBcImluZGV4Lmh0bWxcIikpO1xuICAgIH0pO1xuICB9XG5cbiAgLy8gVGhpcyBibG9jayBvZiBjb2RlIGlzIG1hZGUgdG8gcmVsaWFibHkgc3RhcnQgYW5kIGNsb3NlIG91ciBleHByZXNzIGFwcFxuICAvLyBJdCBpcyB3cml0dGVuIGFzIGEgcHJvbWlzZSwgd2hpY2ggY2FuIGJlIG1vcmUgZWFzaWx5IHRlc3RlZFxuICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHtcbiAgICBjb25zdCBzZXJ2ZXIgPSBhcHAubGlzdGVuKHBvcnQsICgpID0+IHtcbiAgICAgIGxvZ2dlci5pbmZvKGBMaXN0ZW5pbmcgb24gcG9ydCAke3NlcnZlci5hZGRyZXNzKCkucG9ydH1gKTtcblxuICAgICAgY29uc3Qgb3JpZ2luYWxDbG9zZSA9IHNlcnZlci5jbG9zZS5iaW5kKHNlcnZlcik7XG4gICAgICBzZXJ2ZXIuY2xvc2UgPSAoKSA9PiB7XG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZUNsb3NlKSA9PiB7XG4gICAgICAgICAgb3JpZ2luYWxDbG9zZShyZXNvbHZlQ2xvc2UpO1xuICAgICAgICB9KTtcbiAgICAgIH07XG4gICAgICAvLyBUaGlzIGZ1bmN0aW9uIHByb3Blcmx5IGNsb3NlcyB0aGUgc2VydmVyIHdoZW4gdGhlIHByb2dyYW0gZXhpdHNcbiAgICAgIHNldHVwQ2xvc2VPbkV4aXQoc2VydmVyKTtcbiAgICAgIHJlc29sdmUoc2VydmVyKTtcbiAgICB9KTtcbiAgfSk7XG59XG5cbmV4cG9ydCB7IHN0YXJ0U2VydmVyIH07XG4iXX0=",
    "map": {
      "version": 3,
      "sources": [
        "start.js"
      ],
      "names": [
        "dotenv",
        "config",
        "startServer",
        "port",
        "process",
        "env",
        "PORT",
        "app",
        "use",
        "express",
        "json",
        "errorMiddleware",
        "NODE_ENV",
        "static",
        "path",
        "resolve",
        "__dirname",
        "get",
        "req",
        "res",
        "sendFile",
        "Promise",
        "server",
        "listen",
        "logger",
        "info",
        "address",
        "originalClose",
        "close",
        "bind",
        "resolveClose"
      ],
      "mappings": ";;;;;;;AAAA;;AAEA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AAEA;;AACA;;;;AAVA;AAYAA,gBAAOC,MAAP;;AAEA,SAASC,WAAT,CAAqB;AAAEC,EAAAA,IAAI,GAAGC,OAAO,CAACC,GAAR,CAAYC;AAArB,IAA8B,EAAnD,EAAuD;AACrD,QAAMC,GAAG,GAAG,uBAAZ;AACAA,EAAAA,GAAG,CAACC,GAAJ,CAAQ,qBAAO,KAAP,CAAR;AACAD,EAAAA,GAAG,CAACC,GAAJ,CAAQ,oBAAR;AACAD,EAAAA,GAAG,CAACC,GAAJ,CAAQ,4BAAR;AACAD,EAAAA,GAAG,CAACC,GAAJ,CAAQC,iBAAQC,IAAR,EAAR,EALqD,CAMrD;;AACAH,EAAAA,GAAG,CAACC,GAAJ,CAAQ,SAAR,EAAmB,wBAAnB,EAPqD,CASrD;;AACAD,EAAAA,GAAG,CAACC,GAAJ,CAAQG,sBAAR,EAVqD,CAYrD;;AACA,MAAIP,OAAO,CAACC,GAAR,CAAYO,QAAZ,KAAyB,YAA7B,EAA2C;AACzCL,IAAAA,GAAG,CAACC,GAAJ,CAAQC,iBAAQI,MAAR,CAAeC,cAAKC,OAAL,CAAaC,SAAb,EAAwB,iBAAxB,CAAf,CAAR,EADyC,CAGzC;AACA;;AACAT,IAAAA,GAAG,CAACU,GAAJ,CAAQ,GAAR,EAAa,UAAUC,GAAV,EAAeC,GAAf,EAAoB;AAC/BA,MAAAA,GAAG,CAACC,QAAJ,CAAaN,cAAKC,OAAL,CAAaC,SAAb,EAAwB,iBAAxB,EAA2C,YAA3C,CAAb;AACD,KAFD;AAGD,GArBoD,CAuBrD;AACA;;;AACA,SAAO,IAAIK,OAAJ,CAAaN,OAAD,IAAa;AAC9B,UAAMO,MAAM,GAAGf,GAAG,CAACgB,MAAJ,CAAWpB,IAAX,EAAiB,MAAM;AACpCqB,wBAAOC,IAAP,CAAa,qBAAoBH,MAAM,CAACI,OAAP,GAAiBvB,IAAK,EAAvD;;AAEA,YAAMwB,aAAa,GAAGL,MAAM,CAACM,KAAP,CAAaC,IAAb,CAAkBP,MAAlB,CAAtB;;AACAA,MAAAA,MAAM,CAACM,KAAP,GAAe,MAAM;AACnB,eAAO,IAAIP,OAAJ,CAAaS,YAAD,IAAkB;AACnCH,UAAAA,aAAa,CAACG,YAAD,CAAb;AACD,SAFM,CAAP;AAGD,OAJD,CAJoC,CASpC;;;AACA,mCAAiBR,MAAjB;AACAP,MAAAA,OAAO,CAACO,MAAD,CAAP;AACD,KAZc,CAAf;AAaD,GAdM,CAAP;AAeD",
      "sourceRoot": "/Users/egor/Dev/ytclone/fin/server/src/",
      "sourcesContent": [
        "import express from \"express\";\n// Import this module to handle errors when using async functions for our route handlers\nimport \"express-async-errors\";\nimport path from \"path\";\nimport cors from \"cors\";\nimport logger from \"loglevel\";\nimport morgan from \"morgan\";\nimport dotenv from \"dotenv\";\nimport cookieParser from \"cookie-parser\";\n\nimport { getRoutes } from \"./routes\";\nimport { errorMiddleware, setupCloseOnExit } from \"./middleware/error\";\n\ndotenv.config();\n\nfunction startServer({ port = process.env.PORT } = {}) {\n  const app = express();\n  app.use(morgan(\"dev\"));\n  app.use(cors());\n  app.use(cookieParser());\n  app.use(express.json());\n  // all API routes are prefixed with /api/v1\n  app.use(\"/api/v1\", getRoutes());\n\n  // Generic error handler if errors are missed by 'express-async-errors' middleware\n  app.use(errorMiddleware);\n\n  // When our project is pushed to production, we will serve // the react app using express.static() middleware\n  if (process.env.NODE_ENV === \"production\") {\n    app.use(express.static(path.resolve(__dirname, \"../client/build\")));\n\n    // Any request not caught by our API will be routed\n    // to our built react app\n    app.get(\"*\", function (req, res) {\n      res.sendFile(path.resolve(__dirname, \"../client/build\", \"index.html\"));\n    });\n  }\n\n  // This block of code is made to reliably start and close our express app\n  // It is written as a promise, which can be more easily tested\n  return new Promise((resolve) => {\n    const server = app.listen(port, () => {\n      logger.info(`Listening on port ${server.address().port}`);\n\n      const originalClose = server.close.bind(server);\n      server.close = () => {\n        return new Promise((resolveClose) => {\n          originalClose(resolveClose);\n        });\n      };\n      // This function properly closes the server when the program exits\n      setupCloseOnExit(server);\n      resolve(server);\n    });\n  });\n}\n\nexport { startServer };\n"
      ]
    },
    "sourceType": "script",
    "mtime": 1611368296000
  },
  "{\"sourceRoot\":\"/Users/egor/Dev/ytclone/fin/server/src/routes/\",\"caller\":{\"name\":\"@babel/register\"},\"cwd\":\"/Users/egor/Dev/ytclone/fin\",\"filename\":\"/Users/egor/Dev/ytclone/fin/server/src/routes/index.js\",\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"/Users/egor/Dev/ytclone/fin\",\"plugins\":[{\"key\":\"syntax-numeric-separator\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"proposal-logical-assignment-operators\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"AssignmentExpression\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-nullish-coalescing-operator\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-optional-chaining\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-json-strings\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-optional-catch-binding\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-async-generators\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-object-rest-spread\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"transform-modules-commonjs\",\"visitor\":{\"CallExpression\":{\"enter\":[null]},\"Program\":{\"exit\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"proposal-dynamic-import\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"Program\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"proposal-export-namespace-from\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"ExportNamedDeclaration\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}}],\"presets\":[]}:7.12.10": {
    "metadata": {},
    "options": {
      "sourceRoot": "/Users/egor/Dev/ytclone/fin/server/src/routes/",
      "caller": {
        "name": "@babel/register"
      },
      "cwd": "/Users/egor/Dev/ytclone/fin",
      "filename": "/Users/egor/Dev/ytclone/fin/server/src/routes/index.js",
      "cloneInputAst": true,
      "babelrc": false,
      "configFile": false,
      "envName": "development",
      "root": "/Users/egor/Dev/ytclone/fin",
      "sourceMaps": "both",
      "ast": false,
      "passPerPreset": false,
      "plugins": [
        {
          "key": "syntax-numeric-separator",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "proposal-logical-assignment-operators",
          "visitor": {
            "_exploded": {},
            "_verified": {},
            "AssignmentExpression": {
              "enter": [
                null
              ]
            }
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-nullish-coalescing-operator",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-optional-chaining",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-json-strings",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-optional-catch-binding",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-async-generators",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-object-rest-spread",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "transform-modules-commonjs",
          "visitor": {
            "CallExpression": {
              "enter": [
                null
              ]
            },
            "Program": {
              "exit": [
                null
              ]
            },
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "proposal-dynamic-import",
          "visitor": {
            "_exploded": {},
            "_verified": {},
            "Program": {
              "enter": [
                null
              ]
            }
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "proposal-export-namespace-from",
          "visitor": {
            "_exploded": {},
            "_verified": {},
            "ExportNamedDeclaration": {
              "enter": [
                null
              ]
            }
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        }
      ],
      "presets": [],
      "parserOpts": {
        "sourceType": "module",
        "sourceFileName": "/Users/egor/Dev/ytclone/fin/server/src/routes/index.js",
        "plugins": [
          "numericSeparator",
          "logicalAssignment",
          "nullishCoalescingOperator",
          "optionalChaining",
          "jsonStrings",
          "optionalCatchBinding",
          "asyncGenerators",
          "objectRestSpread",
          "dynamicImport",
          "exportNamespaceFrom"
        ]
      },
      "generatorOpts": {
        "filename": "/Users/egor/Dev/ytclone/fin/server/src/routes/index.js",
        "comments": true,
        "compact": "auto",
        "sourceMaps": "both",
        "sourceRoot": "/Users/egor/Dev/ytclone/fin/server/src/routes/",
        "sourceFileName": "index.js"
      }
    },
    "ast": null,
    "code": "\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.getRoutes = getRoutes;\n\nvar _express = _interopRequireDefault(require(\"express\"));\n\nvar _auth = require(\"./auth\");\n\nvar _user = require(\"./user\");\n\nvar _video = require(\"./video\");\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction getRoutes() {\n  // All routes in our Node API are placed on this router\n  const router = _express.default.Router(); // router.use() prefixes our route (i.e. /api/v1/auth)\n\n\n  router.use(\"/auth\", (0, _auth.getAuthRoutes)());\n  router.use(\"/users\", (0, _user.getUserRoutes)());\n  router.use(\"/videos\", (0, _video.getVideoRoutes)());\n  return router;\n}\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluZGV4LmpzIl0sIm5hbWVzIjpbImdldFJvdXRlcyIsInJvdXRlciIsImV4cHJlc3MiLCJSb3V0ZXIiLCJ1c2UiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFBQTs7QUFFQTs7QUFDQTs7QUFDQTs7OztBQUVBLFNBQVNBLFNBQVQsR0FBcUI7QUFDbkI7QUFDQSxRQUFNQyxNQUFNLEdBQUdDLGlCQUFRQyxNQUFSLEVBQWYsQ0FGbUIsQ0FJbkI7OztBQUNBRixFQUFBQSxNQUFNLENBQUNHLEdBQVAsQ0FBVyxPQUFYLEVBQW9CLDBCQUFwQjtBQUNBSCxFQUFBQSxNQUFNLENBQUNHLEdBQVAsQ0FBVyxRQUFYLEVBQXFCLDBCQUFyQjtBQUNBSCxFQUFBQSxNQUFNLENBQUNHLEdBQVAsQ0FBVyxTQUFYLEVBQXNCLDRCQUF0QjtBQUVBLFNBQU9ILE1BQVA7QUFDRCIsInNvdXJjZVJvb3QiOiIvVXNlcnMvZWdvci9EZXYveXRjbG9uZS9maW4vc2VydmVyL3NyYy9yb3V0ZXMvIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGV4cHJlc3MgZnJvbSBcImV4cHJlc3NcIjtcblxuaW1wb3J0IHsgZ2V0QXV0aFJvdXRlcyB9IGZyb20gXCIuL2F1dGhcIjtcbmltcG9ydCB7IGdldFVzZXJSb3V0ZXMgfSBmcm9tIFwiLi91c2VyXCI7XG5pbXBvcnQgeyBnZXRWaWRlb1JvdXRlcyB9IGZyb20gXCIuL3ZpZGVvXCI7XG5cbmZ1bmN0aW9uIGdldFJvdXRlcygpIHtcbiAgLy8gQWxsIHJvdXRlcyBpbiBvdXIgTm9kZSBBUEkgYXJlIHBsYWNlZCBvbiB0aGlzIHJvdXRlclxuICBjb25zdCByb3V0ZXIgPSBleHByZXNzLlJvdXRlcigpO1xuXG4gIC8vIHJvdXRlci51c2UoKSBwcmVmaXhlcyBvdXIgcm91dGUgKGkuZS4gL2FwaS92MS9hdXRoKVxuICByb3V0ZXIudXNlKFwiL2F1dGhcIiwgZ2V0QXV0aFJvdXRlcygpKTtcbiAgcm91dGVyLnVzZShcIi91c2Vyc1wiLCBnZXRVc2VyUm91dGVzKCkpO1xuICByb3V0ZXIudXNlKFwiL3ZpZGVvc1wiLCBnZXRWaWRlb1JvdXRlcygpKTtcblxuICByZXR1cm4gcm91dGVyO1xufVxuXG5leHBvcnQgeyBnZXRSb3V0ZXMgfTtcbiJdfQ==",
    "map": {
      "version": 3,
      "sources": [
        "index.js"
      ],
      "names": [
        "getRoutes",
        "router",
        "express",
        "Router",
        "use"
      ],
      "mappings": ";;;;;;;AAAA;;AAEA;;AACA;;AACA;;;;AAEA,SAASA,SAAT,GAAqB;AACnB;AACA,QAAMC,MAAM,GAAGC,iBAAQC,MAAR,EAAf,CAFmB,CAInB;;;AACAF,EAAAA,MAAM,CAACG,GAAP,CAAW,OAAX,EAAoB,0BAApB;AACAH,EAAAA,MAAM,CAACG,GAAP,CAAW,QAAX,EAAqB,0BAArB;AACAH,EAAAA,MAAM,CAACG,GAAP,CAAW,SAAX,EAAsB,4BAAtB;AAEA,SAAOH,MAAP;AACD",
      "sourceRoot": "/Users/egor/Dev/ytclone/fin/server/src/routes/",
      "sourcesContent": [
        "import express from \"express\";\n\nimport { getAuthRoutes } from \"./auth\";\nimport { getUserRoutes } from \"./user\";\nimport { getVideoRoutes } from \"./video\";\n\nfunction getRoutes() {\n  // All routes in our Node API are placed on this router\n  const router = express.Router();\n\n  // router.use() prefixes our route (i.e. /api/v1/auth)\n  router.use(\"/auth\", getAuthRoutes());\n  router.use(\"/users\", getUserRoutes());\n  router.use(\"/videos\", getVideoRoutes());\n\n  return router;\n}\n\nexport { getRoutes };\n"
      ]
    },
    "sourceType": "script",
    "mtime": 1611368296000
  },
  "{\"sourceRoot\":\"/Users/egor/Dev/ytclone/fin/server/src/routes/\",\"caller\":{\"name\":\"@babel/register\"},\"cwd\":\"/Users/egor/Dev/ytclone/fin\",\"filename\":\"/Users/egor/Dev/ytclone/fin/server/src/routes/auth.js\",\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"/Users/egor/Dev/ytclone/fin\",\"plugins\":[{\"key\":\"syntax-numeric-separator\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"proposal-logical-assignment-operators\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"AssignmentExpression\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-nullish-coalescing-operator\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-optional-chaining\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-json-strings\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-optional-catch-binding\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-async-generators\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-object-rest-spread\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"transform-modules-commonjs\",\"visitor\":{\"CallExpression\":{\"enter\":[null]},\"Program\":{\"exit\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"proposal-dynamic-import\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"Program\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"proposal-export-namespace-from\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"ExportNamedDeclaration\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}}],\"presets\":[]}:7.12.10": {
    "metadata": {},
    "options": {
      "sourceRoot": "/Users/egor/Dev/ytclone/fin/server/src/routes/",
      "caller": {
        "name": "@babel/register"
      },
      "cwd": "/Users/egor/Dev/ytclone/fin",
      "filename": "/Users/egor/Dev/ytclone/fin/server/src/routes/auth.js",
      "cloneInputAst": true,
      "babelrc": false,
      "configFile": false,
      "envName": "development",
      "root": "/Users/egor/Dev/ytclone/fin",
      "sourceMaps": "both",
      "ast": false,
      "passPerPreset": false,
      "plugins": [
        {
          "key": "syntax-numeric-separator",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "proposal-logical-assignment-operators",
          "visitor": {
            "_exploded": {},
            "_verified": {},
            "AssignmentExpression": {
              "enter": [
                null
              ]
            }
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-nullish-coalescing-operator",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-optional-chaining",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-json-strings",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-optional-catch-binding",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-async-generators",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-object-rest-spread",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "transform-modules-commonjs",
          "visitor": {
            "CallExpression": {
              "enter": [
                null
              ]
            },
            "Program": {
              "exit": [
                null
              ]
            },
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "proposal-dynamic-import",
          "visitor": {
            "_exploded": {},
            "_verified": {},
            "Program": {
              "enter": [
                null
              ]
            }
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "proposal-export-namespace-from",
          "visitor": {
            "_exploded": {},
            "_verified": {},
            "ExportNamedDeclaration": {
              "enter": [
                null
              ]
            }
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        }
      ],
      "presets": [],
      "parserOpts": {
        "sourceType": "module",
        "sourceFileName": "/Users/egor/Dev/ytclone/fin/server/src/routes/auth.js",
        "plugins": [
          "numericSeparator",
          "logicalAssignment",
          "nullishCoalescingOperator",
          "optionalChaining",
          "jsonStrings",
          "optionalCatchBinding",
          "asyncGenerators",
          "objectRestSpread",
          "dynamicImport",
          "exportNamespaceFrom"
        ]
      },
      "generatorOpts": {
        "filename": "/Users/egor/Dev/ytclone/fin/server/src/routes/auth.js",
        "comments": true,
        "compact": "auto",
        "sourceMaps": "both",
        "sourceRoot": "/Users/egor/Dev/ytclone/fin/server/src/routes/",
        "sourceFileName": "auth.js"
      }
    },
    "ast": null,
    "code": "\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.getAuthRoutes = getAuthRoutes;\n\nvar _client = require(\"@prisma/client\");\n\nvar _express = _interopRequireDefault(require(\"express\"));\n\nvar _jsonwebtoken = _interopRequireDefault(require(\"jsonwebtoken\"));\n\nvar _authorization = require(\"../middleware/authorization\");\n\nvar _googleAuthLibrary = require(\"google-auth-library\");\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nconst client = new _googleAuthLibrary.OAuth2Client(process.env.GOOGLE_CLIENT_ID);\nconst prisma = new _client.PrismaClient();\n\nfunction getAuthRoutes() {\n  const router = _express.default.Router();\n\n  router.post(\"/google-login\", googleLogin);\n  router.get(\"/me\", _authorization.protect, me);\n  router.get(\"/signout\", signout);\n  return router;\n} // All controllers/utility functions here\n\n\nasync function googleLogin(req, res) {\n  const {\n    idToken\n  } = req.body;\n  const ticket = await client.verifyIdToken({\n    idToken,\n    audience: process.env.GOOGLE_CLIENT_ID\n  });\n  const {\n    name,\n    picture,\n    email\n  } = ticket.getPayload();\n  let user = await prisma.user.findUnique({\n    where: {\n      email\n    }\n  });\n\n  if (!user) {\n    user = await prisma.user.create({\n      data: {\n        email,\n        username: name,\n        avatar: picture\n      }\n    });\n  }\n\n  const tokenPayload = {\n    id: user.id\n  };\n\n  const token = _jsonwebtoken.default.sign(tokenPayload, process.env.JWT_SECRET, {\n    expiresIn: process.env.JWT_EXPIRE\n  });\n\n  res.cookie(\"token\", token, {\n    httpOnly: true\n  });\n  res.status(200).send(token);\n}\n\nasync function me(req, res) {\n  const subscriptions = await prisma.subscription.findMany({\n    where: {\n      subscriberId: {\n        equals: req.user.id\n      }\n    }\n  });\n  const channelIds = subscriptions.map(sub => sub.subscribedToId);\n  const channels = await prisma.user.findMany({\n    where: {\n      id: {\n        in: channelIds\n      }\n    }\n  });\n  const user = req.user;\n  user.channels = channels;\n  res.status(200).json({\n    user\n  });\n}\n\nfunction signout(req, res) {\n  res.clearCookie(\"token\");\n  res.status(200).json({});\n}\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF1dGguanMiXSwibmFtZXMiOlsiY2xpZW50IiwiT0F1dGgyQ2xpZW50IiwicHJvY2VzcyIsImVudiIsIkdPT0dMRV9DTElFTlRfSUQiLCJwcmlzbWEiLCJQcmlzbWFDbGllbnQiLCJnZXRBdXRoUm91dGVzIiwicm91dGVyIiwiZXhwcmVzcyIsIlJvdXRlciIsInBvc3QiLCJnb29nbGVMb2dpbiIsImdldCIsInByb3RlY3QiLCJtZSIsInNpZ25vdXQiLCJyZXEiLCJyZXMiLCJpZFRva2VuIiwiYm9keSIsInRpY2tldCIsInZlcmlmeUlkVG9rZW4iLCJhdWRpZW5jZSIsIm5hbWUiLCJwaWN0dXJlIiwiZW1haWwiLCJnZXRQYXlsb2FkIiwidXNlciIsImZpbmRVbmlxdWUiLCJ3aGVyZSIsImNyZWF0ZSIsImRhdGEiLCJ1c2VybmFtZSIsImF2YXRhciIsInRva2VuUGF5bG9hZCIsImlkIiwidG9rZW4iLCJqd3QiLCJzaWduIiwiSldUX1NFQ1JFVCIsImV4cGlyZXNJbiIsIkpXVF9FWFBJUkUiLCJjb29raWUiLCJodHRwT25seSIsInN0YXR1cyIsInNlbmQiLCJzdWJzY3JpcHRpb25zIiwic3Vic2NyaXB0aW9uIiwiZmluZE1hbnkiLCJzdWJzY3JpYmVySWQiLCJlcXVhbHMiLCJjaGFubmVsSWRzIiwibWFwIiwic3ViIiwic3Vic2NyaWJlZFRvSWQiLCJjaGFubmVscyIsImluIiwianNvbiIsImNsZWFyQ29va2llIl0sIm1hcHBpbmdzIjoiOzs7Ozs7O0FBQUE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7Ozs7QUFFQSxNQUFNQSxNQUFNLEdBQUcsSUFBSUMsK0JBQUosQ0FBaUJDLE9BQU8sQ0FBQ0MsR0FBUixDQUFZQyxnQkFBN0IsQ0FBZjtBQUNBLE1BQU1DLE1BQU0sR0FBRyxJQUFJQyxvQkFBSixFQUFmOztBQUVBLFNBQVNDLGFBQVQsR0FBeUI7QUFDdkIsUUFBTUMsTUFBTSxHQUFHQyxpQkFBUUMsTUFBUixFQUFmOztBQUVBRixFQUFBQSxNQUFNLENBQUNH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TUFBSixDQUFXLEdBQVgsRUFBZ0JhLElBQWhCLENBQXFCO0FBQUU5QixJQUFBQTtBQUFGLEdBQXJCO0FBQ0Q7O0FBRUQsU0FBU1osT0FBVCxDQUFpQkMsR0FBakIsRUFBc0JDLEdBQXRCLEVBQTJCO0FBQ3pCQSxFQUFBQSxHQUFHLENBQUN5QyxXQUFKLENBQWdCLE9BQWhCO0FBQ0F6QyxFQUFBQSxHQUFHLENBQUMyQixNQUFKLENBQVcsR0FBWCxFQUFnQmEsSUFBaEIsQ0FBcUIsRUFBckI7QUFDRCIsInNvdXJjZVJvb3QiOiIvVXNlcnMvZWdvci9EZXYveXRjbG9uZS9maW4vc2VydmVyL3NyYy9yb3V0ZXMvIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgUHJpc21hQ2xpZW50IH0gZnJvbSBcIkBwcmlzbWEvY2xpZW50XCI7XG5pbXBvcnQgZXhwcmVzcyBmcm9tIFwiZXhwcmVzc1wiO1xuaW1wb3J0IGp3dCBmcm9tIFwianNvbndlYnRva2VuXCI7XG5pbXBvcnQgeyBwcm90ZWN0IH0gZnJvbSBcIi4uL21pZGRsZXdhcmUvYXV0aG9yaXphdGlvblwiO1xuaW1wb3J0IHsgT0F1dGgyQ2xpZW50IH0gZnJvbSBcImdvb2dsZS1hdXRoLWxpYnJhcnlcIjtcblxuY29uc3QgY2xpZW50ID0gbmV3IE9BdXRoMkNsaWVudChwcm9jZXNzLmVudi5HT09HTEVfQ0xJRU5UX0lEKTtcbmNvbnN0IHByaXNtYSA9IG5ldyBQcmlzbWFDbGllbnQoKTtcblxuZnVuY3Rpb24gZ2V0QXV0aFJvdXRlcygpIHtcbiAgY29uc3Qgcm91dGVyID0gZXhwcmVzcy5Sb3V0ZXIoKTtcblxuICByb3V0ZXIucG9zdChcIi9nb29nbGUtbG9naW5cIiwgZ29vZ2xlTG9naW4pO1xuICByb3V0ZXIuZ2V0KFwiL21lXCIsIHByb3RlY3QsIG1lKTtcbiAgcm91dGVyLmdldChcIi9zaWdub3V0XCIsIHNpZ25vdXQpO1xuXG4gIHJldHVybiByb3V0ZXI7XG59XG5cbi8vIEFsbCBjb250cm9sbGVycy91dGlsaXR5IGZ1bmN0aW9ucyBoZXJlXG5hc3luYyBmdW5jdGlvbiBnb29nbGVMb2dpbihyZXEsIHJlcykge1xuICBjb25zdCB7IGlkVG9rZW4gfSA9IHJlcS5ib2R5O1xuICBjb25zdCB0aWNrZXQgPSBhd2FpdCBjbGllbnQudmVyaWZ5SWRUb2tlbih7XG4gICAgaWRUb2tlbixcbiAgICBhdWRpZW5jZTogcHJvY2Vzcy5lbnYuR09PR0xFX0NMSUVOVF9JRCxcbiAgfSk7XG4gIGNvbnN0IHsgbmFtZSwgcGljdHVyZSwgZW1haWwgfSA9IHRpY2tldC5nZXRQYXlsb2FkKCk7XG5cbiAgbGV0IHVzZXIgPSBhd2FpdCBwcmlzbWEudXNlci5maW5kVW5pcXVlKHtcbiAgICB3aGVyZToge1xuICAgICAgZW1haWwsXG4gICAgfSxcbiAgfSk7XG5cbiAgaWYgKCF1c2VyKSB7XG4gICAgdXNlciA9IGF3YWl0IHByaXNtYS51c2VyLmNyZWF0ZSh7XG4gICAgICBkYXRhOiB7XG4gICAgICAgIGVtYWlsLFxuICAgICAgICB1c2VybmFtZTogbmFtZSxcbiAgICAgICAgYXZhdGFyOiBwaWN0dXJlLFxuICAgICAgfSxcbiAgICB9KTtcbiAgfVxuXG4gIGNvbnN0IHRva2VuUGF5bG9hZCA9IHsgaWQ6IHVzZXIuaWQgfTtcbiAgY29uc3QgdG9rZW4gPSBqd3Quc2lnbih0b2tlblBheWxvYWQsIHByb2Nlc3MuZW52LkpXVF9TRUNSRVQsIHtcbiAgICBleHBpcmVzSW46IHByb2Nlc3MuZW52LkpXVF9FWFBJUkUsXG4gIH0pO1xuXG4gIHJlcy5jb29raWUoXCJ0b2tlblwiLCB0b2tlbiwgeyBodHRwT25seTogdHJ1ZSB9KTtcbiAgcmVzLnN0YXR1cygyMDApLnNlbmQodG9rZW4pO1xufVxuXG5hc3luYyBmdW5jdGlvbiBtZShyZXEsIHJlcykge1xuICBjb25zdCBzdWJzY3JpcHRpb25zID0gYXdhaXQgcHJpc21hLnN1YnNjcmlwdGlvbi5maW5kTWFueSh7XG4gICAgd2hlcmU6IHtcbiAgICAgIHN1YnNjcmliZXJJZDoge1xuICAgICAgICBlcXVhbHM6IHJlcS51c2VyLmlkLFxuICAgICAgfSxcbiAgICB9LFxuICB9KTtcblxuICBjb25zdCBjaGFubmVsSWRzID0gc3Vic2NyaXB0aW9ucy5tYXAoKHN1YikgPT4gc3ViLnN1YnNjcmliZWRUb0lkKTtcblxuICBjb25zdCBjaGFubmVscyA9IGF3YWl0IHByaXNtYS51c2VyLmZpbmRNYW55KHtcbiAgICB3aGVyZToge1xuICAgICAgaWQ6IHtcbiAgICAgICAgaW46IGNoYW5uZWxJZHMsXG4gICAgICB9LFxuICAgIH0sXG4gIH0pO1xuXG4gIGNvbnN0IHVzZXIgPSByZXEudXNlcjtcbiAgdXNlci5jaGFubmVscyA9IGNoYW5uZWxzO1xuXG4gIHJlcy5zdGF0dXMoMjAwKS5qc29uKHsgdXNlciB9KTtcbn1cblxuZnVuY3Rpb24gc2lnbm91dChyZXEsIHJlcykge1xuICByZXMuY2xlYXJDb29raWUoXCJ0b2tlblwiKTtcbiAgcmVzLnN0YXR1cygyMDApLmpzb24oe30pO1xufVxuXG5leHBvcnQgeyBnZXRBdXRoUm91dGVzIH07XG4iXX0=",
    "map": {
      "version": 3,
      "sources": [
        "auth.js"
      ],
      "names": [
        "client",
        "OAuth2Client",
        "process",
        "env",
        "GOOGLE_CLIENT_ID",
        "prisma",
        "PrismaClient",
        "getAuthRoutes",
        "router",
        "express",
        "Router",
        "post",
        "googleLogin",
        "get",
        "protect",
        "me",
        "signout",
        "req",
        "res",
        "idToken",
        "body",
        "ticket",
        "verifyIdToken",
        "audience",
        "name",
        "picture",
        "email",
        "getPayload",
        "user",
        "findUnique",
        "where",
        "create",
        "data",
        "username",
        "avatar",
        "tokenPayload",
        "id",
        "token",
        "jwt",
        "sign",
        "JWT_SECRET",
        "expiresIn",
        "JWT_EXPIRE",
        "cookie",
        "httpOnly",
        "status",
        "send",
        "subscriptions",
        "subscription",
        "findMany",
        "subscriberId",
        "equals",
        "channelIds",
        "map",
        "sub",
        "subscribedToId",
        "channels",
        "in",
        "json",
        "clearCookie"
      ],
      "mappings": "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",
      "sourceRoot": "/Users/egor/Dev/ytclone/fin/server/src/routes/",
      "sourcesContent": [
        "import { PrismaClient } from \"@prisma/client\";\nimport express from \"express\";\nimport jwt from \"jsonwebtoken\";\nimport { protect } from \"../middleware/authorization\";\nimport { OAuth2Client } from \"google-auth-library\";\n\nconst client = new OAuth2Client(process.env.GOOGLE_CLIENT_ID);\nconst prisma = new PrismaClient();\n\nfunction getAuthRoutes() {\n  const router = express.Router();\n\n  router.post(\"/google-login\", googleLogin);\n  router.get(\"/me\", protect, me);\n  router.get(\"/signout\", signout);\n\n  return router;\n}\n\n// All controllers/utility functions here\nasync function googleLogin(req, res) {\n  const { idToken } = req.body;\n  const ticket = await client.verifyIdToken({\n    idToken,\n    audience: process.env.GOOGLE_CLIENT_ID,\n  });\n  const { name, picture, email } = ticket.getPayload();\n\n  let user = await prisma.user.findUnique({\n    where: {\n      email,\n    },\n  });\n\n  if (!user) {\n    user = await prisma.user.create({\n      data: {\n        email,\n        username: name,\n        avatar: picture,\n      },\n    });\n  }\n\n  const tokenPayload = { id: user.id };\n  const token = jwt.sign(tokenPayload, process.env.JWT_SECRET, {\n    expiresIn: process.env.JWT_EXPIRE,\n  });\n\n  res.cookie(\"token\", token, { httpOnly: true });\n  res.status(200).send(token);\n}\n\nasync function me(req, res) {\n  const subscriptions = await prisma.subscription.findMany({\n    where: {\n      subscriberId: {\n        equals: req.user.id,\n      },\n    },\n  });\n\n  const channelIds = subscriptions.map((sub) => sub.subscribedToId);\n\n  const channels = await prisma.user.findMany({\n    where: {\n      id: {\n        in: channelIds,\n      },\n    },\n  });\n\n  const user = req.user;\n  user.channels = channels;\n\n  res.status(200).json({ user });\n}\n\nfunction signout(req, res) {\n  res.clearCookie(\"token\");\n  res.status(200).json({});\n}\n\nexport { getAuthRoutes };\n"
      ]
    },
    "sourceType": "script",
    "mtime": 1611452835000
  },
  "{\"sourceRoot\":\"/Users/egor/Dev/ytclone/fin/server/src/middleware/\",\"caller\":{\"name\":\"@babel/register\"},\"cwd\":\"/Users/egor/Dev/ytclone/fin\",\"filename\":\"/Users/egor/Dev/ytclone/fin/server/src/middleware/authorization.js\",\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"/Users/egor/Dev/ytclone/fin\",\"plugins\":[{\"key\":\"syntax-numeric-separator\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"proposal-logical-assignment-operators\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"AssignmentExpression\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-nullish-coalescing-operator\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-optional-chaining\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-json-strings\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-optional-catch-binding\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-async-generators\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-object-rest-spread\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"transform-modules-commonjs\",\"visitor\":{\"CallExpression\":{\"enter\":[null]},\"Program\":{\"exit\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"proposal-dynamic-import\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"Program\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"proposal-export-namespace-from\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"ExportNamedDeclaration\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}}],\"presets\":[]}:7.12.10": {
    "metadata": {},
    "options": {
      "sourceRoot": "/Users/egor/Dev/ytclone/fin/server/src/middleware/",
      "caller": {
        "name": "@babel/register"
      },
      "cwd": "/Users/egor/Dev/ytclone/fin",
      "filename": "/Users/egor/Dev/ytclone/fin/server/src/middleware/authorization.js",
      "cloneInputAst": true,
      "babelrc": false,
      "configFile": false,
      "envName": "development",
      "root": "/Users/egor/Dev/ytclone/fin",
      "sourceMaps": "both",
      "ast": false,
      "passPerPreset": false,
      "plugins": [
        {
          "key": "syntax-numeric-separator",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "proposal-logical-assignment-operators",
          "visitor": {
            "_exploded": {},
            "_verified": {},
            "AssignmentExpression": {
              "enter": [
                null
              ]
            }
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-nullish-coalescing-operator",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-optional-chaining",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-json-strings",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-optional-catch-binding",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-async-generators",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-object-rest-spread",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "transform-modules-commonjs",
          "visitor": {
            "CallExpression": {
              "enter": [
                null
              ]
            },
            "Program": {
              "exit": [
                null
              ]
            },
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "proposal-dynamic-import",
          "visitor": {
            "_exploded": {},
            "_verified": {},
            "Program": {
              "enter": [
                null
              ]
            }
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "proposal-export-namespace-from",
          "visitor": {
            "_exploded": {},
            "_verified": {},
            "ExportNamedDeclaration": {
              "enter": [
                null
              ]
            }
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        }
      ],
      "presets": [],
      "parserOpts": {
        "sourceType": "module",
        "sourceFileName": "/Users/egor/Dev/ytclone/fin/server/src/middleware/authorization.js",
        "plugins": [
          "numericSeparator",
          "logicalAssignment",
          "nullishCoalescingOperator",
          "optionalChaining",
          "jsonStrings",
          "optionalCatchBinding",
          "asyncGenerators",
          "objectRestSpread",
          "dynamicImport",
          "exportNamespaceFrom"
        ]
      },
      "generatorOpts": {
        "filename": "/Users/egor/Dev/ytclone/fin/server/src/middleware/authorization.js",
        "comments": true,
        "compact": "auto",
        "sourceMaps": "both",
        "sourceRoot": "/Users/egor/Dev/ytclone/fin/server/src/middleware/",
        "sourceFileName": "authorization.js"
      }
    },
    "ast": null,
    "code": "\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.getAuthUser = getAuthUser;\nexports.protect = protect;\n\nvar _client = require(\"@prisma/client\");\n\nvar _jsonwebtoken = _interopRequireDefault(require(\"jsonwebtoken\"));\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nconst prisma = new _client.PrismaClient();\n\nasync function getAuthUser(req, res, next) {\n  if (!req.cookies.token) {\n    req.user = null;\n    return next();\n  }\n\n  const token = req.cookies.token;\n\n  const decoded = _jsonwebtoken.default.verify(token, process.env.JWT_SECRET);\n\n  const user = await prisma.user.findUnique({\n    where: {\n      id: decoded.id\n    },\n    include: {\n      videos: true\n    }\n  });\n  req.user = user;\n  next();\n}\n\nasync function protect(req, res, next) {\n  if (!req.cookies.token) {\n    return next({\n      message: \"You need to be logged in to visit this route\",\n      statusCode: 401\n    });\n  }\n\n  try {\n    const token = req.cookies.token;\n\n    const decoded = _jsonwebtoken.default.verify(token, process.env.JWT_SECRET);\n\n    const user = await prisma.user.findUnique({\n      where: {\n        id: decoded.id\n      },\n      include: {\n        videos: true\n      }\n    });\n    req.user = user;\n    next();\n  } catch (error) {\n    next({\n      message: \"You need to be logged in to visit this route\",\n      statusCode: 401\n    });\n  }\n}\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF1dGhvcml6YXRpb24uanMiXSwibmFtZXMiOlsicHJpc21hIiwiUHJpc21hQ2xpZW50IiwiZ2V0QXV0aFVzZXIiLCJyZXEiLCJyZXMiLCJuZXh0IiwiY29va2llcyIsInRva2VuIiwidXNlciIsImRlY29kZWQiLCJqd3QiLCJ2ZXJpZnkiLCJwcm9jZXNzIiwiZW52IiwiSldUX1NFQ1JFVCIsImZpbmRVbmlxdWUiLCJ3aGVyZSIsImlkIiwiaW5jbHVkZSIsInZpZGVvcyIsInByb3RlY3QiLCJtZXNzYWdlIiwic3RhdHVzQ29kZSIsImVycm9yIl0sIm1hcHBpbmdzIjoiOzs7Ozs7OztBQUFBOztBQUNBOzs7O0FBRUEsTUFBTUEsTUFBTSxHQUFHLElBQUlDLG9CQUFKLEVBQWY7O0FBRU8sZUFBZUMsV0FBZixDQUEyQkMsR0FBM0IsRUFBZ0NDLEdBQWhDLEVBQXFDQyxJQUFyQyxFQUEyQztBQUNoRCxNQUFJLENBQUNGLEdBQUcsQ0FBQ0csT0FBSixDQUFZQyxLQUFqQixFQUF3QjtBQUN0QkosSUFBQUEsR0FBRyxDQUFDSyxJQUFKLEdBQVcsSUFBWDtBQUNBLFdBQU9ILElBQUksRUFBWDtBQUNEOztBQUVELFFBQU1FLEtBQUssR0FBR0osR0FBRyxDQUFDRyxPQUFKLENBQVlDLEtBQTFCOztBQUNBLFFBQU1FLE9BQU8sR0FBR0Msc0JBQUlDLE1BQUosQ0FBV0osS0FBWCxFQUFrQkssT0FBTyxDQUFDQyxHQUFSLENBQVlDLFVBQTlCLENBQWhCOztBQUVBLFFBQU1OLElBQUksR0FBRyxNQUFNUixNQUFNLENBQUNRLElBQVAsQ0FBWU8sVUFBWixDQUF1QjtBQUN4Q0MsSUFBQUEsS0FBSyxFQUFFO0FBQ0xDLE1BQUFBLEVBQUUsRUFBRVIsT0FBTyxDQUFDUTtBQURQLEtBRGlDO0FBSXhDQyxJQUFBQSxPQUFPLEVBQUU7QUFDUEMsTUFBQUEsTUFBTSxFQUFFO0FBREQ7QUFKK0IsR0FBdkIsQ0FBbkI7QUFTQWhCLEVBQUFBLEdBQUcsQ0FBQ0ssSUFBSixHQUFXQSxJQUFYO0FBQ0FILEVBQUFBLElBQUk7QUFDTDs7QUFFTSxlQUFlZSxPQUFmLENBQXVCakIsR0FBdkIsRUFBNEJDLEdBQTVCLEVBQWlDQyxJQUFqQyxFQUF1QztBQUM1QyxNQUFJLENBQUNGLEdBQUcsQ0FBQ0csT0FBSixDQUFZQyxLQUFqQixFQUF3QjtBQUN0QixXQUFPRixJQUFJLENBQUM7QUFDVmdCLE1BQUFBLE9BQU8sRUFBRSw4Q0FEQztBQUVWQyxNQUFBQSxVQUFVLEVBQUU7QUFGRixLQUFELENBQVg7QUFJRDs7QUFFRCxNQUFJO0FBQ0YsVUFBTWYsS0FBSyxHQUFHSixHQUFHLENBQUNHLE9BQUosQ0FBWUMsS0FBMUI7O0FBQ0EsVUFBTUUsT0FBTyxHQUFHQyxzQkFBSUMsTUFBSixDQUFXSixLQUFYLEVBQWtCSyxPQUFPLENBQUNDLEdBQVIsQ0FBWUMsVUFBOUIsQ0FBaEI7O0FBRUEsVUFBTU4sSUFBSSxHQUFHLE1BQU1SLE1BQU0sQ0FBQ1EsSUFBUCxDQUFZTyxVQUFaLENBQXVCO0FBQ3hDQyxNQUFBQSxLQUFLLEVBQUU7QUFDTEMsUUFBQUEsRUFBRSxFQUFFUixPQUFPLENBQUNRO0FBRFAsT0FEaUM7QUFJeENDLE1BQUFBLE9BQU8sRUFBRTtBQUNQQyxRQUFBQSxNQUFNLEVBQUU7QUFERDtBQUorQixLQUF2QixDQUFuQjtBQVNBaEIsSUFBQUEsR0FBRyxDQUFDSyxJQUFKLEdBQVdBLElBQVg7QUFDQUgsSUFBQUEsSUFBSTtBQUNMLEdBZkQsQ0FlRSxPQUFPa0IsS0FBUCxFQUFjO0FBQ2RsQixJQUFBQSxJQUFJLENBQUM7QUFDSGdCLE1BQUFBLE9BQU8sRUFBRSw4Q0FETjtBQUVIQyxNQUFBQSxVQUFVLEVBQUU7QUFGVCxLQUFELENBQUo7QUFJRDtBQUNGIiwic291cmNlUm9vdCI6Ii9Vc2Vycy9lZ29yL0Rldi95dGNsb25lL2Zpbi9zZXJ2ZXIvc3JjL21pZGRsZXdhcmUvIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgUHJpc21hQ2xpZW50IH0gZnJvbSBcIkBwcmlzbWEvY2xpZW50XCI7XG5pbXBvcnQgand0IGZyb20gXCJqc29ud2VidG9rZW5cIjtcblxuY29uc3QgcHJpc21hID0gbmV3IFByaXNtYUNsaWVudCgpO1xuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0QXV0aFVzZXIocmVxLCByZXMsIG5leHQpIHtcbiAgaWYgKCFyZXEuY29va2llcy50b2tlbikge1xuICAgIHJlcS51c2VyID0gbnVsbDtcbiAgICByZXR1cm4gbmV4dCgpO1xuICB9XG5cbiAgY29uc3QgdG9rZW4gPSByZXEuY29va2llcy50b2tlbjtcbiAgY29uc3QgZGVjb2RlZCA9IGp3dC52ZXJpZnkodG9rZW4sIHByb2Nlc3MuZW52LkpXVF9TRUNSRVQpO1xuXG4gIGNvbnN0IHVzZXIgPSBhd2FpdCBwcmlzbWEudXNlci5maW5kVW5pcXVlKHtcbiAgICB3aGVyZToge1xuICAgICAgaWQ6IGRlY29kZWQuaWQsXG4gICAgfSxcbiAgICBpbmNsdWRlOiB7XG4gICAgICB2aWRlb3M6IHRydWUsXG4gICAgfSxcbiAgfSk7XG5cbiAgcmVxLnVzZXIgPSB1c2VyO1xuICBuZXh0KCk7XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBwcm90ZWN0KHJlcSwgcmVzLCBuZXh0KSB7XG4gIGlmICghcmVxLmNvb2tpZXMudG9rZW4pIHtcbiAgICByZXR1cm4gbmV4dCh7XG4gICAgICBtZXNzYWdlOiBcIllvdSBuZWVkIHRvIGJlIGxvZ2dlZCBpbiB0byB2aXNpdCB0aGlzIHJvdXRlXCIsXG4gICAgICBzdGF0dXNDb2RlOiA0MDEsXG4gICAgfSk7XG4gIH1cblxuICB0cnkge1xuICAgIGNvbnN0IHRva2VuID0gcmVxLmNvb2tpZXMudG9rZW47XG4gICAgY29uc3QgZGVjb2RlZCA9IGp3dC52ZXJpZnkodG9rZW4sIHByb2Nlc3MuZW52LkpXVF9TRUNSRVQpO1xuXG4gICAgY29uc3QgdXNlciA9IGF3YWl0IHByaXNtYS51c2VyLmZpbmRVbmlxdWUoe1xuICAgICAgd2hlcmU6IHtcbiAgICAgICAgaWQ6IGRlY29kZWQuaWQsXG4gICAgICB9LFxuICAgICAgaW5jbHVkZToge1xuICAgICAgICB2aWRlb3M6IHRydWUsXG4gICAgICB9LFxuICAgIH0pO1xuXG4gICAgcmVxLnVzZXIgPSB1c2VyO1xuICAgIG5leHQoKTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBuZXh0KHtcbiAgICAgIG1lc3NhZ2U6IFwiWW91IG5lZWQgdG8gYmUgbG9nZ2VkIGluIHRvIHZpc2l0IHRoaXMgcm91dGVcIixcbiAgICAgIHN0YXR1c0NvZGU6IDQwMSxcbiAgICB9KTtcbiAgfVxufVxuIl19",
    "map": {
      "version": 3,
      "sources": [
        "authorization.js"
      ],
      "names": [
        "prisma",
        "PrismaClient",
        "getAuthUser",
        "req",
        "res",
        "next",
        "cookies",
        "token",
        "user",
        "decoded",
        "jwt",
        "verify",
        "process",
        "env",
        "JWT_SECRET",
        "findUnique",
        "where",
        "id",
        "include",
        "videos",
        "protect",
        "message",
        "statusCode",
        "error"
      ],
      "mappings": ";;;;;;;;AAAA;;AACA;;;;AAEA,MAAMA,MAAM,GAAG,IAAIC,oBAAJ,EAAf;;AAEO,eAAeC,WAAf,CAA2BC,GAA3B,EAAgCC,GAAhC,EAAqCC,IAArC,EAA2C;AAChD,MAAI,CAACF,GAAG,CAACG,OAAJ,CAAYC,KAAjB,EAAwB;AACtBJ,IAAAA,GAAG,CAACK,IAAJ,GAAW,IAAX;AACA,WAAOH,IAAI,EAAX;AACD;;AAED,QAAME,KAAK,GAAGJ,GAAG,CAACG,OAAJ,CAAYC,KAA1B;;AACA,QAAME,OAAO,GAAGC,sBAAIC,MAAJ,CAAWJ,KAAX,EAAkBK,OAAO,CAACC,GAAR,CAAYC,UAA9B,CAAhB;;AAEA,QAAMN,IAAI,GAAG,MAAMR,MAAM,CAACQ,IAAP,CAAYO,UAAZ,CAAuB;AACxCC,IAAAA,KAAK,EAAE;AACLC,MAAAA,EAAE,EAAER,OAAO,CAACQ;AADP,KADiC;AAIxCC,IAAAA,OAAO,EAAE;AACPC,MAAAA,MAAM,EAAE;AADD;AAJ+B,GAAvB,CAAnB;AASAhB,EAAAA,GAAG,CAACK,IAAJ,GAAWA,IAAX;AACAH,EAAAA,IAAI;AACL;;AAEM,eAAee,OAAf,CAAuBjB,GAAvB,EAA4BC,GAA5B,EAAiCC,IAAjC,EAAuC;AAC5C,MAAI,CAACF,GAAG,CAACG,OAAJ,CAAYC,KAAjB,EAAwB;AACtB,WAAOF,IAAI,CAAC;AACVgB,MAAAA,OAAO,EAAE,8CADC;AAEVC,MAAAA,UAAU,EAAE;AAFF,KAAD,CAAX;AAID;;AAED,MAAI;AACF,UAAMf,KAAK,GAAGJ,GAAG,CAACG,OAAJ,CAAYC,KAA1B;;AACA,UAAME,OAAO,GAAGC,sBAAIC,MAAJ,CAAWJ,KAAX,EAAkBK,OAAO,CAACC,GAAR,CAAYC,UAA9B,CAAhB;;AAEA,UAAMN,IAAI,GAAG,MAAMR,MAAM,CAACQ,IAAP,CAAYO,UAAZ,CAAuB;AACxCC,MAAAA,KAAK,EAAE;AACLC,QAAAA,EAAE,EAAER,OAAO,CAACQ;AADP,OADiC;AAIxCC,MAAAA,OAAO,EAAE;AACPC,QAAAA,MAAM,EAAE;AADD;AAJ+B,KAAvB,CAAnB;AASAhB,IAAAA,GAAG,CAACK,IAAJ,GAAWA,IAAX;AACAH,IAAAA,IAAI;AACL,GAfD,CAeE,OAAOkB,KAAP,EAAc;AACdlB,IAAAA,IAAI,CAAC;AACHgB,MAAAA,OAAO,EAAE,8CADN;AAEHC,MAAAA,UAAU,EAAE;AAFT,KAAD,CAAJ;AAID;AACF",
      "sourceRoot": "/Users/egor/Dev/ytclone/fin/server/src/middleware/",
      "sourcesContent": [
        "import { PrismaClient } from \"@prisma/client\";\nimport jwt from \"jsonwebtoken\";\n\nconst prisma = new PrismaClient();\n\nexport async function getAuthUser(req, res, next) {\n  if (!req.cookies.token) {\n    req.user = null;\n    return next();\n  }\n\n  const token = req.cookies.token;\n  const decoded = jwt.verify(token, process.env.JWT_SECRET);\n\n  const user = await prisma.user.findUnique({\n    where: {\n      id: decoded.id,\n    },\n    include: {\n      videos: true,\n    },\n  });\n\n  req.user = user;\n  next();\n}\n\nexport async function protect(req, res, next) {\n  if (!req.cookies.token) {\n    return next({\n      message: \"You need to be logged in to visit this route\",\n      statusCode: 401,\n    });\n  }\n\n  try {\n    const token = req.cookies.token;\n    const decoded = jwt.verify(token, process.env.JWT_SECRET);\n\n    const user = await prisma.user.findUnique({\n      where: {\n        id: decoded.id,\n      },\n      include: {\n        videos: true,\n      },\n    });\n\n    req.user = user;\n    next();\n  } catch (error) {\n    next({\n      message: \"You need to be logged in to visit this route\",\n      statusCode: 401,\n    });\n  }\n}\n"
      ]
    },
    "sourceType": "script",
    "mtime": 1611454252000
  },
  "{\"sourceRoot\":\"/Users/egor/Dev/ytclone/fin/server/src/routes/\",\"caller\":{\"name\":\"@babel/register\"},\"cwd\":\"/Users/egor/Dev/ytclone/fin\",\"filename\":\"/Users/egor/Dev/ytclone/fin/server/src/routes/user.js\",\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"/Users/egor/Dev/ytclone/fin\",\"plugins\":[{\"key\":\"syntax-numeric-separator\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"proposal-logical-assignment-operators\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"AssignmentExpression\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-nullish-coalescing-operator\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-optional-chaining\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-json-strings\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-optional-catch-binding\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-async-generators\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-object-rest-spread\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"transform-modules-commonjs\",\"visitor\":{\"CallExpression\":{\"enter\":[null]},\"Program\":{\"exit\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"proposal-dynamic-import\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"Program\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"proposal-export-namespace-from\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"ExportNamedDeclaration\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}}],\"presets\":[]}:7.12.10": {
    "metadata": {},
    "options": {
      "sourceRoot": "/Users/egor/Dev/ytclone/fin/server/src/routes/",
      "caller": {
        "name": "@babel/register"
      },
      "cwd": "/Users/egor/Dev/ytclone/fin",
      "filename": "/Users/egor/Dev/ytclone/fin/server/src/routes/user.js",
      "cloneInputAst": true,
      "babelrc": false,
      "configFile": false,
      "envName": "development",
      "root": "/Users/egor/Dev/ytclone/fin",
      "sourceMaps": "both",
      "ast": false,
      "passPerPreset": false,
      "plugins": [
        {
          "key": "syntax-numeric-separator",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "proposal-logical-assignment-operators",
          "visitor": {
            "_exploded": {},
            "_verified": {},
            "AssignmentExpression": {
              "enter": [
                null
              ]
            }
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-nullish-coalescing-operator",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-optional-chaining",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-json-strings",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-optional-catch-binding",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-async-generators",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-object-rest-spread",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "transform-modules-commonjs",
          "visitor": {
            "CallExpression": {
              "enter": [
                null
              ]
            },
            "Program": {
              "exit": [
                null
              ]
            },
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "proposal-dynamic-import",
          "visitor": {
            "_exploded": {},
            "_verified": {},
            "Program": {
              "enter": [
                null
              ]
            }
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "proposal-export-namespace-from",
          "visitor": {
            "_exploded": {},
            "_verified": {},
            "ExportNamedDeclaration": {
              "enter": [
                null
              ]
            }
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        }
      ],
      "presets": [],
      "parserOpts": {
        "sourceType": "module",
        "sourceFileName": "/Users/egor/Dev/ytclone/fin/server/src/routes/user.js",
        "plugins": [
          "numericSeparator",
          "logicalAssignment",
          "nullishCoalescingOperator",
          "optionalChaining",
          "jsonStrings",
          "optionalCatchBinding",
          "asyncGenerators",
          "objectRestSpread",
          "dynamicImport",
          "exportNamespaceFrom"
        ]
      },
      "generatorOpts": {
        "filename": "/Users/egor/Dev/ytclone/fin/server/src/routes/user.js",
        "comments": true,
        "compact": "auto",
        "sourceMaps": "both",
        "sourceRoot": "/Users/egor/Dev/ytclone/fin/server/src/routes/",
        "sourceFileName": "user.js"
      }
    },
    "ast": null,
    "code": "\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.getUserRoutes = getUserRoutes;\n\nvar _client = require(\"@prisma/client\");\n\nvar _express = _interopRequireDefault(require(\"express\"));\n\nvar _authorization = require(\"../middleware/authorization\");\n\nvar _video = require(\"./video\");\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nconst prisma = new _client.PrismaClient();\n\nfunction getUserRoutes() {\n  const router = _express.default.Router();\n\n  router.get(\"/\", _authorization.protect, getRecommendedChannels);\n  router.put(\"/\", _authorization.protect, editUser);\n  router.get(\"/liked-videos\", _authorization.protect, getLikedVideos);\n  router.get(\"/history\", _authorization.protect, getHistory);\n  router.get(\"/subscriptions\", _authorization.protect, getFeed);\n  router.get(\"/search\", _authorization.getAuthUser, searchUser);\n  router.get(\"/:userId\", _authorization.getAuthUser, getProfile);\n  router.get(\"/:userId/toggle-subscribe\", _authorization.protect, toggleSubscribe);\n  return router;\n}\n\nasync function getLikedVideos(req, res) {\n  await getVideos(prisma.videoLike, req, res);\n}\n\nasync function getHistory(req, res) {\n  await getVideos(prisma.view, req, res);\n}\n\nasync function getVideos(model, req, res) {\n  const videoRelations = await model.findMany({\n    where: {\n      userId: req.user.id\n    },\n    orderBy: {\n      createdAt: \"desc\"\n    }\n  });\n  const videoIds = videoRelations.map(videoLike => videoLike.videoId);\n  let videos = await prisma.video.findMany({\n    where: {\n      id: {\n        in: videoIds\n      }\n    },\n    include: {\n      user: true\n    }\n  });\n\n  if (!videos.length) {\n    return res.status(200).json({\n      videos\n    });\n  }\n\n  videos = await (0, _video.getVideoViews)(videos);\n  res.status(200).json({\n    videos\n  });\n}\n\nasync function toggleSubscribe(req, res, next) {\n  if (req.user.id === req.params.userId) {\n    return next({\n      message: \"You cannot subscribe to your own channel\",\n      statusCode: 400\n    });\n  }\n\n  const user = await prisma.user.findUnique({\n    where: {\n      id: req.params.userId\n    }\n  });\n\n  if (!user) {\n    return next({\n      message: `No user found with id: \"${req.params.userId}\"`,\n      statusCode: 404\n    });\n  }\n\n  const isSubscribed = await prisma.subscription.findFirst({\n    where: {\n      subscriberId: {\n        equals: req.user.id\n      },\n      subscribedToId: {\n        equals: req.params.userId\n      }\n    }\n  });\n\n  if (isSubscribed) {\n    await prisma.subscription.delete({\n      where: {\n        id: isSubscribed.id\n      }\n    });\n  } else {\n    await prisma.subscription.create({\n      data: {\n        subscriber: {\n          connect: {\n            id: req.user.id\n          }\n        },\n        subscribedTo: {\n          connect: {\n            id: req.params.userId\n          }\n        }\n      }\n    });\n  }\n\n  res.status(200).json({});\n}\n\nasync function getFeed(req, res) {\n  const subscribedTo = await prisma.subscription.findMany({\n    where: {\n      subscriberId: {\n        equals: req.user.id\n      }\n    }\n  });\n  const subscriptions = subscribedTo.map(sub => sub.subscribedToId);\n  const feed = await prisma.video.findMany({\n    where: {\n      userId: {\n        in: subscriptions\n      }\n    },\n    include: {\n      user: true\n    },\n    orderBy: {\n      createdAt: \"desc\"\n    }\n  });\n\n  if (!feed.length) {\n    return res.status(200).json({\n      feed\n    });\n  }\n\n  const feedVideos = await (0, _video.getVideoViews)(feed);\n  res.status(200).json({\n    feed: feedVideos\n  });\n}\n\nasync function searchUser(req, res, next) {\n  if (!req.query.query) {\n    return next({\n      message: \"Please enter a search query\",\n      statusCode: 400\n    });\n  }\n\n  const users = await prisma.user.findMany({\n    where: {\n      username: {\n        contains: req.query.query,\n        mode: \"insensitive\"\n      }\n    }\n  });\n\n  if (!users.length) {\n    return res.status(200).json({\n      users\n    });\n  }\n\n  for (const user of users) {\n    const subscribersCount = await prisma.subscription.count({\n      where: {\n        subscribedToId: {\n          equals: user.id\n        }\n      }\n    });\n    const videosCount = await prisma.video.count({\n      where: {\n        userId: user.id\n      }\n    });\n    let isMe = false;\n    let isSubscribed = false;\n\n    if (req.user) {\n      isMe = req.user.id === user.id;\n      isSubscribed = await prisma.subscription.findFirst({\n        where: {\n          AND: {\n            subscriberId: {\n              equals: req.user.id\n            },\n            subscribedToId: {\n              equals: user.id\n            }\n          }\n        }\n      });\n    }\n\n    user.subscribersCount = subscribersCount;\n    user.videosCount = videosCount;\n    user.isSubscribed = Boolean(isSubscribed);\n    user.isMe = isMe;\n  }\n\n  res.status(200).json({\n    users\n  });\n}\n\nasync function getRecommendedChannels(req, res) {\n  const channels = await prisma.user.findMany({\n    where: {\n      id: {\n        not: req.user.id\n      }\n    },\n    take: 10\n  });\n\n  if (!channels.length) {\n    return res.status(200).json({\n      channels\n    });\n  }\n\n  for (const channel of channels) {\n    const subscribersCount = await prisma.subscription.count({\n      where: {\n        subscribedToId: {\n          equals: channel.id\n        }\n      }\n    });\n    const videosCount = await prisma.video.count({\n      where: {\n        userId: channel.id\n      }\n    });\n    const isSubscribed = await prisma.subscription.findFirst({\n      where: {\n        AND: {\n          subscriberId: {\n            equals: req.user.id\n          },\n          subscribedToId: {\n            equals: channel.id\n          }\n        }\n      }\n    });\n    channel.subscribersCount = subscribersCount;\n    channel.videosCount = videosCount;\n    channel.isSubscribed = Boolean(isSubscribed);\n  }\n\n  res.status(200).json({\n    channels\n  });\n}\n\nasync function getProfile(req, res, next) {\n  const user = await prisma.user.findUnique({\n    where: {\n      id: req.params.userId\n    }\n  });\n\n  if (!user) {\n    return next({\n      message: `No user found with id: \"${req.params.userId}\"`,\n      statusCode: 404\n    });\n  }\n\n  const subscribersCount = await prisma.subscription.count({\n    where: {\n      subscribedToId: {\n        equals: user.id\n      }\n    }\n  });\n  let isMe = false;\n  let isSubscribed = false;\n\n  if (req.user) {\n    isMe = req.user.id === user.id;\n    isSubscribed = await prisma.subscription.findFirst({\n      where: {\n        AND: {\n          subscriberId: {\n            equals: req.user.id\n          },\n          subscribedToId: {\n            equals: user.id\n          }\n        }\n      }\n    });\n  }\n\n  const subscribedTo = await prisma.subscription.findMany({\n    where: {\n      subscriberId: {\n        equals: user.id\n      }\n    }\n  });\n  const subscriptions = subscribedTo.map(sub => sub.subscribedToId);\n  const channels = await prisma.user.findMany({\n    where: {\n      id: {\n        in: subscriptions\n      }\n    }\n  });\n\n  for (const channel of channels) {\n    const subscribersCount = await prisma.subscription.count({\n      where: {\n        subscribedToId: {\n          equals: channel.id\n        }\n      }\n    });\n    channel.subscribersCount = subscribersCount;\n  }\n\n  const videos = await prisma.video.findMany({\n    where: {\n      userId: {\n        equals: user.id\n      }\n    },\n    orderBy: {\n      createdAt: \"desc\"\n    }\n  });\n  user.subscribersCount = subscribersCount;\n  user.isSubscribed = Boolean(isSubscribed);\n  user.isMe = isMe;\n  user.channels = channels;\n  user.videos = videos;\n\n  if (!videos.length) {\n    return res.status(200).json({\n      user\n    });\n  }\n\n  user.videos = await (0, _video.getVideoViews)(videos);\n  res.status(200).json({\n    user\n  });\n}\n\nasync function editUser(req, res) {\n  const {\n    username,\n    cover,\n    avatar,\n    about\n  } = req.body;\n  const user = await prisma.user.update({\n    where: {\n      id: req.user.id\n    },\n    data: {\n      username,\n      cover,\n      avatar,\n      about\n    }\n  });\n  res.status(200).json({\n    user\n  });\n}\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInVzZXIuanMiXSwibmFtZXMiOlsicHJpc21hIiwiUHJpc21hQ2xpZW50IiwiZ2V0VXNlclJvdXRlcyIsInJvdXRlciIsImV4cHJlc3MiLCJSb3V0ZXIiLCJnZXQiLCJwcm90ZWN0IiwiZ2V0UmVjb21tZW5kZWRDaGFubmVscyIsInB1dCIsImVkaXRVc2VyIiwiZ2V0TGlrZWRWaWRlb3MiLCJnZXRIaXN0b3J5IiwiZ2V0RmVlZCIsImdldEF1dGhVc2VyIiwic2VhcmNoVXNlciIsImdldFByb2ZpbGUiLCJ0b2dnbGVTdWJzY3JpYmUiLCJyZXEiLCJyZXMiLCJnZXRWaWRlb3MiLCJ2aWRlb0xpa2UiLCJ2aWV3IiwibW9kZWwiLCJ2aWRlb1JlbGF0aW9ucyIsImZpbmRNYW55Iiwid2hlcmUiLCJ1c2VySWQiLCJ1c2VyIiwiaWQiLCJvcmRlckJ5IiwiY3JlYXRlZEF0IiwidmlkZW9JZHMiLCJtYXAiLCJ2aWRlb0lkIiwidmlkZW9zIiwidmlkZW8iLCJpbiIsImluY2x1ZGUiLCJsZW5ndGgiLCJzdGF0dXMiLCJqc29uIiwibmV4dCIsInBhcmFtcyIsIm1lc3NhZ2UiLCJzdGF0dXNDb2RlIiwiZmluZFVuaXF1ZSIsImlzU3Vic2NyaWJlZCIsInN1YnNjcmlwdGlvbiIsImZpbmRGaXJzdCIsInN1YnNjcmliZXJJZCIsImVxdWFscyIsInN1YnNjcmliZWRUb0lkIiwiZGVsZXRlIiwiY3JlYXRlIiwiZGF0YSIsInN1YnNjcmliZXIiLCJjb25uZWN0Iiwic3Vic2NyaWJlZFRvIiwic3Vic2NyaXB0aW9ucyIsInN1YiIsImZlZWQiLCJmZWVkVmlkZW9zIiwicXVlcnkiLCJ1c2VycyIsInVzZXJuYW1lIiwiY29udGFpbnMiLCJtb2RlIiwic3Vic2NyaWJlcnNDb3VudCIsImNvdW50IiwidmlkZW9zQ291bnQiLCJpc01lIiwiQU5EIiwiQm9vbGVhbiIsImNoYW5uZWxzIiwibm90IiwidGFrZSIsImNoYW5uZWwiLCJjb3ZlciIsImF2YXRhciIsImFib3V0IiwiYm9keSIsInVw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ci9EZXYveXRjbG9uZS9maW4vc2VydmVyL3NyYy9yb3V0ZXMvIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgUHJpc21hQ2xpZW50IH0gZnJvbSBcIkBwcmlzbWEvY2xpZW50XCI7XG5pbXBvcnQgZXhwcmVzcyBmcm9tIFwiZXhwcmVzc1wiO1xuaW1wb3J0IHsgZ2V0QXV0aFVzZXIsIHByb3RlY3QgfSBmcm9tIFwiLi4vbWlkZGxld2FyZS9hdXRob3JpemF0aW9uXCI7XG5pbXBvcnQgeyBnZXRWaWRlb1ZpZXdzIH0gZnJvbSBcIi4vdmlkZW9cIjtcblxuY29uc3QgcHJpc21hID0gbmV3IFByaXNtYUNsaWVudCgpO1xuXG5mdW5jdGlvbiBnZXRVc2VyUm91dGVzKCkge1xuICBjb25zdCByb3V0ZXIgPSBleHByZXNzLlJvdXRlcigpO1xuXG4gIHJvdXRlci5nZXQoXCIvXCIsIHByb3RlY3QsIGdldFJlY29tbWVuZGVkQ2hhbm5lbHMpO1xuICByb3V0ZXIucHV0KFwiL1wiLCBwcm90ZWN0LCBlZGl0VXNlcik7XG5cbiAgcm91dGVyLmdldChcIi9saWtlZC12aWRlb3NcIiwgcHJvdGVjdCwgZ2V0TGlrZWRWaWRlb3MpO1xuICByb3V0ZXIuZ2V0KFwiL2hpc3RvcnlcIiwgcHJvdGVjdCwgZ2V0SGlzdG9yeSk7XG4gIHJvdXRlci5nZXQoXCIvc3Vic2NyaXB0aW9uc1wiLCBwcm90ZWN0LCBnZXRGZWVkKTtcbiAgcm91dGVyLmdldChcIi9zZWFyY2hcIiwgZ2V0QXV0aFVzZXIsIHNlYXJjaFVzZXIpO1xuXG4gIHJvdXRlci5nZXQoXCIvOnVzZXJJZFwiLCBnZXRBdXRoVXNlciwgZ2V0UHJvZmlsZSk7XG4gIHJvdXRlci5nZXQoXCIvOnVzZXJJZC90b2dnbGUtc3Vic2NyaWJlXCIsIHByb3RlY3QsIHRvZ2dsZVN1YnNjcmliZSk7XG5cbiAgcmV0dXJuIHJvdXRlcjtcbn1cblxuYXN5bmMgZnVuY3Rpb24gZ2V0TGlrZWRWaWRlb3MocmVxLCByZXMpIHtcbiAgYXdhaXQgZ2V0VmlkZW9zKHByaXNtYS52aWRlb0xpa2UsIHJlcSwgcmVzKTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gZ2V0SGlzdG9yeShyZXEsIHJlcykge1xuICBhd2FpdCBnZXRWaWRlb3MocHJpc21hLnZpZXcsIHJlcSwgcmVzKTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gZ2V0VmlkZW9zKG1vZGVsLCByZXEsIHJlcykge1xuICBjb25zdCB2aWRlb1JlbGF0aW9ucyA9IGF3YWl0IG1vZGVsLmZpbmRNYW55KHtcbiAgICB3aGVyZToge1xuICAgICAgdXNlcklkOiByZXEudXNlci5pZCxcbiAgICB9LFxuICAgIG9yZGVyQnk6IHtcbiAgICAgIGNyZWF0ZWRBdDogXCJkZXNjXCIsXG4gICAgfSxcbiAgfSk7XG5cbiAgY29uc3QgdmlkZW9JZHMgPSB2aWRlb1JlbGF0aW9ucy5tYXAoKHZpZGVvTGlrZSkgPT4gdmlkZW9MaWtlLnZpZGVvSWQpO1xuXG4gIGxldCB2aWRlb3MgPSBhd2FpdCBwcmlzbWEudmlkZW8uZmluZE1hbnkoe1xuICAgIHdoZXJlOiB7XG4gICAgICBpZDoge1xuICAgICAgICBpbjogdmlkZW9JZHMsXG4gICAgICB9LFxuICAgIH0sXG4gICAgaW5jbHVkZToge1xuICAgICAgdXNlcjogdHJ1ZSxcbiAgICB9LFxuICB9KTtcblxuICBpZiAoIXZpZGVvcy5sZW5ndGgpIHtcbiAgICByZXR1cm4gcmVzLnN0YXR1cygyMDApLmpzb24oeyB2aWRlb3MgfSk7XG4gIH1cblxuICB2aWRlb3MgPSBhd2FpdCBnZXRWaWRlb1ZpZXdzKHZpZGVvcyk7XG5cbiAgcmVzLnN0YXR1cygyMDApLmpzb24oeyB2aWRlb3MgfSk7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIHRvZ2dsZVN1YnNjcmliZShyZXEsIHJlcywgbmV4dCkge1xuICBpZiAocmVxLnVzZXIuaWQgPT09IHJlcS5wYXJhbXMudXNlcklkKSB7XG4gICAgcmV0dXJuIG5leHQoe1xuICAgICAgbWVzc2FnZTogXCJZb3UgY2Fubm90IHN1YnNjcmliZSB0byB5b3VyIG93biBjaGFubmVsXCIsXG4gICAgICBzdGF0dXNDb2RlOiA0MDAsXG4gICAgfSk7XG4gIH1cblxuICBjb25zdCB1c2VyID0gYXdhaXQgcHJpc21hLnVzZXIuZmluZFVuaXF1ZSh7XG4gICAgd2hlcmU6IHtcbiAgICAgIGlkOiByZXEucGFyYW1zLnVzZXJJZCxcbiAgICB9LFxuICB9KTtcblxuICBpZiAoIXVzZXIpIHtcbiAgICByZXR1cm4gbmV4dCh7XG4gICAgICBtZXNzYWdlOiBgTm8gdXNlciBmb3VuZCB3aXRoIGlkOiBcIiR7cmVxLnBhcmFtcy51c2VySWR9XCJgLFxuICAgICAgc3RhdHVzQ29kZTogNDA0LFxuICAgIH0pO1xuICB9XG5cbiAgY29uc3QgaXNTdWJzY3JpYmVkID0gYXdhaXQgcHJpc21hLnN1YnNjcmlwdGlvbi5maW5kRmlyc3Qoe1xuICAgIHdoZXJlOiB7XG4gICAgICBzdWJzY3JpYmVySWQ6IHtcbiAgICAgICAgZXF1YWxzOiByZXEudXNlci5pZCxcbiAgICAgIH0sXG4gICAgICBzdWJzY3JpYmVkVG9JZDoge1xuICAgICAgICBlcXVhbHM6IHJlcS5wYXJhbXMudXNlcklkLFxuICAgICAgfSxcbiAgICB9LFxuICB9KTtcblxuICBpZiAoaXNTdWJzY3JpYmVkKSB7XG4gICAgYXdhaXQgcHJpc21hLnN1YnNjcmlwdGlvbi5kZWxldGUoe1xuICAgICAgd2hlcmU6IHtcbiAgICAgICAgaWQ6IGlzU3Vic2NyaWJlZC5pZCxcbiAgICAgIH0sXG4gICAgfSk7XG4gIH0gZWxzZSB7XG4gICAgYXdhaXQgcHJpc21hLnN1YnNjcmlwdGlvbi5jcmVhdGUoe1xuICAgICAgZGF0YToge1xuICAgICAgICBzdWJzY3JpYmVyOiB7XG4gICAgICAgICAgY29ubmVjdDoge1xuICAgICAgICAgICAgaWQ6IHJlcS51c2VyLmlkLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHN1YnNjcmliZWRUbzoge1xuICAgICAgICAgIGNvbm5lY3Q6IHtcbiAgICAgICAgICAgIGlkOiByZXEucGFyYW1zLnVzZXJJZCxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgfSxcbiAgICB9KTtcbiAgfVxuXG4gIHJlcy5zdGF0dXMoMjAwKS5qc29uKHt9KTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gZ2V0RmVlZChyZXEsIHJlcykge1xuICBjb25zdCBzdWJzY3JpYmVkVG8gPSBhd2FpdCBwcmlzbWEuc3Vic2NyaXB0aW9uLmZpbmRNYW55KHtcbiAgICB3aGVyZToge1xuICAgICAgc3Vic2NyaWJlcklkOiB7XG4gICAgICAgIGVxdWFsczogcmVxLnVzZXIuaWQsXG4gICAgICB9LFxuICAgIH0sXG4gIH0pO1xuXG4gIGNvbnN0IHN1YnNjcmlwdGlvbnMgPSBzdWJzY3JpYmVkVG8ubWFwKChzdWIpID0+IHN1Yi5zdWJzY3JpYmVkVG9JZCk7XG5cbiAgY29uc3QgZmVlZCA9IGF3YWl0IHByaXNtYS52aWRlby5maW5kTWFueSh7XG4gICAgd2hlcmU6IHtcbiAgICAgIHVzZXJJZDoge1xuICAgICAgICBpbjogc3Vic2NyaXB0aW9ucyxcbiAgICAgIH0sXG4gICAgfSxcbiAgICBpbmNsdWRlOiB7XG4gICAgICB1c2VyOiB0cnVlLFxuICAgIH0sXG4gICAgb3JkZXJCeToge1xuICAgICAgY3JlYXRlZEF0OiBcImRlc2NcIixcbiAgICB9LFxuICB9KTtcblxuICBpZiAoIWZlZWQubGVuZ3RoKSB7XG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoMjAwKS5qc29uKHsgZmVlZCB9KTtcbiAgfVxuXG4gIGNvbnN0IGZlZWRWaWRlb3MgPSBhd2FpdCBnZXRWaWRlb1ZpZXdzKGZlZWQpO1xuXG4gIHJlcy5zdGF0dXMoMjAwKS5qc29uKHsgZmVlZDogZmVlZFZpZGVvcyB9KTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gc2VhcmNoVXNlcihyZXEsIHJlcywgbmV4dCkge1xuICBpZiAoIXJlcS5xdWVyeS5xdWVyeSkge1xuICAgIHJldHVybiBuZXh0KHtcbiAgICAgIG1lc3NhZ2U6IFwiUGxlYXNlIGVudGVyIGEgc2VhcmNoIHF1ZXJ5XCIsXG4gICAgICBzdGF0dXNDb2RlOiA0MDAsXG4gICAgfSk7XG4gIH1cblxuICBjb25zdCB1c2VycyA9IGF3YWl0IHByaXNtYS51c2VyLmZpbmRNYW55KHtcbiAgICB3aGVyZToge1xuICAgICAgdXNlcm5hbWU6IHtcbiAgICAgICAgY29udGFpbnM6IHJlcS5xdWVyeS5xdWVyeSxcbiAgICAgICAgbW9kZTogXCJpbnNlbnNpdGl2ZVwiLFxuICAgICAgfSxcbiAgICB9LFxuICB9KTtcblxuICBpZiAoIXVzZXJzLmxlbmd0aCkge1xuICAgIHJldHVybiByZXMuc3RhdHVzKDIwMCkuanNvbih7IHVzZXJzIH0pO1xuICB9XG5cbiAgZm9yIChjb25zdCB1c2VyIG9mIHVzZXJzKSB7XG4gICAgY29uc3Qgc3Vic2NyaWJlcnNDb3VudCA9IGF3YWl0IHByaXNtYS5zdWJzY3JpcHRpb24uY291bnQoe1xuICAgICAgd2hlcmU6IHtcbiAgICAgICAgc3Vic2NyaWJlZFRvSWQ6IHtcbiAgICAgICAgICBlcXVhbHM6IHVzZXIuaWQsXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgIH0pO1xuXG4gICAgY29uc3QgdmlkZW9zQ291bnQgPSBhd2FpdCBwcmlzbWEudmlkZW8uY291bnQoe1xuICAgICAgd2hlcmU6IHtcbiAgICAgICAgdXNlcklkOiB1c2VyLmlkLFxuICAgICAgfSxcbiAgICB9KTtcblxuICAgIGxldCBpc01lID0gZmFsc2U7XG4gICAgbGV0IGlzU3Vic2NyaWJlZCA9IGZhbHNlO1xuXG4gICAgaWYgKHJlcS51c2VyKSB7XG4gICAgICBpc01lID0gcmVxLnVzZXIuaWQgPT09IHVzZXIuaWQ7XG5cbiAgICAgIGlzU3Vic2NyaWJlZCA9IGF3YWl0IHByaXNtYS5zdWJzY3JpcHRpb24uZmluZEZpcnN0KHtcbiAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICBBTkQ6IHtcbiAgICAgICAgICAgIHN1YnNjcmliZXJJZDoge1xuICAgICAgICAgICAgICBlcXVhbHM6IHJlcS51c2VyLmlkLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHN1YnNjcmliZWRUb0lkOiB7XG4gICAgICAgICAgICAgIGVxdWFsczogdXNlci5pZCxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIHVzZXIuc3Vic2NyaWJlcnNDb3VudCA9IHN1YnNjcmliZXJzQ291bnQ7XG4gICAgdXNlci52aWRlb3NDb3VudCA9IHZpZGVvc0NvdW50O1xuICAgIHVzZXIuaXNTdWJzY3JpYmVkID0gQm9vbGVhbihpc1N1YnNjcmliZWQpO1xuICAgIHVzZXIuaXNNZSA9IGlzTWU7XG4gIH1cblxuICByZXMuc3RhdHVzKDIwMCkuanNvbih7IHVzZXJzIH0pO1xufVxuXG5hc3luYyBmdW5jdGlvbiBnZXRSZWNvbW1lbmRlZENoYW5uZWxzKHJlcSwgcmVzKSB7XG4gIGNvbnN0IGNoYW5uZWxzID0gYXdhaXQgcHJpc21hLnVzZXIuZmluZE1hbnkoe1xuICAgIHdoZXJlOiB7XG4gICAgICBpZDoge1xuICAgICAgICBub3Q6IHJlcS51c2VyLmlkLFxuICAgICAgfSxcbiAgICB9LFxuICAgIHRha2U6IDEwLFxuICB9KTtcblxuICBpZiAoIWNoYW5uZWxzLmxlbmd0aCkge1xuICAgIHJldHVybiByZXMuc3RhdHVzKDIwMCkuanNvbih7IGNoYW5uZWxzIH0pO1xuICB9XG5cbiAgZm9yIChjb25zdCBjaGFubmVsIG9mIGNoYW5uZWxzKSB7XG4gICAgY29uc3Qgc3Vic2NyaWJlcnNDb3VudCA9IGF3YWl0IHByaXNtYS5zdWJzY3JpcHRpb24uY291bnQoe1xuICAgICAgd2hlcmU6IHtcbiAgICAgICAgc3Vic2NyaWJlZFRvSWQ6IHtcbiAgICAgICAgICBlcXVhbHM6IGNoYW5uZWwuaWQsXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgIH0pO1xuXG4gICAgY29uc3QgdmlkZW9zQ291bnQgPSBhd2FpdCBwcmlzbWEudmlkZW8uY291bnQoe1xuICAgICAgd2hlcmU6IHtcbiAgICAgICAgdXNlcklkOiBjaGFubmVsLmlkLFxuICAgICAgfSxcbiAgICB9KTtcblxuICAgIGNvbnN0IGlzU3Vic2NyaWJlZCA9IGF3YWl0IHByaXNtYS5zdWJzY3JpcHRpb24uZmluZEZpcnN0KHtcbiAgICAgIHdoZXJlOiB7XG4gICAgICAgIEFORDoge1xuICAgICAgICAgIHN1YnNjcmliZXJJZDoge1xuICAgICAgICAgICAgZXF1YWxzOiByZXEudXNlci5pZCxcbiAgICAgICAgICB9LFxuICAgICAgICAgIHN1YnNjcmliZWRUb0lkOiB7XG4gICAgICAgICAgICBlcXVhbHM6IGNoYW5uZWwuaWQsXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgfSk7XG5cbiAgICBjaGFubmVsLnN1YnNjcmliZXJzQ291bnQgPSBzdWJzY3JpYmVyc0NvdW50O1xuICAgIGNoYW5uZWwudmlkZW9zQ291bnQgPSB2aWRlb3NDb3VudDtcbiAgICBjaGFubmVsLmlzU3Vic2NyaWJlZCA9IEJvb2xlYW4oaXNTdWJzY3JpYmVkKTtcbiAgfVxuXG4gIHJlcy5zdGF0dXMoMjAwKS5qc29uKHsgY2hhbm5lbHMgfSk7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGdldFByb2ZpbGUocmVxLCByZXMsIG5leHQpIHtcbiAgY29uc3QgdXNlciA9IGF3YWl0IHByaXNtYS51c2VyLmZpbmRVbmlxdWUoe1xuICAgIHdoZXJlOiB7XG4gICAgICBpZDogcmVxLnBhcmFtcy51c2VySWQsXG4gICAgfSxcbiAgfSk7XG5cbiAgaWYgKCF1c2VyKSB7XG4gICAgcmV0dXJuIG5leHQoe1xuICAgICAgbWVzc2FnZTogYE5vIHVzZXIgZm91bmQgd2l0aCBpZDogXCIke3JlcS5wYXJhbXMudXNlcklkfVwiYCxcbiAgICAgIHN0YXR1c0NvZGU6IDQwNCxcbiAgICB9KTtcbiAgfVxuXG4gIGNvbnN0IHN1YnNjcmliZXJzQ291bnQgPSBhd2FpdCBwcmlzbWEuc3Vic2NyaXB0aW9uLmNvdW50KHtcbiAgICB3aGVyZToge1xuICAgICAgc3Vic2NyaWJlZFRvSWQ6IHtcbiAgICAgICAgZXF1YWxzOiB1c2VyLmlkLFxuICAgICAgfSxcbiAgICB9LFxuICB9KTtcblxuICBsZXQgaXNNZSA9IGZhbHNlO1xuICBsZXQgaXNTdWJzY3JpYmVkID0gZmFsc2U7XG5cbiAgaWYgKHJlcS51c2VyKSB7XG4gICAgaXNNZSA9IHJlcS51c2VyLmlkID09PSB1c2VyLmlkO1xuXG4gICAgaXNTdWJzY3JpYmVkID0gYXdhaXQgcHJpc21hLnN1YnNjcmlwdGlvbi5maW5kRmlyc3Qoe1xuICAgICAgd2hlcmU6IHtcbiAgICAgICAgQU5EOiB7XG4gICAgICAgICAgc3Vic2NyaWJlcklkOiB7XG4gICAgICAgICAgICBlcXVhbHM6IHJlcS51c2VyLmlkLFxuICAgICAgICAgIH0sXG4gICAgICAgICAgc3Vic2NyaWJlZFRvSWQ6IHtcbiAgICAgICAgICAgIGVxdWFsczogdXNlci5pZCxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgfSxcbiAgICB9KTtcbiAgfVxuXG4gIGNvbnN0IHN1YnNjcmliZWRUbyA9IGF3YWl0IHByaXNtYS5zdWJzY3JpcHRpb24uZmluZE1hbnkoe1xuICAgIHdoZXJlOiB7XG4gICAgICBzdWJzY3JpYmVySWQ6IHtcbiAgICAgICAgZXF1YWxzOiB1c2VyLmlkLFxuICAgICAgfSxcbiAgICB9LFxuICB9KTtcblxuICBjb25zdCBzdWJzY3JpcHRpb25zID0gc3Vic2NyaWJlZFRvLm1hcCgoc3ViKSA9PiBzdWIuc3Vic2NyaWJlZFRvSWQpO1xuXG4gIGNvbnN0IGNoYW5uZWxzID0gYXdhaXQgcHJpc21hLnVzZXIuZmluZE1hbnkoe1xuICAgIHdoZXJlOiB7XG4gICAgICBpZDoge1xuICAgICAgICBpbjogc3Vic2NyaXB0aW9ucyxcbiAgICAgIH0sXG4gICAgfSxcbiAgfSk7XG5cbiAgZm9yIChjb25zdCBjaGFubmVsIG9mIGNoYW5uZWxzKSB7XG4gICAgY29uc3Qgc3Vic2NyaWJlcnNDb3VudCA9IGF3YWl0IHByaXNtYS5zdWJzY3JpcHRpb24uY291bnQoe1xuICAgICAgd2hlcmU6IHtcbiAgICAgICAgc3Vic2NyaWJlZFRvSWQ6IHtcbiAgICAgICAgICBlcXVhbHM6IGNoYW5uZWwuaWQsXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgIH0pO1xuICAgIGNoYW5uZWwuc3Vic2NyaWJlcnNDb3VudCA9IHN1YnNjcmliZXJzQ291bnQ7XG4gIH1cblxuICBjb25zdCB2aWRlb3MgPSBhd2FpdCBwcmlzbWEudmlkZW8uZmluZE1hbnkoe1xuICAgIHdoZXJlOiB7XG4gICAgICB1c2VySWQ6IHtcbiAgICAgICAgZXF1YWxzOiB1c2VyLmlkLFxuICAgICAgfSxcbiAgICB9LFxuICAgIG9yZGVyQnk6IHtcbiAgICAgIGNyZWF0ZWRBdDogXCJkZXNjXCIsXG4gICAgfSxcbiAgfSk7XG5cbiAgdXNlci5zdWJzY3JpYmVyc0NvdW50ID0gc3Vic2NyaWJlcnNDb3VudDtcbiAgdXNlci5pc1N1YnNjcmliZWQgPSBCb29sZWFuKGlzU3Vic2NyaWJlZCk7XG4gIHVzZXIuaXNNZSA9IGlzTWU7XG4gIHVzZXIuY2hhbm5lbHMgPSBjaGFubmVscztcbiAgdXNlci52aWRlb3MgPSB2aWRlb3M7XG5cbiAgaWYgKCF2aWRlb3MubGVuZ3RoKSB7XG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoMjAwKS5qc29uKHsgdXNlciB9KTtcbiAgfVxuXG4gIHVzZXIudmlkZW9zID0gYXdhaXQgZ2V0VmlkZW9WaWV3cyh2aWRlb3MpO1xuXG4gIHJlcy5zdGF0dXMoMjAwKS5qc29uKHsgdXNlciB9KTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gZWRpdFVzZXIocmVxLCByZXMpIHtcbiAgY29uc3QgeyB1c2VybmFtZSwgY292ZXIsIGF2YXRhciwgYWJvdXQgfSA9IHJlcS5ib2R5O1xuXG4gIGNvbnN0IHVzZXIgPSBhd2FpdCBwcmlzbWEudXNlci51cGRhdGUoe1xuICAgIHdoZXJlOiB7XG4gICAgICBpZDogcmVxLnVzZXIuaWQsXG4gICAgfSxcbiAgICBkYXRhOiB7XG4gICAgICB1c2VybmFtZSxcbiAgICAgIGNvdmVyLFxuICAgICAgYXZhdGFyLFxuICAgICAgYWJvdXQsXG4gICAgfSxcbiAgfSk7XG5cbiAgcmVzLnN0YXR1cygyMDApLmpzb24oeyB1c2VyIH0pO1xufVxuXG5leHBvcnQgeyBnZXRVc2VyUm91dGVzIH07XG4iXX0=",
    "map": {
      "version": 3,
      "sources": [
        "user.js"
      ],
      "names": [
        "prisma",
        "PrismaClient",
        "getUserRoutes",
        "router",
        "express",
        "Router",
        "get",
        "protect",
        "getRecommendedChannels",
        "put",
        "editUser",
        "getLikedVideos",
        "getHistory",
        "getFeed",
        "getAuthUser",
        "searchUser",
        "getProfile",
        "toggleSubscribe",
        "req",
        "res",
        "getVideos",
        "videoLike",
        "view",
        "model",
        "videoRelations",
        "findMany",
        "where",
        "userId",
        "user",
        "id",
        "orderBy",
        "createdAt",
        "videoIds",
        "map",
        "videoId",
        "videos",
        "video",
        "in",
        "include",
        "length",
        "status",
        "json",
        "next",
        "params",
        "message",
        "statusCode",
        "findUnique",
        "isSubscribed",
        "subscription",
        "findFirst",
        "subscriberId",
        "equals",
        "subscribedToId",
        "delete",
        "create",
        "data",
        "subscriber",
        "connect",
        "subscribedTo",
        "subscriptions",
        "sub",
        "feed",
        "feedVideos",
        "query",
        "users",
        "username",
        "contains",
        "mode",
        "subscribersCount",
        "count",
        "videosCount",
        "isMe",
        "AND",
        "Boolean",
        "channels",
        "not",
        "take",
        "channel",
        "cover",
        "avatar",
        "about",
        "body",
        "update"
      ],
      "mappings": ";;;;;;;AAAA;;AACA;;AACA;;AACA;;;;AAEA,MAAMA,MAAM,GAAG,IAAIC,oBAAJ,EAAf;;AAEA,SAASC,aAAT,GAAyB;AACvB,QAAMC,MAAM,GAAGC,iBAAQC,MAAR,EAAf;;AAEAF,EAAAA,MAAM,CAACG,GAAP,CAAW,GAAX,EAAgBC,sBAAhB,EAAyBC,sBAAzB;AACAL,EAAAA,MAAM,CAACM,GAAP,CAAW,GAAX,EAAgBF,sBAAhB,EAAyBG,QAAzB;AAEAP,EAAAA,MAAM,CAACG,GAAP,CAAW,eAAX,EAA4BC,sBAA5B,EAAqCI,cAArC;AACAR,EAAAA,MAAM,CAACG,GAAP,CAAW,UAAX,EAAuBC,sBAAvB,EAAgCK,UAAhC;AACAT,EAAAA,MAAM,CAACG,GAAP,CAAW,gBAAX,EAA6BC,sBAA7B,EAAsCM,OAAtC;AACAV,EAAAA,MAAM,CAACG,GAAP,CAAW,SAAX,EAAsBQ,0BAAtB,EAAmCC,UAAnC;AAEAZ,EAAAA,MAAM,CAACG,GAAP,CAAW,UAAX,EAAuBQ,0BAAvB,EAAoCE,UAApC;AACAb,EAAAA,MAAM,CAACG,GAAP,CAAW,2BAAX,EAAwCC,sBAAxC,EAAiDU,eAAjD;AAEA,SAAOd,MAAP;AACD;;AAED,eAAeQ,cAAf,CAA8BO,GAA9B,EAAmCC,GAAnC,EAAwC;AACtC,QAAMC,SAAS,CAACpB,MAAM,CAACqB,SAAR,EAAmBH,GAAnB,EAAwBC,GAAxB,CAAf;AACD;;AAED,eAAeP,UAAf,CAA0BM,GAA1B,EAA+BC,GAA/B,EAAoC;AAClC,QAAMC,SAAS,CAACpB,MAAM,CAACsB,IAAR,EAAcJ,GAAd,EAAmBC,GAAnB,CAAf;AACD;;AAED,eAAeC,SAAf,CAAyBG,KAAzB,EAAgCL,GAAhC,EAAqCC,GAArC,EAA0C;AACxC,QAAMK,cAAc,GAAG,MAAMD,KAAK,CAACE,QAAN,CAAe;AAC1CC,IAAAA,KAAK,EAAE;AACLC,MAAAA,MAAM,EAAET,GAAG,CAACU,IAAJ,CAASC;AADZ,KADmC;AAI1CC,IAAAA,OAAO,EAAE;AACPC,MAAAA,SAAS,EAAE;AADJ;AAJiC,GAAf,CAA7B;AASA,QAAMC,QAAQ,GAAGR,cAAc,CAACS,GAAf,CAAoBZ,SAAD,IAAeA,SAAS,CAACa,OAA5C,CAAjB;AAEA,MAAIC,MAAM,GAAG,MAAMnC,MAAM,CAACoC,KAAP,CAAaX,QAAb,CAAsB;AACvCC,IAAAA,KAAK,EAAE;AACLG,MAAAA,EAAE,EAAE;AACFQ,QAAAA,EAAE,EAAEL;AADF;AADC,KADgC;AAMvCM,IAAAA,OAAO,EAAE;AACPV,MAAAA,IAAI,EAAE;AADC;AAN8B,GAAtB,CAAnB;;AAWA,MAAI,CAACO,MAAM,CAACI,MAAZ,EAAoB;AAClB,WAAOpB,GAAG,CAACqB,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AAAEN,MAAAA;AAAF,KAArB,CAAP;AACD;;AAEDA,EAAAA,MAAM,GAAG,MAAM,0BAAcA,MAAd,CAAf;AAEAhB,EAAAA,GAAG,CAACqB,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AAAEN,IAAAA;AAAF,GAArB;AACD;;AAED,eAAelB,eAAf,CAA+BC,GAA/B,EAAoCC,GAApC,EAAyCuB,IAAzC,EAA+C;AAC7C,MAAIxB,GAAG,CAACU,IAAJ,CAASC,EAAT,KAAgBX,GAAG,CAACyB,MAAJ,CAAWhB,MAA/B,EAAuC;AACrC,WAAOe,IAAI,CAAC;AACVE,MAAAA,OAAO,EAAE,0CADC;AAEVC,MAAAA,UAAU,EAAE;AAFF,KAAD,CAAX;AAID;;AAED,QAAMjB,IAAI,GAAG,MAAM5B,MAAM,CAAC4B,IAAP,CAAYkB,UAAZ,CAAuB;AACxCpB,IAAAA,KAAK,EAAE;AACLG,MAAAA,EAAE,EAAEX,GAAG,CAACyB,MAAJ,CAAWhB;AADV;AADiC,GAAvB,CAAnB;;AAMA,MAAI,CAACC,IAAL,EAAW;AACT,WAAOc,IAAI,CAAC;AACVE,MAAAA,OAAO,EAAG,2BAA0B1B,GAAG,CAACyB,MAAJ,CAAWhB,MAAO,GAD5C;AAEVkB,MAAAA,UAAU,EAAE;AAFF,KAAD,CAAX;AAID;;AAED,QAAME,YAAY,GAAG,MAAM/C,MAAM,CAACgD,YAAP,CAAoBC,SAApB,CAA8B;AACvDvB,IAAAA,KAAK,EAAE;AACLwB,MAAAA,YAAY,EAAE;AACZC,QAAAA,MAAM,EAAEjC,GAAG,CAACU,IAAJ,CAASC;AADL,OADT;AAILuB,MAAAA,cAAc,EAAE;AACdD,QAAAA,MAAM,EAAEjC,GAAG,CAACyB,MAAJ,CAAWhB;AADL;AAJX;AADgD,GAA9B,CAA3B;;AAWA,MAAIoB,YAAJ,EAAkB;AAChB,UAAM/C,MAAM,CAACgD,YAAP,CAAoBK,MAApB,CAA2B;AAC/B3B,MAAAA,KAAK,EAAE;AACLG,QAAAA,EAAE,EAAEkB,YAAY,CAAClB;AADZ;AADwB,KAA3B,CAAN;AAKD,GAND,MAMO;AACL,UAAM7B,MAAM,CAACgD,YAAP,CAAoBM,MAApB,CAA2B;AAC/BC,MAAAA,IAAI,EAAE;AACJC,QAAAA,UAAU,EAAE;AACVC,UAAAA,OAAO,EAAE;AACP5B,YAAAA,EAAE,EAAEX,GAAG,CAACU,IAAJ,CAASC;AADN;AADC,SADR;AAMJ6B,QAAAA,YAAY,EAAE;AACZD,UAAAA,OAAO,EAAE;AACP5B,YAAAA,EAAE,EAAEX,GAAG,CAACyB,MAAJ,CAAWhB;AADR;AADG;AANV;AADyB,KAA3B,CAAN;AAcD;;AAEDR,EAAAA,GAAG,CAACqB,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,EAArB;AACD;;AAED,eAAe5B,OAAf,CAAuBK,GAAvB,EAA4BC,GAA5B,EAAiC;AAC/B,QAAMuC,YAAY,GAAG,MAAM1D,MAAM,CAACgD,YAAP,CAAoBvB,QAApB,CAA6B;AACtDC,IAAAA,KAAK,EAAE;AACLwB,MAAAA,YAAY,EAAE;AACZC,QAAAA,MAAM,EAAEjC,GAAG,CAACU,IAAJ,CAASC;AADL;AADT;AAD+C,GAA7B,CAA3B;AAQA,QAAM8B,aAAa,GAAGD,YAAY,CAACzB,GAAb,CAAkB2B,GAAD,IAASA,GAAG,CAACR,cAA9B,CAAtB;AAEA,QAAMS,IAAI,GAAG,MAAM7D,MAAM,CAACoC,KAAP,CAAaX,QAAb,CAAsB;AACvCC,IAAAA,KAAK,EAAE;AACLC,MAAAA,MAAM,EAAE;AACNU,QAAAA,EAAE,EAAEsB;AADE;AADH,KADgC;AAMvCrB,IAAAA,OAAO,EAAE;AACPV,MAAAA,IAAI,EAAE;AADC,KAN8B;AASvCE,IAAAA,OAAO,EAAE;AACPC,MAAAA,SAAS,EAAE;AADJ;AAT8B,GAAtB,CAAnB;;AAcA,MAAI,CAAC8B,IAAI,CAACtB,MAAV,EAAkB;AAChB,WAAOpB,GAAG,CAACqB,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AAAEoB,MAAAA;AAAF,KAArB,CAAP;AACD;;AAED,QAAMC,UAAU,GAAG,MAAM,0BAAcD,IAAd,CAAzB;AAEA1C,EAAAA,GAAG,CAACqB,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AAAEoB,IAAAA,IAAI,EAAEC;AAAR,GAArB;AACD;;AAED,eAAe/C,UAAf,CAA0BG,GAA1B,EAA+BC,GAA/B,EAAoCuB,IAApC,EAA0C;AACxC,MAAI,CAACxB,GAAG,CAAC6C,KAAJ,CAAUA,KAAf,EAAsB;AACpB,WAAOrB,IAAI,CAAC;AACVE,MAAAA,OAAO,EAAE,6BADC;AAEVC,MAAAA,UAAU,EAAE;AAFF,KAAD,CAAX;AAID;;AAED,QAAMmB,KAAK,GAAG,MAAMhE,MAAM,CAAC4B,IAAP,CAAYH,QAAZ,CAAqB;AACvCC,IAAAA,KAAK,EAAE;AACLuC,MAAAA,QAAQ,EAAE;AACRC,QAAAA,QAAQ,EAAEhD,GAAG,CAAC6C,KAAJ,CAAUA,KADZ;AAERI,QAAAA,IAAI,EAAE;AAFE;AADL;AADgC,GAArB,CAApB;;AASA,MAAI,CAACH,KAAK,CAACzB,MAAX,EAAmB;AACjB,WAAOpB,GAAG,CAACqB,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AAAEuB,MAAAA;AAAF,KAArB,CAAP;AACD;;AAED,OAAK,MAAMpC,IAAX,IAAmBoC,KAAnB,EAA0B;AACxB,UAAMI,gBAAgB,GAAG,MAAMpE,MAAM,CAACgD,YAAP,CAAoBqB,KAApB,CAA0B;AACvD3C,MAAAA,KAAK,EAAE;AACL0B,QAAAA,cAAc,EAAE;AACdD,UAAAA,MAAM,EAAEvB,IAAI,CAACC;AADC;AADX;AADgD,KAA1B,CAA/B;AAQA,UAAMyC,WAAW,GAAG,MAAMtE,MAAM,CAACoC,KAAP,CAAaiC,KAAb,CAAmB;AAC3C3C,MAAAA,KAAK,EAAE;AACLC,QAAAA,MAAM,EAAEC,IAAI,CAACC;AADR;AADoC,KAAnB,CAA1B;AAMA,QAAI0C,IAAI,GAAG,KAAX;AACA,QAAIxB,YAAY,GAAG,KAAnB;;AAEA,QAAI7B,GAAG,CAACU,IAAR,EAAc;AACZ2C,MAAAA,IAAI,GAAGrD,GAAG,CAACU,IAAJ,CAASC,EAAT,KAAgBD,IAAI,CAACC,EAA5B;AAEAkB,MAAAA,YAAY,GAAG,MAAM/C,MAAM,CAACgD,YAAP,CAAoBC,SAApB,CAA8B;AACjDvB,QAAAA,KAAK,EAAE;AACL8C,UAAAA,GAAG,EAAE;AACHtB,YAAAA,YAAY,EAAE;AACZC,cAAAA,MAAM,EAAEjC,GAAG,CAACU,IAAJ,CAASC;AADL,aADX;AAIHuB,YAAAA,cAAc,EAAE;AACdD,cAAAA,MAAM,EAAEvB,IAAI,CAACC;AADC;AAJb;AADA;AAD0C,OAA9B,CAArB;AAYD;;AAEDD,IAAAA,IAAI,CAACwC,gBAAL,GAAwBA,gBAAxB;AACAxC,IAAAA,IAAI,CAAC0C,WAAL,GAAmBA,WAAnB;AACA1C,IAAAA,IAAI,CAACmB,YAAL,GAAoB0B,OAAO,CAAC1B,YAAD,CAA3B;AACAnB,IAAAA,IAAI,CAAC2C,IAAL,GAAYA,IAAZ;AACD;;AAEDpD,EAAAA,GAAG,CAACqB,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AAAEuB,IAAAA;AAAF,GAArB;AACD;;AAED,eAAexD,sBAAf,CAAsCU,GAAtC,EAA2CC,GAA3C,EAAgD;AAC9C,QAAMuD,QAAQ,GAAG,MAAM1E,MAAM,CAAC4B,IAAP,CAAYH,QAAZ,CAAqB;AAC1CC,IAAAA,KAAK,EAAE;AACLG,MAAAA,EAAE,EAAE;AACF8C,QAAAA,GAAG,EAAEzD,GAAG,CAACU,IAAJ,CAASC;AADZ;AADC,KADmC;AAM1C+C,IAAAA,IAAI,EAAE;AANoC,GAArB,CAAvB;;AASA,MAAI,CAACF,QAAQ,CAACnC,MAAd,EAAsB;AACpB,WAAOpB,GAAG,CAACqB,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AAAEiC,MAAAA;AAAF,KAArB,CAAP;AACD;;AAED,OAAK,MAAMG,OAAX,IAAsBH,QAAtB,EAAgC;AAC9B,UAAMN,gBAAgB,GAAG,MAAMpE,MAAM,CAACgD,YAAP,CAAoBqB,KAApB,CAA0B;AACvD3C,MAAAA,KAAK,EAAE;AACL0B,QAAAA,cAAc,EAAE;AACdD,UAAAA,MAAM,EAAE0B,OAAO,CAAChD;AADF;AADX;AADgD,KAA1B,CAA/B;AAQA,UAAMyC,WAAW,GAAG,MAAMtE,MAAM,CAACoC,KAAP,CAAaiC,KAAb,CAAmB;AAC3C3C,MAAAA,KAAK,EAAE;AACLC,QAAAA,MAAM,EAAEkD,OAAO,CAAChD;AADX;AADoC,KAAnB,CAA1B;AAMA,UAAMkB,YAAY,GAAG,MAAM/C,MAAM,CAACgD,YAAP,CAAoBC,SAApB,CAA8B;AACvDvB,MAAAA,KAAK,EAAE;AACL8C,QAAAA,GAAG,EAAE;AACHtB,UAAAA,YAAY,EAAE;AACZC,YAAAA,MAAM,EAAEjC,GAAG,CAACU,IAAJ,CAASC;AADL,WADX;AAIHuB,UAAAA,cAAc,EAAE;AACdD,YAAAA,MAAM,EAAE0B,OAAO,CAAChD;AADF;AAJb;AADA;AADgD,KAA9B,CAA3B;AAaAgD,IAAAA,OAAO,CAACT,gBAAR,GAA2BA,gBAA3B;AACAS,IAAAA,OAAO,CAACP,WAAR,GAAsBA,WAAtB;AACAO,IAAAA,OAAO,CAAC9B,YAAR,GAAuB0B,OAAO,CAAC1B,YAAD,CAA9B;AACD;;AAED5B,EAAAA,GAAG,CAACqB,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AAAEiC,IAAAA;AAAF,GAArB;AACD;;AAED,eAAe1D,UAAf,CAA0BE,GAA1B,EAA+BC,GAA/B,EAAoCuB,IAApC,EAA0C;AACxC,QAAMd,IAAI,GAAG,MAAM5B,MAAM,CAAC4B,IAAP,CAAYkB,UAAZ,CAAuB;AACxCpB,IAAAA,KAAK,EAAE;AACLG,MAAAA,EAAE,EAAEX,GAAG,CAACyB,MAAJ,CAAWhB;AADV;AADiC,GAAvB,CAAnB;;AAMA,MAAI,CAACC,IAAL,EAAW;AACT,WAAOc,IAAI,CAAC;AACVE,MAAAA,OAAO,EAAG,2BAA0B1B,GAAG,CAACyB,MAAJ,CAAWhB,MAAO,GAD5C;AAEVkB,MAAAA,UAAU,EAAE;AAFF,KAAD,CAAX;AAID;;AAED,QAAMuB,gBAAgB,GAAG,MAAMpE,MAAM,CAACgD,YAAP,CAAoBqB,KAApB,CAA0B;AACvD3C,IAAAA,KAAK,EAAE;AACL0B,MAAAA,cAAc,EAAE;AACdD,QAAAA,MAAM,EAAEvB,IAAI,CAACC;AADC;AADX;AADgD,GAA1B,CAA/B;AAQA,MAAI0C,IAAI,GAAG,KAAX;AACA,MAAIxB,YAAY,GAAG,KAAnB;;AAEA,MAAI7B,GAAG,CAACU,IAAR,EAAc;AACZ2C,IAAAA,IAAI,GAAGrD,GAAG,CAACU,IAAJ,CAASC,EAAT,KAAgBD,IAAI,CAACC,EAA5B;AAEAkB,IAAAA,YAAY,GAAG,MAAM/C,MAAM,CAACgD,YAAP,CAAoBC,SAApB,CAA8B;AACjDvB,MAAAA,KAAK,EAAE;AACL8C,QAAAA,GAAG,EAAE;AACHtB,UAAAA,YAAY,EAAE;AACZC,YAAAA,MAAM,EAAEjC,GAAG,CAACU,IAAJ,CAASC;AADL,WADX;AAIHuB,UAAAA,cAAc,EAAE;AACdD,YAAAA,MAAM,EAAEvB,IAAI,CAACC;AADC;AAJb;AADA;AAD0C,KAA9B,CAArB;AAYD;;AAED,QAAM6B,YAAY,GAAG,MAAM1D,MAAM,CAACgD,YAAP,CAAoBvB,QAApB,CAA6B;AACtDC,IAAAA,KAAK,EAAE;AACLwB,MAAAA,YAAY,EAAE;AACZC,QAAAA,MAAM,EAAEvB,IAAI,CAACC;AADD;AADT;AAD+C,GAA7B,CAA3B;AAQA,QAAM8B,aAAa,GAAGD,YAAY,CAACzB,GAAb,CAAkB2B,GAAD,IAASA,GAAG,CAACR,cAA9B,CAAtB;AAEA,QAAMsB,QAAQ,GAAG,MAAM1E,MAAM,CAAC4B,IAAP,CAAYH,QAAZ,CAAqB;AAC1CC,IAAAA,KAAK,EAAE;AACLG,MAAAA,EAAE,EAAE;AACFQ,QAAAA,EAAE,EAAEsB;AADF;AADC;AADmC,GAArB,CAAvB;;AAQA,OAAK,MAAMkB,OAAX,IAAsBH,QAAtB,EAAgC;AAC9B,UAAMN,gBAAgB,GAAG,MAAMpE,MAAM,CAACgD,YAAP,CAAoBqB,KAApB,CAA0B;AACvD3C,MAAAA,KAAK,EAAE;AACL0B,QAAAA,cAAc,EAAE;AACdD,UAAAA,MAAM,EAAE0B,OAAO,CAAChD;AADF;AADX;AADgD,KAA1B,CAA/B;AAOAgD,IAAAA,OAAO,CAACT,gBAAR,GAA2BA,gBAA3B;AACD;;AAED,QAAMjC,MAAM,GAAG,MAAMnC,MAAM,CAACoC,KAAP,CAAaX,QAAb,CAAsB;AACzCC,IAAAA,KAAK,EAAE;AACLC,MAAAA,MAAM,EAAE;AACNwB,QAAAA,MAAM,EAAEvB,IAAI,CAACC;AADP;AADH,KADkC;AAMzCC,IAAAA,OAAO,EAAE;AACPC,MAAAA,SAAS,EAAE;AADJ;AANgC,GAAtB,CAArB;AAWAH,EAAAA,IAAI,CAACwC,gBAAL,GAAwBA,gBAAxB;AACAxC,EAAAA,IAAI,CAACmB,YAAL,GAAoB0B,OAAO,CAAC1B,YAAD,CAA3B;AACAnB,EAAAA,IAAI,CAAC2C,IAAL,GAAYA,IAAZ;AACA3C,EAAAA,IAAI,CAAC8C,QAAL,GAAgBA,QAAhB;AACA9C,EAAAA,IAAI,CAACO,MAAL,GAAcA,MAAd;;AAEA,MAAI,CAACA,MAAM,CAACI,MAAZ,EAAoB;AAClB,WAAOpB,GAAG,CAACqB,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AAAEb,MAAAA;AAAF,KAArB,CAAP;AACD;;AAEDA,EAAAA,IAAI,CAACO,MAAL,GAAc,MAAM,0BAAcA,MAAd,CAApB;AAEAhB,EAAAA,GAAG,CAACqB,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AAAEb,IAAAA;AAAF,GAArB;AACD;;AAED,eAAelB,QAAf,CAAwBQ,GAAxB,EAA6BC,GAA7B,EAAkC;AAChC,QAAM;AAAE8C,IAAAA,QAAF;AAAYa,IAAAA,KAAZ;AAAmBC,IAAAA,MAAnB;AAA2BC,IAAAA;AAA3B,MAAqC9D,GAAG,CAAC+D,IAA/C;AAEA,QAAMrD,IAAI,GAAG,MAAM5B,MAAM,CAAC4B,IAAP,CAAYsD,MAAZ,CAAmB;AACpCxD,IAAAA,KAAK,EAAE;AACLG,MAAAA,EAAE,EAAEX,GAAG,CAACU,IAAJ,CAASC;AADR,KAD6B;AAIpC0B,IAAAA,IAAI,EAAE;AACJU,MAAAA,QADI;AAEJa,MAAAA,KAFI;AAGJC,MAAAA,MAHI;AAIJC,MAAAA;AAJI;AAJ8B,GAAnB,CAAnB;AAYA7D,EAAAA,GAAG,CAACqB,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AAAEb,IAAAA;AAAF,GAArB;AACD",
      "sourceRoot": "/Users/egor/Dev/ytclone/fin/server/src/routes/",
      "sourcesContent": [
        "import { PrismaClient } from \"@prisma/client\";\nimport express from \"express\";\nimport { getAuthUser, protect } from \"../middleware/authorization\";\nimport { getVideoViews } from \"./video\";\n\nconst prisma = new PrismaClient();\n\nfunction getUserRoutes() {\n  const router = express.Router();\n\n  router.get(\"/\", protect, getRecommendedChannels);\n  router.put(\"/\", protect, editUser);\n\n  router.get(\"/liked-videos\", protect, getLikedVideos);\n  router.get(\"/history\", protect, getHistory);\n  router.get(\"/subscriptions\", protect, getFeed);\n  router.get(\"/search\", getAuthUser, searchUser);\n\n  router.get(\"/:userId\", getAuthUser, getProfile);\n  router.get(\"/:userId/toggle-subscribe\", protect, toggleSubscribe);\n\n  return router;\n}\n\nasync function getLikedVideos(req, res) {\n  await getVideos(prisma.videoLike, req, res);\n}\n\nasync function getHistory(req, res) {\n  await getVideos(prisma.view, req, res);\n}\n\nasync function getVideos(model, req, res) {\n  const videoRelations = await model.findMany({\n    where: {\n      userId: req.user.id,\n    },\n    orderBy: {\n      createdAt: \"desc\",\n    },\n  });\n\n  const videoIds = videoRelations.map((videoLike) => videoLike.videoId);\n\n  let videos = await prisma.video.findMany({\n    where: {\n      id: {\n        in: videoIds,\n      },\n    },\n    include: {\n      user: true,\n    },\n  });\n\n  if (!videos.length) {\n    return res.status(200).json({ videos });\n  }\n\n  videos = await getVideoViews(videos);\n\n  res.status(200).json({ videos });\n}\n\nasync function toggleSubscribe(req, res, next) {\n  if (req.user.id === req.params.userId) {\n    return next({\n      message: \"You cannot subscribe to your own channel\",\n      statusCode: 400,\n    });\n  }\n\n  const user = await prisma.user.findUnique({\n    where: {\n      id: req.params.userId,\n    },\n  });\n\n  if (!user) {\n    return next({\n      message: `No user found with id: \"${req.params.userId}\"`,\n      statusCode: 404,\n    });\n  }\n\n  const isSubscribed = await prisma.subscription.findFirst({\n    where: {\n      subscriberId: {\n        equals: req.user.id,\n      },\n      subscribedToId: {\n        equals: req.params.userId,\n      },\n    },\n  });\n\n  if (isSubscribed) {\n    await prisma.subscription.delete({\n      where: {\n        id: isSubscribed.id,\n      },\n    });\n  } else {\n    await prisma.subscription.create({\n      data: {\n        subscriber: {\n          connect: {\n            id: req.user.id,\n          },\n        },\n        subscribedTo: {\n          connect: {\n            id: req.params.userId,\n          },\n        },\n      },\n    });\n  }\n\n  res.status(200).json({});\n}\n\nasync function getFeed(req, res) {\n  const subscribedTo = await prisma.subscription.findMany({\n    where: {\n      subscriberId: {\n        equals: req.user.id,\n      },\n    },\n  });\n\n  const subscriptions = subscribedTo.map((sub) => sub.subscribedToId);\n\n  const feed = await prisma.video.findMany({\n    where: {\n      userId: {\n        in: subscriptions,\n      },\n    },\n    include: {\n      user: true,\n    },\n    orderBy: {\n      createdAt: \"desc\",\n    },\n  });\n\n  if (!feed.length) {\n    return res.status(200).json({ feed });\n  }\n\n  const feedVideos = await getVideoViews(feed);\n\n  res.status(200).json({ feed: feedVideos });\n}\n\nasync function searchUser(req, res, next) {\n  if (!req.query.query) {\n    return next({\n      message: \"Please enter a search query\",\n      statusCode: 400,\n    });\n  }\n\n  const users = await prisma.user.findMany({\n    where: {\n      username: {\n        contains: req.query.query,\n        mode: \"insensitive\",\n      },\n    },\n  });\n\n  if (!users.length) {\n    return res.status(200).json({ users });\n  }\n\n  for (const user of users) {\n    const subscribersCount = await prisma.subscription.count({\n      where: {\n        subscribedToId: {\n          equals: user.id,\n        },\n      },\n    });\n\n    const videosCount = await prisma.video.count({\n      where: {\n        userId: user.id,\n      },\n    });\n\n    let isMe = false;\n    let isSubscribed = false;\n\n    if (req.user) {\n      isMe = req.user.id === user.id;\n\n      isSubscribed = await prisma.subscription.findFirst({\n        where: {\n          AND: {\n            subscriberId: {\n              equals: req.user.id,\n            },\n            subscribedToId: {\n              equals: user.id,\n            },\n          },\n        },\n      });\n    }\n\n    user.subscribersCount = subscribersCount;\n    user.videosCount = videosCount;\n    user.isSubscribed = Boolean(isSubscribed);\n    user.isMe = isMe;\n  }\n\n  res.status(200).json({ users });\n}\n\nasync function getRecommendedChannels(req, res) {\n  const channels = await prisma.user.findMany({\n    where: {\n      id: {\n        not: req.user.id,\n      },\n    },\n    take: 10,\n  });\n\n  if (!channels.length) {\n    return res.status(200).json({ channels });\n  }\n\n  for (const channel of channels) {\n    const subscribersCount = await prisma.subscription.count({\n      where: {\n        subscribedToId: {\n          equals: channel.id,\n        },\n      },\n    });\n\n    const videosCount = await prisma.video.count({\n      where: {\n        userId: channel.id,\n      },\n    });\n\n    const isSubscribed = await prisma.subscription.findFirst({\n      where: {\n        AND: {\n          subscriberId: {\n            equals: req.user.id,\n          },\n          subscribedToId: {\n            equals: channel.id,\n          },\n        },\n      },\n    });\n\n    channel.subscribersCount = subscribersCount;\n    channel.videosCount = videosCount;\n    channel.isSubscribed = Boolean(isSubscribed);\n  }\n\n  res.status(200).json({ channels });\n}\n\nasync function getProfile(req, res, next) {\n  const user = await prisma.user.findUnique({\n    where: {\n      id: req.params.userId,\n    },\n  });\n\n  if (!user) {\n    return next({\n      message: `No user found with id: \"${req.params.userId}\"`,\n      statusCode: 404,\n    });\n  }\n\n  const subscribersCount = await prisma.subscription.count({\n    where: {\n      subscribedToId: {\n        equals: user.id,\n      },\n    },\n  });\n\n  let isMe = false;\n  let isSubscribed = false;\n\n  if (req.user) {\n    isMe = req.user.id === user.id;\n\n    isSubscribed = await prisma.subscription.findFirst({\n      where: {\n        AND: {\n          subscriberId: {\n            equals: req.user.id,\n          },\n          subscribedToId: {\n            equals: user.id,\n          },\n        },\n      },\n    });\n  }\n\n  const subscribedTo = await prisma.subscription.findMany({\n    where: {\n      subscriberId: {\n        equals: user.id,\n      },\n    },\n  });\n\n  const subscriptions = subscribedTo.map((sub) => sub.subscribedToId);\n\n  const channels = await prisma.user.findMany({\n    where: {\n      id: {\n        in: subscriptions,\n      },\n    },\n  });\n\n  for (const channel of channels) {\n    const subscribersCount = await prisma.subscription.count({\n      where: {\n        subscribedToId: {\n          equals: channel.id,\n        },\n      },\n    });\n    channel.subscribersCount = subscribersCount;\n  }\n\n  const videos = await prisma.video.findMany({\n    where: {\n      userId: {\n        equals: user.id,\n      },\n    },\n    orderBy: {\n      createdAt: \"desc\",\n    },\n  });\n\n  user.subscribersCount = subscribersCount;\n  user.isSubscribed = Boolean(isSubscribed);\n  user.isMe = isMe;\n  user.channels = channels;\n  user.videos = videos;\n\n  if (!videos.length) {\n    return res.status(200).json({ user });\n  }\n\n  user.videos = await getVideoViews(videos);\n\n  res.status(200).json({ user });\n}\n\nasync function editUser(req, res) {\n  const { username, cover, avatar, about } = req.body;\n\n  const user = await prisma.user.update({\n    where: {\n      id: req.user.id,\n    },\n    data: {\n      username,\n      cover,\n      avatar,\n      about,\n    },\n  });\n\n  res.status(200).json({ user });\n}\n\nexport { getUserRoutes };\n"
      ]
    },
    "sourceType": "script",
    "mtime": 1611426347000
  },
  "{\"sourceRoot\":\"/Users/egor/Dev/ytclone/fin/server/src/routes/\",\"caller\":{\"name\":\"@babel/register\"},\"cwd\":\"/Users/egor/Dev/ytclone/fin\",\"filename\":\"/Users/egor/Dev/ytclone/fin/server/src/routes/video.js\",\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"/Users/egor/Dev/ytclone/fin\",\"plugins\":[{\"key\":\"syntax-numeric-separator\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"proposal-logical-assignment-operators\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"AssignmentExpression\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-nullish-coalescing-operator\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-optional-chaining\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-json-strings\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-optional-catch-binding\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-async-generators\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-object-rest-spread\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"transform-modules-commonjs\",\"visitor\":{\"CallExpression\":{\"enter\":[null]},\"Program\":{\"exit\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"proposal-dynamic-import\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"Program\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"proposal-export-namespace-from\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"ExportNamedDeclaration\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}}],\"presets\":[]}:7.12.10": {
    "metadata": {},
    "options": {
      "sourceRoot": "/Users/egor/Dev/ytclone/fin/server/src/routes/",
      "caller": {
        "name": "@babel/register"
      },
      "cwd": "/Users/egor/Dev/ytclone/fin",
      "filename": "/Users/egor/Dev/ytclone/fin/server/src/routes/video.js",
      "cloneInputAst": true,
      "babelrc": false,
      "configFile": false,
      "envName": "development",
      "root": "/Users/egor/Dev/ytclone/fin",
      "sourceMaps": "both",
      "ast": false,
      "passPerPreset": false,
      "plugins": [
        {
          "key": "syntax-numeric-separator",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "proposal-logical-assignment-operators",
          "visitor": {
            "_exploded": {},
            "_verified": {},
            "AssignmentExpression": {
              "enter": [
                null
              ]
            }
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-nullish-coalescing-operator",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-optional-chaining",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-json-strings",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-optional-catch-binding",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-async-generators",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-object-rest-spread",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "transform-modules-commonjs",
          "visitor": {
            "CallExpression": {
              "enter": [
                null
              ]
            },
            "Program": {
              "exit": [
                null
              ]
            },
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "proposal-dynamic-import",
          "visitor": {
            "_exploded": {},
            "_verified": {},
            "Program": {
              "enter": [
                null
              ]
            }
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "proposal-export-namespace-from",
          "visitor": {
            "_exploded": {},
            "_verified": {},
            "ExportNamedDeclaration": {
              "enter": [
                null
              ]
            }
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        }
      ],
      "presets": [],
      "parserOpts": {
        "sourceType": "module",
        "sourceFileName": "/Users/egor/Dev/ytclone/fin/server/src/routes/video.js",
        "plugins": [
          "numericSeparator",
          "logicalAssignment",
          "nullishCoalescingOperator",
          "optionalChaining",
          "jsonStrings",
          "optionalCatchBinding",
          "asyncGenerators",
          "objectRestSpread",
          "dynamicImport",
          "exportNamespaceFrom"
        ]
      },
      "generatorOpts": {
        "filename": "/Users/egor/Dev/ytclone/fin/server/src/routes/video.js",
        "comments": true,
        "compact": "auto",
        "sourceMaps": "both",
        "sourceRoot": "/Users/egor/Dev/ytclone/fin/server/src/routes/",
        "sourceFileName": "video.js"
      }
    },
    "ast": null,
    "code": "\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.getVideoViews = getVideoViews;\nexports.getVideoRoutes = getVideoRoutes;\n\nvar _client = require(\"@prisma/client\");\n\nvar _express = _interopRequireDefault(require(\"express\"));\n\nvar _authorization = require(\"../middleware/authorization\");\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nconst prisma = new _client.PrismaClient();\n\nfunction getVideoRoutes() {\n  const router = _express.default.Router();\n\n  router.get(\"/\", getRecommendedVideos);\n  router.post(\"/\", _authorization.protect, addVideo);\n  router.get(\"/trending\", getTrendingVideos);\n  router.get(\"/search\", searchVideos);\n  router.get(\"/:videoId\", _authorization.getAuthUser, getVideo);\n  router.delete(\"/:videoId\", _authorization.protect, deleteVideo);\n  router.get(\"/:videoId/view\", _authorization.getAuthUser, addVideoView);\n  router.get(\"/:videoId/like\", _authorization.protect, likeVideo);\n  router.get(\"/:videoId/dislike\", _authorization.protect, dislikeVideo);\n  router.post(\"/:videoId/comments\", _authorization.protect, addComment);\n  router.delete(\"/:videoId/comments/:commentId\", _authorization.protect, deleteComment);\n  return router;\n}\n\nasync function getVideoViews(videos) {\n  for (const video of videos) {\n    const views = await prisma.view.count({\n      where: {\n        videoId: {\n          equals: video.id\n        }\n      }\n    });\n    video.views = views;\n  }\n\n  return videos;\n}\n\nasync function getRecommendedVideos(req, res) {\n  let videos = await prisma.video.findMany({\n    include: {\n      user: true\n    },\n    orderBy: {\n      createdAt: \"desc\"\n    }\n  });\n\n  if (!videos.length) {\n    return res.status(200).json({\n      videos\n    });\n  }\n\n  videos = await getVideoViews(videos);\n  res.status(200).json({\n    videos\n  });\n}\n\nasync function getTrendingVideos(req, res) {\n  let videos = await prisma.video.findMany({\n    include: {\n      user: true\n    },\n    orderBy: {\n      createdAt: \"desc\"\n    }\n  });\n\n  if (!videos.length) {\n    return res.status(200).json({\n      videos\n    });\n  }\n\n  videos = await getVideoViews(videos);\n  videos.sort((a, b) => b.views - a.views);\n  res.status(200).json({\n    videos\n  });\n}\n\nasync function searchVideos(req, res, next) {\n  if (!req.query.query) {\n    return next({\n      message: \"Please enter a search query\",\n      statusCode: 400\n    });\n  }\n\n  let videos = await prisma.video.findMany({\n    include: {\n      user: true\n    },\n    where: {\n      OR: [{\n        title: {\n          contains: req.query.query,\n          mode: \"insensitive\"\n        }\n      }, {\n        description: {\n          contains: req.query.query,\n          mode: \"insensitive\"\n        }\n      }]\n    }\n  });\n\n  if (!videos.length) {\n    return res.status(200).json({\n      videos\n    });\n  }\n\n  videos = await getVideoViews(videos);\n  res.status(200).json({\n    videos\n  });\n}\n\nasync function addVideo(req, res) {\n  const {\n    title,\n    description,\n    url,\n    thumbnail\n  } = req.body;\n  const video = await prisma.video.create({\n    data: {\n      title,\n      description,\n      url,\n      thumbnail,\n      user: {\n        connect: {\n          id: req.user.id\n        }\n      }\n    }\n  });\n  res.status(200).json({\n    video\n  });\n}\n\nasync function addComment(req, res, next) {\n  const video = await prisma.video.findUnique({\n    where: {\n      id: req.params.videoId\n    }\n  });\n\n  if (!video) {\n    return next({\n      message: `No video found with id: \"${req.params.videoId}\"`,\n      statusCode: 404\n    });\n  }\n\n  const comment = await prisma.comment.create({\n    data: {\n      text: req.body.text,\n      user: {\n        connect: {\n          id: req.user.id\n        }\n      },\n      video: {\n        connect: {\n          id: req.params.videoId\n        }\n      }\n    }\n  });\n  res.status(200).json({\n    comment\n  });\n}\n\nasync function deleteComment(req, res) {\n  const comment = await prisma.comment.findUnique({\n    where: {\n      id: req.params.commentId\n    },\n    select: {\n      userId: true\n    }\n  });\n\n  if (comment.userId !== req.user.id) {\n    return res.status(401).send(\"You are not authorized to delete this comment\");\n  }\n\n  await prisma.comment.delete({\n    where: {\n      id: req.params.commentId\n    }\n  });\n  res.status(200).json({});\n}\n\nasync function addVideoView(req, res, next) {\n  const video = await prisma.video.findUnique({\n    where: {\n      id: req.params.videoId\n    }\n  });\n\n  if (!video) {\n    return next({\n      message: `No video found with id: \"${req.params.videoId}\"`,\n      statusCode: 404\n    });\n  }\n\n  if (req.user) {\n    await prisma.view.create({\n      data: {\n        video: {\n          connect: {\n            id: req.params.videoId\n          }\n        },\n        user: {\n          connect: {\n            id: req.user.id\n          }\n        }\n      }\n    });\n  } else {\n    await prisma.view.create({\n      data: {\n        video: {\n          connect: {\n            id: req.params.videoId\n          }\n        }\n      }\n    });\n  }\n\n  res.status(200).json({});\n}\n\nasync function likeVideo(req, res, next) {\n  const video = await prisma.video.findUnique({\n    where: {\n      id: req.params.videoId\n    }\n  });\n\n  if (!video) {\n    return next({\n      message: `No video found with id: \"${req.params.videoId}\"`,\n      statusCode: 404\n    });\n  }\n\n  const isLiked = await prisma.videoLike.findFirst({\n    where: {\n      userId: {\n        equals: req.user.id\n      },\n      videoId: {\n        equals: req.params.videoId\n      },\n      like: {\n        equals: 1\n      }\n    }\n  });\n  const isDisliked = await prisma.videoLike.findFirst({\n    where: {\n      userId: {\n        equals: req.user.id\n      },\n      videoId: {\n        equals: req.params.videoId\n      },\n      like: {\n        equals: -1\n      }\n    }\n  });\n\n  if (isLiked) {\n    await prisma.videoLike.delete({\n      where: {\n        id: isLiked.id\n      }\n    });\n  } else if (isDisliked) {\n    await prisma.videoLike.update({\n      where: {\n        id: isDisliked.id\n      },\n      data: {\n        like: 1\n      }\n    });\n  } else {\n    await prisma.videoLike.create({\n      data: {\n        user: {\n          connect: {\n            id: req.user.id\n          }\n        },\n        video: {\n          connect: {\n            id: req.params.videoId\n          }\n        },\n        like: 1\n      }\n    });\n  }\n\n  res.status(200).json({});\n}\n\nasync function dislikeVideo(req, res, next) {\n  const video = await prisma.video.findUnique({\n    where: {\n      id: req.params.videoId\n    }\n  });\n\n  if (!video) {\n    return next({\n      message: `No video found with id: \"${req.params.videoId}\"`,\n      statusCode: 404\n    });\n  }\n\n  const isLiked = await prisma.videoLike.findFirst({\n    where: {\n      userId: {\n        equals: req.user.id\n      },\n      videoId: {\n        equals: req.params.videoId\n      },\n      like: {\n        equals: 1\n      }\n    }\n  });\n  const isDisliked = await prisma.videoLike.findFirst({\n    where: {\n      userId: {\n        equals: req.user.id\n      },\n      videoId: {\n        equals: req.params.videoId\n      },\n      like: {\n        equals: -1\n      }\n    }\n  });\n\n  if (isDisliked) {\n    await prisma.videoLike.delete({\n      where: {\n        id: isDisliked.id\n      }\n    });\n  } else if (isLiked) {\n    await prisma.videoLike.update({\n      where: {\n        id: isLiked.id\n      },\n      data: {\n        like: -1\n      }\n    });\n  } else {\n    await prisma.videoLike.create({\n      data: {\n        user: {\n          connect: {\n            id: req.user.id\n          }\n        },\n        video: {\n          connect: {\n            id: req.params.videoId\n          }\n        },\n        like: -1\n      }\n    });\n  }\n\n  res.status(200).json({});\n}\n\nasync function getVideo(req, res, next) {\n  const video = await prisma.video.findUnique({\n    where: {\n      id: req.params.videoId\n    },\n    include: {\n      user: true,\n      comments: {\n        include: {\n          user: true\n        },\n        orderBy: {\n          createdAt: \"desc\"\n        }\n      }\n    }\n  });\n\n  if (!video) {\n    return next({\n      message: `No video found with id: \"${req.params.videoId}\"`,\n      statusCode: 404\n    });\n  }\n\n  let isVideoMine = false;\n  let isLiked = false;\n  let isDisliked = false;\n  let isSubscribed = false;\n  let isViewed = false;\n\n  if (req.user) {\n    isVideoMine = req.user.id === video.userId;\n    isLiked = await prisma.videoLike.findFirst({\n      where: {\n        userId: {\n          equals: req.user.id\n        },\n        videoId: {\n          equals: req.params.videoId\n        },\n        like: {\n          equals: 1\n        }\n      }\n    });\n    isDisliked = await prisma.videoLike.findFirst({\n      where: {\n        userId: {\n          equals: req.user.id\n        },\n        videoId: {\n          equals: req.params.videoId\n        },\n        like: {\n          equals: -1\n        }\n      }\n    });\n    isViewed = await prisma.view.findFirst({\n      where: {\n        userId: {\n          equals: req.user.id\n        },\n        videoId: {\n          equals: video.id\n        }\n      }\n    });\n    isSubscribed = await prisma.subscription.findFirst({\n      where: {\n        subscriberId: {\n          equals: req.user.id\n        },\n        subscribedToId: {\n          equals: video.userId\n        }\n      }\n    });\n  }\n\n  const likesCount = await prisma.videoLike.count({\n    where: {\n      AND: {\n        videoId: {\n          equals: req.params.videoId\n        },\n        like: {\n          equals: 1\n        }\n      }\n    }\n  });\n  const dislikesCount = await prisma.videoLike.count({\n    where: {\n      AND: {\n        videoId: {\n          equals: req.params.videoId\n        },\n        like: {\n          equals: -1\n        }\n      }\n    }\n  });\n  const views = await prisma.view.count({\n    where: {\n      videoId: {\n        equals: video.id\n      }\n    }\n  });\n  const subscribersCount = await prisma.subscription.count({\n    where: {\n      subscribedToId: {\n        equals: video.userId\n      }\n    }\n  });\n  video.commentsCount = video.comments.length;\n  video.isLiked = Boolean(isLiked);\n  video.isDisliked = Boolean(isDisliked);\n  video.likesCount = likesCount;\n  video.dislikesCount = dislikesCount;\n  video.isVideoMine = isVideoMine;\n  video.views = views;\n  video.isSubscribed = Boolean(isSubscribed);\n  video.isViewed = Boolean(isViewed);\n  video.subscribersCount = subscribersCount;\n  res.status(200).json({\n    video\n  });\n}\n\nasync function deleteVideo(req, res) {\n  const video = await prisma.video.findUnique({\n    where: {\n      id: req.params.videoId\n    },\n    select: {\n      userId: true\n    }\n  });\n\n  if (req.user.id !== video.userId) {\n    return res.status(401).send(\"You are not authorized to delete this video\");\n  }\n\n  await prisma.view.deleteMany({\n    where: {\n      videoId: {\n        equals: req.params.videoId\n      }\n    }\n  });\n  await prisma.videoLike.deleteMany({\n    where: {\n      videoId: {\n        equals: req.params.videoId\n      }\n    }\n  });\n  await prisma.comment.deleteMany({\n    where: {\n      videoId: {\n        equals: req.params.videoId\n      }\n    }\n  });\n  await prisma.video.delete({\n    where: {\n      id: req.params.videoId\n    }\n  });\n  res.status(200).json({});\n}\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInZpZGVvLmpzIl0sIm5hbWVzIjpbInByaXNtYSIsIlByaXNtYUNsaWVudCIsImdldFZpZGVvUm91dGVzIiwicm91dGVyIiwiZXhwcmVzcyIsIlJvdXRlciIsImdldCIsImdldFJlY29tbWVuZGVkVmlkZW9zIiwicG9zdCIsInByb3RlY3QiLCJhZGRWaWRlbyIsImdldFRyZW5kaW5nVmlkZW9zIiwic2VhcmNoVmlkZW9zIiwiZ2V0QXV0aFVzZXIiLCJnZXRWaWRlbyIsImRlbGV0ZSIsImRlbGV0ZVZpZGVvIiwiYWRkVmlkZW9WaWV3IiwibGlrZVZpZGVvIiwiZGlzbGlrZVZpZGVvIiwiYWRkQ29tbWVudCIsImRlbGV0ZUNvbW1lbnQiLCJnZXRWaWRlb1ZpZXdzIiwidmlkZW9zIiwidmlkZW8iLCJ2aWV3cyIsInZpZXciLCJjb3VudCIsIndoZXJlIiwidmlkZW9JZCIsImVxdWFscyIsImlkIiwicmVxIiwicmVzIiwiZmluZE1hbnkiLCJpbmNsdWRlIiwidXNlciIsIm9yZGVyQnkiLCJjcmVhdGVkQXQiLCJsZW5ndGgiLCJzdGF0dXMiLCJqc29uIiwic29ydCIsImEiLCJiIiwibmV4dCIsInF1ZXJ5IiwibWVzc2FnZSIsInN0YXR1c0NvZGUiLCJPUiIsInRpdGxlIiwiY29udGFpbnMiLCJtb2RlIiwiZGVzY3JpcHRpb24iLCJ1cmwiLCJ0aHVtYm5haWwiLCJib2R5IiwiY3JlYXRlIiwiZGF0YSIsImNvbm5lY3QiLCJmaW5kVW5pcXVlIiwicGFyYW1zIiwiY29tbWVudCIsInRleHQiLCJjb21tZW50SWQiLCJzZWxlY3QiLCJ1c2VySWQiLCJzZW5kIiwiaXNMaWtlZCIsInZpZGVvTGlrZSIsImZpbmRGaXJzdCIsImxpa2UiLCJpc0Rpc2xpa2VkIiwidXBkYXRlIiwiY29tbWVudHMiLCJpc1ZpZGVvTWluZSIsImlzU3Vic2NyaWJlZCIsImlzVmlld2VkIiwic3Vic2NyaXB0aW9uIiwic3Vic2NyaWJlcklkIiwic3Vic2NyaWJlZFRvSWQiLCJsaWtlc0NvdW50IiwiQU5EIiwiZGlzbGlrZXNDb3VudCIsInN1YnNjcmliZXJzQ291bnQiLCJjb21tZW50c0NvdW50IiwiQm9vbGVhbiIsImRlbGV0ZU1hbnkiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBQUE7O0FBQ0E7O0FBQ0E7Ozs7QUFFQSxNQUFNQSxNQUFNLEdBQUcsSUFBSUMsb0JBQUosRUFBZjs7QUFFQSxTQUFTQyxjQUFULEdBQTBCO0FBQ3hCLFFBQU1DLE1BQU0sR0FBR0MsaUJBQVFDLE1BQVIsRUFBZjs7QUFFQUYsRUFBQUEsTUFBTSxDQUFDRyxHQUFQLENBQVcsR0FBWCxFQUFnQkMsb0JBQWhCO0FBQ0FKLEVBQUFBLE1BQU0sQ0FBQ0ssSUFBUCxDQUFZLEdBQVosRUFBaUJDLHNCQUFqQixFQUEwQkMsUUFBMUI7QUFFQVAsRUFBQUEsTUFBTSxDQUFDRyxHQUFQLENBQVcsV0FBWCxFQUF3QkssaUJBQXhCO0FBQ0FSLEVBQUFBLE1BQU0sQ0FBQ0csR0FBUCxDQUFXLFNBQVgsRUFBc0JNLFlBQXRCO0FBRUFULEVBQUFBLE1BQU0sQ0FBQ0csR0FBUCxDQUFXLFdBQVgsRUFBd0JPLDBCQUF4QixFQUFxQ0MsUUFBckM7QUFDQVgsRUFBQUEsTUFBTSxDQUFDWSxNQUFQLENBQWMsV0FBZCxFQUEyQk4sc0JBQTNCLEVBQW9DTyxXQUFwQztBQUVBYixFQUFBQSxNQUFNLENBQUNHLEdBQVAsQ0FBVyxnQkFBWCxFQUE2Qk8sMEJBQTdCLEVBQTBDSSxZQUExQztBQUNBZCxFQUFBQSxNQUFNLENBQUNHLEdBQVAsQ0FBVyxnQkFBWCxFQUE2Qkcsc0JBQTdCLEVBQXNDUyxTQUF0QztBQUNBZixFQUFBQSxNQUFNLENBQUNHLEdBQVAsQ0FBVyxtQkFBWCxFQUFnQ0csc0JBQWhDLEVBQXlDVSxZQUF6QztBQUNBaEIsRUFBQUEsTUFBTSxDQUFDSyxJQUFQLENBQVksb0JBQVosRUFBa0NDLHNCQUFsQyxFQUEyQ1csVUFBM0M7QUFDQWpCLEVBQUFBLE1BQU0sQ0FBQ1ksTUFBUCxDQUFjLCtCQUFkLEVBQStDTixzQkFBL0MsRUFBd0RZLGFB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QixHQUFwQixDQUFOO0FBTUFJLEVBQUFBLEdBQUcsQ0FBQ08sTUFBSixDQUFXLEdBQVgsRUFBZ0JDLElBQWhCLENBQXFCLEVBQXJCO0FBQ0QiLCJzb3VyY2VSb290IjoiL1VzZXJzL2Vnb3IvRGV2L3l0Y2xvbmUvZmluL3NlcnZlci9zcmMvcm91dGVzLyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFByaXNtYUNsaWVudCB9IGZyb20gXCJAcHJpc21hL2NsaWVudFwiO1xuaW1wb3J0IGV4cHJlc3MgZnJvbSBcImV4cHJlc3NcIjtcbmltcG9ydCB7IGdldEF1dGhVc2VyLCBwcm90ZWN0IH0gZnJvbSBcIi4uL21pZGRsZXdhcmUvYXV0aG9yaXphdGlvblwiO1xuXG5jb25zdCBwcmlzbWEgPSBuZXcgUHJpc21hQ2xpZW50KCk7XG5cbmZ1bmN0aW9uIGdldFZpZGVvUm91dGVzKCkge1xuICBjb25zdCByb3V0ZXIgPSBleHByZXNzLlJvdXRlcigpO1xuXG4gIHJvdXRlci5nZXQoXCIvXCIsIGdldFJlY29tbWVuZGVkVmlkZW9zKTtcbiAgcm91dGVyLnBvc3QoXCIvXCIsIHByb3RlY3QsIGFkZFZpZGVvKTtcblxuICByb3V0ZXIuZ2V0KFwiL3RyZW5kaW5nXCIsIGdldFRyZW5kaW5nVmlkZW9zKTtcbiAgcm91dGVyLmdldChcIi9zZWFyY2hcIiwgc2VhcmNoVmlkZW9zKTtcblxuICByb3V0ZXIuZ2V0KFwiLzp2aWRlb0lkXCIsIGdldEF1dGhVc2VyLCBnZXRWaWRlbyk7XG4gIHJvdXRlci5kZWxldGUoXCIvOnZpZGVvSWRcIiwgcHJvdGVjdCwgZGVsZXRlVmlkZW8pO1xuXG4gIHJvdXRlci5nZXQoXCIvOnZpZGVvSWQvdmlld1wiLCBnZXRBdXRoVXNlciwgYWRkVmlkZW9WaWV3KTtcbiAgcm91dGVyLmdldChcIi86dmlkZW9JZC9saWtlXCIsIHByb3RlY3QsIGxpa2VWaWRlbyk7XG4gIHJvdXRlci5nZXQoXCIvOnZpZGVvSWQvZGlzbGlrZVwiLCBwcm90ZWN0LCBkaXNsaWtlVmlkZW8pO1xuICByb3V0ZXIucG9zdChcIi86dmlkZW9JZC9jb21tZW50c1wiLCBwcm90ZWN0LCBhZGRDb21tZW50KTtcbiAgcm91dGVyLmRlbGV0ZShcIi86dmlkZW9JZC9jb21tZW50cy86Y29tbWVudElkXCIsIHByb3RlY3QsIGRlbGV0ZUNvbW1lbnQpO1xuXG4gIHJldHVybiByb3V0ZXI7XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRWaWRlb1ZpZXdzKHZpZGVvcykge1xuICBmb3IgKGNvbnN0IHZpZGVvIG9mIHZpZGVvcykge1xuICAgIGNvbnN0IHZpZXdzID0gYXdhaXQgcHJpc21hLnZpZXcuY291bnQoe1xuICAgICAgd2hlcmU6IHtcbiAgICAgICAgdmlkZW9JZDoge1xuICAgICAgICAgIGVxdWFsczogdmlkZW8uaWQsXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgIH0pO1xuICAgIHZpZGVvLnZpZXdzID0gdmlld3M7XG4gIH1cbiAgcmV0dXJuIHZpZGVvcztcbn1cblxuYXN5bmMgZnVuY3Rpb24gZ2V0UmVjb21tZW5kZWRWaWRlb3MocmVxLCByZXMpIHtcbiAgbGV0IHZpZGVvcyA9IGF3YWl0IHByaXNtYS52aWRlby5maW5kTWFueSh7XG4gICAgaW5jbHVkZToge1xuICAgICAgdXNlcjogdHJ1ZSxcbiAgICB9LFxuICAgIG9yZGVyQnk6IHtcbiAgICAgIGNyZWF0ZWRBdDogXCJkZXNjXCIsXG4gICAgfSxcbiAgfSk7XG5cbiAgaWYgKCF2aWRlb3MubGVuZ3RoKSB7XG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoMjAwKS5qc29uKHsgdmlkZW9zIH0pO1xuICB9XG5cbiAgdmlkZW9zID0gYXdhaXQgZ2V0VmlkZW9WaWV3cyh2aWRlb3MpO1xuXG4gIHJlcy5zdGF0dXMoMjAwKS5qc29uKHsgdmlkZW9zIH0pO1xufVxuXG5hc3luYyBmdW5jdGlvbiBnZXRUcmVuZGluZ1ZpZGVvcyhyZXEsIHJlcykge1xuICBsZXQgdmlkZW9zID0gYXdhaXQgcHJpc21hLnZpZGVvLmZpbmRNYW55KHtcbiAgICBpbmNsdWRlOiB7XG4gICAgICB1c2VyOiB0cnVlLFxuICAgIH0sXG4gICAgb3JkZXJCeToge1xuICAgICAgY3JlYXRlZEF0OiBcImRlc2NcIixcbiAgICB9LFxuICB9KTtcblxuICBpZiAoIXZpZGVvcy5sZW5ndGgpIHtcbiAgICByZXR1cm4gcmVzLnN0YXR1cygyMDApLmpzb24oeyB2aWRlb3MgfSk7XG4gIH1cblxuICB2aWRlb3MgPSBhd2FpdCBnZXRWaWRlb1ZpZXdzKHZpZGVvcyk7XG4gIHZpZGVvcy5zb3J0KChhLCBiKSA9PiBiLnZpZXdzIC0gYS52aWV3cyk7XG5cbiAgcmVzLnN0YXR1cygyMDApLmpzb24oeyB2aWRlb3MgfSk7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIHNlYXJjaFZpZGVvcyhyZXEsIHJlcywgbmV4dCkge1xuICBpZiAoIXJlcS5xdWVyeS5xdWVyeSkge1xuICAgIHJldHVybiBuZXh0KHtcbiAgICAgIG1lc3NhZ2U6IFwiUGxlYXNlIGVudGVyIGEgc2VhcmNoIHF1ZXJ5XCIsXG4gICAgICBzdGF0dXNDb2RlOiA0MDAsXG4gICAgfSk7XG4gIH1cblxuICBsZXQgdmlkZW9zID0gYXdhaXQgcHJpc21hLnZpZGVvLmZpbmRNYW55KHtcbiAgICBpbmNsdWRlOiB7XG4gICAgICB1c2VyOiB0cnVlLFxuICAgIH0sXG4gICAgd2hlcmU6IHtcbiAgICAgIE9SOiBbXG4gICAgICAgIHtcbiAgICAgICAgICB0aXRsZToge1xuICAgICAgICAgICAgY29udGFpbnM6IHJlcS5xdWVyeS5xdWVyeSxcbiAgICAgICAgICAgIG1vZGU6IFwiaW5zZW5zaXRpdmVcIixcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgZGVzY3JpcHRpb246IHtcbiAgICAgICAgICAgIGNvbnRhaW5zOiByZXEucXVlcnkucXVlcnksXG4gICAgICAgICAgICBtb2RlOiBcImluc2Vuc2l0aXZlXCIsXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgIF0sXG4gICAgfSxcbiAgfSk7XG5cbiAgaWYgKCF2aWRlb3MubGVuZ3RoKSB7XG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoMjAwKS5qc29uKHsgdmlkZW9zIH0pO1xuICB9XG5cbiAgdmlkZW9zID0gYXdhaXQgZ2V0VmlkZW9WaWV3cyh2aWRlb3MpO1xuXG4gIHJlcy5zdGF0dXMoMjAwKS5qc29uKHsgdmlkZW9zIH0pO1xufVxuXG5hc3luYyBmdW5jdGlvbiBhZGRWaWRlbyhyZXEsIHJlcykge1xuICBjb25zdCB7IHRpdGxlLCBkZXNjcmlwdGlvbiwgdXJsLCB0aHVtYm5haWwgfSA9IHJlcS5ib2R5O1xuXG4gIGNvbnN0IHZpZGVvID0gYXdhaXQgcHJpc21hLnZpZGVvLmNyZWF0ZSh7XG4gICAgZGF0YToge1xuICAgICAgdGl0bGUsXG4gICAgICBkZXNjcmlwdGlvbixcbiAgICAgIHVybCxcbiAgICAgIHRodW1ibmFpbCxcbiAgICAgIHVzZXI6IHtcbiAgICAgICAgY29ubmVjdDoge1xuICAgICAgICAgIGlkOiByZXEudXNlci5pZCxcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgfSxcbiAgfSk7XG5cbiAgcmVzLnN0YXR1cygyMDApLmpzb24oeyB2aWRlbyB9KTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gYWRkQ29tbWVudChyZXEsIHJlcywgbmV4dCkge1xuICBjb25zdCB2aWRlbyA9IGF3YWl0IHByaXNtYS52aWRlby5maW5kVW5pcXVlKHtcbiAgICB3aGVyZToge1xuICAgICAgaWQ6IHJlcS5wYXJhbXMudmlkZW9JZCxcbiAgICB9LFxuICB9KTtcblxuICBpZiAoIXZpZGVvKSB7XG4gICAgcmV0dXJuIG5leHQoe1xuICAgICAgbWVzc2FnZTogYE5vIHZpZGVvIGZvdW5kIHdpdGggaWQ6IFwiJHtyZXEucGFyYW1zLnZpZGVvSWR9XCJgLFxuICAgICAgc3RhdHVzQ29kZTogNDA0LFxuICAgIH0pO1xuICB9XG5cbiAgY29uc3QgY29tbWVudCA9IGF3YWl0IHByaXNtYS5jb21tZW50LmNyZWF0ZSh7XG4gICAgZGF0YToge1xuICAgICAgdGV4dDogcmVxLmJvZHkudGV4dCxcbiAgICAgIHVzZXI6IHtcbiAgICAgICAgY29ubmVjdDoge1xuICAgICAgICAgIGlkOiByZXEudXNlci5pZCxcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgICB2aWRlbzoge1xuICAgICAgICBjb25uZWN0OiB7XG4gICAgICAgICAgaWQ6IHJlcS5wYXJhbXMudmlkZW9JZCxcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgfSxcbiAgfSk7XG5cbiAgcmVzLnN0YXR1cygyMDApLmpzb24oeyBjb21tZW50IH0pO1xufVxuXG5hc3luYyBmdW5jdGlvbiBkZWxldGVDb21tZW50KHJlcSwgcmVzKSB7XG4gIGNvbnN0IGNvbW1lbnQgPSBhd2FpdCBwcmlzbWEuY29tbWVudC5maW5kVW5pcXVlKHtcbiAgICB3aGVyZToge1xuICAgICAgaWQ6IHJlcS5wYXJhbXMuY29tbWVudElkLFxuICAgIH0sXG4gICAgc2VsZWN0OiB7XG4gICAgICB1c2VySWQ6IHRydWUsXG4gICAgfSxcbiAgfSk7XG5cbiAgaWYgKGNvbW1lbnQudXNlcklkICE9PSByZXEudXNlci5pZCkge1xuICAgIHJldHVybiByZXNcbiAgICAgIC5zdGF0dXMoNDAxKVxuICAgICAgLnNlbmQoXCJZb3UgYXJlIG5vdCBhdXRob3JpemVkIHRvIGRlbGV0ZSB0aGlzIGNvbW1lbnRcIik7XG4gIH1cblxuICBhd2FpdCBwcmlzbWEuY29tbWVudC5kZWxldGUoe1xuICAgIHdoZXJlOiB7XG4gICAgICBpZDogcmVxLnBhcmFtcy5jb21tZW50SWQsXG4gICAgfSxcbiAgfSk7XG5cbiAgcmVzLnN0YXR1cygyMDApLmpzb24oe30pO1xufVxuXG5hc3luYyBmdW5jdGlvbiBhZGRWaWRlb1ZpZXcocmVxLCByZXMsIG5leHQpIHtcbiAgY29uc3QgdmlkZW8gPSBhd2FpdCBwcmlzbWEudmlkZW8uZmluZFVuaXF1ZSh7XG4gICAgd2hlcmU6IHtcbiAgICAgIGlkOiByZXEucGFyYW1zLnZpZGVvSWQsXG4gICAgfSxcbiAgfSk7XG5cbiAgaWYgKCF2aWRlbykge1xuICAgIHJldHVybiBuZXh0KHtcbiAgICAgIG1lc3NhZ2U6IGBObyB2aWRlbyBmb3VuZCB3aXRoIGlkOiBcIiR7cmVxLnBhcmFtcy52aWRlb0lkfVwiYCxcbiAgICAgIHN0YXR1c0NvZGU6IDQwNCxcbiAgICB9KTtcbiAgfVxuXG4gIGlmIChyZXEudXNlcikge1xuICAgIGF3YWl0IHByaXNtYS52aWV3LmNyZWF0ZSh7XG4gICAgICBkYXRhOiB7XG4gICAgICAgIHZpZGVvOiB7XG4gICAgICAgICAgY29ubmVjdDoge1xuICAgICAgICAgICAgaWQ6IHJlcS5wYXJhbXMudmlkZW9JZCxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB1c2VyOiB7XG4gICAgICAgICAgY29ubmVjdDoge1xuICAgICAgICAgICAgaWQ6IHJlcS51c2VyLmlkLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgIH0pO1xuICB9IGVsc2Uge1xuICAgIGF3YWl0IHByaXNtYS52aWV3LmNyZWF0ZSh7XG4gICAgICBkYXRhOiB7XG4gICAgICAgIHZpZGVvOiB7XG4gICAgICAgICAgY29ubmVjdDoge1xuICAgICAgICAgICAgaWQ6IHJlcS5wYXJhbXMudmlkZW9JZCxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgfSxcbiAgICB9KTtcbiAgfVxuXG4gIHJlcy5zdGF0dXMoMjAwKS5qc29uKHt9KTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gbGlrZVZpZGVvKHJlcSwgcmVzLCBuZXh0KSB7XG4gIGNvbnN0IHZpZGVvID0gYXdhaXQgcHJpc21hLnZpZGVvLmZpbmRVbmlxdWUoe1xuICAgIHdoZXJlOiB7XG4gICAgICBpZDogcmVxLnBhcmFtcy52aWRlb0lkLFxuICAgIH0sXG4gIH0pO1xuXG4gIGlmICghdmlkZW8pIHtcbiAgICByZXR1cm4gbmV4dCh7XG4gICAgICBtZXNzYWdlOiBgTm8gdmlkZW8gZm91bmQgd2l0aCBpZDogXCIke3JlcS5wYXJhbXMudmlkZW9JZH1cImAsXG4gICAgICBzdGF0dXNDb2RlOiA0MDQsXG4gICAgfSk7XG4gIH1cblxuICBjb25zdCBpc0xpa2VkID0gYXdhaXQgcHJpc21hLnZpZGVvTGlrZS5maW5kRmlyc3Qoe1xuICAgIHdoZXJlOiB7XG4gICAgICB1c2VySWQ6IHtcbiAgICAgICAgZXF1YWxzOiByZXEudXNlci5pZCxcbiAgICAgIH0sXG4gICAgICB2aWRlb0lkOiB7XG4gICAgICAgIGVxdWFsczogcmVxLnBhcmFtcy52aWRlb0lkLFxuICAgICAgfSxcbiAgICAgIGxpa2U6IHtcbiAgICAgICAgZXF1YWxzOiAxLFxuICAgICAgfSxcbiAgICB9LFxuICB9KTtcblxuICBjb25zdCBpc0Rpc2xpa2VkID0gYXdhaXQgcHJpc21hLnZpZGVvTGlrZS5maW5kRmlyc3Qoe1xuICAgIHdoZXJlOiB7XG4gICAgICB1c2VySWQ6IHtcbiAgICAgICAgZXF1YWxzOiByZXEudXNlci5pZCxcbiAgICAgIH0sXG4gICAgICB2aWRlb0lkOiB7XG4gICAgICAgIGVxdWFsczogcmVxLnBhcmFtcy52aWRlb0lkLFxuICAgICAgfSxcbiAgICAgIGxpa2U6IHtcbiAgICAgICAgZXF1YWxzOiAtMSxcbiAgICAgIH0sXG4gICAgfSxcbiAgfSk7XG5cbiAgaWYgKGlzTGlrZWQpIHtcbiAgICBhd2FpdCBwcmlzbWEudmlkZW9MaWtlLmRlbGV0ZSh7XG4gICAgICB3aGVyZToge1xuICAgICAgICBpZDogaXNMaWtlZC5pZCxcbiAgICAgIH0sXG4gICAgfSk7XG4gIH0gZWxzZSBpZiAoaXNEaXNsaWtlZCkge1xuICAgIGF3YWl0IHByaXNtYS52aWRlb0xpa2UudXBkYXRlKHtcbiAgICAgIHdoZXJlOiB7XG4gICAgICAgIGlkOiBpc0Rpc2xpa2VkLmlkLFxuICAgICAgfSxcbiAgICAgIGRhdGE6IHtcbiAgICAgICAgbGlrZTogMSxcbiAgICAgIH0sXG4gICAgfSk7XG4gIH0gZWxzZSB7XG4gICAgYXdhaXQgcHJpc21hLnZpZGVvTGlrZS5jcmVhdGUoe1xuICAgICAgZGF0YToge1xuICAgICAgICB1c2VyOiB7XG4gICAgICAgICAgY29ubmVjdDoge1xuICAgICAgICAgICAgaWQ6IHJlcS51c2VyLmlkLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHZpZGVvOiB7XG4gICAgICAgICAgY29ubmVjdDoge1xuICAgICAgICAgICAgaWQ6IHJlcS5wYXJhbXMudmlkZW9JZCxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICBsaWtlOiAxLFxuICAgICAgfSxcbiAgICB9KTtcbiAgfVxuXG4gIHJlcy5zdGF0dXMoMjAwKS5qc29uKHt9KTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gZGlzbGlrZVZpZGVvKHJlcSwgcmVzLCBuZXh0KSB7XG4gIGNvbnN0IHZpZGVvID0gYXdhaXQgcHJpc21hLnZpZGVvLmZpbmRVbmlxdWUoe1xuICAgIHdoZXJlOiB7XG4gICAgICBpZDogcmVxLnBhcmFtcy52aWRlb0lkLFxuICAgIH0sXG4gIH0pO1xuXG4gIGlmICghdmlkZW8pIHtcbiAgICByZXR1cm4gbmV4dCh7XG4gICAgICBtZXNzYWdlOiBgTm8gdmlkZW8gZm91bmQgd2l0aCBpZDogXCIke3JlcS5wYXJhbXMudmlkZW9JZH1cImAsXG4gICAgICBzdGF0dXNDb2RlOiA0MDQsXG4gICAgfSk7XG4gIH1cblxuICBjb25zdCBpc0xpa2VkID0gYXdhaXQgcHJpc21hLnZpZGVvTGlrZS5maW5kRmlyc3Qoe1xuICAgIHdoZXJlOiB7XG4gICAgICB1c2VySWQ6IHtcbiAgICAgICAgZXF1YWxzOiByZXEudXNlci5pZCxcbiAgICAgIH0sXG4gICAgICB2aWRlb0lkOiB7XG4gICAgICAgIGVxdWFsczogcmVxLnBhcmFtcy52aWRlb0lkLFxuICAgICAgfSxcbiAgICAgIGxpa2U6IHtcbiAgICAgICAgZXF1YWxzOiAxLFxuICAgICAgfSxcbiAgICB9LFxuICB9KTtcblxuICBjb25zdCBpc0Rpc2xpa2VkID0gYXdhaXQgcHJpc21hLnZpZGVvTGlrZS5maW5kRmlyc3Qoe1xuICAgIHdoZXJlOiB7XG4gICAgICB1c2VySWQ6IHtcbiAgICAgICAgZXF1YWxzOiByZXEudXNlci5pZCxcbiAgICAgIH0sXG4gICAgICB2aWRlb0lkOiB7XG4gICAgICAgIGVxdWFsczogcmVxLnBhcmFtcy52aWRlb0lkLFxuICAgICAgfSxcbiAgICAgIGxpa2U6IHtcbiAgICAgICAgZXF1YWxzOiAtMSxcbiAgICAgIH0sXG4gICAgfSxcbiAgfSk7XG5cbiAgaWYgKGlzRGlzbGlrZWQpIHtcbiAgICBhd2FpdCBwcmlzbWEudmlkZW9MaWtlLmRlbGV0ZSh7XG4gICAgICB3aGVyZToge1xuICAgICAgICBpZDogaXNEaXNsaWtlZC5pZCxcbiAgICAgIH0sXG4gICAgfSk7XG4gIH0gZWxzZSBpZiAoaXNMaWtlZCkge1xuICAgIGF3YWl0IHByaXNtYS52aWRlb0xpa2UudXBkYXRlKHtcbiAgICAgIHdoZXJlOiB7XG4gICAgICAgIGlkOiBpc0xpa2VkLmlkLFxuICAgICAgfSxcbiAgICAgIGRhdGE6IHtcbiAgICAgICAgbGlrZTogLTEsXG4gICAgICB9LFxuICAgIH0pO1xuICB9IGVsc2Uge1xuICAgIGF3YWl0IHByaXNtYS52aWRlb0xpa2UuY3JlYXRlKHtcbiAgICAgIGRhdGE6IHtcbiAgICAgICAgdXNlcjoge1xuICAgICAgICAgIGNvbm5lY3Q6IHtcbiAgICAgICAgICAgIGlkOiByZXEudXNlci5pZCxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB2aWRlbzoge1xuICAgICAgICAgIGNvbm5lY3Q6IHtcbiAgICAgICAgICAgIGlkOiByZXEucGFyYW1zLnZpZGVvSWQsXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAgbGlrZTogLTEsXG4gICAgICB9LFxuICAgIH0pO1xuICB9XG5cbiAgcmVzLnN0YXR1cygyMDApLmpzb24oe30pO1xufVxuXG5hc3luYyBmdW5jdGlvbiBnZXRWaWRlbyhyZXEsIHJlcywgbmV4dCkge1xuICBjb25zdCB2aWRlbyA9IGF3YWl0IHByaXNtYS52aWRlby5maW5kVW5pcXVlKHtcbiAgICB3aGVyZToge1xuICAgICAgaWQ6IHJlcS5wYXJhbXMudmlkZW9JZCxcbiAgICB9LFxuICAgIGluY2x1ZGU6IHtcbiAgICAgIHVzZXI6IHRydWUsXG4gICAgICBjb21tZW50czoge1xuICAgICAgICBpbmNsdWRlOiB7XG4gICAgICAgICAgdXNlcjogdHJ1ZSxcbiAgICAgICAgfSxcbiAgICAgICAgb3JkZXJCeToge1xuICAgICAgICAgIGNyZWF0ZWRBdDogXCJkZXNjXCIsXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgIH0sXG4gIH0pO1xuXG4gIGlmICghdmlkZW8pIHtcbiAgICByZXR1cm4gbmV4dCh7XG4gICAgICBtZXNzYWdlOiBgTm8gdmlkZW8gZm91bmQgd2l0aCBpZDogXCIke3JlcS5wYXJhbXMudmlkZW9JZH1cImAsXG4gICAgICBzdGF0dXNDb2RlOiA0MDQsXG4gICAgfSk7XG4gIH1cblxuICBsZXQgaXNWaWRlb01pbmUgPSBmYWxzZTtcbiAgbGV0IGlzTGlrZWQgPSBmYWxzZTtcbiAgbGV0IGlzRGlzbGlrZWQgPSBmYWxzZTtcbiAgbGV0IGlzU3Vic2NyaWJlZCA9IGZhbHNlO1xuICBsZXQgaXNWaWV3ZWQgPSBmYWxzZTtcblxuICBpZiAocmVxLnVzZXIpIHtcbiAgICBpc1ZpZGVvTWluZSA9IHJlcS51c2VyLmlkID09PSB2aWRlby51c2VySWQ7XG5cbiAgICBpc0xpa2VkID0gYXdhaXQgcHJpc21hLnZpZGVvTGlrZS5maW5kRmlyc3Qoe1xuICAgICAgd2hlcmU6IHtcbiAgICAgICAgdXNlcklkOiB7XG4gICAgICAgICAgZXF1YWxzOiByZXEudXNlci5pZCxcbiAgICAgICAgfSxcbiAgICAgICAgdmlkZW9JZDoge1xuICAgICAgICAgIGVxdWFsczogcmVxLnBhcmFtcy52aWRlb0lkLFxuICAgICAgICB9LFxuICAgICAgICBsaWtlOiB7XG4gICAgICAgICAgZXF1YWxzOiAxLFxuICAgICAgICB9LFxuICAgICAgfSxcbiAgICB9KTtcblxuICAgIGlzRGlzbGlrZWQgPSBhd2FpdCBwcmlzbWEudmlkZW9MaWtlLmZpbmRGaXJzdCh7XG4gICAgICB3aGVyZToge1xuICAgICAgICB1c2VySWQ6IHtcbiAgICAgICAgICBlcXVhbHM6IHJlcS51c2VyLmlkLFxuICAgICAgICB9LFxuICAgICAgICB2aWRlb0lkOiB7XG4gICAgICAgICAgZXF1YWxzOiByZXEucGFyYW1zLnZpZGVvSWQsXG4gICAgICAgIH0sXG4gICAgICAgIGxpa2U6IHtcbiAgICAgICAgICBlcXVhbHM6IC0xLFxuICAgICAgICB9LFxuICAgICAgfSxcbiAgICB9KTtcblxuICAgIGlzVmlld2VkID0gYXdhaXQgcHJpc21hLnZpZXcuZmluZEZpcnN0KHtcbiAgICAgIHdoZXJlOiB7XG4gICAgICAgIHVzZXJJZDoge1xuICAgICAgICAgIGVxdWFsczogcmVxLnVzZXIuaWQsXG4gICAgICAgIH0sXG4gICAgICAgIHZpZGVvSWQ6IHtcbiAgICAgICAgICBlcXVhbHM6IHZpZGVvLmlkLFxuICAgICAgICB9LFxuICAgICAgfSxcbiAgICB9KTtcblxuICAgIGlzU3Vic2NyaWJlZCA9IGF3YWl0IHByaXNtYS5zdWJzY3JpcHRpb24uZmluZEZpcnN0KHtcbiAgICAgIHdoZXJlOiB7XG4gICAgICAgIHN1YnNjcmliZXJJZDoge1xuICAgICAgICAgIGVxdWFsczogcmVxLnVzZXIuaWQsXG4gICAgICAgIH0sXG4gICAgICAgIHN1YnNjcmliZWRUb0lkOiB7XG4gICAgICAgICAgZXF1YWxzOiB2aWRlby51c2VySWQsXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgIH0pO1xuICB9XG5cbiAgY29uc3QgbGlrZXNDb3VudCA9IGF3YWl0IHByaXNtYS52aWRlb0xpa2UuY291bnQoe1xuICAgIHdoZXJlOiB7XG4gICAgICBBTkQ6IHtcbiAgICAgICAgdmlkZW9JZDoge1xuICAgICAgICAgIGVxdWFsczogcmVxLnBhcmFtcy52aWRlb0lkLFxuICAgICAgICB9LFxuICAgICAgICBsaWtlOiB7XG4gICAgICAgICAgZXF1YWxzOiAxLFxuICAgICAgICB9LFxuICAgICAgfSxcbiAgICB9LFxuICB9KTtcblxuICBjb25zdCBkaXNsaWtlc0NvdW50ID0gYXdhaXQgcHJpc21hLnZpZGVvTGlrZS5jb3VudCh7XG4gICAgd2hlcmU6IHtcbiAgICAgIEFORDoge1xuICAgICAgICB2aWRlb0lkOiB7XG4gICAgICAgICAgZXF1YWxzOiByZXEucGFyYW1zLnZpZGVvSWQsXG4gICAgICAgIH0sXG4gICAgICAgIGxpa2U6IHtcbiAgICAgICAgICBlcXVhbHM6IC0xLFxuICAgICAgICB9LFxuICAgICAgfSxcbiAgICB9LFxuICB9KTtcblxuICBjb25zdCB2aWV3cyA9IGF3YWl0IHByaXNtYS52aWV3LmNvdW50KHtcbiAgICB3aGVyZToge1xuICAgICAgdmlkZW9JZDoge1xuICAgICAgICBlcXVhbHM6IHZpZGVvLmlkLFxuICAgICAgfSxcbiAgICB9LFxuICB9KTtcblxuICBjb25zdCBzdWJzY3JpYmVyc0NvdW50ID0gYXdhaXQgcHJpc21hLnN1YnNjcmlwdGlvbi5jb3VudCh7XG4gICAgd2hlcmU6IHtcbiAgICAgIHN1YnNjcmliZWRUb0lkOiB7XG4gICAgICAgIGVxdWFsczogdmlkZW8udXNlcklkLFxuICAgICAgfSxcbiAgICB9LFxuICB9KTtcblxuICB2aWRlby5jb21tZW50c0NvdW50ID0gdmlkZW8uY29tbWVudHMubGVuZ3RoO1xuICB2aWRlby5pc0xpa2VkID0gQm9vbGVhbihpc0xpa2VkKTtcbiAgdmlkZW8uaXNEaXNsaWtlZCA9IEJvb2xlYW4oaXNEaXNsaWtlZCk7XG4gIHZpZGVvLmxpa2VzQ291bnQgPSBsaWtlc0NvdW50O1xuICB2aWRlby5kaXNsaWtlc0NvdW50ID0gZGlzbGlrZXNDb3VudDtcbiAgdmlkZW8uaXNWaWRlb01pbmUgPSBpc1ZpZGVvTWluZTtcbiAgdmlkZW8udmlld3MgPSB2aWV3cztcbiAgdmlkZW8uaXNTdWJzY3JpYmVkID0gQm9vbGVhbihpc1N1YnNjcmliZWQpO1xuICB2aWRlby5pc1ZpZXdlZCA9IEJvb2xlYW4oaXNWaWV3ZWQpO1xuICB2aWRlby5zdWJzY3JpYmVyc0NvdW50ID0gc3Vic2NyaWJlcnNDb3VudDtcblxuICByZXMuc3RhdHVzKDIwMCkuanNvbih7IHZpZGVvIH0pO1xufVxuXG5hc3luYyBmdW5jdGlvbiBkZWxldGVWaWRlbyhyZXEsIHJlcykge1xuICBjb25zdCB2aWRlbyA9IGF3YWl0IHByaXNtYS52aWRlby5maW5kVW5pcXVlKHtcbiAgICB3aGVyZToge1xuICAgICAgaWQ6IHJlcS5wYXJhbXMudmlkZW9JZCxcbiAgICB9LFxuICAgIHNlbGVjdDoge1xuICAgICAgdXNlcklkOiB0cnVlLFxuICAgIH0sXG4gIH0pO1xuXG4gIGlmIChyZXEudXNlci5pZCAhPT0gdmlkZW8udXNlcklkKSB7XG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAxKS5zZW5kKFwiWW91IGFyZSBub3QgYXV0aG9yaXplZCB0byBkZWxldGUgdGhpcyB2aWRlb1wiKTtcbiAgfVxuXG4gIGF3YWl0IHByaXNtYS52aWV3LmRlbGV0ZU1hbnkoe1xuICAgIHdoZXJlOiB7XG4gICAgICB2aWRlb0lkOiB7XG4gICAgICAgIGVxdWFsczogcmVxLnBhcmFtcy52aWRlb0lkLFxuICAgICAgfSxcbiAgICB9LFxuICB9KTtcblxuICBhd2FpdCBwcmlzbWEudmlkZW9MaWtlLmRlbGV0ZU1hbnkoe1xuICAgIHdoZXJlOiB7XG4gICAgICB2aWRlb0lkOiB7XG4gICAgICAgIGVxdWFsczogcmVxLnBhcmFtcy52aWRlb0lkLFxuICAgICAgfSxcbiAgICB9LFxuICB9KTtcblxuICBhd2FpdCBwcmlzbWEuY29tbWVudC5kZWxldGVNYW55KHtcbiAgICB3aGVyZToge1xuICAgICAgdmlkZW9JZDoge1xuICAgICAgICBlcXVhbHM6IHJlcS5wYXJhbXMudmlkZW9JZCxcbiAgICAgIH0sXG4gICAgfSxcbiAgfSk7XG5cbiAgYXdhaXQgcHJpc21hLnZpZGVvLmRlbGV0ZSh7XG4gICAgd2hlcmU6IHtcbiAgICAgIGlkOiByZXEucGFyYW1zLnZpZGVvSWQsXG4gICAgfSxcbiAgfSk7XG5cbiAgcmVzLnN0YXR1cygyMDApLmpzb24oe30pO1xufVxuXG5leHBvcnQgeyBnZXRWaWRlb1JvdXRlcyB9O1xuIl19",
    "map": {
      "version": 3,
      "sources": [
        "video.js"
      ],
      "names": [
        "prisma",
        "PrismaClient",
        "getVideoRoutes",
        "router",
        "express",
        "Router",
        "get",
        "getRecommendedVideos",
        "post",
        "protect",
        "addVideo",
        "getTrendingVideos",
        "searchVideos",
        "getAuthUser",
        "getVideo",
        "delete",
        "deleteVideo",
        "addVideoView",
        "likeVideo",
        "dislikeVideo",
        "addComment",
        "deleteComment",
        "getVideoViews",
        "videos",
        "video",
        "views",
        "view",
        "count",
        "where",
        "videoId",
        "equals",
        "id",
        "req",
        "res",
        "findMany",
        "include",
        "user",
        "orderBy",
        "createdAt",
        "length",
        "status",
        "json",
        "sort",
        "a",
        "b",
        "next",
        "query",
        "message",
        "statusCode",
        "OR",
        "title",
        "contains",
        "mode",
        "description",
        "url",
        "thumbnail",
        "body",
        "create",
        "data",
        "connect",
        "findUnique",
        "params",
        "comment",
        "text",
        "commentId",
        "select",
        "userId",
        "send",
        "isLiked",
        "videoLike",
        "findFirst",
        "like",
        "isDisliked",
        "update",
        "comments",
        "isVideoMine",
        "isSubscribed",
        "isViewed",
        "subscription",
        "subscriberId",
        "subscribedToId",
        "likesCount",
        "AND",
        "dislikesCount",
        "subscribersCount",
        "commentsCount",
        "Boolean",
        "deleteMany"
      ],
      "mappings": "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",
      "sourceRoot": "/Users/egor/Dev/ytclone/fin/server/src/routes/",
      "sourcesContent": [
        "import { PrismaClient } from \"@prisma/client\";\nimport express from \"express\";\nimport { getAuthUser, protect } from \"../middleware/authorization\";\n\nconst prisma = new PrismaClient();\n\nfunction getVideoRoutes() {\n  const router = express.Router();\n\n  router.get(\"/\", getRecommendedVideos);\n  router.post(\"/\", protect, addVideo);\n\n  router.get(\"/trending\", getTrendingVideos);\n  router.get(\"/search\", searchVideos);\n\n  router.get(\"/:videoId\", getAuthUser, getVideo);\n  router.delete(\"/:videoId\", protect, deleteVideo);\n\n  router.get(\"/:videoId/view\", getAuthUser, addVideoView);\n  router.get(\"/:videoId/like\", protect, likeVideo);\n  router.get(\"/:videoId/dislike\", protect, dislikeVideo);\n  router.post(\"/:videoId/comments\", protect, addComment);\n  router.delete(\"/:videoId/comments/:commentId\", protect, deleteComment);\n\n  return router;\n}\n\nexport async function getVideoViews(videos) {\n  for (const video of videos) {\n    const views = await prisma.view.count({\n      where: {\n        videoId: {\n          equals: video.id,\n        },\n      },\n    });\n    video.views = views;\n  }\n  return videos;\n}\n\nasync function getRecommendedVideos(req, res) {\n  let videos = await prisma.video.findMany({\n    include: {\n      user: true,\n    },\n    orderBy: {\n      createdAt: \"desc\",\n    },\n  });\n\n  if (!videos.length) {\n    return res.status(200).json({ videos });\n  }\n\n  videos = await getVideoViews(videos);\n\n  res.status(200).json({ videos });\n}\n\nasync function getTrendingVideos(req, res) {\n  let videos = await prisma.video.findMany({\n    include: {\n      user: true,\n    },\n    orderBy: {\n      createdAt: \"desc\",\n    },\n  });\n\n  if (!videos.length) {\n    return res.status(200).json({ videos });\n  }\n\n  videos = await getVideoViews(videos);\n  videos.sort((a, b) => b.views - a.views);\n\n  res.status(200).json({ videos });\n}\n\nasync function searchVideos(req, res, next) {\n  if (!req.query.query) {\n    return next({\n      message: \"Please enter a search query\",\n      statusCode: 400,\n    });\n  }\n\n  let videos = await prisma.video.findMany({\n    include: {\n      user: true,\n    },\n    where: {\n      OR: [\n        {\n          title: {\n            contains: req.query.query,\n            mode: \"insensitive\",\n          },\n        },\n        {\n          description: {\n            contains: req.query.query,\n            mode: \"insensitive\",\n          },\n        },\n      ],\n    },\n  });\n\n  if (!videos.length) {\n    return res.status(200).json({ videos });\n  }\n\n  videos = await getVideoViews(videos);\n\n  res.status(200).json({ videos });\n}\n\nasync function addVideo(req, res) {\n  const { title, description, url, thumbnail } = req.body;\n\n  const video = await prisma.video.create({\n    data: {\n      title,\n      description,\n      url,\n      thumbnail,\n      user: {\n        connect: {\n          id: req.user.id,\n        },\n      },\n    },\n  });\n\n  res.status(200).json({ video });\n}\n\nasync function addComment(req, res, next) {\n  const video = await prisma.video.findUnique({\n    where: {\n      id: req.params.videoId,\n    },\n  });\n\n  if (!video) {\n    return next({\n      message: `No video found with id: \"${req.params.videoId}\"`,\n      statusCode: 404,\n    });\n  }\n\n  const comment = await prisma.comment.create({\n    data: {\n      text: req.body.text,\n      user: {\n        connect: {\n          id: req.user.id,\n        },\n      },\n      video: {\n        connect: {\n          id: req.params.videoId,\n        },\n      },\n    },\n  });\n\n  res.status(200).json({ comment });\n}\n\nasync function deleteComment(req, res) {\n  const comment = await prisma.comment.findUnique({\n    where: {\n      id: req.params.commentId,\n    },\n    select: {\n      userId: true,\n    },\n  });\n\n  if (comment.userId !== req.user.id) {\n    return res\n      .status(401)\n      .send(\"You are not authorized to delete this comment\");\n  }\n\n  await prisma.comment.delete({\n    where: {\n      id: req.params.commentId,\n    },\n  });\n\n  res.status(200).json({});\n}\n\nasync function addVideoView(req, res, next) {\n  const video = await prisma.video.findUnique({\n    where: {\n      id: req.params.videoId,\n    },\n  });\n\n  if (!video) {\n    return next({\n      message: `No video found with id: \"${req.params.videoId}\"`,\n      statusCode: 404,\n    });\n  }\n\n  if (req.user) {\n    await prisma.view.create({\n      data: {\n        video: {\n          connect: {\n            id: req.params.videoId,\n          },\n        },\n        user: {\n          connect: {\n            id: req.user.id,\n          },\n        },\n      },\n    });\n  } else {\n    await prisma.view.create({\n      data: {\n        video: {\n          connect: {\n            id: req.params.videoId,\n          },\n        },\n      },\n    });\n  }\n\n  res.status(200).json({});\n}\n\nasync function likeVideo(req, res, next) {\n  const video = await prisma.video.findUnique({\n    where: {\n      id: req.params.videoId,\n    },\n  });\n\n  if (!video) {\n    return next({\n      message: `No video found with id: \"${req.params.videoId}\"`,\n      statusCode: 404,\n    });\n  }\n\n  const isLiked = await prisma.videoLike.findFirst({\n    where: {\n      userId: {\n        equals: req.user.id,\n      },\n      videoId: {\n        equals: req.params.videoId,\n      },\n      like: {\n        equals: 1,\n      },\n    },\n  });\n\n  const isDisliked = await prisma.videoLike.findFirst({\n    where: {\n      userId: {\n        equals: req.user.id,\n      },\n      videoId: {\n        equals: req.params.videoId,\n      },\n      like: {\n        equals: -1,\n      },\n    },\n  });\n\n  if (isLiked) {\n    await prisma.videoLike.delete({\n      where: {\n        id: isLiked.id,\n      },\n    });\n  } else if (isDisliked) {\n    await prisma.videoLike.update({\n      where: {\n        id: isDisliked.id,\n      },\n      data: {\n        like: 1,\n      },\n    });\n  } else {\n    await prisma.videoLike.create({\n      data: {\n        user: {\n          connect: {\n            id: req.user.id,\n          },\n        },\n        video: {\n          connect: {\n            id: req.params.videoId,\n          },\n        },\n        like: 1,\n      },\n    });\n  }\n\n  res.status(200).json({});\n}\n\nasync function dislikeVideo(req, res, next) {\n  const video = await prisma.video.findUnique({\n    where: {\n      id: req.params.videoId,\n    },\n  });\n\n  if (!video) {\n    return next({\n      message: `No video found with id: \"${req.params.videoId}\"`,\n      statusCode: 404,\n    });\n  }\n\n  const isLiked = await prisma.videoLike.findFirst({\n    where: {\n      userId: {\n        equals: req.user.id,\n      },\n      videoId: {\n        equals: req.params.videoId,\n      },\n      like: {\n        equals: 1,\n      },\n    },\n  });\n\n  const isDisliked = await prisma.videoLike.findFirst({\n    where: {\n      userId: {\n        equals: req.user.id,\n      },\n      videoId: {\n        equals: req.params.videoId,\n      },\n      like: {\n        equals: -1,\n      },\n    },\n  });\n\n  if (isDisliked) {\n    await prisma.videoLike.delete({\n      where: {\n        id: isDisliked.id,\n      },\n    });\n  } else if (isLiked) {\n    await prisma.videoLike.update({\n      where: {\n        id: isLiked.id,\n      },\n      data: {\n        like: -1,\n      },\n    });\n  } else {\n    await prisma.videoLike.create({\n      data: {\n        user: {\n          connect: {\n            id: req.user.id,\n          },\n        },\n        video: {\n          connect: {\n            id: req.params.videoId,\n          },\n        },\n        like: -1,\n      },\n    });\n  }\n\n  res.status(200).json({});\n}\n\nasync function getVideo(req, res, next) {\n  const video = await prisma.video.findUnique({\n    where: {\n      id: req.params.videoId,\n    },\n    include: {\n      user: true,\n      comments: {\n        include: {\n          user: true,\n        },\n        orderBy: {\n          createdAt: \"desc\",\n        },\n      },\n    },\n  });\n\n  if (!video) {\n    return next({\n      message: `No video found with id: \"${req.params.videoId}\"`,\n      statusCode: 404,\n    });\n  }\n\n  let isVideoMine = false;\n  let isLiked = false;\n  let isDisliked = false;\n  let isSubscribed = false;\n  let isViewed = false;\n\n  if (req.user) {\n    isVideoMine = req.user.id === video.userId;\n\n    isLiked = await prisma.videoLike.findFirst({\n      where: {\n        userId: {\n          equals: req.user.id,\n        },\n        videoId: {\n          equals: req.params.videoId,\n        },\n        like: {\n          equals: 1,\n        },\n      },\n    });\n\n    isDisliked = await prisma.videoLike.findFirst({\n      where: {\n        userId: {\n          equals: req.user.id,\n        },\n        videoId: {\n          equals: req.params.videoId,\n        },\n        like: {\n          equals: -1,\n        },\n      },\n    });\n\n    isViewed = await prisma.view.findFirst({\n      where: {\n        userId: {\n          equals: req.user.id,\n        },\n        videoId: {\n          equals: video.id,\n        },\n      },\n    });\n\n    isSubscribed = await prisma.subscription.findFirst({\n      where: {\n        subscriberId: {\n          equals: req.user.id,\n        },\n        subscribedToId: {\n          equals: video.userId,\n        },\n      },\n    });\n  }\n\n  const likesCount = await prisma.videoLike.count({\n    where: {\n      AND: {\n        videoId: {\n          equals: req.params.videoId,\n        },\n        like: {\n          equals: 1,\n        },\n      },\n    },\n  });\n\n  const dislikesCount = await prisma.videoLike.count({\n    where: {\n      AND: {\n        videoId: {\n          equals: req.params.videoId,\n        },\n        like: {\n          equals: -1,\n        },\n      },\n    },\n  });\n\n  const views = await prisma.view.count({\n    where: {\n      videoId: {\n        equals: video.id,\n      },\n    },\n  });\n\n  const subscribersCount = await prisma.subscription.count({\n    where: {\n      subscribedToId: {\n        equals: video.userId,\n      },\n    },\n  });\n\n  video.commentsCount = video.comments.length;\n  video.isLiked = Boolean(isLiked);\n  video.isDisliked = Boolean(isDisliked);\n  video.likesCount = likesCount;\n  video.dislikesCount = dislikesCount;\n  video.isVideoMine = isVideoMine;\n  video.views = views;\n  video.isSubscribed = Boolean(isSubscribed);\n  video.isViewed = Boolean(isViewed);\n  video.subscribersCount = subscribersCount;\n\n  res.status(200).json({ video });\n}\n\nasync function deleteVideo(req, res) {\n  const video = await prisma.video.findUnique({\n    where: {\n      id: req.params.videoId,\n    },\n    select: {\n      userId: true,\n    },\n  });\n\n  if (req.user.id !== video.userId) {\n    return res.status(401).send(\"You are not authorized to delete this video\");\n  }\n\n  await prisma.view.deleteMany({\n    where: {\n      videoId: {\n        equals: req.params.videoId,\n      },\n    },\n  });\n\n  await prisma.videoLike.deleteMany({\n    where: {\n      videoId: {\n        equals: req.params.videoId,\n      },\n    },\n  });\n\n  await prisma.comment.deleteMany({\n    where: {\n      videoId: {\n        equals: req.params.videoId,\n      },\n    },\n  });\n\n  await prisma.video.delete({\n    where: {\n      id: req.params.videoId,\n    },\n  });\n\n  res.status(200).json({});\n}\n\nexport { getVideoRoutes };\n"
      ]
    },
    "sourceType": "script",
    "mtime": 1611420432000
  },
  "{\"sourceRoot\":\"/Users/egor/Dev/ytclone/fin/server/src/middleware/\",\"caller\":{\"name\":\"@babel/register\"},\"cwd\":\"/Users/egor/Dev/ytclone/fin\",\"filename\":\"/Users/egor/Dev/ytclone/fin/server/src/middleware/error.js\",\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"/Users/egor/Dev/ytclone/fin\",\"plugins\":[{\"key\":\"syntax-numeric-separator\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"proposal-logical-assignment-operators\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"AssignmentExpression\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-nullish-coalescing-operator\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-optional-chaining\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-json-strings\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-optional-catch-binding\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-async-generators\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-object-rest-spread\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"transform-modules-commonjs\",\"visitor\":{\"CallExpression\":{\"enter\":[null]},\"Program\":{\"exit\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"proposal-dynamic-import\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"Program\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"proposal-export-namespace-from\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"ExportNamedDeclaration\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}}],\"presets\":[]}:7.12.10": {
    "metadata": {},
    "options": {
      "sourceRoot": "/Users/egor/Dev/ytclone/fin/server/src/middleware/",
      "caller": {
        "name": "@babel/register"
      },
      "cwd": "/Users/egor/Dev/ytclone/fin",
      "filename": "/Users/egor/Dev/ytclone/fin/server/src/middleware/error.js",
      "cloneInputAst": true,
      "babelrc": false,
      "configFile": false,
      "envName": "development",
      "root": "/Users/egor/Dev/ytclone/fin",
      "sourceMaps": "both",
      "ast": false,
      "passPerPreset": false,
      "plugins": [
        {
          "key": "syntax-numeric-separator",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "proposal-logical-assignment-operators",
          "visitor": {
            "_exploded": {},
            "_verified": {},
            "AssignmentExpression": {
              "enter": [
                null
              ]
            }
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-nullish-coalescing-operator",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-optional-chaining",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-json-strings",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-optional-catch-binding",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-async-generators",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-object-rest-spread",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "transform-modules-commonjs",
          "visitor": {
            "CallExpression": {
              "enter": [
                null
              ]
            },
            "Program": {
              "exit": [
                null
              ]
            },
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "proposal-dynamic-import",
          "visitor": {
            "_exploded": {},
            "_verified": {},
            "Program": {
              "enter": [
                null
              ]
            }
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "proposal-export-namespace-from",
          "visitor": {
            "_exploded": {},
            "_verified": {},
            "ExportNamedDeclaration": {
              "enter": [
                null
              ]
            }
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        }
      ],
      "presets": [],
      "parserOpts": {
        "sourceType": "module",
        "sourceFileName": "/Users/egor/Dev/ytclone/fin/server/src/middleware/error.js",
        "plugins": [
          "numericSeparator",
          "logicalAssignment",
          "nullishCoalescingOperator",
          "optionalChaining",
          "jsonStrings",
          "optionalCatchBinding",
          "asyncGenerators",
          "objectRestSpread",
          "dynamicImport",
          "exportNamespaceFrom"
        ]
      },
      "generatorOpts": {
        "filename": "/Users/egor/Dev/ytclone/fin/server/src/middleware/error.js",
        "comments": true,
        "compact": "auto",
        "sourceMaps": "both",
        "sourceRoot": "/Users/egor/Dev/ytclone/fin/server/src/middleware/",
        "sourceFileName": "error.js"
      }
    },
    "ast": null,
    "code": "\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.errorMiddleware = errorMiddleware;\nexports.setupCloseOnExit = setupCloseOnExit;\n\nvar _loglevel = _interopRequireDefault(require(\"loglevel\"));\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n// Middleware that will help us catch generic express-related errors\nfunction errorMiddleware(error, req, res, next) {\n  if (res.headersSent) {\n    next(error);\n  } else {\n    _loglevel.default.error(error);\n\n    res.status(error.statusCode || 500);\n    res.json({\n      message: error.message,\n      ...(process.env.NODE_ENV === \"production\" ? null : {\n        stack: error.stack\n      })\n    });\n  }\n} // This closes the server in the event of an error so\n// that our requests do not hang\n\n\nfunction setupCloseOnExit(server) {\n  async function exitHandler(options = {}) {\n    await server.close().then(() => {\n      _loglevel.default.info(\"Server successfully closed\");\n    }).catch(error => {\n      _loglevel.default.warn(\"Something went wrong closing the server\", error.stack);\n    });\n    if (options.exit) process.exit();\n  } // Do something when app is closing\n\n\n  process.on(\"exit\", exitHandler); // Catches ctrl+c event\n\n  process.on(\"SIGINT\", exitHandler.bind(null, {\n    exit: true\n  })); // Catches \"kill pid\" (for example: nodemon restart)\n\n  process.on(\"SIGUSR1\", exitHandler.bind(null, {\n    exit: true\n  }));\n  process.on(\"SIGUSR2\", exitHandler.bind(null, {\n    exit: true\n  })); // Catches uncaught exceptions\n\n  process.on(\"uncaughtException\", exitHandler.bind(null, {\n    exit: true\n  }));\n}\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImVycm9yLmpzIl0sIm5hbWVzIjpbImVycm9yTWlkZGxld2FyZSIsImVycm9yIiwicmVxIiwicmVzIiwibmV4dCIsImhlYWRlcnNTZW50IiwibG9nZ2VyIiwic3RhdHVzIiwic3RhdHVzQ29kZSIsImpzb24iLCJtZXNzYWdlIiwicHJvY2VzcyIsImVudiIsIk5PREVfRU5WIiwic3RhY2siLCJzZXR1cENsb3NlT25FeGl0Iiwic2VydmVyIiwiZXhpdEhhbmRsZXIiLCJvcHRpb25zIiwiY2xvc2UiLCJ0aGVuIiwiaW5mbyIsImNhdGNoIiwid2FybiIsImV4aXQiLCJvbiIsImJpbmQiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBQUE7Ozs7QUFFQTtBQUNBLFNBQVNBLGVBQVQsQ0FBeUJDLEtBQXpCLEVBQWdDQyxHQUFoQyxFQUFxQ0MsR0FBckMsRUFBMENDLElBQTFDLEVBQWdEO0FBQzlDLE1BQUlELEdBQUcsQ0FBQ0UsV0FBUixFQUFxQjtBQUNuQkQsSUFBQUEsSUFBSSxDQUFDSCxLQUFELENBQUo7QUFDRCxHQUZELE1BRU87QUFDTEssc0JBQU9MLEtBQVAsQ0FBYUEsS0FBYjs7QUFDQUUsSUFBQUEsR0FBRyxDQUFDSSxNQUFKLENBQVdOLEtBQUssQ0FBQ08sVUFBTixJQUFvQixHQUEvQjtBQUNBTCxJQUFBQSxHQUFHLENBQUNNLElBQUosQ0FBUztBQUNQQyxNQUFBQSxPQUFPLEVBQUVULEtBQUssQ0FBQ1MsT0FEUjtBQUVQLFVBQUlDLE9BQU8sQ0FBQ0MsR0FBUixDQUFZQyxRQUFaLEtBQXlCLFlBQXpCLEdBQ0EsSUFEQSxHQUVBO0FBQUVDLFFBQUFBLEtBQUssRUFBRWIsS0FBSyxDQUFDYTtBQUFmLE9BRko7QUFGTyxLQUFUO0FBTUQ7QUFDRixDLENBRUQ7QUFDQTs7O0FBQ0EsU0FBU0MsZ0JBQVQsQ0FBMEJDLE1BQTFCLEVBQWtDO0FBQ2hDLGlCQUFlQyxXQUFmLENBQTJCQyxPQUFPLEdBQUcsRUFBckMsRUFBeUM7QUFDdkMsVUFBTUYsTUFBTSxDQUNURyxLQURHLEdBRUhDLElBRkcsQ0FFRSxNQUFNO0FBQ1ZkLHdCQUFPZSxJQUFQLENBQVksNEJBQVo7QUFDRCxLQUpHLEVBS0hDLEtBTEcsQ0FLSXJCLEtBQUQsSUFBVztBQUNoQkssd0JBQU9pQixJQUFQLENBQVkseUNBQVosRUFBdUR0QixLQUFLLENBQUNhLEtBQTdEO0FBQ0QsS0FQRyxDQUFOO0FBUUEsUUFBSUksT0FBTyxDQUFDTSxJQUFaLEVBQWtCYixPQUFPLENBQUNhLElBQVI7QUFDbkIsR0FYK0IsQ0FZaEM7OztBQUNBYixFQUFBQSxPQUFPLENBQUNjLEVBQVIsQ0FBVyxNQUFYLEVBQW1CUixXQUFuQixFQWJnQyxDQWNoQzs7QUFDQU4sRUFBQUEsT0FBTyxDQUFDYyxFQUFSLENBQVcsUUFBWCxFQUFxQlIsV0FBVyxDQUFDUyxJQUFaLENBQWlCLElBQWpCLEVBQXVCO0FBQUVGLElBQUFBLElBQUksRUFBRTtBQUFSLEdBQXZCLENBQXJCLEVBZmdDLENBZ0JoQzs7QUFDQWIsRUFBQUEsT0FBTyxDQUFDYyxFQUFSLENBQVcsU0FBWCxFQUFzQlIsV0FBVyxDQUFDUyxJQUFaLENBQWlCLElBQWpCLEVBQXVCO0FBQUVGLElBQUFBLElBQUksRUFBRTtBQUFSLEdBQXZCLENBQXRCO0FBQ0FiLEVBQUFBLE9BQU8sQ0FBQ2MsRUFBUixDQUFXLFNBQVgsRUFBc0JSLFdBQVcsQ0FBQ1MsSUFBWixDQUFpQixJQUFqQixFQUF1QjtBQUFFRixJQUFBQSxJQUFJLEVBQUU7QUFBUixHQUF2QixDQUF0QixFQWxCZ0MsQ0FtQmhDOztBQUNBYixFQUFBQSxPQUFPLENBQUNjLEVBQVIsQ0FBVyxtQkFBWCxFQUFnQ1IsV0FBVyxDQUFDUyxJQUFaLENBQWlCLElBQWpCLEVBQXVCO0FBQUVGLElBQUFBLElBQUksRUFBRTtBQUFSLEdBQXZCLENBQWhDO0FBQ0QiLCJzb3VyY2VSb290IjoiL1VzZXJzL2Vnb3IvRGV2L3l0Y2xvbmUvZmluL3NlcnZlci9zcmMvbWlkZGxld2FyZS8iLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgbG9nZ2VyIGZyb20gXCJsb2dsZXZlbFwiO1xuXG4vLyBNaWRkbGV3YXJlIHRoYXQgd2lsbCBoZWxwIHVzIGNhdGNoIGdlbmVyaWMgZXhwcmVzcy1yZWxhdGVkIGVycm9yc1xuZnVuY3Rpb24gZXJyb3JNaWRkbGV3YXJlKGVycm9yLCByZXEsIHJlcywgbmV4dCkge1xuICBpZiAocmVzLmhlYWRlcnNTZW50KSB7XG4gICAgbmV4dChlcnJvcik7XG4gIH0gZWxzZSB7XG4gICAgbG9nZ2VyLmVycm9yKGVycm9yKTtcbiAgICByZXMuc3RhdHVzKGVycm9yLnN0YXR1c0NvZGUgfHwgNTAwKTtcbiAgICByZXMuanNvbih7XG4gICAgICBtZXNzYWdlOiBlcnJvci5tZXNzYWdlLFxuICAgICAgLi4uKHByb2Nlc3MuZW52Lk5PREVfRU5WID09PSBcInByb2R1Y3Rpb25cIlxuICAgICAgICA/IG51bGxcbiAgICAgICAgOiB7IHN0YWNrOiBlcnJvci5zdGFjayB9KSxcbiAgICB9KTtcbiAgfVxufVxuXG4vLyBUaGlzIGNsb3NlcyB0aGUgc2VydmVyIGluIHRoZSBldmVudCBvZiBhbiBlcnJvciBzb1xuLy8gdGhhdCBvdXIgcmVxdWVzdHMgZG8gbm90IGhhbmdcbmZ1bmN0aW9uIHNldHVwQ2xvc2VPbkV4aXQoc2VydmVyKSB7XG4gIGFzeW5jIGZ1bmN0aW9uIGV4aXRIYW5kbGVyKG9wdGlvbnMgPSB7fSkge1xuICAgIGF3YWl0IHNlcnZlclxuICAgICAgLmNsb3NlKClcbiAgICAgIC50aGVuKCgpID0+IHtcbiAgICAgICAgbG9nZ2VyLmluZm8oXCJTZXJ2ZXIgc3VjY2Vzc2Z1bGx5IGNsb3NlZFwiKTtcbiAgICAgIH0pXG4gICAgICAuY2F0Y2goKGVycm9yKSA9PiB7XG4gICAgICAgIGxvZ2dlci53YXJuKFwiU29tZXRoaW5nIHdlbnQgd3JvbmcgY2xvc2luZyB0aGUgc2VydmVyXCIsIGVycm9yLnN0YWNrKTtcbiAgICAgIH0pO1xuICAgIGlmIChvcHRpb25zLmV4aXQpIHByb2Nlc3MuZXhpdCgpO1xuICB9XG4gIC8vIERvIHNvbWV0aGluZyB3aGVuIGFwcCBpcyBjbG9zaW5nXG4gIHByb2Nlc3Mub24oXCJleGl0XCIsIGV4aXRIYW5kbGVyKTtcbiAgLy8gQ2F0Y2hlcyBjdHJsK2MgZXZlbnRcbiAgcHJvY2Vzcy5vbihcIlNJR0lOVFwiLCBleGl0SGFuZGxlci5iaW5kKG51bGwsIHsgZXhpdDogdHJ1ZSB9KSk7XG4gIC8vIENhdGNoZXMgXCJraWxsIHBpZFwiIChmb3IgZXhhbXBsZTogbm9kZW1vbiByZXN0YXJ0KVxuICBwcm9jZXNzLm9uKFwiU0lHVVNSMVwiLCBleGl0SGFuZGxlci5iaW5kKG51bGwsIHsgZXhpdDogdHJ1ZSB9KSk7XG4gIHByb2Nlc3Mub24oXCJTSUdVU1IyXCIsIGV4aXRIYW5kbGVyLmJpbmQobnVsbCwgeyBleGl0OiB0cnVlIH0pKTtcbiAgLy8gQ2F0Y2hlcyB1bmNhdWdodCBleGNlcHRpb25zXG4gIHByb2Nlc3Mub24oXCJ1bmNhdWdodEV4Y2VwdGlvblwiLCBleGl0SGFuZGxlci5iaW5kKG51bGwsIHsgZXhpdDogdHJ1ZSB9KSk7XG59XG5cbmV4cG9ydCB7IGVycm9yTWlkZGxld2FyZSwgc2V0dXBDbG9zZU9uRXhpdCB9O1xuIl19",
    "map": {
      "version": 3,
      "sources": [
        "error.js"
      ],
      "names": [
        "errorMiddleware",
        "error",
        "req",
        "res",
        "next",
        "headersSent",
        "logger",
        "status",
        "statusCode",
        "json",
        "message",
        "process",
        "env",
        "NODE_ENV",
        "stack",
        "setupCloseOnExit",
        "server",
        "exitHandler",
        "options",
        "close",
        "then",
        "info",
        "catch",
        "warn",
        "exit",
        "on",
        "bind"
      ],
      "mappings": ";;;;;;;;AAAA;;;;AAEA;AACA,SAASA,eAAT,CAAyBC,KAAzB,EAAgCC,GAAhC,EAAqCC,GAArC,EAA0CC,IAA1C,EAAgD;AAC9C,MAAID,GAAG,CAACE,WAAR,EAAqB;AACnBD,IAAAA,IAAI,CAACH,KAAD,CAAJ;AACD,GAFD,MAEO;AACLK,sBAAOL,KAAP,CAAaA,KAAb;;AACAE,IAAAA,GAAG,CAACI,MAAJ,CAAWN,KAAK,CAACO,UAAN,IAAoB,GAA/B;AACAL,IAAAA,GAAG,CAACM,IAAJ,CAAS;AACPC,MAAAA,OAAO,EAAET,KAAK,CAACS,OADR;AAEP,UAAIC,OAAO,CAACC,GAAR,CAAYC,QAAZ,KAAyB,YAAzB,GACA,IADA,GAEA;AAAEC,QAAAA,KAAK,EAAEb,KAAK,CAACa;AAAf,OAFJ;AAFO,KAAT;AAMD;AACF,C,CAED;AACA;;;AACA,SAASC,gBAAT,CAA0BC,MAA1B,EAAkC;AAChC,iBAAeC,WAAf,CAA2BC,OAAO,GAAG,EAArC,EAAyC;AACvC,UAAMF,MAAM,CACTG,KADG,GAEHC,IAFG,CAEE,MAAM;AACVd,wBAAOe,IAAP,CAAY,4BAAZ;AACD,KAJG,EAKHC,KALG,CAKIrB,KAAD,IAAW;AAChBK,wBAAOiB,IAAP,CAAY,yCAAZ,EAAuDtB,KAAK,CAACa,KAA7D;AACD,KAPG,CAAN;AAQA,QAAII,OAAO,CAACM,IAAZ,EAAkBb,OAAO,CAACa,IAAR;AACnB,GAX+B,CAYhC;;;AACAb,EAAAA,OAAO,CAACc,EAAR,CAAW,MAAX,EAAmBR,WAAnB,EAbgC,CAchC;;AACAN,EAAAA,OAAO,CAACc,EAAR,CAAW,QAAX,EAAqBR,WAAW,CAACS,IAAZ,CAAiB,IAAjB,EAAuB;AAAEF,IAAAA,IAAI,EAAE;AAAR,GAAvB,CAArB,EAfgC,CAgBhC;;AACAb,EAAAA,OAAO,CAACc,EAAR,CAAW,SAAX,EAAsBR,WAAW,CAACS,IAAZ,CAAiB,IAAjB,EAAuB;AAAEF,IAAAA,IAAI,EAAE;AAAR,GAAvB,CAAtB;AACAb,EAAAA,OAAO,CAACc,EAAR,CAAW,SAAX,EAAsBR,WAAW,CAACS,IAAZ,CAAiB,IAAjB,EAAuB;AAAEF,IAAAA,IAAI,EAAE;AAAR,GAAvB,CAAtB,EAlBgC,CAmBhC;;AACAb,EAAAA,OAAO,CAACc,EAAR,CAAW,mBAAX,EAAgCR,WAAW,CAACS,IAAZ,CAAiB,IAAjB,EAAuB;AAAEF,IAAAA,IAAI,EAAE;AAAR,GAAvB,CAAhC;AACD",
      "sourceRoot": "/Users/egor/Dev/ytclone/fin/server/src/middleware/",
      "sourcesContent": [
        "import logger from \"loglevel\";\n\n// Middleware that will help us catch generic express-related errors\nfunction errorMiddleware(error, req, res, next) {\n  if (res.headersSent) {\n    next(error);\n  } else {\n    logger.error(error);\n    res.status(error.statusCode || 500);\n    res.json({\n      message: error.message,\n      ...(process.env.NODE_ENV === \"production\"\n        ? null\n        : { stack: error.stack }),\n    });\n  }\n}\n\n// This closes the server in the event of an error so\n// that our requests do not hang\nfunction setupCloseOnExit(server) {\n  async function exitHandler(options = {}) {\n    await server\n      .close()\n      .then(() => {\n        logger.info(\"Server successfully closed\");\n      })\n      .catch((error) => {\n        logger.warn(\"Something went wrong closing the server\", error.stack);\n      });\n    if (options.exit) process.exit();\n  }\n  // Do something when app is closing\n  process.on(\"exit\", exitHandler);\n  // Catches ctrl+c event\n  process.on(\"SIGINT\", exitHandler.bind(null, { exit: true }));\n  // Catches \"kill pid\" (for example: nodemon restart)\n  process.on(\"SIGUSR1\", exitHandler.bind(null, { exit: true }));\n  process.on(\"SIGUSR2\", exitHandler.bind(null, { exit: true }));\n  // Catches uncaught exceptions\n  process.on(\"uncaughtException\", exitHandler.bind(null, { exit: true }));\n}\n\nexport { errorMiddleware, setupCloseOnExit };\n"
      ]
    },
    "sourceType": "script",
    "mtime": 1611368296000
  },
  "{\"sourceRoot\":\"/Users/egor/Dev/ytclone/1/server/src/\",\"caller\":{\"name\":\"@babel/register\"},\"cwd\":\"/Users/egor/Dev/ytclone/1\",\"filename\":\"/Users/egor/Dev/ytclone/1/server/src/index.js\",\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"/Users/egor/Dev/ytclone/1\",\"plugins\":[{\"key\":\"syntax-numeric-separator\",\"visitor\":{},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"proposal-logical-assignment-operators\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"AssignmentExpression\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-nullish-coalescing-operator\",\"visitor\":{},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-optional-chaining\",\"visitor\":{},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-json-strings\",\"visitor\":{},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-optional-catch-binding\",\"visitor\":{},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-async-generators\",\"visitor\":{},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-object-rest-spread\",\"visitor\":{},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"transform-modules-commonjs\",\"visitor\":{\"CallExpression\":{\"enter\":[null]},\"Program\":{\"exit\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"proposal-dynamic-import\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"Program\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"proposal-export-namespace-from\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"ExportNamedDeclaration\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}}],\"presets\":[]}:7.12.10": {
    "metadata": {},
    "options": {
      "sourceRoot": "/Users/egor/Dev/ytclone/1/server/src/",
      "caller": {
        "name": "@babel/register"
      },
      "cwd": "/Users/egor/Dev/ytclone/1",
      "filename": "/Users/egor/Dev/ytclone/1/server/src/index.js",
      "cloneInputAst": true,
      "babelrc": false,
      "configFile": false,
      "envName": "development",
      "root": "/Users/egor/Dev/ytclone/1",
      "sourceMaps": "both",
      "ast": false,
      "passPerPreset": false,
      "plugins": [
        {
          "key": "syntax-numeric-separator",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "proposal-logical-assignment-operators",
          "visitor": {
            "_exploded": {},
            "_verified": {},
            "AssignmentExpression": {
              "enter": [
                null
              ]
            }
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-nullish-coalescing-operator",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-optional-chaining",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-json-strings",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-optional-catch-binding",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-async-generators",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-object-rest-spread",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "transform-modules-commonjs",
          "visitor": {
            "CallExpression": {
              "enter": [
                null
              ]
            },
            "Program": {
              "exit": [
                null
              ]
            },
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "proposal-dynamic-import",
          "visitor": {
            "_exploded": {},
            "_verified": {},
            "Program": {
              "enter": [
                null
              ]
            }
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "proposal-export-namespace-from",
          "visitor": {
            "_exploded": {},
            "_verified": {},
            "ExportNamedDeclaration": {
              "enter": [
                null
              ]
            }
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        }
      ],
      "presets": [],
      "parserOpts": {
        "sourceType": "module",
        "sourceFileName": "/Users/egor/Dev/ytclone/1/server/src/index.js",
        "plugins": [
          "numericSeparator",
          "logicalAssignment",
          "nullishCoalescingOperator",
          "optionalChaining",
          "jsonStrings",
          "optionalCatchBinding",
          "asyncGenerators",
          "objectRestSpread",
          "dynamicImport",
          "exportNamespaceFrom"
        ]
      },
      "generatorOpts": {
        "filename": "/Users/egor/Dev/ytclone/1/server/src/index.js",
        "comments": true,
        "compact": "auto",
        "sourceMaps": "both",
        "sourceRoot": "/Users/egor/Dev/ytclone/1/server/src/",
        "sourceFileName": "index.js"
      }
    },
    "ast": null,
    "code": "\"use strict\";\n\nvar _loglevel = _interopRequireDefault(require(\"loglevel\"));\n\nvar _start = require(\"./start\");\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n_loglevel.default.setLevel(\"info\");\n\n(0, _start.startServer)();\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluZGV4LmpzIl0sIm5hbWVzIjpbImxvZ2dlciIsInNldExldmVsIl0sIm1hcHBpbmdzIjoiOztBQUFBOztBQUNBOzs7O0FBQ0FBLGtCQUFPQyxRQUFQLENBQWdCLE1BQWhCOztBQUNBIiwic291cmNlUm9vdCI6Ii9Vc2Vycy9lZ29yL0Rldi95dGNsb25lLzEvc2VydmVyL3NyYy8iLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgbG9nZ2VyIGZyb20gXCJsb2dsZXZlbFwiO1xuaW1wb3J0IHsgc3RhcnRTZXJ2ZXIgfSBmcm9tIFwiLi9zdGFydFwiO1xubG9nZ2VyLnNldExldmVsKFwiaW5mb1wiKTtcbnN0YXJ0U2VydmVyKCk7XG4iXX0=",
    "map": {
      "version": 3,
      "sources": [
        "index.js"
      ],
      "names": [
        "logger",
        "setLevel"
      ],
      "mappings": ";;AAAA;;AACA;;;;AACAA,kBAAOC,QAAP,CAAgB,MAAhB;;AACA",
      "sourceRoot": "/Users/egor/Dev/ytclone/1/server/src/",
      "sourcesContent": [
        "import logger from \"loglevel\";\nimport { startServer } from \"./start\";\nlogger.setLevel(\"info\");\nstartServer();\n"
      ]
    },
    "sourceType": "script",
    "mtime": 1611368296000
  },
  "{\"sourceRoot\":\"/Users/egor/Dev/ytclone/1/server/src/\",\"caller\":{\"name\":\"@babel/register\"},\"cwd\":\"/Users/egor/Dev/ytclone/1\",\"filename\":\"/Users/egor/Dev/ytclone/1/server/src/start.js\",\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"/Users/egor/Dev/ytclone/1\",\"plugins\":[{\"key\":\"syntax-numeric-separator\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"proposal-logical-assignment-operators\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"AssignmentExpression\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-nullish-coalescing-operator\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-optional-chaining\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-json-strings\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-optional-catch-binding\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-async-generators\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-object-rest-spread\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"transform-modules-commonjs\",\"visitor\":{\"CallExpression\":{\"enter\":[null]},\"Program\":{\"exit\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"proposal-dynamic-import\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"Program\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"proposal-export-namespace-from\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"ExportNamedDeclaration\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}}],\"presets\":[]}:7.12.10": {
    "metadata": {},
    "options": {
      "sourceRoot": "/Users/egor/Dev/ytclone/1/server/src/",
      "caller": {
        "name": "@babel/register"
      },
      "cwd": "/Users/egor/Dev/ytclone/1",
      "filename": "/Users/egor/Dev/ytclone/1/server/src/start.js",
      "cloneInputAst": true,
      "babelrc": false,
      "configFile": false,
      "envName": "development",
      "root": "/Users/egor/Dev/ytclone/1",
      "sourceMaps": "both",
      "ast": false,
      "passPerPreset": false,
      "plugins": [
        {
          "key": "syntax-numeric-separator",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "proposal-logical-assignment-operators",
          "visitor": {
            "_exploded": {},
            "_verified": {},
            "AssignmentExpression": {
              "enter": [
                null
              ]
            }
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-nullish-coalescing-operator",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-optional-chaining",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-json-strings",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-optional-catch-binding",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-async-generators",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-object-rest-spread",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "transform-modules-commonjs",
          "visitor": {
            "CallExpression": {
              "enter": [
                null
              ]
            },
            "Program": {
              "exit": [
                null
              ]
            },
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "proposal-dynamic-import",
          "visitor": {
            "_exploded": {},
            "_verified": {},
            "Program": {
              "enter": [
                null
              ]
            }
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "proposal-export-namespace-from",
          "visitor": {
            "_exploded": {},
            "_verified": {},
            "ExportNamedDeclaration": {
              "enter": [
                null
              ]
            }
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        }
      ],
      "presets": [],
      "parserOpts": {
        "sourceType": "module",
        "sourceFileName": "/Users/egor/Dev/ytclone/1/server/src/start.js",
        "plugins": [
          "numericSeparator",
          "logicalAssignment",
          "nullishCoalescingOperator",
          "optionalChaining",
          "jsonStrings",
          "optionalCatchBinding",
          "asyncGenerators",
          "objectRestSpread",
          "dynamicImport",
          "exportNamespaceFrom"
        ]
      },
      "generatorOpts": {
        "filename": "/Users/egor/Dev/ytclone/1/server/src/start.js",
        "comments": true,
        "compact": "auto",
        "sourceMaps": "both",
        "sourceRoot": "/Users/egor/Dev/ytclone/1/server/src/",
        "sourceFileName": "start.js"
      }
    },
    "ast": null,
    "code": "\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.startServer = startServer;\n\nvar _express = _interopRequireDefault(require(\"express\"));\n\nrequire(\"express-async-errors\");\n\nvar _path = _interopRequireDefault(require(\"path\"));\n\nvar _cors = _interopRequireDefault(require(\"cors\"));\n\nvar _loglevel = _interopRequireDefault(require(\"loglevel\"));\n\nvar _morgan = _interopRequireDefault(require(\"morgan\"));\n\nvar _dotenv = _interopRequireDefault(require(\"dotenv\"));\n\nvar _cookieParser = _interopRequireDefault(require(\"cookie-parser\"));\n\nvar _routes = require(\"./routes\");\n\nvar _error = require(\"./middleware/error\");\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n// Import this module to handle errors when using async functions for our route handlers\n_dotenv.default.config();\n\nfunction startServer({\n  port = process.env.PORT\n} = {}) {\n  const app = (0, _express.default)();\n  app.use((0, _morgan.default)(\"dev\"));\n  app.use((0, _cors.default)());\n  app.use((0, _cookieParser.default)());\n  app.use(_express.default.json()); // all API routes are prefixed with /api/v1\n\n  app.use(\"/api/v1\", (0, _routes.getRoutes)()); // Generic error handler if errors are missed by 'express-async-errors' middleware\n\n  app.use(_error.errorMiddleware); // When our project is pushed to production, we will serve // the react app using express.static() middleware\n\n  if (process.env.NODE_ENV === \"production\") {\n    app.use(_express.default.static(_path.default.resolve(__dirname, \"../client/build\"))); // Any request not caught by our API will be routed\n    // to our built react app\n\n    app.get(\"*\", function (req, res) {\n      res.sendFile(_path.default.resolve(__dirname, \"../client/build\", \"index.html\"));\n    });\n  } // This block of code is made to reliably start and close our express app\n  // It is written as a promise, which can be more easily tested\n\n\n  return new Promise(resolve => {\n    const server = app.listen(port, () => {\n      _loglevel.default.info(`Listening on port ${server.address().port}`);\n\n      const originalClose = server.close.bind(server);\n\n      server.close = () => {\n        return new Promise(resolveClose => {\n          originalClose(resolveClose);\n        });\n      }; // This function properly closes the server when the program exits\n\n\n      (0, _error.setupCloseOnExit)(server);\n      resolve(server);\n    });\n  });\n}\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInN0YXJ0LmpzIl0sIm5hbWVzIjpbImRvdGVudiIsImNvbmZpZyIsInN0YXJ0U2VydmVyIiwicG9ydCIsInByb2Nlc3MiLCJlbnYiLCJQT1JUIiwiYXBwIiwidXNlIiwiZXhwcmVzcyIsImpzb24iLCJlcnJvck1pZGRsZXdhcmUiLCJOT0RFX0VOViIsInN0YXRpYyIsInBhdGgiLCJyZXNvbHZlIiwiX19kaXJuYW1lIiwiZ2V0IiwicmVxIiwicmVzIiwic2VuZEZpbGUiLCJQcm9taXNlIiwic2VydmVyIiwibGlzdGVuIiwibG9nZ2VyIiwiaW5mbyIsImFkZHJlc3MiLCJvcmlnaW5hbENsb3NlIiwiY2xvc2UiLCJiaW5kIiwicmVzb2x2ZUNsb3NlIl0sIm1hcHBpbmdzIjoiOzs7Ozs7O0FBQUE7O0FBRUE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBRUE7O0FBQ0E7Ozs7QUFWQTtBQVlBQSxnQkFBT0MsTUFBUDs7QUFFQSxTQUFTQyxXQUFULENBQXFCO0FBQUVDLEVBQUFBLElBQUksR0FBR0MsT0FBTyxDQUFDQyxHQUFSLENBQVlDO0FBQXJCLElBQThCLEVBQW5ELEVBQXVEO0FBQ3JELFFBQU1DLEdBQUcsR0FBRyx1QkFBWjtBQUNBQSxFQUFBQSxHQUFHLENBQUNDLEdBQUosQ0FBUSxxQkFBTyxLQUFQLENBQVI7QUFDQUQsRUFBQUEsR0FBRyxDQUFDQyxHQUFKLENBQVEsb0JBQVI7QUFDQUQsRUFBQUEsR0FBRyxDQUFDQyxHQUFKLENBQVEsNEJBQVI7QUFDQUQsRUFBQUEsR0FBRyxDQUFDQyxHQUFKLENBQVFDLGlCQUFRQyxJQUFSLEVBQVIsRUFMcUQsQ0FNckQ7O0FBQ0FILEVBQUFBLEdBQUcsQ0FBQ0MsR0FBSixDQUFRLFNBQVIsRUFBbUIsd0JBQW5CLEVBUHFELENBU3JEOztBQUNBRCxFQUFBQSxHQUFHLENBQUNDLEdBQUosQ0FBUUcsc0JBQVIsRUFWcUQsQ0FZckQ7O0FBQ0EsTUFBSVAsT0FBTyxDQUFDQyxHQUFSLENBQVlPLFFBQVosS0FBeUIsWUFBN0IsRUFBMkM7QUFDekNMLElBQUFBLEdBQUcsQ0FBQ0MsR0FBSixDQUFRQyxpQkFBUUksTUFBUixDQUFlQyxjQUFLQyxPQUFMLENBQWFDLFNBQWIsRUFBd0IsaUJBQXhCLENBQWYsQ0FBUixFQUR5QyxDQUd6QztBQUNBOztBQUNBVCxJQUFBQSxHQUFHLENBQUNVLEdBQUosQ0FBUSxHQUFSLEVBQWEsVUFBVUMsR0FBVixFQUFlQyxHQUFmLEVBQW9CO0FBQy9CQSxNQUFBQSxHQUFHLENBQUNDLFFBQUosQ0FBYU4sY0FBS0MsT0FBTCxDQUFhQyxTQUFiLEVBQXdCLGlCQUF4QixFQUEyQyxZQUEzQyxDQUFiO0FBQ0QsS0FGRDtBQUdELEdBckJvRCxDQXVCckQ7QUFDQTs7O0FBQ0EsU0FBTyxJQUFJSyxPQUFKLENBQWFOLE9BQUQsSUFBYTtBQUM5QixVQUFNTyxNQUFNLEdBQUdmLEdBQUcsQ0FBQ2dCLE1BQUosQ0FBV3BCLElBQVgsRUFBaUIsTUFBTTtBQUNwQ3FCLHdCQUFPQyxJQUFQLENBQWEscUJBQW9CSCxNQUFNLENBQUNJLE9BQVAsR0FBaUJ2QixJQUFLLEVBQXZEOztBQUVBLFlBQU13QixhQUFhLEdBQUdMLE1BQU0sQ0FBQ00sS0FBUCxDQUFhQyxJQUFiLENBQWtCUCxNQUFsQixDQUF0Qjs7QUFDQUEsTUFBQUEsTUFBTSxDQUFDTSxLQUFQLEdBQWUsTUFBTTtBQUNuQixlQUFPLElBQUlQLE9BQUosQ0FBYVMsWUFBRCxJQUFrQjtBQUNuQ0gsVUFBQUEsYUFBYSxDQUFDRyxZQUFELENBQWI7QUFDRCxTQUZNLENBQVA7QUFHRCxPQUpELENBSm9DLENBU3BDOzs7QUFDQSxtQ0FBaUJSLE1BQWpCO0FBQ0FQLE1BQUFBLE9BQU8sQ0FBQ08sTUFBRCxDQUFQO0FBQ0QsS0FaYyxDQUFmO0FBYUQsR0FkTSxDQUFQO0FBZUQiLCJzb3VyY2VSb290IjoiL1VzZXJzL2Vnb3IvRGV2L3l0Y2xvbmUvMS9zZXJ2ZXIvc3JjLyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBleHByZXNzIGZyb20gXCJleHByZXNzXCI7XG4vLyBJbXBvcnQgdGhpcyBtb2R1bGUgdG8gaGFuZGxlIGVycm9ycyB3aGVuIHVzaW5nIGFzeW5jIGZ1bmN0aW9ucyBmb3Igb3VyIHJvdXRlIGhhbmRsZXJzXG5pbXBvcnQgXCJleHByZXNzLWFzeW5jLWVycm9yc1wiO1xuaW1wb3J0IHBhdGggZnJvbSBcInBhdGhcIjtcbmltcG9ydCBjb3JzIGZyb20gXCJjb3JzXCI7XG5pbXBvcnQgbG9nZ2VyIGZyb20gXCJsb2dsZXZlbFwiO1xuaW1wb3J0IG1vcmdhbiBmcm9tIFwibW9yZ2FuXCI7XG5pbXBvcnQgZG90ZW52IGZyb20gXCJkb3RlbnZcIjtcbmltcG9ydCBjb29raWVQYXJzZXIgZnJvbSBcImNvb2tpZS1wYXJzZXJcIjtcblxuaW1wb3J0IHsgZ2V0Um91dGVzIH0gZnJvbSBcIi4vcm91dGVzXCI7XG5pbXBvcnQgeyBlcnJvck1pZGRsZXdhcmUsIHNldHVwQ2xvc2VPbkV4aXQgfSBmcm9tIFwiLi9taWRkbGV3YXJlL2Vycm9yXCI7XG5cbmRvdGVudi5jb25maWcoKTtcblxuZnVuY3Rpb24gc3RhcnRTZXJ2ZXIoeyBwb3J0ID0gcHJvY2Vzcy5lbnYuUE9SVCB9ID0ge30pIHtcbiAgY29uc3QgYXBwID0gZXhwcmVzcygpO1xuICBhcHAudXNlKG1vcmdhbihcImRldlwiKSk7XG4gIGFwcC51c2UoY29ycygpKTtcbiAgYXBwLnVzZShjb29raWVQYXJzZXIoKSk7XG4gIGFwcC51c2UoZXhwcmVzcy5qc29uKCkpO1xuICAvLyBhbGwgQVBJIHJvdXRlcyBhcmUgcHJlZml4ZWQgd2l0aCAvYXBpL3YxXG4gIGFwcC51c2UoXCIvYXBpL3YxXCIsIGdldFJvdXRlcygpKTtcblxuICAvLyBHZW5lcmljIGVycm9yIGhhbmRsZXIgaWYgZXJyb3JzIGFyZSBtaXNzZWQgYnkgJ2V4cHJlc3MtYXN5bmMtZXJyb3JzJyBtaWRkbGV3YXJlXG4gIGFwcC51c2UoZXJyb3JNaWRkbGV3YXJlKTtcblxuICAvLyBXaGVuIG91ciBwcm9qZWN0IGlzIHB1c2hlZCB0byBwcm9kdWN0aW9uLCB3ZSB3aWxsIHNlcnZlIC8vIHRoZSByZWFjdCBhcHAgdXNpbmcgZXhwcmVzcy5zdGF0aWMoKSBtaWRkbGV3YXJlXG4gIGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViA9PT0gXCJwcm9kdWN0aW9uXCIpIHtcbiAgICBhcHAudXNlKGV4cHJlc3Muc3RhdGljKHBhdGgucmVzb2x2ZShfX2Rpcm5hbWUsIFwiLi4vY2xpZW50L2J1aWxkXCIpKSk7XG5cbiAgICAvLyBBbnkgcmVxdWVzdCBub3QgY2F1Z2h0IGJ5IG91ciBBUEkgd2lsbCBiZSByb3V0ZWRcbiAgICAvLyB0byBvdXIgYnVpbHQgcmVhY3QgYXBwXG4gICAgYXBwLmdldChcIipcIiwgZnVuY3Rpb24gKHJlcSwgcmVzKSB7XG4gICAgICByZXMuc2VuZEZpbGUocGF0aC5yZXNvbHZlKF9fZGlybmFtZSwgXCIuLi9jbGllbnQvYnVpbGRcIiwgXCJpbmRleC5odG1sXCIpKTtcbiAgICB9KTtcbiAgfVxuXG4gIC8vIFRoaXMgYmxvY2sgb2YgY29kZSBpcyBtYWRlIHRvIHJlbGlhYmx5IHN0YXJ0IGFuZCBjbG9zZSBvdXIgZXhwcmVzcyBhcHBcbiAgLy8gSXQgaXMgd3JpdHRlbiBhcyBhIHByb21pc2UsIHdoaWNoIGNhbiBiZSBtb3JlIGVhc2lseSB0ZXN0ZWRcbiAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7XG4gICAgY29uc3Qgc2VydmVyID0gYXBwLmxpc3Rlbihwb3J0LCAoKSA9PiB7XG4gICAgICBsb2dnZXIuaW5mbyhgTGlzdGVuaW5nIG9uIHBvcnQgJHtzZXJ2ZXIuYWRkcmVzcygpLnBvcnR9YCk7XG5cbiAgICAgIGNvbnN0IG9yaWdpbmFsQ2xvc2UgPSBzZXJ2ZXIuY2xvc2UuYmluZChzZXJ2ZXIpO1xuICAgICAgc2VydmVyLmNsb3NlID0gKCkgPT4ge1xuICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmVDbG9zZSkgPT4ge1xuICAgICAgICAgIG9yaWdpbmFsQ2xvc2UocmVzb2x2ZUNsb3NlKTtcbiAgICAgICAgfSk7XG4gICAgICB9O1xuICAgICAgLy8gVGhpcyBmdW5jdGlvbiBwcm9wZXJseSBjbG9zZXMgdGhlIHNlcnZlciB3aGVuIHRoZSBwcm9ncmFtIGV4aXRzXG4gICAgICBzZXR1cENsb3NlT25FeGl0KHNlcnZlcik7XG4gICAgICByZXNvbHZlKHNlcnZlcik7XG4gICAgfSk7XG4gIH0pO1xufVxuXG5leHBvcnQgeyBzdGFydFNlcnZlciB9O1xuIl19",
    "map": {
      "version": 3,
      "sources": [
        "start.js"
      ],
      "names": [
        "dotenv",
        "config",
        "startServer",
        "port",
        "process",
        "env",
        "PORT",
        "app",
        "use",
        "express",
        "json",
        "errorMiddleware",
        "NODE_ENV",
        "static",
        "path",
        "resolve",
        "__dirname",
        "get",
        "req",
        "res",
        "sendFile",
        "Promise",
        "server",
        "listen",
        "logger",
        "info",
        "address",
        "originalClose",
        "close",
        "bind",
        "resolveClose"
      ],
      "mappings": ";;;;;;;AAAA;;AAEA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AAEA;;AACA;;;;AAVA;AAYAA,gBAAOC,MAAP;;AAEA,SAASC,WAAT,CAAqB;AAAEC,EAAAA,IAAI,GAAGC,OAAO,CAACC,GAAR,CAAYC;AAArB,IAA8B,EAAnD,EAAuD;AACrD,QAAMC,GAAG,GAAG,uBAAZ;AACAA,EAAAA,GAAG,CAACC,GAAJ,CAAQ,qBAAO,KAAP,CAAR;AACAD,EAAAA,GAAG,CAACC,GAAJ,CAAQ,oBAAR;AACAD,EAAAA,GAAG,CAACC,GAAJ,CAAQ,4BAAR;AACAD,EAAAA,GAAG,CAACC,GAAJ,CAAQC,iBAAQC,IAAR,EAAR,EALqD,CAMrD;;AACAH,EAAAA,GAAG,CAACC,GAAJ,CAAQ,SAAR,EAAmB,wBAAnB,EAPqD,CASrD;;AACAD,EAAAA,GAAG,CAACC,GAAJ,CAAQG,sBAAR,EAVqD,CAYrD;;AACA,MAAIP,OAAO,CAACC,GAAR,CAAYO,QAAZ,KAAyB,YAA7B,EAA2C;AACzCL,IAAAA,GAAG,CAACC,GAAJ,CAAQC,iBAAQI,MAAR,CAAeC,cAAKC,OAAL,CAAaC,SAAb,EAAwB,iBAAxB,CAAf,CAAR,EADyC,CAGzC;AACA;;AACAT,IAAAA,GAAG,CAACU,GAAJ,CAAQ,GAAR,EAAa,UAAUC,GAAV,EAAeC,GAAf,EAAoB;AAC/BA,MAAAA,GAAG,CAACC,QAAJ,CAAaN,cAAKC,OAAL,CAAaC,SAAb,EAAwB,iBAAxB,EAA2C,YAA3C,CAAb;AACD,KAFD;AAGD,GArBoD,CAuBrD;AACA;;;AACA,SAAO,IAAIK,OAAJ,CAAaN,OAAD,IAAa;AAC9B,UAAMO,MAAM,GAAGf,GAAG,CAACgB,MAAJ,CAAWpB,IAAX,EAAiB,MAAM;AACpCqB,wBAAOC,IAAP,CAAa,qBAAoBH,MAAM,CAACI,OAAP,GAAiBvB,IAAK,EAAvD;;AAEA,YAAMwB,aAAa,GAAGL,MAAM,CAACM,KAAP,CAAaC,IAAb,CAAkBP,MAAlB,CAAtB;;AACAA,MAAAA,MAAM,CAACM,KAAP,GAAe,MAAM;AACnB,eAAO,IAAIP,OAAJ,CAAaS,YAAD,IAAkB;AACnCH,UAAAA,aAAa,CAACG,YAAD,CAAb;AACD,SAFM,CAAP;AAGD,OAJD,CAJoC,CASpC;;;AACA,mCAAiBR,MAAjB;AACAP,MAAAA,OAAO,CAACO,MAAD,CAAP;AACD,KAZc,CAAf;AAaD,GAdM,CAAP;AAeD",
      "sourceRoot": "/Users/egor/Dev/ytclone/1/server/src/",
      "sourcesContent": [
        "import express from \"express\";\n// Import this module to handle errors when using async functions for our route handlers\nimport \"express-async-errors\";\nimport path from \"path\";\nimport cors from \"cors\";\nimport logger from \"loglevel\";\nimport morgan from \"morgan\";\nimport dotenv from \"dotenv\";\nimport cookieParser from \"cookie-parser\";\n\nimport { getRoutes } from \"./routes\";\nimport { errorMiddleware, setupCloseOnExit } from \"./middleware/error\";\n\ndotenv.config();\n\nfunction startServer({ port = process.env.PORT } = {}) {\n  const app = express();\n  app.use(morgan(\"dev\"));\n  app.use(cors());\n  app.use(cookieParser());\n  app.use(express.json());\n  // all API routes are prefixed with /api/v1\n  app.use(\"/api/v1\", getRoutes());\n\n  // Generic error handler if errors are missed by 'express-async-errors' middleware\n  app.use(errorMiddleware);\n\n  // When our project is pushed to production, we will serve // the react app using express.static() middleware\n  if (process.env.NODE_ENV === \"production\") {\n    app.use(express.static(path.resolve(__dirname, \"../client/build\")));\n\n    // Any request not caught by our API will be routed\n    // to our built react app\n    app.get(\"*\", function (req, res) {\n      res.sendFile(path.resolve(__dirname, \"../client/build\", \"index.html\"));\n    });\n  }\n\n  // This block of code is made to reliably start and close our express app\n  // It is written as a promise, which can be more easily tested\n  return new Promise((resolve) => {\n    const server = app.listen(port, () => {\n      logger.info(`Listening on port ${server.address().port}`);\n\n      const originalClose = server.close.bind(server);\n      server.close = () => {\n        return new Promise((resolveClose) => {\n          originalClose(resolveClose);\n        });\n      };\n      // This function properly closes the server when the program exits\n      setupCloseOnExit(server);\n      resolve(server);\n    });\n  });\n}\n\nexport { startServer };\n"
      ]
    },
    "sourceType": "script",
    "mtime": 1611368296000
  },
  "{\"sourceRoot\":\"/Users/egor/Dev/ytclone/1/server/src/routes/\",\"caller\":{\"name\":\"@babel/register\"},\"cwd\":\"/Users/egor/Dev/ytclone/1\",\"filename\":\"/Users/egor/Dev/ytclone/1/server/src/routes/index.js\",\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"/Users/egor/Dev/ytclone/1\",\"plugins\":[{\"key\":\"syntax-numeric-separator\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"proposal-logical-assignment-operators\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"AssignmentExpression\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-nullish-coalescing-operator\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-optional-chaining\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-json-strings\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-optional-catch-binding\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-async-generators\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-object-rest-spread\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"transform-modules-commonjs\",\"visitor\":{\"CallExpression\":{\"enter\":[null]},\"Program\":{\"exit\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"proposal-dynamic-import\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"Program\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"proposal-export-namespace-from\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"ExportNamedDeclaration\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}}],\"presets\":[]}:7.12.10": {
    "metadata": {},
    "options": {
      "sourceRoot": "/Users/egor/Dev/ytclone/1/server/src/routes/",
      "caller": {
        "name": "@babel/register"
      },
      "cwd": "/Users/egor/Dev/ytclone/1",
      "filename": "/Users/egor/Dev/ytclone/1/server/src/routes/index.js",
      "cloneInputAst": true,
      "babelrc": false,
      "configFile": false,
      "envName": "development",
      "root": "/Users/egor/Dev/ytclone/1",
      "sourceMaps": "both",
      "ast": false,
      "passPerPreset": false,
      "plugins": [
        {
          "key": "syntax-numeric-separator",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "proposal-logical-assignment-operators",
          "visitor": {
            "_exploded": {},
            "_verified": {},
            "AssignmentExpression": {
              "enter": [
                null
              ]
            }
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-nullish-coalescing-operator",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-optional-chaining",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-json-strings",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-optional-catch-binding",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-async-generators",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-object-rest-spread",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "transform-modules-commonjs",
          "visitor": {
            "CallExpression": {
              "enter": [
                null
              ]
            },
            "Program": {
              "exit": [
                null
              ]
            },
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "proposal-dynamic-import",
          "visitor": {
            "_exploded": {},
            "_verified": {},
            "Program": {
              "enter": [
                null
              ]
            }
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "proposal-export-namespace-from",
          "visitor": {
            "_exploded": {},
            "_verified": {},
            "ExportNamedDeclaration": {
              "enter": [
                null
              ]
            }
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        }
      ],
      "presets": [],
      "parserOpts": {
        "sourceType": "module",
        "sourceFileName": "/Users/egor/Dev/ytclone/1/server/src/routes/index.js",
        "plugins": [
          "numericSeparator",
          "logicalAssignment",
          "nullishCoalescingOperator",
          "optionalChaining",
          "jsonStrings",
          "optionalCatchBinding",
          "asyncGenerators",
          "objectRestSpread",
          "dynamicImport",
          "exportNamespaceFrom"
        ]
      },
      "generatorOpts": {
        "filename": "/Users/egor/Dev/ytclone/1/server/src/routes/index.js",
        "comments": true,
        "compact": "auto",
        "sourceMaps": "both",
        "sourceRoot": "/Users/egor/Dev/ytclone/1/server/src/routes/",
        "sourceFileName": "index.js"
      }
    },
    "ast": null,
    "code": "\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.getRoutes = getRoutes;\n\nvar _express = _interopRequireDefault(require(\"express\"));\n\nvar _auth = require(\"./auth\");\n\nvar _user = require(\"./user\");\n\nvar _video = require(\"./video\");\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction getRoutes() {\n  // All routes in our Node API are placed on this router\n  const router = _express.default.Router(); // router.use() prefixes our route (i.e. /api/v1/auth)\n\n\n  router.use(\"/auth\", (0, _auth.getAuthRoutes)());\n  router.use(\"/users\", (0, _user.getUserRoutes)());\n  router.use(\"/videos\", (0, _video.getVideoRoutes)());\n  return router;\n}\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluZGV4LmpzIl0sIm5hbWVzIjpbImdldFJvdXRlcyIsInJvdXRlciIsImV4cHJlc3MiLCJSb3V0ZXIiLCJ1c2UiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFBQTs7QUFFQTs7QUFDQTs7QUFDQTs7OztBQUVBLFNBQVNBLFNBQVQsR0FBcUI7QUFDbkI7QUFDQSxRQUFNQyxNQUFNLEdBQUdDLGlCQUFRQyxNQUFSLEVBQWYsQ0FGbUIsQ0FJbkI7OztBQUNBRixFQUFBQSxNQUFNLENBQUNHLEdBQVAsQ0FBVyxPQUFYLEVBQW9CLDBCQUFwQjtBQUNBSCxFQUFBQSxNQUFNLENBQUNHLEdBQVAsQ0FBVyxRQUFYLEVBQXFCLDBCQUFyQjtBQUNBSCxFQUFBQSxNQUFNLENBQUNHLEdBQVAsQ0FBVyxTQUFYLEVBQXNCLDRCQUF0QjtBQUVBLFNBQU9ILE1BQVA7QUFDRCIsInNvdXJjZVJvb3QiOiIvVXNlcnMvZWdvci9EZXYveXRjbG9uZS8xL3NlcnZlci9zcmMvcm91dGVzLyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBleHByZXNzIGZyb20gXCJleHByZXNzXCI7XG5cbmltcG9ydCB7IGdldEF1dGhSb3V0ZXMgfSBmcm9tIFwiLi9hdXRoXCI7XG5pbXBvcnQgeyBnZXRVc2VyUm91dGVzIH0gZnJvbSBcIi4vdXNlclwiO1xuaW1wb3J0IHsgZ2V0VmlkZW9Sb3V0ZXMgfSBmcm9tIFwiLi92aWRlb1wiO1xuXG5mdW5jdGlvbiBnZXRSb3V0ZXMoKSB7XG4gIC8vIEFsbCByb3V0ZXMgaW4gb3VyIE5vZGUgQVBJIGFyZSBwbGFjZWQgb24gdGhpcyByb3V0ZXJcbiAgY29uc3Qgcm91dGVyID0gZXhwcmVzcy5Sb3V0ZXIoKTtcblxuICAvLyByb3V0ZXIudXNlKCkgcHJlZml4ZXMgb3VyIHJvdXRlIChpLmUuIC9hcGkvdjEvYXV0aClcbiAgcm91dGVyLnVzZShcIi9hdXRoXCIsIGdldEF1dGhSb3V0ZXMoKSk7XG4gIHJvdXRlci51c2UoXCIvdXNlcnNcIiwgZ2V0VXNlclJvdXRlcygpKTtcbiAgcm91dGVyLnVzZShcIi92aWRlb3NcIiwgZ2V0VmlkZW9Sb3V0ZXMoKSk7XG5cbiAgcmV0dXJuIHJvdXRlcjtcbn1cblxuZXhwb3J0IHsgZ2V0Um91dGVzIH07XG4iXX0=",
    "map": {
      "version": 3,
      "sources": [
        "index.js"
      ],
      "names": [
        "getRoutes",
        "router",
        "express",
        "Router",
        "use"
      ],
      "mappings": ";;;;;;;AAAA;;AAEA;;AACA;;AACA;;;;AAEA,SAASA,SAAT,GAAqB;AACnB;AACA,QAAMC,MAAM,GAAGC,iBAAQC,MAAR,EAAf,CAFmB,CAInB;;;AACAF,EAAAA,MAAM,CAACG,GAAP,CAAW,OAAX,EAAoB,0BAApB;AACAH,EAAAA,MAAM,CAACG,GAAP,CAAW,QAAX,EAAqB,0BAArB;AACAH,EAAAA,MAAM,CAACG,GAAP,CAAW,SAAX,EAAsB,4BAAtB;AAEA,SAAOH,MAAP;AACD",
      "sourceRoot": "/Users/egor/Dev/ytclone/1/server/src/routes/",
      "sourcesContent": [
        "import express from \"express\";\n\nimport { getAuthRoutes } from \"./auth\";\nimport { getUserRoutes } from \"./user\";\nimport { getVideoRoutes } from \"./video\";\n\nfunction getRoutes() {\n  // All routes in our Node API are placed on this router\n  const router = express.Router();\n\n  // router.use() prefixes our route (i.e. /api/v1/auth)\n  router.use(\"/auth\", getAuthRoutes());\n  router.use(\"/users\", getUserRoutes());\n  router.use(\"/videos\", getVideoRoutes());\n\n  return router;\n}\n\nexport { getRoutes };\n"
      ]
    },
    "sourceType": "script",
    "mtime": 1611368296000
  },
  "{\"sourceRoot\":\"/Users/egor/Dev/ytclone/1/server/src/routes/\",\"caller\":{\"name\":\"@babel/register\"},\"cwd\":\"/Users/egor/Dev/ytclone/1\",\"filename\":\"/Users/egor/Dev/ytclone/1/server/src/routes/auth.js\",\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"/Users/egor/Dev/ytclone/1\",\"plugins\":[{\"key\":\"syntax-numeric-separator\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"proposal-logical-assignment-operators\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"AssignmentExpression\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-nullish-coalescing-operator\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-optional-chaining\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-json-strings\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-optional-catch-binding\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-async-generators\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-object-rest-spread\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"transform-modules-commonjs\",\"visitor\":{\"CallExpression\":{\"enter\":[null]},\"Program\":{\"exit\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"proposal-dynamic-import\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"Program\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"proposal-export-namespace-from\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"ExportNamedDeclaration\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}}],\"presets\":[]}:7.12.10": {
    "metadata": {},
    "options": {
      "sourceRoot": "/Users/egor/Dev/ytclone/1/server/src/routes/",
      "caller": {
        "name": "@babel/register"
      },
      "cwd": "/Users/egor/Dev/ytclone/1",
      "filename": "/Users/egor/Dev/ytclone/1/server/src/routes/auth.js",
      "cloneInputAst": true,
      "babelrc": false,
      "configFile": false,
      "envName": "development",
      "root": "/Users/egor/Dev/ytclone/1",
      "sourceMaps": "both",
      "ast": false,
      "passPerPreset": false,
      "plugins": [
        {
          "key": "syntax-numeric-separator",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "proposal-logical-assignment-operators",
          "visitor": {
            "_exploded": {},
            "_verified": {},
            "AssignmentExpression": {
              "enter": [
                null
              ]
            }
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-nullish-coalescing-operator",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-optional-chaining",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-json-strings",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-optional-catch-binding",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-async-generators",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-object-rest-spread",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "transform-modules-commonjs",
          "visitor": {
            "CallExpression": {
              "enter": [
                null
              ]
            },
            "Program": {
              "exit": [
                null
              ]
            },
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "proposal-dynamic-import",
          "visitor": {
            "_exploded": {},
            "_verified": {},
            "Program": {
              "enter": [
                null
              ]
            }
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "proposal-export-namespace-from",
          "visitor": {
            "_exploded": {},
            "_verified": {},
            "ExportNamedDeclaration": {
              "enter": [
                null
              ]
            }
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        }
      ],
      "presets": [],
      "parserOpts": {
        "sourceType": "module",
        "sourceFileName": "/Users/egor/Dev/ytclone/1/server/src/routes/auth.js",
        "plugins": [
          "numericSeparator",
          "logicalAssignment",
          "nullishCoalescingOperator",
          "optionalChaining",
          "jsonStrings",
          "optionalCatchBinding",
          "asyncGenerators",
          "objectRestSpread",
          "dynamicImport",
          "exportNamespaceFrom"
        ]
      },
      "generatorOpts": {
        "filename": "/Users/egor/Dev/ytclone/1/server/src/routes/auth.js",
        "comments": true,
        "compact": "auto",
        "sourceMaps": "both",
        "sourceRoot": "/Users/egor/Dev/ytclone/1/server/src/routes/",
        "sourceFileName": "auth.js"
      }
    },
    "ast": null,
    "code": "\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.getAuthRoutes = getAuthRoutes;\n\nvar _client = require(\"@prisma/client\");\n\nvar _express = _interopRequireDefault(require(\"express\"));\n\nvar _jsonwebtoken = _interopRequireDefault(require(\"jsonwebtoken\"));\n\nvar _authorization = require(\"../middleware/authorization\");\n\nvar _googleAuthLibrary = require(\"google-auth-library\");\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nconst client = new _googleAuthLibrary.OAuth2Client(process.env.GOOGLE_CLIENT_ID);\nconst prisma = new _client.PrismaClient();\n\nfunction getAuthRoutes() {\n  const router = _express.default.Router();\n\n  router.post(\"/google-login\", googleLogin);\n  router.get(\"/me\", _authorization.protect, me);\n  router.get(\"/signout\", signout);\n  return router;\n} // All controllers/utility functions here\n\n\nasync function googleLogin(req, res) {\n  const {\n    idToken\n  } = req.body;\n  const ticket = await client.verifyIdToken({\n    idToken,\n    audience: process.env.GOOGLE_CLIENT_ID\n  });\n  const {\n    name,\n    picture,\n    email\n  } = ticket.getPayload();\n  let user = await prisma.user.findUnique({\n    where: {\n      email\n    }\n  });\n\n  if (!user) {\n    user = await prisma.user.create({\n      data: {\n        email,\n        username: name,\n        avatar: picture\n      }\n    });\n  }\n\n  const tokenPayload = {\n    id: user.id\n  };\n\n  const token = _jsonwebtoken.default.sign(tokenPayload, process.env.JWT_SECRET, {\n    expiresIn: process.env.JWT_EXPIRE\n  });\n\n  res.cookie(\"token\", token, {\n    httpOnly: true\n  });\n  res.status(200).send(token);\n}\n\nasync function me(req, res) {\n  const subscriptions = await prisma.subscription.findMany({\n    where: {\n      subscriberId: {\n        equals: req.user.id\n      }\n    }\n  });\n  const channelIds = subscriptions.map(sub => sub.subscribedToId);\n  const channels = await prisma.user.findMany({\n    where: {\n      id: {\n        in: channelIds\n      }\n    }\n  });\n  const user = req.user;\n  user.channels = channels;\n  res.status(200).json({\n    user\n  });\n}\n\nfunction signout(req, res) {\n  res.clearCookie(\"token\");\n  res.status(200).json({});\n}\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF1dGguanMiXSwibmFtZXMiOlsiY2xpZW50IiwiT0F1dGgyQ2xpZW50IiwicHJvY2VzcyIsImVudiIsIkdPT0dMRV9DTElFTlRfSUQiLCJwcmlzbWEiLCJQcmlzbWFDbGllbnQiLCJnZXRBdXRoUm91dGVzIiwicm91dGVyIiwiZXhwcmVzcyIsIlJvdXRlciIsInBvc3QiLCJnb29nbGVMb2dpbiIsImdldCIsInByb3RlY3QiLCJtZSIsInNpZ25vdXQiLCJyZXEiLCJyZXMiLCJpZFRva2VuIiwiYm9keSIsInRpY2tldCIsInZlcmlmeUlkVG9rZW4iLCJhdWRpZW5jZSIsIm5hbWUiLCJwaWN0dXJlIiwiZW1haWwiLCJnZXRQYXlsb2FkIiwidXNlciIsImZpbmRVbmlxdWUiLCJ3aGVyZSIsImNyZWF0ZSIsImRhdGEiLCJ1c2VybmFtZSIsImF2YXRhciIsInRva2VuUGF5bG9hZCIsImlkIiwidG9rZW4iLCJqd3QiLCJzaWduIiwiSldUX1NFQ1JFVCIsImV4cGlyZXNJbiIsIkpXVF9FWFBJUkUiLCJjb29raWUiLCJodHRwT25seSIsInN0YXR1cyIsInNlbmQiLCJzdWJzY3JpcHRpb25zIiwic3Vic2NyaXB0aW9uIiwiZmluZE1hbnkiLCJzdWJzY3JpYmVySWQiLCJlcXVhbHMiLCJjaGFubmVsSWRzIiwibWFwIiwic3ViIiwic3Vic2NyaWJlZFRvSWQiLCJjaGFubmVscyIsImluIiwianNvbiIsImNsZWFyQ29va2llIl0sIm1hcHBpbmdzIjoiOzs7Ozs7O0FBQUE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7Ozs7QUFFQSxNQUFNQSxNQUFNLEdBQUcsSUFBSUMsK0JBQUosQ0FBaUJDLE9BQU8sQ0FBQ0MsR0FBUixDQUFZQyxnQkFBN0IsQ0FBZjtBQUNBLE1BQU1DLE1BQU0sR0FBRyxJQUFJQyxvQkFBSixFQUFmOztBQUVBLFNBQVNDLGFBQVQsR0FBeUI7QUFDdkIsUUFBTUMsTUFBTSxHQUFHQyxpQkFBUUMsTUFBUixFQUFmOztBQUVBRixFQUFBQSxNQUFNLENBQUNH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TUFBSixDQUFXLEdBQVgsRUFBZ0JhLElBQWhCLENBQXFCO0FBQUU5QixJQUFBQTtBQUFGLEdBQXJCO0FBQ0Q7O0FBRUQsU0FBU1osT0FBVCxDQUFpQkMsR0FBakIsRUFBc0JDLEdBQXRCLEVBQTJCO0FBQ3pCQSxFQUFBQSxHQUFHLENBQUN5QyxXQUFKLENBQWdCLE9BQWhCO0FBQ0F6QyxFQUFBQSxHQUFHLENBQUMyQixNQUFKLENBQVcsR0FBWCxFQUFnQmEsSUFBaEIsQ0FBcUIsRUFBckI7QUFDRCIsInNvdXJjZVJvb3QiOiIvVXNlcnMvZWdvci9EZXYveXRjbG9uZS8xL3NlcnZlci9zcmMvcm91dGVzLyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFByaXNtYUNsaWVudCB9IGZyb20gXCJAcHJpc21hL2NsaWVudFwiO1xuaW1wb3J0IGV4cHJlc3MgZnJvbSBcImV4cHJlc3NcIjtcbmltcG9ydCBqd3QgZnJvbSBcImpzb253ZWJ0b2tlblwiO1xuaW1wb3J0IHsgcHJvdGVjdCB9IGZyb20gXCIuLi9taWRkbGV3YXJlL2F1dGhvcml6YXRpb25cIjtcbmltcG9ydCB7IE9BdXRoMkNsaWVudCB9IGZyb20gXCJnb29nbGUtYXV0aC1saWJyYXJ5XCI7XG5cbmNvbnN0IGNsaWVudCA9IG5ldyBPQXV0aDJDbGllbnQocHJvY2Vzcy5lbnYuR09PR0xFX0NMSUVOVF9JRCk7XG5jb25zdCBwcmlzbWEgPSBuZXcgUHJpc21hQ2xpZW50KCk7XG5cbmZ1bmN0aW9uIGdldEF1dGhSb3V0ZXMoKSB7XG4gIGNvbnN0IHJvdXRlciA9IGV4cHJlc3MuUm91dGVyKCk7XG5cbiAgcm91dGVyLnBvc3QoXCIvZ29vZ2xlLWxvZ2luXCIsIGdvb2dsZUxvZ2luKTtcbiAgcm91dGVyLmdldChcIi9tZVwiLCBwcm90ZWN0LCBtZSk7XG4gIHJvdXRlci5nZXQoXCIvc2lnbm91dFwiLCBzaWdub3V0KTtcblxuICByZXR1cm4gcm91dGVyO1xufVxuXG4vLyBBbGwgY29udHJvbGxlcnMvdXRpbGl0eSBmdW5jdGlvbnMgaGVyZVxuYXN5bmMgZnVuY3Rpb24gZ29vZ2xlTG9naW4ocmVxLCByZXMpIHtcbiAgY29uc3QgeyBpZFRva2VuIH0gPSByZXEuYm9keTtcbiAgY29uc3QgdGlja2V0ID0gYXdhaXQgY2xpZW50LnZlcmlmeUlkVG9rZW4oe1xuICAgIGlkVG9rZW4sXG4gICAgYXVkaWVuY2U6IHByb2Nlc3MuZW52LkdPT0dMRV9DTElFTlRfSUQsXG4gIH0pO1xuICBjb25zdCB7IG5hbWUsIHBpY3R1cmUsIGVtYWlsIH0gPSB0aWNrZXQuZ2V0UGF5bG9hZCgpO1xuXG4gIGxldCB1c2VyID0gYXdhaXQgcHJpc21hLnVzZXIuZmluZFVuaXF1ZSh7XG4gICAgd2hlcmU6IHtcbiAgICAgIGVtYWlsLFxuICAgIH0sXG4gIH0pO1xuXG4gIGlmICghdXNlcikge1xuICAgIHVzZXIgPSBhd2FpdCBwcmlzbWEudXNlci5jcmVhdGUoe1xuICAgICAgZGF0YToge1xuICAgICAgICBlbWFpbCxcbiAgICAgICAgdXNlcm5hbWU6IG5hbWUsXG4gICAgICAgIGF2YXRhcjogcGljdHVyZSxcbiAgICAgIH0sXG4gICAgfSk7XG4gIH1cblxuICBjb25zdCB0b2tlblBheWxvYWQgPSB7IGlkOiB1c2VyLmlkIH07XG4gIGNvbnN0IHRva2VuID0gand0LnNpZ24odG9rZW5QYXlsb2FkLCBwcm9jZXNzLmVudi5KV1RfU0VDUkVULCB7XG4gICAgZXhwaXJlc0luOiBwcm9jZXNzLmVudi5KV1RfRVhQSVJFLFxuICB9KTtcblxuICByZXMuY29va2llKFwidG9rZW5cIiwgdG9rZW4sIHsgaHR0cE9ubHk6IHRydWUgfSk7XG4gIHJlcy5zdGF0dXMoMjAwKS5zZW5kKHRva2VuKTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gbWUocmVxLCByZXMpIHtcbiAgY29uc3Qgc3Vic2NyaXB0aW9ucyA9IGF3YWl0IHByaXNtYS5zdWJzY3JpcHRpb24uZmluZE1hbnkoe1xuICAgIHdoZXJlOiB7XG4gICAgICBzdWJzY3JpYmVySWQ6IHtcbiAgICAgICAgZXF1YWxzOiByZXEudXNlci5pZCxcbiAgICAgIH0sXG4gICAgfSxcbiAgfSk7XG5cbiAgY29uc3QgY2hhbm5lbElkcyA9IHN1YnNjcmlwdGlvbnMubWFwKChzdWIpID0+IHN1Yi5zdWJzY3JpYmVkVG9JZCk7XG5cbiAgY29uc3QgY2hhbm5lbHMgPSBhd2FpdCBwcmlzbWEudXNlci5maW5kTWFueSh7XG4gICAgd2hlcmU6IHtcbiAgICAgIGlkOiB7XG4gICAgICAgIGluOiBjaGFubmVsSWRzLFxuICAgICAgfSxcbiAgICB9LFxuICB9KTtcblxuICBjb25zdCB1c2VyID0gcmVxLnVzZXI7XG4gIHVzZXIuY2hhbm5lbHMgPSBjaGFubmVscztcblxuICByZXMuc3RhdHVzKDIwMCkuanNvbih7IHVzZXIgfSk7XG59XG5cbmZ1bmN0aW9uIHNpZ25vdXQocmVxLCByZXMpIHtcbiAgcmVzLmNsZWFyQ29va2llKFwidG9rZW5cIik7XG4gIHJlcy5zdGF0dXMoMjAwKS5qc29uKHt9KTtcbn1cblxuZXhwb3J0IHsgZ2V0QXV0aFJvdXRlcyB9O1xuIl19",
    "map": {
      "version": 3,
      "sources": [
        "auth.js"
      ],
      "names": [
        "client",
        "OAuth2Client",
        "process",
        "env",
        "GOOGLE_CLIENT_ID",
        "prisma",
        "PrismaClient",
        "getAuthRoutes",
        "router",
        "express",
        "Router",
        "post",
        "googleLogin",
        "get",
        "protect",
        "me",
        "signout",
        "req",
        "res",
        "idToken",
        "body",
        "ticket",
        "verifyIdToken",
        "audience",
        "name",
        "picture",
        "email",
        "getPayload",
        "user",
        "findUnique",
        "where",
        "create",
        "data",
        "username",
        "avatar",
        "tokenPayload",
        "id",
        "token",
        "jwt",
        "sign",
        "JWT_SECRET",
        "expiresIn",
        "JWT_EXPIRE",
        "cookie",
        "httpOnly",
        "status",
        "send",
        "subscriptions",
        "subscription",
        "findMany",
        "subscriberId",
        "equals",
        "channelIds",
        "map",
        "sub",
        "subscribedToId",
        "channels",
        "in",
        "json",
        "clearCookie"
      ],
      "mappings": "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",
      "sourceRoot": "/Users/egor/Dev/ytclone/1/server/src/routes/",
      "sourcesContent": [
        "import { PrismaClient } from \"@prisma/client\";\nimport express from \"express\";\nimport jwt from \"jsonwebtoken\";\nimport { protect } from \"../middleware/authorization\";\nimport { OAuth2Client } from \"google-auth-library\";\n\nconst client = new OAuth2Client(process.env.GOOGLE_CLIENT_ID);\nconst prisma = new PrismaClient();\n\nfunction getAuthRoutes() {\n  const router = express.Router();\n\n  router.post(\"/google-login\", googleLogin);\n  router.get(\"/me\", protect, me);\n  router.get(\"/signout\", signout);\n\n  return router;\n}\n\n// All controllers/utility functions here\nasync function googleLogin(req, res) {\n  const { idToken } = req.body;\n  const ticket = await client.verifyIdToken({\n    idToken,\n    audience: process.env.GOOGLE_CLIENT_ID,\n  });\n  const { name, picture, email } = ticket.getPayload();\n\n  let user = await prisma.user.findUnique({\n    where: {\n      email,\n    },\n  });\n\n  if (!user) {\n    user = await prisma.user.create({\n      data: {\n        email,\n        username: name,\n        avatar: picture,\n      },\n    });\n  }\n\n  const tokenPayload = { id: user.id };\n  const token = jwt.sign(tokenPayload, process.env.JWT_SECRET, {\n    expiresIn: process.env.JWT_EXPIRE,\n  });\n\n  res.cookie(\"token\", token, { httpOnly: true });\n  res.status(200).send(token);\n}\n\nasync function me(req, res) {\n  const subscriptions = await prisma.subscription.findMany({\n    where: {\n      subscriberId: {\n        equals: req.user.id,\n      },\n    },\n  });\n\n  const channelIds = subscriptions.map((sub) => sub.subscribedToId);\n\n  const channels = await prisma.user.findMany({\n    where: {\n      id: {\n        in: channelIds,\n      },\n    },\n  });\n\n  const user = req.user;\n  user.channels = channels;\n\n  res.status(200).json({ user });\n}\n\nfunction signout(req, res) {\n  res.clearCookie(\"token\");\n  res.status(200).json({});\n}\n\nexport { getAuthRoutes };\n"
      ]
    },
    "sourceType": "script",
    "mtime": 1611452835000
  },
  "{\"sourceRoot\":\"/Users/egor/Dev/ytclone/1/server/src/middleware/\",\"caller\":{\"name\":\"@babel/register\"},\"cwd\":\"/Users/egor/Dev/ytclone/1\",\"filename\":\"/Users/egor/Dev/ytclone/1/server/src/middleware/authorization.js\",\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"/Users/egor/Dev/ytclone/1\",\"plugins\":[{\"key\":\"syntax-numeric-separator\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"proposal-logical-assignment-operators\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"AssignmentExpression\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-nullish-coalescing-operator\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-optional-chaining\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-json-strings\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-optional-catch-binding\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-async-generators\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-object-rest-spread\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"transform-modules-commonjs\",\"visitor\":{\"CallExpression\":{\"enter\":[null]},\"Program\":{\"exit\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"proposal-dynamic-import\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"Program\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"proposal-export-namespace-from\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"ExportNamedDeclaration\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}}],\"presets\":[]}:7.12.10": {
    "metadata": {},
    "options": {
      "sourceRoot": "/Users/egor/Dev/ytclone/1/server/src/middleware/",
      "caller": {
        "name": "@babel/register"
      },
      "cwd": "/Users/egor/Dev/ytclone/1",
      "filename": "/Users/egor/Dev/ytclone/1/server/src/middleware/authorization.js",
      "cloneInputAst": true,
      "babelrc": false,
      "configFile": false,
      "envName": "development",
      "root": "/Users/egor/Dev/ytclone/1",
      "sourceMaps": "both",
      "ast": false,
      "passPerPreset": false,
      "plugins": [
        {
          "key": "syntax-numeric-separator",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "proposal-logical-assignment-operators",
          "visitor": {
            "_exploded": {},
            "_verified": {},
            "AssignmentExpression": {
              "enter": [
                null
              ]
            }
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-nullish-coalescing-operator",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-optional-chaining",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-json-strings",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-optional-catch-binding",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-async-generators",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-object-rest-spread",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "transform-modules-commonjs",
          "visitor": {
            "CallExpression": {
              "enter": [
                null
              ]
            },
            "Program": {
              "exit": [
                null
              ]
            },
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "proposal-dynamic-import",
          "visitor": {
            "_exploded": {},
            "_verified": {},
            "Program": {
              "enter": [
                null
              ]
            }
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "proposal-export-namespace-from",
          "visitor": {
            "_exploded": {},
            "_verified": {},
            "ExportNamedDeclaration": {
              "enter": [
                null
              ]
            }
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        }
      ],
      "presets": [],
      "parserOpts": {
        "sourceType": "module",
        "sourceFileName": "/Users/egor/Dev/ytclone/1/server/src/middleware/authorization.js",
        "plugins": [
          "numericSeparator",
          "logicalAssignment",
          "nullishCoalescingOperator",
          "optionalChaining",
          "jsonStrings",
          "optionalCatchBinding",
          "asyncGenerators",
          "objectRestSpread",
          "dynamicImport",
          "exportNamespaceFrom"
        ]
      },
      "generatorOpts": {
        "filename": "/Users/egor/Dev/ytclone/1/server/src/middleware/authorization.js",
        "comments": true,
        "compact": "auto",
        "sourceMaps": "both",
        "sourceRoot": "/Users/egor/Dev/ytclone/1/server/src/middleware/",
        "sourceFileName": "authorization.js"
      }
    },
    "ast": null,
    "code": "\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.getAuthUser = getAuthUser;\nexports.protect = protect;\n\nvar _client = require(\"@prisma/client\");\n\nvar _jsonwebtoken = _interopRequireDefault(require(\"jsonwebtoken\"));\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nconst prisma = new _client.PrismaClient();\n\nasync function getAuthUser(req, res, next) {\n  if (!req.cookies.token) {\n    req.user = null;\n    return next();\n  }\n\n  const token = req.cookies.token;\n\n  const decoded = _jsonwebtoken.default.verify(token, process.env.JWT_SECRET);\n\n  const user = await prisma.user.findUnique({\n    where: {\n      id: decoded.id\n    },\n    include: {\n      videos: true\n    }\n  });\n  req.user = user;\n  next();\n}\n\nasync function protect(req, res, next) {\n  if (!req.cookies.token) {\n    return next({\n      message: \"You need to be logged in to visit this route\",\n      statusCode: 401\n    });\n  }\n\n  try {\n    const token = req.cookies.token;\n\n    const decoded = _jsonwebtoken.default.verify(token, process.env.JWT_SECRET);\n\n    const user = await prisma.user.findUnique({\n      where: {\n        id: decoded.id\n      },\n      include: {\n        videos: true\n      }\n    });\n    req.user = user;\n    next();\n  } catch (error) {\n    next({\n      message: \"You need to be logged in to visit this route\",\n      statusCode: 401\n    });\n  }\n}\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF1dGhvcml6YXRpb24uanMiXSwibmFtZXMiOlsicHJpc21hIiwiUHJpc21hQ2xpZW50IiwiZ2V0QXV0aFVzZXIiLCJyZXEiLCJyZXMiLCJuZXh0IiwiY29va2llcyIsInRva2VuIiwidXNlciIsImRlY29kZWQiLCJqd3QiLCJ2ZXJpZnkiLCJwcm9jZXNzIiwiZW52IiwiSldUX1NFQ1JFVCIsImZpbmRVbmlxdWUiLCJ3aGVyZSIsImlkIiwiaW5jbHVkZSIsInZpZGVvcyIsInByb3RlY3QiLCJtZXNzYWdlIiwic3RhdHVzQ29kZSIsImVycm9yIl0sIm1hcHBpbmdzIjoiOzs7Ozs7OztBQUFBOztBQUNBOzs7O0FBRUEsTUFBTUEsTUFBTSxHQUFHLElBQUlDLG9CQUFKLEVBQWY7O0FBRU8sZUFBZUMsV0FBZixDQUEyQkMsR0FBM0IsRUFBZ0NDLEdBQWhDLEVBQXFDQyxJQUFyQyxFQUEyQztBQUNoRCxNQUFJLENBQUNGLEdBQUcsQ0FBQ0csT0FBSixDQUFZQyxLQUFqQixFQUF3QjtBQUN0QkosSUFBQUEsR0FBRyxDQUFDSyxJQUFKLEdBQVcsSUFBWDtBQUNBLFdBQU9ILElBQUksRUFBWDtBQUNEOztBQUVELFFBQU1FLEtBQUssR0FBR0osR0FBRyxDQUFDRyxPQUFKLENBQVlDLEtBQTFCOztBQUNBLFFBQU1FLE9BQU8sR0FBR0Msc0JBQUlDLE1BQUosQ0FBV0osS0FBWCxFQUFrQkssT0FBTyxDQUFDQyxHQUFSLENBQVlDLFVBQTlCLENBQWhCOztBQUVBLFFBQU1OLElBQUksR0FBRyxNQUFNUixNQUFNLENBQUNRLElBQVAsQ0FBWU8sVUFBWixDQUF1QjtBQUN4Q0MsSUFBQUEsS0FBSyxFQUFFO0FBQ0xDLE1BQUFBLEVBQUUsRUFBRVIsT0FBTyxDQUFDUTtBQURQLEtBRGlDO0FBSXhDQyxJQUFBQSxPQUFPLEVBQUU7QUFDUEMsTUFBQUEsTUFBTSxFQUFFO0FBREQ7QUFKK0IsR0FBdkIsQ0FBbkI7QUFTQWhCLEVBQUFBLEdBQUcsQ0FBQ0ssSUFBSixHQUFXQSxJQUFYO0FBQ0FILEVBQUFBLElBQUk7QUFDTDs7QUFFTSxlQUFlZSxPQUFmLENBQXVCakIsR0FBdkIsRUFBNEJDLEdBQTVCLEVBQWlDQyxJQUFqQyxFQUF1QztBQUM1QyxNQUFJLENBQUNGLEdBQUcsQ0FBQ0csT0FBSixDQUFZQyxLQUFqQixFQUF3QjtBQUN0QixXQUFPRixJQUFJLENBQUM7QUFDVmdCLE1BQUFBLE9BQU8sRUFBRSw4Q0FEQztBQUVWQyxNQUFBQSxVQUFVLEVBQUU7QUFGRixLQUFELENBQVg7QUFJRDs7QUFFRCxNQUFJO0FBQ0YsVUFBTWYsS0FBSyxHQUFHSixHQUFHLENBQUNHLE9BQUosQ0FBWUMsS0FBMUI7O0FBQ0EsVUFBTUUsT0FBTyxHQUFHQyxzQkFBSUMsTUFBSixDQUFXSixLQUFYLEVBQWtCSyxPQUFPLENBQUNDLEdBQVIsQ0FBWUMsVUFBOUIsQ0FBaEI7O0FBRUEsVUFBTU4sSUFBSSxHQUFHLE1BQU1SLE1BQU0sQ0FBQ1EsSUFBUCxDQUFZTyxVQUFaLENBQXVCO0FBQ3hDQyxNQUFBQSxLQUFLLEVBQUU7QUFDTEMsUUFBQUEsRUFBRSxFQUFFUixPQUFPLENBQUNRO0FBRFAsT0FEaUM7QUFJeENDLE1BQUFBLE9BQU8sRUFBRTtBQUNQQyxRQUFBQSxNQUFNLEVBQUU7QUFERDtBQUorQixLQUF2QixDQUFuQjtBQVNBaEIsSUFBQUEsR0FBRyxDQUFDSyxJQUFKLEdBQVdBLElBQVg7QUFDQUgsSUFBQUEsSUFBSTtBQUNMLEdBZkQsQ0FlRSxPQUFPa0IsS0FBUCxFQUFjO0FBQ2RsQixJQUFBQSxJQUFJLENBQUM7QUFDSGdCLE1BQUFBLE9BQU8sRUFBRSw4Q0FETjtBQUVIQyxNQUFBQSxVQUFVLEVBQUU7QUFGVCxLQUFELENBQUo7QUFJRDtBQUNGIiwic291cmNlUm9vdCI6Ii9Vc2Vycy9lZ29yL0Rldi95dGNsb25lLzEvc2VydmVyL3NyYy9taWRkbGV3YXJlLyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFByaXNtYUNsaWVudCB9IGZyb20gXCJAcHJpc21hL2NsaWVudFwiO1xuaW1wb3J0IGp3dCBmcm9tIFwianNvbndlYnRva2VuXCI7XG5cbmNvbnN0IHByaXNtYSA9IG5ldyBQcmlzbWFDbGllbnQoKTtcblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldEF1dGhVc2VyKHJlcSwgcmVzLCBuZXh0KSB7XG4gIGlmICghcmVxLmNvb2tpZXMudG9rZW4pIHtcbiAgICByZXEudXNlciA9IG51bGw7XG4gICAgcmV0dXJuIG5leHQoKTtcbiAgfVxuXG4gIGNvbnN0IHRva2VuID0gcmVxLmNvb2tpZXMudG9rZW47XG4gIGNvbnN0IGRlY29kZWQgPSBqd3QudmVyaWZ5KHRva2VuLCBwcm9jZXNzLmVudi5KV1RfU0VDUkVUKTtcblxuICBjb25zdCB1c2VyID0gYXdhaXQgcHJpc21hLnVzZXIuZmluZFVuaXF1ZSh7XG4gICAgd2hlcmU6IHtcbiAgICAgIGlkOiBkZWNvZGVkLmlkLFxuICAgIH0sXG4gICAgaW5jbHVkZToge1xuICAgICAgdmlkZW9zOiB0cnVlLFxuICAgIH0sXG4gIH0pO1xuXG4gIHJlcS51c2VyID0gdXNlcjtcbiAgbmV4dCgpO1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gcHJvdGVjdChyZXEsIHJlcywgbmV4dCkge1xuICBpZiAoIXJlcS5jb29raWVzLnRva2VuKSB7XG4gICAgcmV0dXJuIG5leHQoe1xuICAgICAgbWVzc2FnZTogXCJZb3UgbmVlZCB0byBiZSBsb2dnZWQgaW4gdG8gdmlzaXQgdGhpcyByb3V0ZVwiLFxuICAgICAgc3RhdHVzQ29kZTogNDAxLFxuICAgIH0pO1xuICB9XG5cbiAgdHJ5IHtcbiAgICBjb25zdCB0b2tlbiA9IHJlcS5jb29raWVzLnRva2VuO1xuICAgIGNvbnN0IGRlY29kZWQgPSBqd3QudmVyaWZ5KHRva2VuLCBwcm9jZXNzLmVudi5KV1RfU0VDUkVUKTtcblxuICAgIGNvbnN0IHVzZXIgPSBhd2FpdCBwcmlzbWEudXNlci5maW5kVW5pcXVlKHtcbiAgICAgIHdoZXJlOiB7XG4gICAgICAgIGlkOiBkZWNvZGVkLmlkLFxuICAgICAgfSxcbiAgICAgIGluY2x1ZGU6IHtcbiAgICAgICAgdmlkZW9zOiB0cnVlLFxuICAgICAgfSxcbiAgICB9KTtcblxuICAgIHJlcS51c2VyID0gdXNlcjtcbiAgICBuZXh0KCk7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgbmV4dCh7XG4gICAgICBtZXNzYWdlOiBcIllvdSBuZWVkIHRvIGJlIGxvZ2dlZCBpbiB0byB2aXNpdCB0aGlzIHJvdXRlXCIsXG4gICAgICBzdGF0dXNDb2RlOiA0MDEsXG4gICAgfSk7XG4gIH1cbn1cbiJdfQ==",
    "map": {
      "version": 3,
      "sources": [
        "authorization.js"
      ],
      "names": [
        "prisma",
        "PrismaClient",
        "getAuthUser",
        "req",
        "res",
        "next",
        "cookies",
        "token",
        "user",
        "decoded",
        "jwt",
        "verify",
        "process",
        "env",
        "JWT_SECRET",
        "findUnique",
        "where",
        "id",
        "include",
        "videos",
        "protect",
        "message",
        "statusCode",
        "error"
      ],
      "mappings": ";;;;;;;;AAAA;;AACA;;;;AAEA,MAAMA,MAAM,GAAG,IAAIC,oBAAJ,EAAf;;AAEO,eAAeC,WAAf,CAA2BC,GAA3B,EAAgCC,GAAhC,EAAqCC,IAArC,EAA2C;AAChD,MAAI,CAACF,GAAG,CAACG,OAAJ,CAAYC,KAAjB,EAAwB;AACtBJ,IAAAA,GAAG,CAACK,IAAJ,GAAW,IAAX;AACA,WAAOH,IAAI,EAAX;AACD;;AAED,QAAME,KAAK,GAAGJ,GAAG,CAACG,OAAJ,CAAYC,KAA1B;;AACA,QAAME,OAAO,GAAGC,sBAAIC,MAAJ,CAAWJ,KAAX,EAAkBK,OAAO,CAACC,GAAR,CAAYC,UAA9B,CAAhB;;AAEA,QAAMN,IAAI,GAAG,MAAMR,MAAM,CAACQ,IAAP,CAAYO,UAAZ,CAAuB;AACxCC,IAAAA,KAAK,EAAE;AACLC,MAAAA,EAAE,EAAER,OAAO,CAACQ;AADP,KADiC;AAIxCC,IAAAA,OAAO,EAAE;AACPC,MAAAA,MAAM,EAAE;AADD;AAJ+B,GAAvB,CAAnB;AASAhB,EAAAA,GAAG,CAACK,IAAJ,GAAWA,IAAX;AACAH,EAAAA,IAAI;AACL;;AAEM,eAAee,OAAf,CAAuBjB,GAAvB,EAA4BC,GAA5B,EAAiCC,IAAjC,EAAuC;AAC5C,MAAI,CAACF,GAAG,CAACG,OAAJ,CAAYC,KAAjB,EAAwB;AACtB,WAAOF,IAAI,CAAC;AACVgB,MAAAA,OAAO,EAAE,8CADC;AAEVC,MAAAA,UAAU,EAAE;AAFF,KAAD,CAAX;AAID;;AAED,MAAI;AACF,UAAMf,KAAK,GAAGJ,GAAG,CAACG,OAAJ,CAAYC,KAA1B;;AACA,UAAME,OAAO,GAAGC,sBAAIC,MAAJ,CAAWJ,KAAX,EAAkBK,OAAO,CAACC,GAAR,CAAYC,UAA9B,CAAhB;;AAEA,UAAMN,IAAI,GAAG,MAAMR,MAAM,CAACQ,IAAP,CAAYO,UAAZ,CAAuB;AACxCC,MAAAA,KAAK,EAAE;AACLC,QAAAA,EAAE,EAAER,OAAO,CAACQ;AADP,OADiC;AAIxCC,MAAAA,OAAO,EAAE;AACPC,QAAAA,MAAM,EAAE;AADD;AAJ+B,KAAvB,CAAnB;AASAhB,IAAAA,GAAG,CAACK,IAAJ,GAAWA,IAAX;AACAH,IAAAA,IAAI;AACL,GAfD,CAeE,OAAOkB,KAAP,EAAc;AACdlB,IAAAA,IAAI,CAAC;AACHgB,MAAAA,OAAO,EAAE,8CADN;AAEHC,MAAAA,UAAU,EAAE;AAFT,KAAD,CAAJ;AAID;AACF",
      "sourceRoot": "/Users/egor/Dev/ytclone/1/server/src/middleware/",
      "sourcesContent": [
        "import { PrismaClient } from \"@prisma/client\";\nimport jwt from \"jsonwebtoken\";\n\nconst prisma = new PrismaClient();\n\nexport async function getAuthUser(req, res, next) {\n  if (!req.cookies.token) {\n    req.user = null;\n    return next();\n  }\n\n  const token = req.cookies.token;\n  const decoded = jwt.verify(token, process.env.JWT_SECRET);\n\n  const user = await prisma.user.findUnique({\n    where: {\n      id: decoded.id,\n    },\n    include: {\n      videos: true,\n    },\n  });\n\n  req.user = user;\n  next();\n}\n\nexport async function protect(req, res, next) {\n  if (!req.cookies.token) {\n    return next({\n      message: \"You need to be logged in to visit this route\",\n      statusCode: 401,\n    });\n  }\n\n  try {\n    const token = req.cookies.token;\n    const decoded = jwt.verify(token, process.env.JWT_SECRET);\n\n    const user = await prisma.user.findUnique({\n      where: {\n        id: decoded.id,\n      },\n      include: {\n        videos: true,\n      },\n    });\n\n    req.user = user;\n    next();\n  } catch (error) {\n    next({\n      message: \"You need to be logged in to visit this route\",\n      statusCode: 401,\n    });\n  }\n}\n"
      ]
    },
    "sourceType": "script",
    "mtime": 1611454252000
  },
  "{\"sourceRoot\":\"/Users/egor/Dev/ytclone/1/server/src/routes/\",\"caller\":{\"name\":\"@babel/register\"},\"cwd\":\"/Users/egor/Dev/ytclone/1\",\"filename\":\"/Users/egor/Dev/ytclone/1/server/src/routes/user.js\",\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"/Users/egor/Dev/ytclone/1\",\"plugins\":[{\"key\":\"syntax-numeric-separator\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"proposal-logical-assignment-operators\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"AssignmentExpression\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-nullish-coalescing-operator\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-optional-chaining\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-json-strings\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-optional-catch-binding\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-async-generators\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-object-rest-spread\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"transform-modules-commonjs\",\"visitor\":{\"CallExpression\":{\"enter\":[null]},\"Program\":{\"exit\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"proposal-dynamic-import\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"Program\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"proposal-export-namespace-from\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"ExportNamedDeclaration\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}}],\"presets\":[]}:7.12.10": {
    "metadata": {},
    "options": {
      "sourceRoot": "/Users/egor/Dev/ytclone/1/server/src/routes/",
      "caller": {
        "name": "@babel/register"
      },
      "cwd": "/Users/egor/Dev/ytclone/1",
      "filename": "/Users/egor/Dev/ytclone/1/server/src/routes/user.js",
      "cloneInputAst": true,
      "babelrc": false,
      "configFile": false,
      "envName": "development",
      "root": "/Users/egor/Dev/ytclone/1",
      "sourceMaps": "both",
      "ast": false,
      "passPerPreset": false,
      "plugins": [
        {
          "key": "syntax-numeric-separator",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "proposal-logical-assignment-operators",
          "visitor": {
            "_exploded": {},
            "_verified": {},
            "AssignmentExpression": {
              "enter": [
                null
              ]
            }
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-nullish-coalescing-operator",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-optional-chaining",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-json-strings",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-optional-catch-binding",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-async-generators",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-object-rest-spread",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "transform-modules-commonjs",
          "visitor": {
            "CallExpression": {
              "enter": [
                null
              ]
            },
            "Program": {
              "exit": [
                null
              ]
            },
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "proposal-dynamic-import",
          "visitor": {
            "_exploded": {},
            "_verified": {},
            "Program": {
              "enter": [
                null
              ]
            }
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "proposal-export-namespace-from",
          "visitor": {
            "_exploded": {},
            "_verified": {},
            "ExportNamedDeclaration": {
              "enter": [
                null
              ]
            }
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        }
      ],
      "presets": [],
      "parserOpts": {
        "sourceType": "module",
        "sourceFileName": "/Users/egor/Dev/ytclone/1/server/src/routes/user.js",
        "plugins": [
          "numericSeparator",
          "logicalAssignment",
          "nullishCoalescingOperator",
          "optionalChaining",
          "jsonStrings",
          "optionalCatchBinding",
          "asyncGenerators",
          "objectRestSpread",
          "dynamicImport",
          "exportNamespaceFrom"
        ]
      },
      "generatorOpts": {
        "filename": "/Users/egor/Dev/ytclone/1/server/src/routes/user.js",
        "comments": true,
        "compact": "auto",
        "sourceMaps": "both",
        "sourceRoot": "/Users/egor/Dev/ytclone/1/server/src/routes/",
        "sourceFileName": "user.js"
      }
    },
    "ast": null,
    "code": "\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.getUserRoutes = getUserRoutes;\n\nvar _client = require(\"@prisma/client\");\n\nvar _express = _interopRequireDefault(require(\"express\"));\n\nvar _authorization = require(\"../middleware/authorization\");\n\nvar _video = require(\"./video\");\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nconst prisma = new _client.PrismaClient();\n\nfunction getUserRoutes() {\n  const router = _express.default.Router();\n\n  router.get(\"/\", _authorization.protect, getRecommendedChannels);\n  router.put(\"/\", _authorization.protect, editUser);\n  router.get(\"/liked-videos\", _authorization.protect, getLikedVideos);\n  router.get(\"/history\", _authorization.protect, getHistory);\n  router.get(\"/subscriptions\", _authorization.protect, getFeed);\n  router.get(\"/search\", _authorization.getAuthUser, searchUser);\n  router.get(\"/:userId\", _authorization.getAuthUser, getProfile);\n  router.get(\"/:userId/toggle-subscribe\", _authorization.protect, toggleSubscribe);\n  return router;\n}\n\nasync function getLikedVideos(req, res) {\n  await getVideos(prisma.videoLike, req, res);\n}\n\nasync function getHistory(req, res) {\n  await getVideos(prisma.view, req, res);\n}\n\nasync function getVideos(model, req, res) {\n  const videoRelations = await model.findMany({\n    where: {\n      userId: req.user.id\n    },\n    orderBy: {\n      createdAt: \"desc\"\n    }\n  });\n  const videoIds = videoRelations.map(videoLike => videoLike.videoId);\n  let videos = await prisma.video.findMany({\n    where: {\n      id: {\n        in: videoIds\n      }\n    },\n    include: {\n      user: true\n    }\n  });\n\n  if (!videos.length) {\n    return res.status(200).json({\n      videos\n    });\n  }\n\n  videos = await (0, _video.getVideoViews)(videos);\n  res.status(200).json({\n    videos\n  });\n}\n\nasync function toggleSubscribe(req, res, next) {\n  if (req.user.id === req.params.userId) {\n    return next({\n      message: \"You cannot subscribe to your own channel\",\n      statusCode: 400\n    });\n  }\n\n  const user = await prisma.user.findUnique({\n    where: {\n      id: req.params.userId\n    }\n  });\n\n  if (!user) {\n    return next({\n      message: `No user found with id: \"${req.params.userId}\"`,\n      statusCode: 404\n    });\n  }\n\n  const isSubscribed = await prisma.subscription.findFirst({\n    where: {\n      subscriberId: {\n        equals: req.user.id\n      },\n      subscribedToId: {\n        equals: req.params.userId\n      }\n    }\n  });\n\n  if (isSubscribed) {\n    await prisma.subscription.delete({\n      where: {\n        id: isSubscribed.id\n      }\n    });\n  } else {\n    await prisma.subscription.create({\n      data: {\n        subscriber: {\n          connect: {\n            id: req.user.id\n          }\n        },\n        subscribedTo: {\n          connect: {\n            id: req.params.userId\n          }\n        }\n      }\n    });\n  }\n\n  res.status(200).json({});\n}\n\nasync function getFeed(req, res) {\n  const subscribedTo = await prisma.subscription.findMany({\n    where: {\n      subscriberId: {\n        equals: req.user.id\n      }\n    }\n  });\n  const subscriptions = subscribedTo.map(sub => sub.subscribedToId);\n  const feed = await prisma.video.findMany({\n    where: {\n      userId: {\n        in: subscriptions\n      }\n    },\n    include: {\n      user: true\n    },\n    orderBy: {\n      createdAt: \"desc\"\n    }\n  });\n\n  if (!feed.length) {\n    return res.status(200).json({\n      feed\n    });\n  }\n\n  const feedVideos = await (0, _video.getVideoViews)(feed);\n  res.status(200).json({\n    feed: feedVideos\n  });\n}\n\nasync function searchUser(req, res, next) {\n  if (!req.query.query) {\n    return next({\n      message: \"Please enter a search query\",\n      statusCode: 400\n    });\n  }\n\n  const users = await prisma.user.findMany({\n    where: {\n      username: {\n        contains: req.query.query,\n        mode: \"insensitive\"\n      }\n    }\n  });\n\n  if (!users.length) {\n    return res.status(200).json({\n      users\n    });\n  }\n\n  for (const user of users) {\n    const subscribersCount = await prisma.subscription.count({\n      where: {\n        subscribedToId: {\n          equals: user.id\n        }\n      }\n    });\n    const videosCount = await prisma.video.count({\n      where: {\n        userId: user.id\n      }\n    });\n    let isMe = false;\n    let isSubscribed = false;\n\n    if (req.user) {\n      isMe = req.user.id === user.id;\n      isSubscribed = await prisma.subscription.findFirst({\n        where: {\n          AND: {\n            subscriberId: {\n              equals: req.user.id\n            },\n            subscribedToId: {\n              equals: user.id\n            }\n          }\n        }\n      });\n    }\n\n    user.subscribersCount = subscribersCount;\n    user.videosCount = videosCount;\n    user.isSubscribed = Boolean(isSubscribed);\n    user.isMe = isMe;\n  }\n\n  res.status(200).json({\n    users\n  });\n}\n\nasync function getRecommendedChannels(req, res) {\n  const channels = await prisma.user.findMany({\n    where: {\n      id: {\n        not: req.user.id\n      }\n    },\n    take: 10\n  });\n\n  if (!channels.length) {\n    return res.status(200).json({\n      channels\n    });\n  }\n\n  for (const channel of channels) {\n    const subscribersCount = await prisma.subscription.count({\n      where: {\n        subscribedToId: {\n          equals: channel.id\n        }\n      }\n    });\n    const videosCount = await prisma.video.count({\n      where: {\n        userId: channel.id\n      }\n    });\n    const isSubscribed = await prisma.subscription.findFirst({\n      where: {\n        AND: {\n          subscriberId: {\n            equals: req.user.id\n          },\n          subscribedToId: {\n            equals: channel.id\n          }\n        }\n      }\n    });\n    channel.subscribersCount = subscribersCount;\n    channel.videosCount = videosCount;\n    channel.isSubscribed = Boolean(isSubscribed);\n  }\n\n  res.status(200).json({\n    channels\n  });\n}\n\nasync function getProfile(req, res, next) {\n  const user = await prisma.user.findUnique({\n    where: {\n      id: req.params.userId\n    }\n  });\n\n  if (!user) {\n    return next({\n      message: `No user found with id: \"${req.params.userId}\"`,\n      statusCode: 404\n    });\n  }\n\n  const subscribersCount = await prisma.subscription.count({\n    where: {\n      subscribedToId: {\n        equals: user.id\n      }\n    }\n  });\n  let isMe = false;\n  let isSubscribed = false;\n\n  if (req.user) {\n    isMe = req.user.id === user.id;\n    isSubscribed = await prisma.subscription.findFirst({\n      where: {\n        AND: {\n          subscriberId: {\n            equals: req.user.id\n          },\n          subscribedToId: {\n            equals: user.id\n          }\n        }\n      }\n    });\n  }\n\n  const subscribedTo = await prisma.subscription.findMany({\n    where: {\n      subscriberId: {\n        equals: user.id\n      }\n    }\n  });\n  const subscriptions = subscribedTo.map(sub => sub.subscribedToId);\n  const channels = await prisma.user.findMany({\n    where: {\n      id: {\n        in: subscriptions\n      }\n    }\n  });\n\n  for (const channel of channels) {\n    const subscribersCount = await prisma.subscription.count({\n      where: {\n        subscribedToId: {\n          equals: channel.id\n        }\n      }\n    });\n    channel.subscribersCount = subscribersCount;\n  }\n\n  const videos = await prisma.video.findMany({\n    where: {\n      userId: {\n        equals: user.id\n      }\n    },\n    orderBy: {\n      createdAt: \"desc\"\n    }\n  });\n  user.subscribersCount = subscribersCount;\n  user.isSubscribed = Boolean(isSubscribed);\n  user.isMe = isMe;\n  user.channels = channels;\n  user.videos = videos;\n\n  if (!videos.length) {\n    return res.status(200).json({\n      user\n    });\n  }\n\n  user.videos = await (0, _video.getVideoViews)(videos);\n  res.status(200).json({\n    user\n  });\n}\n\nasync function editUser(req, res) {\n  const {\n    username,\n    cover,\n    avatar,\n    about\n  } = req.body;\n  const user = await prisma.user.update({\n    where: {\n      id: req.user.id\n    },\n    data: {\n      username,\n      cover,\n      avatar,\n      about\n    }\n  });\n  res.status(200).json({\n    user\n  });\n}\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInVzZXIuanMiXSwibmFtZXMiOlsicHJpc21hIiwiUHJpc21hQ2xpZW50IiwiZ2V0VXNlclJvdXRlcyIsInJvdXRlciIsImV4cHJlc3MiLCJSb3V0ZXIiLCJnZXQiLCJwcm90ZWN0IiwiZ2V0UmVjb21tZW5kZWRDaGFubmVscyIsInB1dCIsImVkaXRVc2VyIiwiZ2V0TGlrZWRWaWRlb3MiLCJnZXRIaXN0b3J5IiwiZ2V0RmVlZCIsImdldEF1dGhVc2VyIiwic2VhcmNoVXNlciIsImdldFByb2ZpbGUiLCJ0b2dnbGVTdWJzY3JpYmUiLCJyZXEiLCJyZXMiLCJnZXRWaWRlb3MiLCJ2aWRlb0xpa2UiLCJ2aWV3IiwibW9kZWwiLCJ2aWRlb1JlbGF0aW9ucyIsImZpbmRNYW55Iiwid2hlcmUiLCJ1c2VySWQiLCJ1c2VyIiwiaWQiLCJvcmRlckJ5IiwiY3JlYXRlZEF0IiwidmlkZW9JZHMiLCJtYXAiLCJ2aWRlb0lkIiwidmlkZW9zIiwidmlkZW8iLCJpbiIsImluY2x1ZGUiLCJsZW5ndGgiLCJzdGF0dXMiLCJqc29uIiwibmV4dCIsInBhcmFtcyIsIm1lc3NhZ2UiLCJzdGF0dXNDb2RlIiwiZmluZFVuaXF1ZSIsImlzU3Vic2NyaWJlZCIsInN1YnNjcmlwdGlvbiIsImZpbmRGaXJzdCIsInN1YnNjcmliZXJJZCIsImVxdWFscyIsInN1YnNjcmliZWRUb0lkIiwiZGVsZXRlIiwiY3JlYXRlIiwiZGF0YSIsInN1YnNjcmliZXIiLCJjb25uZWN0Iiwic3Vic2NyaWJlZFRvIiwic3Vic2NyaXB0aW9ucyIsInN1YiIsImZlZWQiLCJmZWVkVmlkZW9zIiwicXVlcnkiLCJ1c2VycyIsInVzZXJuYW1lIiwiY29udGFpbnMiLCJtb2RlIiwic3Vic2NyaWJlcnNDb3VudCIsImNvdW50IiwidmlkZW9zQ291bnQiLCJpc01lIiwiQU5EIiwiQm9vbGVhbiIsImNoYW5uZWxzIiwibm90IiwidGFrZSIsImNoYW5uZWwiLCJjb3ZlciIsImF2YXRhciIsImFib3V0IiwiYm9keSIsInVw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ci9EZXYveXRjbG9uZS8xL3NlcnZlci9zcmMvcm91dGVzLyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFByaXNtYUNsaWVudCB9IGZyb20gXCJAcHJpc21hL2NsaWVudFwiO1xuaW1wb3J0IGV4cHJlc3MgZnJvbSBcImV4cHJlc3NcIjtcbmltcG9ydCB7IGdldEF1dGhVc2VyLCBwcm90ZWN0IH0gZnJvbSBcIi4uL21pZGRsZXdhcmUvYXV0aG9yaXphdGlvblwiO1xuaW1wb3J0IHsgZ2V0VmlkZW9WaWV3cyB9IGZyb20gXCIuL3ZpZGVvXCI7XG5cbmNvbnN0IHByaXNtYSA9IG5ldyBQcmlzbWFDbGllbnQoKTtcblxuZnVuY3Rpb24gZ2V0VXNlclJvdXRlcygpIHtcbiAgY29uc3Qgcm91dGVyID0gZXhwcmVzcy5Sb3V0ZXIoKTtcblxuICByb3V0ZXIuZ2V0KFwiL1wiLCBwcm90ZWN0LCBnZXRSZWNvbW1lbmRlZENoYW5uZWxzKTtcbiAgcm91dGVyLnB1dChcIi9cIiwgcHJvdGVjdCwgZWRpdFVzZXIpO1xuXG4gIHJvdXRlci5nZXQoXCIvbGlrZWQtdmlkZW9zXCIsIHByb3RlY3QsIGdldExpa2VkVmlkZW9zKTtcbiAgcm91dGVyLmdldChcIi9oaXN0b3J5XCIsIHByb3RlY3QsIGdldEhpc3RvcnkpO1xuICByb3V0ZXIuZ2V0KFwiL3N1YnNjcmlwdGlvbnNcIiwgcHJvdGVjdCwgZ2V0RmVlZCk7XG4gIHJvdXRlci5nZXQoXCIvc2VhcmNoXCIsIGdldEF1dGhVc2VyLCBzZWFyY2hVc2VyKTtcblxuICByb3V0ZXIuZ2V0KFwiLzp1c2VySWRcIiwgZ2V0QXV0aFVzZXIsIGdldFByb2ZpbGUpO1xuICByb3V0ZXIuZ2V0KFwiLzp1c2VySWQvdG9nZ2xlLXN1YnNjcmliZVwiLCBwcm90ZWN0LCB0b2dnbGVTdWJzY3JpYmUpO1xuXG4gIHJldHVybiByb3V0ZXI7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGdldExpa2VkVmlkZW9zKHJlcSwgcmVzKSB7XG4gIGF3YWl0IGdldFZpZGVvcyhwcmlzbWEudmlkZW9MaWtlLCByZXEsIHJlcyk7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGdldEhpc3RvcnkocmVxLCByZXMpIHtcbiAgYXdhaXQgZ2V0VmlkZW9zKHByaXNtYS52aWV3LCByZXEsIHJlcyk7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGdldFZpZGVvcyhtb2RlbCwgcmVxLCByZXMpIHtcbiAgY29uc3QgdmlkZW9SZWxhdGlvbnMgPSBhd2FpdCBtb2RlbC5maW5kTWFueSh7XG4gICAgd2hlcmU6IHtcbiAgICAgIHVzZXJJZDogcmVxLnVzZXIuaWQsXG4gICAgfSxcbiAgICBvcmRlckJ5OiB7XG4gICAgICBjcmVhdGVkQXQ6IFwiZGVzY1wiLFxuICAgIH0sXG4gIH0pO1xuXG4gIGNvbnN0IHZpZGVvSWRzID0gdmlkZW9SZWxhdGlvbnMubWFwKCh2aWRlb0xpa2UpID0+IHZpZGVvTGlrZS52aWRlb0lkKTtcblxuICBsZXQgdmlkZW9zID0gYXdhaXQgcHJpc21hLnZpZGVvLmZpbmRNYW55KHtcbiAgICB3aGVyZToge1xuICAgICAgaWQ6IHtcbiAgICAgICAgaW46IHZpZGVvSWRzLFxuICAgICAgfSxcbiAgICB9LFxuICAgIGluY2x1ZGU6IHtcbiAgICAgIHVzZXI6IHRydWUsXG4gICAgfSxcbiAgfSk7XG5cbiAgaWYgKCF2aWRlb3MubGVuZ3RoKSB7XG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoMjAwKS5qc29uKHsgdmlkZW9zIH0pO1xuICB9XG5cbiAgdmlkZW9zID0gYXdhaXQgZ2V0VmlkZW9WaWV3cyh2aWRlb3MpO1xuXG4gIHJlcy5zdGF0dXMoMjAwKS5qc29uKHsgdmlkZW9zIH0pO1xufVxuXG5hc3luYyBmdW5jdGlvbiB0b2dnbGVTdWJzY3JpYmUocmVxLCByZXMsIG5leHQpIHtcbiAgaWYgKHJlcS51c2VyLmlkID09PSByZXEucGFyYW1zLnVzZXJJZCkge1xuICAgIHJldHVybiBuZXh0KHtcbiAgICAgIG1lc3NhZ2U6IFwiWW91IGNhbm5vdCBzdWJzY3JpYmUgdG8geW91ciBvd24gY2hhbm5lbFwiLFxuICAgICAgc3RhdHVzQ29kZTogNDAwLFxuICAgIH0pO1xuICB9XG5cbiAgY29uc3QgdXNlciA9IGF3YWl0IHByaXNtYS51c2VyLmZpbmRVbmlxdWUoe1xuICAgIHdoZXJlOiB7XG4gICAgICBpZDogcmVxLnBhcmFtcy51c2VySWQsXG4gICAgfSxcbiAgfSk7XG5cbiAgaWYgKCF1c2VyKSB7XG4gICAgcmV0dXJuIG5leHQoe1xuICAgICAgbWVzc2FnZTogYE5vIHVzZXIgZm91bmQgd2l0aCBpZDogXCIke3JlcS5wYXJhbXMudXNlcklkfVwiYCxcbiAgICAgIHN0YXR1c0NvZGU6IDQwNCxcbiAgICB9KTtcbiAgfVxuXG4gIGNvbnN0IGlzU3Vic2NyaWJlZCA9IGF3YWl0IHByaXNtYS5zdWJzY3JpcHRpb24uZmluZEZpcnN0KHtcbiAgICB3aGVyZToge1xuICAgICAgc3Vic2NyaWJlcklkOiB7XG4gICAgICAgIGVxdWFsczogcmVxLnVzZXIuaWQsXG4gICAgICB9LFxuICAgICAgc3Vic2NyaWJlZFRvSWQ6IHtcbiAgICAgICAgZXF1YWxzOiByZXEucGFyYW1zLnVzZXJJZCxcbiAgICAgIH0sXG4gICAgfSxcbiAgfSk7XG5cbiAgaWYgKGlzU3Vic2NyaWJlZCkge1xuICAgIGF3YWl0IHByaXNtYS5zdWJzY3JpcHRpb24uZGVsZXRlKHtcbiAgICAgIHdoZXJlOiB7XG4gICAgICAgIGlkOiBpc1N1YnNjcmliZWQuaWQsXG4gICAgICB9LFxuICAgIH0pO1xuICB9IGVsc2Uge1xuICAgIGF3YWl0IHByaXNtYS5zdWJzY3JpcHRpb24uY3JlYXRlKHtcbiAgICAgIGRhdGE6IHtcbiAgICAgICAgc3Vic2NyaWJlcjoge1xuICAgICAgICAgIGNvbm5lY3Q6IHtcbiAgICAgICAgICAgIGlkOiByZXEudXNlci5pZCxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICBzdWJzY3JpYmVkVG86IHtcbiAgICAgICAgICBjb25uZWN0OiB7XG4gICAgICAgICAgICBpZDogcmVxLnBhcmFtcy51c2VySWQsXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgfSk7XG4gIH1cblxuICByZXMuc3RhdHVzKDIwMCkuanNvbih7fSk7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGdldEZlZWQocmVxLCByZXMpIHtcbiAgY29uc3Qgc3Vic2NyaWJlZFRvID0gYXdhaXQgcHJpc21hLnN1YnNjcmlwdGlvbi5maW5kTWFueSh7XG4gICAgd2hlcmU6IHtcbiAgICAgIHN1YnNjcmliZXJJZDoge1xuICAgICAgICBlcXVhbHM6IHJlcS51c2VyLmlkLFxuICAgICAgfSxcbiAgICB9LFxuICB9KTtcblxuICBjb25zdCBzdWJzY3JpcHRpb25zID0gc3Vic2NyaWJlZFRvLm1hcCgoc3ViKSA9PiBzdWIuc3Vic2NyaWJlZFRvSWQpO1xuXG4gIGNvbnN0IGZlZWQgPSBhd2FpdCBwcmlzbWEudmlkZW8uZmluZE1hbnkoe1xuICAgIHdoZXJlOiB7XG4gICAgICB1c2VySWQ6IHtcbiAgICAgICAgaW46IHN1YnNjcmlwdGlvbnMsXG4gICAgICB9LFxuICAgIH0sXG4gICAgaW5jbHVkZToge1xuICAgICAgdXNlcjogdHJ1ZSxcbiAgICB9LFxuICAgIG9yZGVyQnk6IHtcbiAgICAgIGNyZWF0ZWRBdDogXCJkZXNjXCIsXG4gICAgfSxcbiAgfSk7XG5cbiAgaWYgKCFmZWVkLmxlbmd0aCkge1xuICAgIHJldHVybiByZXMuc3RhdHVzKDIwMCkuanNvbih7IGZlZWQgfSk7XG4gIH1cblxuICBjb25zdCBmZWVkVmlkZW9zID0gYXdhaXQgZ2V0VmlkZW9WaWV3cyhmZWVkKTtcblxuICByZXMuc3RhdHVzKDIwMCkuanNvbih7IGZlZWQ6IGZlZWRWaWRlb3MgfSk7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIHNlYXJjaFVzZXIocmVxLCByZXMsIG5leHQpIHtcbiAgaWYgKCFyZXEucXVlcnkucXVlcnkpIHtcbiAgICByZXR1cm4gbmV4dCh7XG4gICAgICBtZXNzYWdlOiBcIlBsZWFzZSBlbnRlciBhIHNlYXJjaCBxdWVyeVwiLFxuICAgICAgc3RhdHVzQ29kZTogNDAwLFxuICAgIH0pO1xuICB9XG5cbiAgY29uc3QgdXNlcnMgPSBhd2FpdCBwcmlzbWEudXNlci5maW5kTWFueSh7XG4gICAgd2hlcmU6IHtcbiAgICAgIHVzZXJuYW1lOiB7XG4gICAgICAgIGNvbnRhaW5zOiByZXEucXVlcnkucXVlcnksXG4gICAgICAgIG1vZGU6IFwiaW5zZW5zaXRpdmVcIixcbiAgICAgIH0sXG4gICAgfSxcbiAgfSk7XG5cbiAgaWYgKCF1c2Vycy5sZW5ndGgpIHtcbiAgICByZXR1cm4gcmVzLnN0YXR1cygyMDApLmpzb24oeyB1c2VycyB9KTtcbiAgfVxuXG4gIGZvciAoY29uc3QgdXNlciBvZiB1c2Vycykge1xuICAgIGNvbnN0IHN1YnNjcmliZXJzQ291bnQgPSBhd2FpdCBwcmlzbWEuc3Vic2NyaXB0aW9uLmNvdW50KHtcbiAgICAgIHdoZXJlOiB7XG4gICAgICAgIHN1YnNjcmliZWRUb0lkOiB7XG4gICAgICAgICAgZXF1YWxzOiB1c2VyLmlkLFxuICAgICAgICB9LFxuICAgICAgfSxcbiAgICB9KTtcblxuICAgIGNvbnN0IHZpZGVvc0NvdW50ID0gYXdhaXQgcHJpc21hLnZpZGVvLmNvdW50KHtcbiAgICAgIHdoZXJlOiB7XG4gICAgICAgIHVzZXJJZDogdXNlci5pZCxcbiAgICAgIH0sXG4gICAgfSk7XG5cbiAgICBsZXQgaXNNZSA9IGZhbHNlO1xuICAgIGxldCBpc1N1YnNjcmliZWQgPSBmYWxzZTtcblxuICAgIGlmIChyZXEudXNlcikge1xuICAgICAgaXNNZSA9IHJlcS51c2VyLmlkID09PSB1c2VyLmlkO1xuXG4gICAgICBpc1N1YnNjcmliZWQgPSBhd2FpdCBwcmlzbWEuc3Vic2NyaXB0aW9uLmZpbmRGaXJzdCh7XG4gICAgICAgIHdoZXJlOiB7XG4gICAgICAgICAgQU5EOiB7XG4gICAgICAgICAgICBzdWJzY3JpYmVySWQ6IHtcbiAgICAgICAgICAgICAgZXF1YWxzOiByZXEudXNlci5pZCxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBzdWJzY3JpYmVkVG9JZDoge1xuICAgICAgICAgICAgICBlcXVhbHM6IHVzZXIuaWQsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICB9KTtcbiAgICB9XG5cbiAgICB1c2VyLnN1YnNjcmliZXJzQ291bnQgPSBzdWJzY3JpYmVyc0NvdW50O1xuICAgIHVzZXIudmlkZW9zQ291bnQgPSB2aWRlb3NDb3VudDtcbiAgICB1c2VyLmlzU3Vic2NyaWJlZCA9IEJvb2xlYW4oaXNTdWJzY3JpYmVkKTtcbiAgICB1c2VyLmlzTWUgPSBpc01lO1xuICB9XG5cbiAgcmVzLnN0YXR1cygyMDApLmpzb24oeyB1c2VycyB9KTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gZ2V0UmVjb21tZW5kZWRDaGFubmVscyhyZXEsIHJlcykge1xuICBjb25zdCBjaGFubmVscyA9IGF3YWl0IHByaXNtYS51c2VyLmZpbmRNYW55KHtcbiAgICB3aGVyZToge1xuICAgICAgaWQ6IHtcbiAgICAgICAgbm90OiByZXEudXNlci5pZCxcbiAgICAgIH0sXG4gICAgfSxcbiAgICB0YWtlOiAxMCxcbiAgfSk7XG5cbiAgaWYgKCFjaGFubmVscy5sZW5ndGgpIHtcbiAgICByZXR1cm4gcmVzLnN0YXR1cygyMDApLmpzb24oeyBjaGFubmVscyB9KTtcbiAgfVxuXG4gIGZvciAoY29uc3QgY2hhbm5lbCBvZiBjaGFubmVscykge1xuICAgIGNvbnN0IHN1YnNjcmliZXJzQ291bnQgPSBhd2FpdCBwcmlzbWEuc3Vic2NyaXB0aW9uLmNvdW50KHtcbiAgICAgIHdoZXJlOiB7XG4gICAgICAgIHN1YnNjcmliZWRUb0lkOiB7XG4gICAgICAgICAgZXF1YWxzOiBjaGFubmVsLmlkLFxuICAgICAgICB9LFxuICAgICAgfSxcbiAgICB9KTtcblxuICAgIGNvbnN0IHZpZGVvc0NvdW50ID0gYXdhaXQgcHJpc21hLnZpZGVvLmNvdW50KHtcbiAgICAgIHdoZXJlOiB7XG4gICAgICAgIHVzZXJJZDogY2hhbm5lbC5pZCxcbiAgICAgIH0sXG4gICAgfSk7XG5cbiAgICBjb25zdCBpc1N1YnNjcmliZWQgPSBhd2FpdCBwcmlzbWEuc3Vic2NyaXB0aW9uLmZpbmRGaXJzdCh7XG4gICAgICB3aGVyZToge1xuICAgICAgICBBTkQ6IHtcbiAgICAgICAgICBzdWJzY3JpYmVySWQ6IHtcbiAgICAgICAgICAgIGVxdWFsczogcmVxLnVzZXIuaWQsXG4gICAgICAgICAgfSxcbiAgICAgICAgICBzdWJzY3JpYmVkVG9JZDoge1xuICAgICAgICAgICAgZXF1YWxzOiBjaGFubmVsLmlkLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgIH0pO1xuXG4gICAgY2hhbm5lbC5zdWJzY3JpYmVyc0NvdW50ID0gc3Vic2NyaWJlcnNDb3VudDtcbiAgICBjaGFubmVsLnZpZGVvc0NvdW50ID0gdmlkZW9zQ291bnQ7XG4gICAgY2hhbm5lbC5pc1N1YnNjcmliZWQgPSBCb29sZWFuKGlzU3Vic2NyaWJlZCk7XG4gIH1cblxuICByZXMuc3RhdHVzKDIwMCkuanNvbih7IGNoYW5uZWxzIH0pO1xufVxuXG5hc3luYyBmdW5jdGlvbiBnZXRQcm9maWxlKHJlcSwgcmVzLCBuZXh0KSB7XG4gIGNvbnN0IHVzZXIgPSBhd2FpdCBwcmlzbWEudXNlci5maW5kVW5pcXVlKHtcbiAgICB3aGVyZToge1xuICAgICAgaWQ6IHJlcS5wYXJhbXMudXNlcklkLFxuICAgIH0sXG4gIH0pO1xuXG4gIGlmICghdXNlcikge1xuICAgIHJldHVybiBuZXh0KHtcbiAgICAgIG1lc3NhZ2U6IGBObyB1c2VyIGZvdW5kIHdpdGggaWQ6IFwiJHtyZXEucGFyYW1zLnVzZXJJZH1cImAsXG4gICAgICBzdGF0dXNDb2RlOiA0MDQsXG4gICAgfSk7XG4gIH1cblxuICBjb25zdCBzdWJzY3JpYmVyc0NvdW50ID0gYXdhaXQgcHJpc21hLnN1YnNjcmlwdGlvbi5jb3VudCh7XG4gICAgd2hlcmU6IHtcbiAgICAgIHN1YnNjcmliZWRUb0lkOiB7XG4gICAgICAgIGVxdWFsczogdXNlci5pZCxcbiAgICAgIH0sXG4gICAgfSxcbiAgfSk7XG5cbiAgbGV0IGlzTWUgPSBmYWxzZTtcbiAgbGV0IGlzU3Vic2NyaWJlZCA9IGZhbHNlO1xuXG4gIGlmIChyZXEudXNlcikge1xuICAgIGlzTWUgPSByZXEudXNlci5pZCA9PT0gdXNlci5pZDtcblxuICAgIGlzU3Vic2NyaWJlZCA9IGF3YWl0IHByaXNtYS5zdWJzY3JpcHRpb24uZmluZEZpcnN0KHtcbiAgICAgIHdoZXJlOiB7XG4gICAgICAgIEFORDoge1xuICAgICAgICAgIHN1YnNjcmliZXJJZDoge1xuICAgICAgICAgICAgZXF1YWxzOiByZXEudXNlci5pZCxcbiAgICAgICAgICB9LFxuICAgICAgICAgIHN1YnNjcmliZWRUb0lkOiB7XG4gICAgICAgICAgICBlcXVhbHM6IHVzZXIuaWQsXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgfSk7XG4gIH1cblxuICBjb25zdCBzdWJzY3JpYmVkVG8gPSBhd2FpdCBwcmlzbWEuc3Vic2NyaXB0aW9uLmZpbmRNYW55KHtcbiAgICB3aGVyZToge1xuICAgICAgc3Vic2NyaWJlcklkOiB7XG4gICAgICAgIGVxdWFsczogdXNlci5pZCxcbiAgICAgIH0sXG4gICAgfSxcbiAgfSk7XG5cbiAgY29uc3Qgc3Vic2NyaXB0aW9ucyA9IHN1YnNjcmliZWRUby5tYXAoKHN1YikgPT4gc3ViLnN1YnNjcmliZWRUb0lkKTtcblxuICBjb25zdCBjaGFubmVscyA9IGF3YWl0IHByaXNtYS51c2VyLmZpbmRNYW55KHtcbiAgICB3aGVyZToge1xuICAgICAgaWQ6IHtcbiAgICAgICAgaW46IHN1YnNjcmlwdGlvbnMsXG4gICAgICB9LFxuICAgIH0sXG4gIH0pO1xuXG4gIGZvciAoY29uc3QgY2hhbm5lbCBvZiBjaGFubmVscykge1xuICAgIGNvbnN0IHN1YnNjcmliZXJzQ291bnQgPSBhd2FpdCBwcmlzbWEuc3Vic2NyaXB0aW9uLmNvdW50KHtcbiAgICAgIHdoZXJlOiB7XG4gICAgICAgIHN1YnNjcmliZWRUb0lkOiB7XG4gICAgICAgICAgZXF1YWxzOiBjaGFubmVsLmlkLFxuICAgICAgICB9LFxuICAgICAgfSxcbiAgICB9KTtcbiAgICBjaGFubmVsLnN1YnNjcmliZXJzQ291bnQgPSBzdWJzY3JpYmVyc0NvdW50O1xuICB9XG5cbiAgY29uc3QgdmlkZW9zID0gYXdhaXQgcHJpc21hLnZpZGVvLmZpbmRNYW55KHtcbiAgICB3aGVyZToge1xuICAgICAgdXNlcklkOiB7XG4gICAgICAgIGVxdWFsczogdXNlci5pZCxcbiAgICAgIH0sXG4gICAgfSxcbiAgICBvcmRlckJ5OiB7XG4gICAgICBjcmVhdGVkQXQ6IFwiZGVzY1wiLFxuICAgIH0sXG4gIH0pO1xuXG4gIHVzZXIuc3Vic2NyaWJlcnNDb3VudCA9IHN1YnNjcmliZXJzQ291bnQ7XG4gIHVzZXIuaXNTdWJzY3JpYmVkID0gQm9vbGVhbihpc1N1YnNjcmliZWQpO1xuICB1c2VyLmlzTWUgPSBpc01lO1xuICB1c2VyLmNoYW5uZWxzID0gY2hhbm5lbHM7XG4gIHVzZXIudmlkZW9zID0gdmlkZW9zO1xuXG4gIGlmICghdmlkZW9zLmxlbmd0aCkge1xuICAgIHJldHVybiByZXMuc3RhdHVzKDIwMCkuanNvbih7IHVzZXIgfSk7XG4gIH1cblxuICB1c2VyLnZpZGVvcyA9IGF3YWl0IGdldFZpZGVvVmlld3ModmlkZW9zKTtcblxuICByZXMuc3RhdHVzKDIwMCkuanNvbih7IHVzZXIgfSk7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGVkaXRVc2VyKHJlcSwgcmVzKSB7XG4gIGNvbnN0IHsgdXNlcm5hbWUsIGNvdmVyLCBhdmF0YXIsIGFib3V0IH0gPSByZXEuYm9keTtcblxuICBjb25zdCB1c2VyID0gYXdhaXQgcHJpc21hLnVzZXIudXBkYXRlKHtcbiAgICB3aGVyZToge1xuICAgICAgaWQ6IHJlcS51c2VyLmlkLFxuICAgIH0sXG4gICAgZGF0YToge1xuICAgICAgdXNlcm5hbWUsXG4gICAgICBjb3ZlcixcbiAgICAgIGF2YXRhcixcbiAgICAgIGFib3V0LFxuICAgIH0sXG4gIH0pO1xuXG4gIHJlcy5zdGF0dXMoMjAwKS5qc29uKHsgdXNlciB9KTtcbn1cblxuZXhwb3J0IHsgZ2V0VXNlclJvdXRlcyB9O1xuIl19",
    "map": {
      "version": 3,
      "sources": [
        "user.js"
      ],
      "names": [
        "prisma",
        "PrismaClient",
        "getUserRoutes",
        "router",
        "express",
        "Router",
        "get",
        "protect",
        "getRecommendedChannels",
        "put",
        "editUser",
        "getLikedVideos",
        "getHistory",
        "getFeed",
        "getAuthUser",
        "searchUser",
        "getProfile",
        "toggleSubscribe",
        "req",
        "res",
        "getVideos",
        "videoLike",
        "view",
        "model",
        "videoRelations",
        "findMany",
        "where",
        "userId",
        "user",
        "id",
        "orderBy",
        "createdAt",
        "videoIds",
        "map",
        "videoId",
        "videos",
        "video",
        "in",
        "include",
        "length",
        "status",
        "json",
        "next",
        "params",
        "message",
        "statusCode",
        "findUnique",
        "isSubscribed",
        "subscription",
        "findFirst",
        "subscriberId",
        "equals",
        "subscribedToId",
        "delete",
        "create",
        "data",
        "subscriber",
        "connect",
        "subscribedTo",
        "subscriptions",
        "sub",
        "feed",
        "feedVideos",
        "query",
        "users",
        "username",
        "contains",
        "mode",
        "subscribersCount",
        "count",
        "videosCount",
        "isMe",
        "AND",
        "Boolean",
        "channels",
        "not",
        "take",
        "channel",
        "cover",
        "avatar",
        "about",
        "body",
        "update"
      ],
      "mappings": "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",
      "sourceRoot": "/Users/egor/Dev/ytclone/1/server/src/routes/",
      "sourcesContent": [
        "import { PrismaClient } from \"@prisma/client\";\nimport express from \"express\";\nimport { getAuthUser, protect } from \"../middleware/authorization\";\nimport { getVideoViews } from \"./video\";\n\nconst prisma = new PrismaClient();\n\nfunction getUserRoutes() {\n  const router = express.Router();\n\n  router.get(\"/\", protect, getRecommendedChannels);\n  router.put(\"/\", protect, editUser);\n\n  router.get(\"/liked-videos\", protect, getLikedVideos);\n  router.get(\"/history\", protect, getHistory);\n  router.get(\"/subscriptions\", protect, getFeed);\n  router.get(\"/search\", getAuthUser, searchUser);\n\n  router.get(\"/:userId\", getAuthUser, getProfile);\n  router.get(\"/:userId/toggle-subscribe\", protect, toggleSubscribe);\n\n  return router;\n}\n\nasync function getLikedVideos(req, res) {\n  await getVideos(prisma.videoLike, req, res);\n}\n\nasync function getHistory(req, res) {\n  await getVideos(prisma.view, req, res);\n}\n\nasync function getVideos(model, req, res) {\n  const videoRelations = await model.findMany({\n    where: {\n      userId: req.user.id,\n    },\n    orderBy: {\n      createdAt: \"desc\",\n    },\n  });\n\n  const videoIds = videoRelations.map((videoLike) => videoLike.videoId);\n\n  let videos = await prisma.video.findMany({\n    where: {\n      id: {\n        in: videoIds,\n      },\n    },\n    include: {\n      user: true,\n    },\n  });\n\n  if (!videos.length) {\n    return res.status(200).json({ videos });\n  }\n\n  videos = await getVideoViews(videos);\n\n  res.status(200).json({ videos });\n}\n\nasync function toggleSubscribe(req, res, next) {\n  if (req.user.id === req.params.userId) {\n    return next({\n      message: \"You cannot subscribe to your own channel\",\n      statusCode: 400,\n    });\n  }\n\n  const user = await prisma.user.findUnique({\n    where: {\n      id: req.params.userId,\n    },\n  });\n\n  if (!user) {\n    return next({\n      message: `No user found with id: \"${req.params.userId}\"`,\n      statusCode: 404,\n    });\n  }\n\n  const isSubscribed = await prisma.subscription.findFirst({\n    where: {\n      subscriberId: {\n        equals: req.user.id,\n      },\n      subscribedToId: {\n        equals: req.params.userId,\n      },\n    },\n  });\n\n  if (isSubscribed) {\n    await prisma.subscription.delete({\n      where: {\n        id: isSubscribed.id,\n      },\n    });\n  } else {\n    await prisma.subscription.create({\n      data: {\n        subscriber: {\n          connect: {\n            id: req.user.id,\n          },\n        },\n        subscribedTo: {\n          connect: {\n            id: req.params.userId,\n          },\n        },\n      },\n    });\n  }\n\n  res.status(200).json({});\n}\n\nasync function getFeed(req, res) {\n  const subscribedTo = await prisma.subscription.findMany({\n    where: {\n      subscriberId: {\n        equals: req.user.id,\n      },\n    },\n  });\n\n  const subscriptions = subscribedTo.map((sub) => sub.subscribedToId);\n\n  const feed = await prisma.video.findMany({\n    where: {\n      userId: {\n        in: subscriptions,\n      },\n    },\n    include: {\n      user: true,\n    },\n    orderBy: {\n      createdAt: \"desc\",\n    },\n  });\n\n  if (!feed.length) {\n    return res.status(200).json({ feed });\n  }\n\n  const feedVideos = await getVideoViews(feed);\n\n  res.status(200).json({ feed: feedVideos });\n}\n\nasync function searchUser(req, res, next) {\n  if (!req.query.query) {\n    return next({\n      message: \"Please enter a search query\",\n      statusCode: 400,\n    });\n  }\n\n  const users = await prisma.user.findMany({\n    where: {\n      username: {\n        contains: req.query.query,\n        mode: \"insensitive\",\n      },\n    },\n  });\n\n  if (!users.length) {\n    return res.status(200).json({ users });\n  }\n\n  for (const user of users) {\n    const subscribersCount = await prisma.subscription.count({\n      where: {\n        subscribedToId: {\n          equals: user.id,\n        },\n      },\n    });\n\n    const videosCount = await prisma.video.count({\n      where: {\n        userId: user.id,\n      },\n    });\n\n    let isMe = false;\n    let isSubscribed = false;\n\n    if (req.user) {\n      isMe = req.user.id === user.id;\n\n      isSubscribed = await prisma.subscription.findFirst({\n        where: {\n          AND: {\n            subscriberId: {\n              equals: req.user.id,\n            },\n            subscribedToId: {\n              equals: user.id,\n            },\n          },\n        },\n      });\n    }\n\n    user.subscribersCount = subscribersCount;\n    user.videosCount = videosCount;\n    user.isSubscribed = Boolean(isSubscribed);\n    user.isMe = isMe;\n  }\n\n  res.status(200).json({ users });\n}\n\nasync function getRecommendedChannels(req, res) {\n  const channels = await prisma.user.findMany({\n    where: {\n      id: {\n        not: req.user.id,\n      },\n    },\n    take: 10,\n  });\n\n  if (!channels.length) {\n    return res.status(200).json({ channels });\n  }\n\n  for (const channel of channels) {\n    const subscribersCount = await prisma.subscription.count({\n      where: {\n        subscribedToId: {\n          equals: channel.id,\n        },\n      },\n    });\n\n    const videosCount = await prisma.video.count({\n      where: {\n        userId: channel.id,\n      },\n    });\n\n    const isSubscribed = await prisma.subscription.findFirst({\n      where: {\n        AND: {\n          subscriberId: {\n            equals: req.user.id,\n          },\n          subscribedToId: {\n            equals: channel.id,\n          },\n        },\n      },\n    });\n\n    channel.subscribersCount = subscribersCount;\n    channel.videosCount = videosCount;\n    channel.isSubscribed = Boolean(isSubscribed);\n  }\n\n  res.status(200).json({ channels });\n}\n\nasync function getProfile(req, res, next) {\n  const user = await prisma.user.findUnique({\n    where: {\n      id: req.params.userId,\n    },\n  });\n\n  if (!user) {\n    return next({\n      message: `No user found with id: \"${req.params.userId}\"`,\n      statusCode: 404,\n    });\n  }\n\n  const subscribersCount = await prisma.subscription.count({\n    where: {\n      subscribedToId: {\n        equals: user.id,\n      },\n    },\n  });\n\n  let isMe = false;\n  let isSubscribed = false;\n\n  if (req.user) {\n    isMe = req.user.id === user.id;\n\n    isSubscribed = await prisma.subscription.findFirst({\n      where: {\n        AND: {\n          subscriberId: {\n            equals: req.user.id,\n          },\n          subscribedToId: {\n            equals: user.id,\n          },\n        },\n      },\n    });\n  }\n\n  const subscribedTo = await prisma.subscription.findMany({\n    where: {\n      subscriberId: {\n        equals: user.id,\n      },\n    },\n  });\n\n  const subscriptions = subscribedTo.map((sub) => sub.subscribedToId);\n\n  const channels = await prisma.user.findMany({\n    where: {\n      id: {\n        in: subscriptions,\n      },\n    },\n  });\n\n  for (const channel of channels) {\n    const subscribersCount = await prisma.subscription.count({\n      where: {\n        subscribedToId: {\n          equals: channel.id,\n        },\n      },\n    });\n    channel.subscribersCount = subscribersCount;\n  }\n\n  const videos = await prisma.video.findMany({\n    where: {\n      userId: {\n        equals: user.id,\n      },\n    },\n    orderBy: {\n      createdAt: \"desc\",\n    },\n  });\n\n  user.subscribersCount = subscribersCount;\n  user.isSubscribed = Boolean(isSubscribed);\n  user.isMe = isMe;\n  user.channels = channels;\n  user.videos = videos;\n\n  if (!videos.length) {\n    return res.status(200).json({ user });\n  }\n\n  user.videos = await getVideoViews(videos);\n\n  res.status(200).json({ user });\n}\n\nasync function editUser(req, res) {\n  const { username, cover, avatar, about } = req.body;\n\n  const user = await prisma.user.update({\n    where: {\n      id: req.user.id,\n    },\n    data: {\n      username,\n      cover,\n      avatar,\n      about,\n    },\n  });\n\n  res.status(200).json({ user });\n}\n\nexport { getUserRoutes };\n"
      ]
    },
    "sourceType": "script",
    "mtime": 1611426347000
  },
  "{\"sourceRoot\":\"/Users/egor/Dev/ytclone/1/server/src/routes/\",\"caller\":{\"name\":\"@babel/register\"},\"cwd\":\"/Users/egor/Dev/ytclone/1\",\"filename\":\"/Users/egor/Dev/ytclone/1/server/src/routes/video.js\",\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"/Users/egor/Dev/ytclone/1\",\"plugins\":[{\"key\":\"syntax-numeric-separator\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"proposal-logical-assignment-operators\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"AssignmentExpression\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-nullish-coalescing-operator\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-optional-chaining\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-json-strings\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-optional-catch-binding\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-async-generators\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-object-rest-spread\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"transform-modules-commonjs\",\"visitor\":{\"CallExpression\":{\"enter\":[null]},\"Program\":{\"exit\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"proposal-dynamic-import\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"Program\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"proposal-export-namespace-from\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"ExportNamedDeclaration\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}}],\"presets\":[]}:7.12.10": {
    "metadata": {},
    "options": {
      "sourceRoot": "/Users/egor/Dev/ytclone/1/server/src/routes/",
      "caller": {
        "name": "@babel/register"
      },
      "cwd": "/Users/egor/Dev/ytclone/1",
      "filename": "/Users/egor/Dev/ytclone/1/server/src/routes/video.js",
      "cloneInputAst": true,
      "babelrc": false,
      "configFile": false,
      "envName": "development",
      "root": "/Users/egor/Dev/ytclone/1",
      "sourceMaps": "both",
      "ast": false,
      "passPerPreset": false,
      "plugins": [
        {
          "key": "syntax-numeric-separator",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "proposal-logical-assignment-operators",
          "visitor": {
            "_exploded": {},
            "_verified": {},
            "AssignmentExpression": {
              "enter": [
                null
              ]
            }
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-nullish-coalescing-operator",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-optional-chaining",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-json-strings",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-optional-catch-binding",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-async-generators",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-object-rest-spread",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "transform-modules-commonjs",
          "visitor": {
            "CallExpression": {
              "enter": [
                null
              ]
            },
            "Program": {
              "exit": [
                null
              ]
            },
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "proposal-dynamic-import",
          "visitor": {
            "_exploded": {},
            "_verified": {},
            "Program": {
              "enter": [
                null
              ]
            }
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "proposal-export-namespace-from",
          "visitor": {
            "_exploded": {},
            "_verified": {},
            "ExportNamedDeclaration": {
              "enter": [
                null
              ]
            }
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        }
      ],
      "presets": [],
      "parserOpts": {
        "sourceType": "module",
        "sourceFileName": "/Users/egor/Dev/ytclone/1/server/src/routes/video.js",
        "plugins": [
          "numericSeparator",
          "logicalAssignment",
          "nullishCoalescingOperator",
          "optionalChaining",
          "jsonStrings",
          "optionalCatchBinding",
          "asyncGenerators",
          "objectRestSpread",
          "dynamicImport",
          "exportNamespaceFrom"
        ]
      },
      "generatorOpts": {
        "filename": "/Users/egor/Dev/ytclone/1/server/src/routes/video.js",
        "comments": true,
        "compact": "auto",
        "sourceMaps": "both",
        "sourceRoot": "/Users/egor/Dev/ytclone/1/server/src/routes/",
        "sourceFileName": "video.js"
      }
    },
    "ast": null,
    "code": "\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.getVideoViews = getVideoViews;\nexports.getVideoRoutes = getVideoRoutes;\n\nvar _client = require(\"@prisma/client\");\n\nvar _express = _interopRequireDefault(require(\"express\"));\n\nvar _authorization = require(\"../middleware/authorization\");\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nconst prisma = new _client.PrismaClient();\n\nfunction getVideoRoutes() {\n  const router = _express.default.Router();\n\n  router.get(\"/\", getRecommendedVideos);\n  router.post(\"/\", _authorization.protect, addVideo);\n  router.get(\"/trending\", getTrendingVideos);\n  router.get(\"/search\", searchVideos);\n  router.get(\"/:videoId\", _authorization.getAuthUser, getVideo);\n  router.delete(\"/:videoId\", _authorization.protect, deleteVideo);\n  router.get(\"/:videoId/view\", _authorization.getAuthUser, addVideoView);\n  router.get(\"/:videoId/like\", _authorization.protect, likeVideo);\n  router.get(\"/:videoId/dislike\", _authorization.protect, dislikeVideo);\n  router.post(\"/:videoId/comments\", _authorization.protect, addComment);\n  router.delete(\"/:videoId/comments/:commentId\", _authorization.protect, deleteComment);\n  return router;\n}\n\nasync function getVideoViews(videos) {\n  for (const video of videos) {\n    const views = await prisma.view.count({\n      where: {\n        videoId: {\n          equals: video.id\n        }\n      }\n    });\n    video.views = views;\n  }\n\n  return videos;\n}\n\nasync function getRecommendedVideos(req, res) {\n  let videos = await prisma.video.findMany({\n    include: {\n      user: true\n    },\n    orderBy: {\n      createdAt: \"desc\"\n    }\n  });\n\n  if (!videos.length) {\n    return res.status(200).json({\n      videos\n    });\n  }\n\n  videos = await getVideoViews(videos);\n  res.status(200).json({\n    videos\n  });\n}\n\nasync function getTrendingVideos(req, res) {\n  let videos = await prisma.video.findMany({\n    include: {\n      user: true\n    },\n    orderBy: {\n      createdAt: \"desc\"\n    }\n  });\n\n  if (!videos.length) {\n    return res.status(200).json({\n      videos\n    });\n  }\n\n  videos = await getVideoViews(videos);\n  videos.sort((a, b) => b.views - a.views);\n  res.status(200).json({\n    videos\n  });\n}\n\nasync function searchVideos(req, res, next) {\n  if (!req.query.query) {\n    return next({\n      message: \"Please enter a search query\",\n      statusCode: 400\n    });\n  }\n\n  let videos = await prisma.video.findMany({\n    include: {\n      user: true\n    },\n    where: {\n      OR: [{\n        title: {\n          contains: req.query.query,\n          mode: \"insensitive\"\n        }\n      }, {\n        description: {\n          contains: req.query.query,\n          mode: \"insensitive\"\n        }\n      }]\n    }\n  });\n\n  if (!videos.length) {\n    return res.status(200).json({\n      videos\n    });\n  }\n\n  videos = await getVideoViews(videos);\n  res.status(200).json({\n    videos\n  });\n}\n\nasync function addVideo(req, res) {\n  const {\n    title,\n    description,\n    url,\n    thumbnail\n  } = req.body;\n  const video = await prisma.video.create({\n    data: {\n      title,\n      description,\n      url,\n      thumbnail,\n      user: {\n        connect: {\n          id: req.user.id\n        }\n      }\n    }\n  });\n  res.status(200).json({\n    video\n  });\n}\n\nasync function addComment(req, res, next) {\n  const video = await prisma.video.findUnique({\n    where: {\n      id: req.params.videoId\n    }\n  });\n\n  if (!video) {\n    return next({\n      message: `No video found with id: \"${req.params.videoId}\"`,\n      statusCode: 404\n    });\n  }\n\n  const comment = await prisma.comment.create({\n    data: {\n      text: req.body.text,\n      user: {\n        connect: {\n          id: req.user.id\n        }\n      },\n      video: {\n        connect: {\n          id: req.params.videoId\n        }\n      }\n    }\n  });\n  res.status(200).json({\n    comment\n  });\n}\n\nasync function deleteComment(req, res) {\n  const comment = await prisma.comment.findUnique({\n    where: {\n      id: req.params.commentId\n    },\n    select: {\n      userId: true\n    }\n  });\n\n  if (comment.userId !== req.user.id) {\n    return res.status(401).send(\"You are not authorized to delete this comment\");\n  }\n\n  await prisma.comment.delete({\n    where: {\n      id: req.params.commentId\n    }\n  });\n  res.status(200).json({});\n}\n\nasync function addVideoView(req, res, next) {\n  const video = await prisma.video.findUnique({\n    where: {\n      id: req.params.videoId\n    }\n  });\n\n  if (!video) {\n    return next({\n      message: `No video found with id: \"${req.params.videoId}\"`,\n      statusCode: 404\n    });\n  }\n\n  if (req.user) {\n    await prisma.view.create({\n      data: {\n        video: {\n          connect: {\n            id: req.params.videoId\n          }\n        },\n        user: {\n          connect: {\n            id: req.user.id\n          }\n        }\n      }\n    });\n  } else {\n    await prisma.view.create({\n      data: {\n        video: {\n          connect: {\n            id: req.params.videoId\n          }\n        }\n      }\n    });\n  }\n\n  res.status(200).json({});\n}\n\nasync function likeVideo(req, res, next) {\n  const video = await prisma.video.findUnique({\n    where: {\n      id: req.params.videoId\n    }\n  });\n\n  if (!video) {\n    return next({\n      message: `No video found with id: \"${req.params.videoId}\"`,\n      statusCode: 404\n    });\n  }\n\n  const isLiked = await prisma.videoLike.findFirst({\n    where: {\n      userId: {\n        equals: req.user.id\n      },\n      videoId: {\n        equals: req.params.videoId\n      },\n      like: {\n        equals: 1\n      }\n    }\n  });\n  const isDisliked = await prisma.videoLike.findFirst({\n    where: {\n      userId: {\n        equals: req.user.id\n      },\n      videoId: {\n        equals: req.params.videoId\n      },\n      like: {\n        equals: -1\n      }\n    }\n  });\n\n  if (isLiked) {\n    await prisma.videoLike.delete({\n      where: {\n        id: isLiked.id\n      }\n    });\n  } else if (isDisliked) {\n    await prisma.videoLike.update({\n      where: {\n        id: isDisliked.id\n      },\n      data: {\n        like: 1\n      }\n    });\n  } else {\n    await prisma.videoLike.create({\n      data: {\n        user: {\n          connect: {\n            id: req.user.id\n          }\n        },\n        video: {\n          connect: {\n            id: req.params.videoId\n          }\n        },\n        like: 1\n      }\n    });\n  }\n\n  res.status(200).json({});\n}\n\nasync function dislikeVideo(req, res, next) {\n  const video = await prisma.video.findUnique({\n    where: {\n      id: req.params.videoId\n    }\n  });\n\n  if (!video) {\n    return next({\n      message: `No video found with id: \"${req.params.videoId}\"`,\n      statusCode: 404\n    });\n  }\n\n  const isLiked = await prisma.videoLike.findFirst({\n    where: {\n      userId: {\n        equals: req.user.id\n      },\n      videoId: {\n        equals: req.params.videoId\n      },\n      like: {\n        equals: 1\n      }\n    }\n  });\n  const isDisliked = await prisma.videoLike.findFirst({\n    where: {\n      userId: {\n        equals: req.user.id\n      },\n      videoId: {\n        equals: req.params.videoId\n      },\n      like: {\n        equals: -1\n      }\n    }\n  });\n\n  if (isDisliked) {\n    await prisma.videoLike.delete({\n      where: {\n        id: isDisliked.id\n      }\n    });\n  } else if (isLiked) {\n    await prisma.videoLike.update({\n      where: {\n        id: isLiked.id\n      },\n      data: {\n        like: -1\n      }\n    });\n  } else {\n    await prisma.videoLike.create({\n      data: {\n        user: {\n          connect: {\n            id: req.user.id\n          }\n        },\n        video: {\n          connect: {\n            id: req.params.videoId\n          }\n        },\n        like: -1\n      }\n    });\n  }\n\n  res.status(200).json({});\n}\n\nasync function getVideo(req, res, next) {\n  const video = await prisma.video.findUnique({\n    where: {\n      id: req.params.videoId\n    },\n    include: {\n      user: true,\n      comments: {\n        include: {\n          user: true\n        },\n        orderBy: {\n          createdAt: \"desc\"\n        }\n      }\n    }\n  });\n\n  if (!video) {\n    return next({\n      message: `No video found with id: \"${req.params.videoId}\"`,\n      statusCode: 404\n    });\n  }\n\n  let isVideoMine = false;\n  let isLiked = false;\n  let isDisliked = false;\n  let isSubscribed = false;\n  let isViewed = false;\n\n  if (req.user) {\n    isVideoMine = req.user.id === video.userId;\n    isLiked = await prisma.videoLike.findFirst({\n      where: {\n        userId: {\n          equals: req.user.id\n        },\n        videoId: {\n          equals: req.params.videoId\n        },\n        like: {\n          equals: 1\n        }\n      }\n    });\n    isDisliked = await prisma.videoLike.findFirst({\n      where: {\n        userId: {\n          equals: req.user.id\n        },\n        videoId: {\n          equals: req.params.videoId\n        },\n        like: {\n          equals: -1\n        }\n      }\n    });\n    isViewed = await prisma.view.findFirst({\n      where: {\n        userId: {\n          equals: req.user.id\n        },\n        videoId: {\n          equals: video.id\n        }\n      }\n    });\n    isSubscribed = await prisma.subscription.findFirst({\n      where: {\n        subscriberId: {\n          equals: req.user.id\n        },\n        subscribedToId: {\n          equals: video.userId\n        }\n      }\n    });\n  }\n\n  const likesCount = await prisma.videoLike.count({\n    where: {\n      AND: {\n        videoId: {\n          equals: req.params.videoId\n        },\n        like: {\n          equals: 1\n        }\n      }\n    }\n  });\n  const dislikesCount = await prisma.videoLike.count({\n    where: {\n      AND: {\n        videoId: {\n          equals: req.params.videoId\n        },\n        like: {\n          equals: -1\n        }\n      }\n    }\n  });\n  const views = await prisma.view.count({\n    where: {\n      videoId: {\n        equals: video.id\n      }\n    }\n  });\n  const subscribersCount = await prisma.subscription.count({\n    where: {\n      subscribedToId: {\n        equals: video.userId\n      }\n    }\n  });\n  video.commentsCount = video.comments.length;\n  video.isLiked = Boolean(isLiked);\n  video.isDisliked = Boolean(isDisliked);\n  video.likesCount = likesCount;\n  video.dislikesCount = dislikesCount;\n  video.isVideoMine = isVideoMine;\n  video.views = views;\n  video.isSubscribed = Boolean(isSubscribed);\n  video.isViewed = Boolean(isViewed);\n  video.subscribersCount = subscribersCount;\n  res.status(200).json({\n    video\n  });\n}\n\nasync function deleteVideo(req, res) {\n  const video = await prisma.video.findUnique({\n    where: {\n      id: req.params.videoId\n    },\n    select: {\n      userId: true\n    }\n  });\n\n  if (req.user.id !== video.userId) {\n    return res.status(401).send(\"You are not authorized to delete this video\");\n  }\n\n  await prisma.view.deleteMany({\n    where: {\n      videoId: {\n        equals: req.params.videoId\n      }\n    }\n  });\n  await prisma.videoLike.deleteMany({\n    where: {\n      videoId: {\n        equals: req.params.videoId\n      }\n    }\n  });\n  await prisma.comment.deleteMany({\n    where: {\n      videoId: {\n        equals: req.params.videoId\n      }\n    }\n  });\n  await prisma.video.delete({\n    where: {\n      id: req.params.videoId\n    }\n  });\n  res.status(200).json({});\n}\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInZpZGVvLmpzIl0sIm5hbWVzIjpbInByaXNtYSIsIlByaXNtYUNsaWVudCIsImdldFZpZGVvUm91dGVzIiwicm91dGVyIiwiZXhwcmVzcyIsIlJvdXRlciIsImdldCIsImdldFJlY29tbWVuZGVkVmlkZW9zIiwicG9zdCIsInByb3RlY3QiLCJhZGRWaWRlbyIsImdldFRyZW5kaW5nVmlkZW9zIiwic2VhcmNoVmlkZW9zIiwiZ2V0QXV0aFVzZXIiLCJnZXRWaWRlbyIsImRlbGV0ZSIsImRlbGV0ZVZpZGVvIiwiYWRkVmlkZW9WaWV3IiwibGlrZVZpZGVvIiwiZGlzbGlrZVZpZGVvIiwiYWRkQ29tbWVudCIsImRlbGV0ZUNvbW1lbnQiLCJnZXRWaWRlb1ZpZXdzIiwidmlkZW9zIiwidmlkZW8iLCJ2aWV3cyIsInZpZXciLCJjb3VudCIsIndoZXJlIiwidmlkZW9JZCIsImVxdWFscyIsImlkIiwicmVxIiwicmVzIiwiZmluZE1hbnkiLCJpbmNsdWRlIiwidXNlciIsIm9yZGVyQnkiLCJjcmVhdGVkQXQiLCJsZW5ndGgiLCJzdGF0dXMiLCJqc29uIiwic29ydCIsImEiLCJiIiwibmV4dCIsInF1ZXJ5IiwibWVzc2FnZSIsInN0YXR1c0NvZGUiLCJPUiIsInRpdGxlIiwiY29udGFpbnMiLCJtb2RlIiwiZGVzY3JpcHRpb24iLCJ1cmwiLCJ0aHVtYm5haWwiLCJib2R5IiwiY3JlYXRlIiwiZGF0YSIsImNvbm5lY3QiLCJmaW5kVW5pcXVlIiwicGFyYW1zIiwiY29tbWVudCIsInRleHQiLCJjb21tZW50SWQiLCJzZWxlY3QiLCJ1c2VySWQiLCJzZW5kIiwiaXNMaWtlZCIsInZpZGVvTGlrZSIsImZpbmRGaXJzdCIsImxpa2UiLCJpc0Rpc2xpa2VkIiwidXBkYXRlIiwiY29tbWVudHMiLCJpc1ZpZGVvTWluZSIsImlzU3Vic2NyaWJlZCIsImlzVmlld2VkIiwic3Vic2NyaXB0aW9uIiwic3Vic2NyaWJlcklkIiwic3Vic2NyaWJlZFRvSWQiLCJsaWtlc0NvdW50IiwiQU5EIiwiZGlzbGlrZXNDb3VudCIsInN1YnNjcmliZXJzQ291bnQiLCJjb21tZW50c0NvdW50IiwiQm9vbGVhbiIsImRlbGV0ZU1hbnkiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBQUE7O0FBQ0E7O0FBQ0E7Ozs7QUFFQSxNQUFNQSxNQUFNLEdBQUcsSUFBSUMsb0JBQUosRUFBZjs7QUFFQSxTQUFTQyxjQUFULEdBQTBCO0FBQ3hCLFFBQU1DLE1BQU0sR0FBR0MsaUJBQVFDLE1BQVIsRUFBZjs7QUFFQUYsRUFBQUEsTUFBTSxDQUFDRyxHQUFQLENBQVcsR0FBWCxFQUFnQkMsb0JBQWhCO0FBQ0FKLEVBQUFBLE1BQU0sQ0FBQ0ssSUFBUCxDQUFZLEdBQVosRUFBaUJDLHNCQUFqQixFQUEwQkMsUUFBMUI7QUFFQVAsRUFBQUEsTUFBTSxDQUFDRyxHQUFQLENBQVcsV0FBWCxFQUF3QkssaUJBQXhCO0FBQ0FSLEVBQUFBLE1BQU0sQ0FBQ0csR0FBUCxDQUFXLFNBQVgsRUFBc0JNLFlBQXRCO0FBRUFULEVBQUFBLE1BQU0sQ0FBQ0csR0FBUCxDQUFXLFdBQVgsRUFBd0JPLDBCQUF4QixFQUFxQ0MsUUFBckM7QUFDQVgsRUFBQUEsTUFBTSxDQUFDWSxNQUFQLENBQWMsV0FBZCxFQUEyQk4sc0JBQTNCLEVBQW9DTyxXQUFwQztBQUVBYixFQUFBQSxNQUFNLENBQUNHLEdBQVAsQ0FBVyxnQkFBWCxFQUE2Qk8sMEJBQTdCLEVBQTBDSSxZQUExQztBQUNBZCxFQUFBQSxNQUFNLENBQUNHLEdBQVAsQ0FBVyxnQkFBWCxFQUE2Qkcsc0JBQTdCLEVBQXNDUyxTQUF0QztBQUNBZixFQUFBQSxNQUFNLENBQUNHLEdBQVAsQ0FBVyxtQkFBWCxFQUFnQ0csc0JBQWhDLEVBQXlDVSxZQUF6QztBQUNBaEIsRUFBQUEsTUFBTSxDQUFDSyxJQUFQLENBQVksb0JBQVosRUFBa0NDLHNCQUFsQyxFQUEyQ1csVUFBM0M7QUFDQWpCLEVBQUFBLE1BQU0sQ0FBQ1ksTUFBUCxDQUFjLCtCQUFkLEVBQStDTixzQkFBL0MsRUFBd0RZLGFB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QixHQUFwQixDQUFOO0FBTUFJLEVBQUFBLEdBQUcsQ0FBQ08sTUFBSixDQUFXLEdBQVgsRUFBZ0JDLElBQWhCLENBQXFCLEVBQXJCO0FBQ0QiLCJzb3VyY2VSb290IjoiL1VzZXJzL2Vnb3IvRGV2L3l0Y2xvbmUvMS9zZXJ2ZXIvc3JjL3JvdXRlcy8iLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBQcmlzbWFDbGllbnQgfSBmcm9tIFwiQHByaXNtYS9jbGllbnRcIjtcbmltcG9ydCBleHByZXNzIGZyb20gXCJleHByZXNzXCI7XG5pbXBvcnQgeyBnZXRBdXRoVXNlciwgcHJvdGVjdCB9IGZyb20gXCIuLi9taWRkbGV3YXJlL2F1dGhvcml6YXRpb25cIjtcblxuY29uc3QgcHJpc21hID0gbmV3IFByaXNtYUNsaWVudCgpO1xuXG5mdW5jdGlvbiBnZXRWaWRlb1JvdXRlcygpIHtcbiAgY29uc3Qgcm91dGVyID0gZXhwcmVzcy5Sb3V0ZXIoKTtcblxuICByb3V0ZXIuZ2V0KFwiL1wiLCBnZXRSZWNvbW1lbmRlZFZpZGVvcyk7XG4gIHJvdXRlci5wb3N0KFwiL1wiLCBwcm90ZWN0LCBhZGRWaWRlbyk7XG5cbiAgcm91dGVyLmdldChcIi90cmVuZGluZ1wiLCBnZXRUcmVuZGluZ1ZpZGVvcyk7XG4gIHJvdXRlci5nZXQoXCIvc2VhcmNoXCIsIHNlYXJjaFZpZGVvcyk7XG5cbiAgcm91dGVyLmdldChcIi86dmlkZW9JZFwiLCBnZXRBdXRoVXNlciwgZ2V0VmlkZW8pO1xuICByb3V0ZXIuZGVsZXRlKFwiLzp2aWRlb0lkXCIsIHByb3RlY3QsIGRlbGV0ZVZpZGVvKTtcblxuICByb3V0ZXIuZ2V0KFwiLzp2aWRlb0lkL3ZpZXdcIiwgZ2V0QXV0aFVzZXIsIGFkZFZpZGVvVmlldyk7XG4gIHJvdXRlci5nZXQoXCIvOnZpZGVvSWQvbGlrZVwiLCBwcm90ZWN0LCBsaWtlVmlkZW8pO1xuICByb3V0ZXIuZ2V0KFwiLzp2aWRlb0lkL2Rpc2xpa2VcIiwgcHJvdGVjdCwgZGlzbGlrZVZpZGVvKTtcbiAgcm91dGVyLnBvc3QoXCIvOnZpZGVvSWQvY29tbWVudHNcIiwgcHJvdGVjdCwgYWRkQ29tbWVudCk7XG4gIHJvdXRlci5kZWxldGUoXCIvOnZpZGVvSWQvY29tbWVudHMvOmNvbW1lbnRJZFwiLCBwcm90ZWN0LCBkZWxldGVDb21tZW50KTtcblxuICByZXR1cm4gcm91dGVyO1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0VmlkZW9WaWV3cyh2aWRlb3MpIHtcbiAgZm9yIChjb25zdCB2aWRlbyBvZiB2aWRlb3MpIHtcbiAgICBjb25zdCB2aWV3cyA9IGF3YWl0IHByaXNtYS52aWV3LmNvdW50KHtcbiAgICAgIHdoZXJlOiB7XG4gICAgICAgIHZpZGVvSWQ6IHtcbiAgICAgICAgICBlcXVhbHM6IHZpZGVvLmlkLFxuICAgICAgICB9LFxuICAgICAgfSxcbiAgICB9KTtcbiAgICB2aWRlby52aWV3cyA9IHZpZXdzO1xuICB9XG4gIHJldHVybiB2aWRlb3M7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGdldFJlY29tbWVuZGVkVmlkZW9zKHJlcSwgcmVzKSB7XG4gIGxldCB2aWRlb3MgPSBhd2FpdCBwcmlzbWEudmlkZW8uZmluZE1hbnkoe1xuICAgIGluY2x1ZGU6IHtcbiAgICAgIHVzZXI6IHRydWUsXG4gICAgfSxcbiAgICBvcmRlckJ5OiB7XG4gICAgICBjcmVhdGVkQXQ6IFwiZGVzY1wiLFxuICAgIH0sXG4gIH0pO1xuXG4gIGlmICghdmlkZW9zLmxlbmd0aCkge1xuICAgIHJldHVybiByZXMuc3RhdHVzKDIwMCkuanNvbih7IHZpZGVvcyB9KTtcbiAgfVxuXG4gIHZpZGVvcyA9IGF3YWl0IGdldFZpZGVvVmlld3ModmlkZW9zKTtcblxuICByZXMuc3RhdHVzKDIwMCkuanNvbih7IHZpZGVvcyB9KTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gZ2V0VHJlbmRpbmdWaWRlb3MocmVxLCByZXMpIHtcbiAgbGV0IHZpZGVvcyA9IGF3YWl0IHByaXNtYS52aWRlby5maW5kTWFueSh7XG4gICAgaW5jbHVkZToge1xuICAgICAgdXNlcjogdHJ1ZSxcbiAgICB9LFxuICAgIG9yZGVyQnk6IHtcbiAgICAgIGNyZWF0ZWRBdDogXCJkZXNjXCIsXG4gICAgfSxcbiAgfSk7XG5cbiAgaWYgKCF2aWRlb3MubGVuZ3RoKSB7XG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoMjAwKS5qc29uKHsgdmlkZW9zIH0pO1xuICB9XG5cbiAgdmlkZW9zID0gYXdhaXQgZ2V0VmlkZW9WaWV3cyh2aWRlb3MpO1xuICB2aWRlb3Muc29ydCgoYSwgYikgPT4gYi52aWV3cyAtIGEudmlld3MpO1xuXG4gIHJlcy5zdGF0dXMoMjAwKS5qc29uKHsgdmlkZW9zIH0pO1xufVxuXG5hc3luYyBmdW5jdGlvbiBzZWFyY2hWaWRlb3MocmVxLCByZXMsIG5leHQpIHtcbiAgaWYgKCFyZXEucXVlcnkucXVlcnkpIHtcbiAgICByZXR1cm4gbmV4dCh7XG4gICAgICBtZXNzYWdlOiBcIlBsZWFzZSBlbnRlciBhIHNlYXJjaCBxdWVyeVwiLFxuICAgICAgc3RhdHVzQ29kZTogNDAwLFxuICAgIH0pO1xuICB9XG5cbiAgbGV0IHZpZGVvcyA9IGF3YWl0IHByaXNtYS52aWRlby5maW5kTWFueSh7XG4gICAgaW5jbHVkZToge1xuICAgICAgdXNlcjogdHJ1ZSxcbiAgICB9LFxuICAgIHdoZXJlOiB7XG4gICAgICBPUjogW1xuICAgICAgICB7XG4gICAgICAgICAgdGl0bGU6IHtcbiAgICAgICAgICAgIGNvbnRhaW5zOiByZXEucXVlcnkucXVlcnksXG4gICAgICAgICAgICBtb2RlOiBcImluc2Vuc2l0aXZlXCIsXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIGRlc2NyaXB0aW9uOiB7XG4gICAgICAgICAgICBjb250YWluczogcmVxLnF1ZXJ5LnF1ZXJ5LFxuICAgICAgICAgICAgbW9kZTogXCJpbnNlbnNpdGl2ZVwiLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICBdLFxuICAgIH0sXG4gIH0pO1xuXG4gIGlmICghdmlkZW9zLmxlbmd0aCkge1xuICAgIHJldHVybiByZXMuc3RhdHVzKDIwMCkuanNvbih7IHZpZGVvcyB9KTtcbiAgfVxuXG4gIHZpZGVvcyA9IGF3YWl0IGdldFZpZGVvVmlld3ModmlkZW9zKTtcblxuICByZXMuc3RhdHVzKDIwMCkuanNvbih7IHZpZGVvcyB9KTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gYWRkVmlkZW8ocmVxLCByZXMpIHtcbiAgY29uc3QgeyB0aXRsZSwgZGVzY3JpcHRpb24sIHVybCwgdGh1bWJuYWlsIH0gPSByZXEuYm9keTtcblxuICBjb25zdCB2aWRlbyA9IGF3YWl0IHByaXNtYS52aWRlby5jcmVhdGUoe1xuICAgIGRhdGE6IHtcbiAgICAgIHRpdGxlLFxuICAgICAgZGVzY3JpcHRpb24sXG4gICAgICB1cmwsXG4gICAgICB0aHVtYm5haWwsXG4gICAgICB1c2VyOiB7XG4gICAgICAgIGNvbm5lY3Q6IHtcbiAgICAgICAgICBpZDogcmVxLnVzZXIuaWQsXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgIH0sXG4gIH0pO1xuXG4gIHJlcy5zdGF0dXMoMjAwKS5qc29uKHsgdmlkZW8gfSk7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGFkZENvbW1lbnQocmVxLCByZXMsIG5leHQpIHtcbiAgY29uc3QgdmlkZW8gPSBhd2FpdCBwcmlzbWEudmlkZW8uZmluZFVuaXF1ZSh7XG4gICAgd2hlcmU6IHtcbiAgICAgIGlkOiByZXEucGFyYW1zLnZpZGVvSWQsXG4gICAgfSxcbiAgfSk7XG5cbiAgaWYgKCF2aWRlbykge1xuICAgIHJldHVybiBuZXh0KHtcbiAgICAgIG1lc3NhZ2U6IGBObyB2aWRlbyBmb3VuZCB3aXRoIGlkOiBcIiR7cmVxLnBhcmFtcy52aWRlb0lkfVwiYCxcbiAgICAgIHN0YXR1c0NvZGU6IDQwNCxcbiAgICB9KTtcbiAgfVxuXG4gIGNvbnN0IGNvbW1lbnQgPSBhd2FpdCBwcmlzbWEuY29tbWVudC5jcmVhdGUoe1xuICAgIGRhdGE6IHtcbiAgICAgIHRleHQ6IHJlcS5ib2R5LnRleHQsXG4gICAgICB1c2VyOiB7XG4gICAgICAgIGNvbm5lY3Q6IHtcbiAgICAgICAgICBpZDogcmVxLnVzZXIuaWQsXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgICAgdmlkZW86IHtcbiAgICAgICAgY29ubmVjdDoge1xuICAgICAgICAgIGlkOiByZXEucGFyYW1zLnZpZGVvSWQsXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgIH0sXG4gIH0pO1xuXG4gIHJlcy5zdGF0dXMoMjAwKS5qc29uKHsgY29tbWVudCB9KTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gZGVsZXRlQ29tbWVudChyZXEsIHJlcykge1xuICBjb25zdCBjb21tZW50ID0gYXdhaXQgcHJpc21hLmNvbW1lbnQuZmluZFVuaXF1ZSh7XG4gICAgd2hlcmU6IHtcbiAgICAgIGlkOiByZXEucGFyYW1zLmNvbW1lbnRJZCxcbiAgICB9LFxuICAgIHNlbGVjdDoge1xuICAgICAgdXNlcklkOiB0cnVlLFxuICAgIH0sXG4gIH0pO1xuXG4gIGlmIChjb21tZW50LnVzZXJJZCAhPT0gcmVxLnVzZXIuaWQpIHtcbiAgICByZXR1cm4gcmVzXG4gICAgICAuc3RhdHVzKDQwMSlcbiAgICAgIC5zZW5kKFwiWW91IGFyZSBub3QgYXV0aG9yaXplZCB0byBkZWxldGUgdGhpcyBjb21tZW50XCIpO1xuICB9XG5cbiAgYXdhaXQgcHJpc21hLmNvbW1lbnQuZGVsZXRlKHtcbiAgICB3aGVyZToge1xuICAgICAgaWQ6IHJlcS5wYXJhbXMuY29tbWVudElkLFxuICAgIH0sXG4gIH0pO1xuXG4gIHJlcy5zdGF0dXMoMjAwKS5qc29uKHt9KTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gYWRkVmlkZW9WaWV3KHJlcSwgcmVzLCBuZXh0KSB7XG4gIGNvbnN0IHZpZGVvID0gYXdhaXQgcHJpc21hLnZpZGVvLmZpbmRVbmlxdWUoe1xuICAgIHdoZXJlOiB7XG4gICAgICBpZDogcmVxLnBhcmFtcy52aWRlb0lkLFxuICAgIH0sXG4gIH0pO1xuXG4gIGlmICghdmlkZW8pIHtcbiAgICByZXR1cm4gbmV4dCh7XG4gICAgICBtZXNzYWdlOiBgTm8gdmlkZW8gZm91bmQgd2l0aCBpZDogXCIke3JlcS5wYXJhbXMudmlkZW9JZH1cImAsXG4gICAgICBzdGF0dXNDb2RlOiA0MDQsXG4gICAgfSk7XG4gIH1cblxuICBpZiAocmVxLnVzZXIpIHtcbiAgICBhd2FpdCBwcmlzbWEudmlldy5jcmVhdGUoe1xuICAgICAgZGF0YToge1xuICAgICAgICB2aWRlbzoge1xuICAgICAgICAgIGNvbm5lY3Q6IHtcbiAgICAgICAgICAgIGlkOiByZXEucGFyYW1zLnZpZGVvSWQsXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAgdXNlcjoge1xuICAgICAgICAgIGNvbm5lY3Q6IHtcbiAgICAgICAgICAgIGlkOiByZXEudXNlci5pZCxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgfSxcbiAgICB9KTtcbiAgfSBlbHNlIHtcbiAgICBhd2FpdCBwcmlzbWEudmlldy5jcmVhdGUoe1xuICAgICAgZGF0YToge1xuICAgICAgICB2aWRlbzoge1xuICAgICAgICAgIGNvbm5lY3Q6IHtcbiAgICAgICAgICAgIGlkOiByZXEucGFyYW1zLnZpZGVvSWQsXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgfSk7XG4gIH1cblxuICByZXMuc3RhdHVzKDIwMCkuanNvbih7fSk7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGxpa2VWaWRlbyhyZXEsIHJlcywgbmV4dCkge1xuICBjb25zdCB2aWRlbyA9IGF3YWl0IHByaXNtYS52aWRlby5maW5kVW5pcXVlKHtcbiAgICB3aGVyZToge1xuICAgICAgaWQ6IHJlcS5wYXJhbXMudmlkZW9JZCxcbiAgICB9LFxuICB9KTtcblxuICBpZiAoIXZpZGVvKSB7XG4gICAgcmV0dXJuIG5leHQoe1xuICAgICAgbWVzc2FnZTogYE5vIHZpZGVvIGZvdW5kIHdpdGggaWQ6IFwiJHtyZXEucGFyYW1zLnZpZGVvSWR9XCJgLFxuICAgICAgc3RhdHVzQ29kZTogNDA0LFxuICAgIH0pO1xuICB9XG5cbiAgY29uc3QgaXNMaWtlZCA9IGF3YWl0IHByaXNtYS52aWRlb0xpa2UuZmluZEZpcnN0KHtcbiAgICB3aGVyZToge1xuICAgICAgdXNlcklkOiB7XG4gICAgICAgIGVxdWFsczogcmVxLnVzZXIuaWQsXG4gICAgICB9LFxuICAgICAgdmlkZW9JZDoge1xuICAgICAgICBlcXVhbHM6IHJlcS5wYXJhbXMudmlkZW9JZCxcbiAgICAgIH0sXG4gICAgICBsaWtlOiB7XG4gICAgICAgIGVxdWFsczogMSxcbiAgICAgIH0sXG4gICAgfSxcbiAgfSk7XG5cbiAgY29uc3QgaXNEaXNsaWtlZCA9IGF3YWl0IHByaXNtYS52aWRlb0xpa2UuZmluZEZpcnN0KHtcbiAgICB3aGVyZToge1xuICAgICAgdXNlcklkOiB7XG4gICAgICAgIGVxdWFsczogcmVxLnVzZXIuaWQsXG4gICAgICB9LFxuICAgICAgdmlkZW9JZDoge1xuICAgICAgICBlcXVhbHM6IHJlcS5wYXJhbXMudmlkZW9JZCxcbiAgICAgIH0sXG4gICAgICBsaWtlOiB7XG4gICAgICAgIGVxdWFsczogLTEsXG4gICAgICB9LFxuICAgIH0sXG4gIH0pO1xuXG4gIGlmIChpc0xpa2VkKSB7XG4gICAgYXdhaXQgcHJpc21hLnZpZGVvTGlrZS5kZWxldGUoe1xuICAgICAgd2hlcmU6IHtcbiAgICAgICAgaWQ6IGlzTGlrZWQuaWQsXG4gICAgICB9LFxuICAgIH0pO1xuICB9IGVsc2UgaWYgKGlzRGlzbGlrZWQpIHtcbiAgICBhd2FpdCBwcmlzbWEudmlkZW9MaWtlLnVwZGF0ZSh7XG4gICAgICB3aGVyZToge1xuICAgICAgICBpZDogaXNEaXNsaWtlZC5pZCxcbiAgICAgIH0sXG4gICAgICBkYXRhOiB7XG4gICAgICAgIGxpa2U6IDEsXG4gICAgICB9LFxuICAgIH0pO1xuICB9IGVsc2Uge1xuICAgIGF3YWl0IHByaXNtYS52aWRlb0xpa2UuY3JlYXRlKHtcbiAgICAgIGRhdGE6IHtcbiAgICAgICAgdXNlcjoge1xuICAgICAgICAgIGNvbm5lY3Q6IHtcbiAgICAgICAgICAgIGlkOiByZXEudXNlci5pZCxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB2aWRlbzoge1xuICAgICAgICAgIGNvbm5lY3Q6IHtcbiAgICAgICAgICAgIGlkOiByZXEucGFyYW1zLnZpZGVvSWQsXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAgbGlrZTogMSxcbiAgICAgIH0sXG4gICAgfSk7XG4gIH1cblxuICByZXMuc3RhdHVzKDIwMCkuanNvbih7fSk7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGRpc2xpa2VWaWRlbyhyZXEsIHJlcywgbmV4dCkge1xuICBjb25zdCB2aWRlbyA9IGF3YWl0IHByaXNtYS52aWRlby5maW5kVW5pcXVlKHtcbiAgICB3aGVyZToge1xuICAgICAgaWQ6IHJlcS5wYXJhbXMudmlkZW9JZCxcbiAgICB9LFxuICB9KTtcblxuICBpZiAoIXZpZGVvKSB7XG4gICAgcmV0dXJuIG5leHQoe1xuICAgICAgbWVzc2FnZTogYE5vIHZpZGVvIGZvdW5kIHdpdGggaWQ6IFwiJHtyZXEucGFyYW1zLnZpZGVvSWR9XCJgLFxuICAgICAgc3RhdHVzQ29kZTogNDA0LFxuICAgIH0pO1xuICB9XG5cbiAgY29uc3QgaXNMaWtlZCA9IGF3YWl0IHByaXNtYS52aWRlb0xpa2UuZmluZEZpcnN0KHtcbiAgICB3aGVyZToge1xuICAgICAgdXNlcklkOiB7XG4gICAgICAgIGVxdWFsczogcmVxLnVzZXIuaWQsXG4gICAgICB9LFxuICAgICAgdmlkZW9JZDoge1xuICAgICAgICBlcXVhbHM6IHJlcS5wYXJhbXMudmlkZW9JZCxcbiAgICAgIH0sXG4gICAgICBsaWtlOiB7XG4gICAgICAgIGVxdWFsczogMSxcbiAgICAgIH0sXG4gICAgfSxcbiAgfSk7XG5cbiAgY29uc3QgaXNEaXNsaWtlZCA9IGF3YWl0IHByaXNtYS52aWRlb0xpa2UuZmluZEZpcnN0KHtcbiAgICB3aGVyZToge1xuICAgICAgdXNlcklkOiB7XG4gICAgICAgIGVxdWFsczogcmVxLnVzZXIuaWQsXG4gICAgICB9LFxuICAgICAgdmlkZW9JZDoge1xuICAgICAgICBlcXVhbHM6IHJlcS5wYXJhbXMudmlkZW9JZCxcbiAgICAgIH0sXG4gICAgICBsaWtlOiB7XG4gICAgICAgIGVxdWFsczogLTEsXG4gICAgICB9LFxuICAgIH0sXG4gIH0pO1xuXG4gIGlmIChpc0Rpc2xpa2VkKSB7XG4gICAgYXdhaXQgcHJpc21hLnZpZGVvTGlrZS5kZWxldGUoe1xuICAgICAgd2hlcmU6IHtcbiAgICAgICAgaWQ6IGlzRGlzbGlrZWQuaWQsXG4gICAgICB9LFxuICAgIH0pO1xuICB9IGVsc2UgaWYgKGlzTGlrZWQpIHtcbiAgICBhd2FpdCBwcmlzbWEudmlkZW9MaWtlLnVwZGF0ZSh7XG4gICAgICB3aGVyZToge1xuICAgICAgICBpZDogaXNMaWtlZC5pZCxcbiAgICAgIH0sXG4gICAgICBkYXRhOiB7XG4gICAgICAgIGxpa2U6IC0xLFxuICAgICAgfSxcbiAgICB9KTtcbiAgfSBlbHNlIHtcbiAgICBhd2FpdCBwcmlzbWEudmlkZW9MaWtlLmNyZWF0ZSh7XG4gICAgICBkYXRhOiB7XG4gICAgICAgIHVzZXI6IHtcbiAgICAgICAgICBjb25uZWN0OiB7XG4gICAgICAgICAgICBpZDogcmVxLnVzZXIuaWQsXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAgdmlkZW86IHtcbiAgICAgICAgICBjb25uZWN0OiB7XG4gICAgICAgICAgICBpZDogcmVxLnBhcmFtcy52aWRlb0lkLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIGxpa2U6IC0xLFxuICAgICAgfSxcbiAgICB9KTtcbiAgfVxuXG4gIHJlcy5zdGF0dXMoMjAwKS5qc29uKHt9KTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gZ2V0VmlkZW8ocmVxLCByZXMsIG5leHQpIHtcbiAgY29uc3QgdmlkZW8gPSBhd2FpdCBwcmlzbWEudmlkZW8uZmluZFVuaXF1ZSh7XG4gICAgd2hlcmU6IHtcbiAgICAgIGlkOiByZXEucGFyYW1zLnZpZGVvSWQsXG4gICAgfSxcbiAgICBpbmNsdWRlOiB7XG4gICAgICB1c2VyOiB0cnVlLFxuICAgICAgY29tbWVudHM6IHtcbiAgICAgICAgaW5jbHVkZToge1xuICAgICAgICAgIHVzZXI6IHRydWUsXG4gICAgICAgIH0sXG4gICAgICAgIG9yZGVyQnk6IHtcbiAgICAgICAgICBjcmVhdGVkQXQ6IFwiZGVzY1wiLFxuICAgICAgICB9LFxuICAgICAgfSxcbiAgICB9LFxuICB9KTtcblxuICBpZiAoIXZpZGVvKSB7XG4gICAgcmV0dXJuIG5leHQoe1xuICAgICAgbWVzc2FnZTogYE5vIHZpZGVvIGZvdW5kIHdpdGggaWQ6IFwiJHtyZXEucGFyYW1zLnZpZGVvSWR9XCJgLFxuICAgICAgc3RhdHVzQ29kZTogNDA0LFxuICAgIH0pO1xuICB9XG5cbiAgbGV0IGlzVmlkZW9NaW5lID0gZmFsc2U7XG4gIGxldCBpc0xpa2VkID0gZmFsc2U7XG4gIGxldCBpc0Rpc2xpa2VkID0gZmFsc2U7XG4gIGxldCBpc1N1YnNjcmliZWQgPSBmYWxzZTtcbiAgbGV0IGlzVmlld2VkID0gZmFsc2U7XG5cbiAgaWYgKHJlcS51c2VyKSB7XG4gICAgaXNWaWRlb01pbmUgPSByZXEudXNlci5pZCA9PT0gdmlkZW8udXNlcklkO1xuXG4gICAgaXNMaWtlZCA9IGF3YWl0IHByaXNtYS52aWRlb0xpa2UuZmluZEZpcnN0KHtcbiAgICAgIHdoZXJlOiB7XG4gICAgICAgIHVzZXJJZDoge1xuICAgICAgICAgIGVxdWFsczogcmVxLnVzZXIuaWQsXG4gICAgICAgIH0sXG4gICAgICAgIHZpZGVvSWQ6IHtcbiAgICAgICAgICBlcXVhbHM6IHJlcS5wYXJhbXMudmlkZW9JZCxcbiAgICAgICAgfSxcbiAgICAgICAgbGlrZToge1xuICAgICAgICAgIGVxdWFsczogMSxcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgfSk7XG5cbiAgICBpc0Rpc2xpa2VkID0gYXdhaXQgcHJpc21hLnZpZGVvTGlrZS5maW5kRmlyc3Qoe1xuICAgICAgd2hlcmU6IHtcbiAgICAgICAgdXNlcklkOiB7XG4gICAgICAgICAgZXF1YWxzOiByZXEudXNlci5pZCxcbiAgICAgICAgfSxcbiAgICAgICAgdmlkZW9JZDoge1xuICAgICAgICAgIGVxdWFsczogcmVxLnBhcmFtcy52aWRlb0lkLFxuICAgICAgICB9LFxuICAgICAgICBsaWtlOiB7XG4gICAgICAgICAgZXF1YWxzOiAtMSxcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgfSk7XG5cbiAgICBpc1ZpZXdlZCA9IGF3YWl0IHByaXNtYS52aWV3LmZpbmRGaXJzdCh7XG4gICAgICB3aGVyZToge1xuICAgICAgICB1c2VySWQ6IHtcbiAgICAgICAgICBlcXVhbHM6IHJlcS51c2VyLmlkLFxuICAgICAgICB9LFxuICAgICAgICB2aWRlb0lkOiB7XG4gICAgICAgICAgZXF1YWxzOiB2aWRlby5pZCxcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgfSk7XG5cbiAgICBpc1N1YnNjcmliZWQgPSBhd2FpdCBwcmlzbWEuc3Vic2NyaXB0aW9uLmZpbmRGaXJzdCh7XG4gICAgICB3aGVyZToge1xuICAgICAgICBzdWJzY3JpYmVySWQ6IHtcbiAgICAgICAgICBlcXVhbHM6IHJlcS51c2VyLmlkLFxuICAgICAgICB9LFxuICAgICAgICBzdWJzY3JpYmVkVG9JZDoge1xuICAgICAgICAgIGVxdWFsczogdmlkZW8udXNlcklkLFxuICAgICAgICB9LFxuICAgICAgfSxcbiAgICB9KTtcbiAgfVxuXG4gIGNvbnN0IGxpa2VzQ291bnQgPSBhd2FpdCBwcmlzbWEudmlkZW9MaWtlLmNvdW50KHtcbiAgICB3aGVyZToge1xuICAgICAgQU5EOiB7XG4gICAgICAgIHZpZGVvSWQ6IHtcbiAgICAgICAgICBlcXVhbHM6IHJlcS5wYXJhbXMudmlkZW9JZCxcbiAgICAgICAgfSxcbiAgICAgICAgbGlrZToge1xuICAgICAgICAgIGVxdWFsczogMSxcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgfSxcbiAgfSk7XG5cbiAgY29uc3QgZGlzbGlrZXNDb3VudCA9IGF3YWl0IHByaXNtYS52aWRlb0xpa2UuY291bnQoe1xuICAgIHdoZXJlOiB7XG4gICAgICBBTkQ6IHtcbiAgICAgICAgdmlkZW9JZDoge1xuICAgICAgICAgIGVxdWFsczogcmVxLnBhcmFtcy52aWRlb0lkLFxuICAgICAgICB9LFxuICAgICAgICBsaWtlOiB7XG4gICAgICAgICAgZXF1YWxzOiAtMSxcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgfSxcbiAgfSk7XG5cbiAgY29uc3Qgdmlld3MgPSBhd2FpdCBwcmlzbWEudmlldy5jb3VudCh7XG4gICAgd2hlcmU6IHtcbiAgICAgIHZpZGVvSWQ6IHtcbiAgICAgICAgZXF1YWxzOiB2aWRlby5pZCxcbiAgICAgIH0sXG4gICAgfSxcbiAgfSk7XG5cbiAgY29uc3Qgc3Vic2NyaWJlcnNDb3VudCA9IGF3YWl0IHByaXNtYS5zdWJzY3JpcHRpb24uY291bnQoe1xuICAgIHdoZXJlOiB7XG4gICAgICBzdWJzY3JpYmVkVG9JZDoge1xuICAgICAgICBlcXVhbHM6IHZpZGVvLnVzZXJJZCxcbiAgICAgIH0sXG4gICAgfSxcbiAgfSk7XG5cbiAgdmlkZW8uY29tbWVudHNDb3VudCA9IHZpZGVvLmNvbW1lbnRzLmxlbmd0aDtcbiAgdmlkZW8uaXNMaWtlZCA9IEJvb2xlYW4oaXNMaWtlZCk7XG4gIHZpZGVvLmlzRGlzbGlrZWQgPSBCb29sZWFuKGlzRGlzbGlrZWQpO1xuICB2aWRlby5saWtlc0NvdW50ID0gbGlrZXNDb3VudDtcbiAgdmlkZW8uZGlzbGlrZXNDb3VudCA9IGRpc2xpa2VzQ291bnQ7XG4gIHZpZGVvLmlzVmlkZW9NaW5lID0gaXNWaWRlb01pbmU7XG4gIHZpZGVvLnZpZXdzID0gdmlld3M7XG4gIHZpZGVvLmlzU3Vic2NyaWJlZCA9IEJvb2xlYW4oaXNTdWJzY3JpYmVkKTtcbiAgdmlkZW8uaXNWaWV3ZWQgPSBCb29sZWFuKGlzVmlld2VkKTtcbiAgdmlkZW8uc3Vic2NyaWJlcnNDb3VudCA9IHN1YnNjcmliZXJzQ291bnQ7XG5cbiAgcmVzLnN0YXR1cygyMDApLmpzb24oeyB2aWRlbyB9KTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gZGVsZXRlVmlkZW8ocmVxLCByZXMpIHtcbiAgY29uc3QgdmlkZW8gPSBhd2FpdCBwcmlzbWEudmlkZW8uZmluZFVuaXF1ZSh7XG4gICAgd2hlcmU6IHtcbiAgICAgIGlkOiByZXEucGFyYW1zLnZpZGVvSWQsXG4gICAgfSxcbiAgICBzZWxlY3Q6IHtcbiAgICAgIHVzZXJJZDogdHJ1ZSxcbiAgICB9LFxuICB9KTtcblxuICBpZiAocmVxLnVzZXIuaWQgIT09IHZpZGVvLnVzZXJJZCkge1xuICAgIHJldHVybiByZXMuc3RhdHVzKDQwMSkuc2VuZChcIllvdSBhcmUgbm90IGF1dGhvcml6ZWQgdG8gZGVsZXRlIHRoaXMgdmlkZW9cIik7XG4gIH1cblxuICBhd2FpdCBwcmlzbWEudmlldy5kZWxldGVNYW55KHtcbiAgICB3aGVyZToge1xuICAgICAgdmlkZW9JZDoge1xuICAgICAgICBlcXVhbHM6IHJlcS5wYXJhbXMudmlkZW9JZCxcbiAgICAgIH0sXG4gICAgfSxcbiAgfSk7XG5cbiAgYXdhaXQgcHJpc21hLnZpZGVvTGlrZS5kZWxldGVNYW55KHtcbiAgICB3aGVyZToge1xuICAgICAgdmlkZW9JZDoge1xuICAgICAgICBlcXVhbHM6IHJlcS5wYXJhbXMudmlkZW9JZCxcbiAgICAgIH0sXG4gICAgfSxcbiAgfSk7XG5cbiAgYXdhaXQgcHJpc21hLmNvbW1lbnQuZGVsZXRlTWFueSh7XG4gICAgd2hlcmU6IHtcbiAgICAgIHZpZGVvSWQ6IHtcbiAgICAgICAgZXF1YWxzOiByZXEucGFyYW1zLnZpZGVvSWQsXG4gICAgICB9LFxuICAgIH0sXG4gIH0pO1xuXG4gIGF3YWl0IHByaXNtYS52aWRlby5kZWxldGUoe1xuICAgIHdoZXJlOiB7XG4gICAgICBpZDogcmVxLnBhcmFtcy52aWRlb0lkLFxuICAgIH0sXG4gIH0pO1xuXG4gIHJlcy5zdGF0dXMoMjAwKS5qc29uKHt9KTtcbn1cblxuZXhwb3J0IHsgZ2V0VmlkZW9Sb3V0ZXMgfTtcbiJdfQ==",
    "map": {
      "version": 3,
      "sources": [
        "video.js"
      ],
      "names": [
        "prisma",
        "PrismaClient",
        "getVideoRoutes",
        "router",
        "express",
        "Router",
        "get",
        "getRecommendedVideos",
        "post",
        "protect",
        "addVideo",
        "getTrendingVideos",
        "searchVideos",
        "getAuthUser",
        "getVideo",
        "delete",
        "deleteVideo",
        "addVideoView",
        "likeVideo",
        "dislikeVideo",
        "addComment",
        "deleteComment",
        "getVideoViews",
        "videos",
        "video",
        "views",
        "view",
        "count",
        "where",
        "videoId",
        "equals",
        "id",
        "req",
        "res",
        "findMany",
        "include",
        "user",
        "orderBy",
        "createdAt",
        "length",
        "status",
        "json",
        "sort",
        "a",
        "b",
        "next",
        "query",
        "message",
        "statusCode",
        "OR",
        "title",
        "contains",
        "mode",
        "description",
        "url",
        "thumbnail",
        "body",
        "create",
        "data",
        "connect",
        "findUnique",
        "params",
        "comment",
        "text",
        "commentId",
        "select",
        "userId",
        "send",
        "isLiked",
        "videoLike",
        "findFirst",
        "like",
        "isDisliked",
        "update",
        "comments",
        "isVideoMine",
        "isSubscribed",
        "isViewed",
        "subscription",
        "subscriberId",
        "subscribedToId",
        "likesCount",
        "AND",
        "dislikesCount",
        "subscribersCount",
        "commentsCount",
        "Boolean",
        "deleteMany"
      ],
      "mappings": "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",
      "sourceRoot": "/Users/egor/Dev/ytclone/1/server/src/routes/",
      "sourcesContent": [
        "import { PrismaClient } from \"@prisma/client\";\nimport express from \"express\";\nimport { getAuthUser, protect } from \"../middleware/authorization\";\n\nconst prisma = new PrismaClient();\n\nfunction getVideoRoutes() {\n  const router = express.Router();\n\n  router.get(\"/\", getRecommendedVideos);\n  router.post(\"/\", protect, addVideo);\n\n  router.get(\"/trending\", getTrendingVideos);\n  router.get(\"/search\", searchVideos);\n\n  router.get(\"/:videoId\", getAuthUser, getVideo);\n  router.delete(\"/:videoId\", protect, deleteVideo);\n\n  router.get(\"/:videoId/view\", getAuthUser, addVideoView);\n  router.get(\"/:videoId/like\", protect, likeVideo);\n  router.get(\"/:videoId/dislike\", protect, dislikeVideo);\n  router.post(\"/:videoId/comments\", protect, addComment);\n  router.delete(\"/:videoId/comments/:commentId\", protect, deleteComment);\n\n  return router;\n}\n\nexport async function getVideoViews(videos) {\n  for (const video of videos) {\n    const views = await prisma.view.count({\n      where: {\n        videoId: {\n          equals: video.id,\n        },\n      },\n    });\n    video.views = views;\n  }\n  return videos;\n}\n\nasync function getRecommendedVideos(req, res) {\n  let videos = await prisma.video.findMany({\n    include: {\n      user: true,\n    },\n    orderBy: {\n      createdAt: \"desc\",\n    },\n  });\n\n  if (!videos.length) {\n    return res.status(200).json({ videos });\n  }\n\n  videos = await getVideoViews(videos);\n\n  res.status(200).json({ videos });\n}\n\nasync function getTrendingVideos(req, res) {\n  let videos = await prisma.video.findMany({\n    include: {\n      user: true,\n    },\n    orderBy: {\n      createdAt: \"desc\",\n    },\n  });\n\n  if (!videos.length) {\n    return res.status(200).json({ videos });\n  }\n\n  videos = await getVideoViews(videos);\n  videos.sort((a, b) => b.views - a.views);\n\n  res.status(200).json({ videos });\n}\n\nasync function searchVideos(req, res, next) {\n  if (!req.query.query) {\n    return next({\n      message: \"Please enter a search query\",\n      statusCode: 400,\n    });\n  }\n\n  let videos = await prisma.video.findMany({\n    include: {\n      user: true,\n    },\n    where: {\n      OR: [\n        {\n          title: {\n            contains: req.query.query,\n            mode: \"insensitive\",\n          },\n        },\n        {\n          description: {\n            contains: req.query.query,\n            mode: \"insensitive\",\n          },\n        },\n      ],\n    },\n  });\n\n  if (!videos.length) {\n    return res.status(200).json({ videos });\n  }\n\n  videos = await getVideoViews(videos);\n\n  res.status(200).json({ videos });\n}\n\nasync function addVideo(req, res) {\n  const { title, description, url, thumbnail } = req.body;\n\n  const video = await prisma.video.create({\n    data: {\n      title,\n      description,\n      url,\n      thumbnail,\n      user: {\n        connect: {\n          id: req.user.id,\n        },\n      },\n    },\n  });\n\n  res.status(200).json({ video });\n}\n\nasync function addComment(req, res, next) {\n  const video = await prisma.video.findUnique({\n    where: {\n      id: req.params.videoId,\n    },\n  });\n\n  if (!video) {\n    return next({\n      message: `No video found with id: \"${req.params.videoId}\"`,\n      statusCode: 404,\n    });\n  }\n\n  const comment = await prisma.comment.create({\n    data: {\n      text: req.body.text,\n      user: {\n        connect: {\n          id: req.user.id,\n        },\n      },\n      video: {\n        connect: {\n          id: req.params.videoId,\n        },\n      },\n    },\n  });\n\n  res.status(200).json({ comment });\n}\n\nasync function deleteComment(req, res) {\n  const comment = await prisma.comment.findUnique({\n    where: {\n      id: req.params.commentId,\n    },\n    select: {\n      userId: true,\n    },\n  });\n\n  if (comment.userId !== req.user.id) {\n    return res\n      .status(401)\n      .send(\"You are not authorized to delete this comment\");\n  }\n\n  await prisma.comment.delete({\n    where: {\n      id: req.params.commentId,\n    },\n  });\n\n  res.status(200).json({});\n}\n\nasync function addVideoView(req, res, next) {\n  const video = await prisma.video.findUnique({\n    where: {\n      id: req.params.videoId,\n    },\n  });\n\n  if (!video) {\n    return next({\n      message: `No video found with id: \"${req.params.videoId}\"`,\n      statusCode: 404,\n    });\n  }\n\n  if (req.user) {\n    await prisma.view.create({\n      data: {\n        video: {\n          connect: {\n            id: req.params.videoId,\n          },\n        },\n        user: {\n          connect: {\n            id: req.user.id,\n          },\n        },\n      },\n    });\n  } else {\n    await prisma.view.create({\n      data: {\n        video: {\n          connect: {\n            id: req.params.videoId,\n          },\n        },\n      },\n    });\n  }\n\n  res.status(200).json({});\n}\n\nasync function likeVideo(req, res, next) {\n  const video = await prisma.video.findUnique({\n    where: {\n      id: req.params.videoId,\n    },\n  });\n\n  if (!video) {\n    return next({\n      message: `No video found with id: \"${req.params.videoId}\"`,\n      statusCode: 404,\n    });\n  }\n\n  const isLiked = await prisma.videoLike.findFirst({\n    where: {\n      userId: {\n        equals: req.user.id,\n      },\n      videoId: {\n        equals: req.params.videoId,\n      },\n      like: {\n        equals: 1,\n      },\n    },\n  });\n\n  const isDisliked = await prisma.videoLike.findFirst({\n    where: {\n      userId: {\n        equals: req.user.id,\n      },\n      videoId: {\n        equals: req.params.videoId,\n      },\n      like: {\n        equals: -1,\n      },\n    },\n  });\n\n  if (isLiked) {\n    await prisma.videoLike.delete({\n      where: {\n        id: isLiked.id,\n      },\n    });\n  } else if (isDisliked) {\n    await prisma.videoLike.update({\n      where: {\n        id: isDisliked.id,\n      },\n      data: {\n        like: 1,\n      },\n    });\n  } else {\n    await prisma.videoLike.create({\n      data: {\n        user: {\n          connect: {\n            id: req.user.id,\n          },\n        },\n        video: {\n          connect: {\n            id: req.params.videoId,\n          },\n        },\n        like: 1,\n      },\n    });\n  }\n\n  res.status(200).json({});\n}\n\nasync function dislikeVideo(req, res, next) {\n  const video = await prisma.video.findUnique({\n    where: {\n      id: req.params.videoId,\n    },\n  });\n\n  if (!video) {\n    return next({\n      message: `No video found with id: \"${req.params.videoId}\"`,\n      statusCode: 404,\n    });\n  }\n\n  const isLiked = await prisma.videoLike.findFirst({\n    where: {\n      userId: {\n        equals: req.user.id,\n      },\n      videoId: {\n        equals: req.params.videoId,\n      },\n      like: {\n        equals: 1,\n      },\n    },\n  });\n\n  const isDisliked = await prisma.videoLike.findFirst({\n    where: {\n      userId: {\n        equals: req.user.id,\n      },\n      videoId: {\n        equals: req.params.videoId,\n      },\n      like: {\n        equals: -1,\n      },\n    },\n  });\n\n  if (isDisliked) {\n    await prisma.videoLike.delete({\n      where: {\n        id: isDisliked.id,\n      },\n    });\n  } else if (isLiked) {\n    await prisma.videoLike.update({\n      where: {\n        id: isLiked.id,\n      },\n      data: {\n        like: -1,\n      },\n    });\n  } else {\n    await prisma.videoLike.create({\n      data: {\n        user: {\n          connect: {\n            id: req.user.id,\n          },\n        },\n        video: {\n          connect: {\n            id: req.params.videoId,\n          },\n        },\n        like: -1,\n      },\n    });\n  }\n\n  res.status(200).json({});\n}\n\nasync function getVideo(req, res, next) {\n  const video = await prisma.video.findUnique({\n    where: {\n      id: req.params.videoId,\n    },\n    include: {\n      user: true,\n      comments: {\n        include: {\n          user: true,\n        },\n        orderBy: {\n          createdAt: \"desc\",\n        },\n      },\n    },\n  });\n\n  if (!video) {\n    return next({\n      message: `No video found with id: \"${req.params.videoId}\"`,\n      statusCode: 404,\n    });\n  }\n\n  let isVideoMine = false;\n  let isLiked = false;\n  let isDisliked = false;\n  let isSubscribed = false;\n  let isViewed = false;\n\n  if (req.user) {\n    isVideoMine = req.user.id === video.userId;\n\n    isLiked = await prisma.videoLike.findFirst({\n      where: {\n        userId: {\n          equals: req.user.id,\n        },\n        videoId: {\n          equals: req.params.videoId,\n        },\n        like: {\n          equals: 1,\n        },\n      },\n    });\n\n    isDisliked = await prisma.videoLike.findFirst({\n      where: {\n        userId: {\n          equals: req.user.id,\n        },\n        videoId: {\n          equals: req.params.videoId,\n        },\n        like: {\n          equals: -1,\n        },\n      },\n    });\n\n    isViewed = await prisma.view.findFirst({\n      where: {\n        userId: {\n          equals: req.user.id,\n        },\n        videoId: {\n          equals: video.id,\n        },\n      },\n    });\n\n    isSubscribed = await prisma.subscription.findFirst({\n      where: {\n        subscriberId: {\n          equals: req.user.id,\n        },\n        subscribedToId: {\n          equals: video.userId,\n        },\n      },\n    });\n  }\n\n  const likesCount = await prisma.videoLike.count({\n    where: {\n      AND: {\n        videoId: {\n          equals: req.params.videoId,\n        },\n        like: {\n          equals: 1,\n        },\n      },\n    },\n  });\n\n  const dislikesCount = await prisma.videoLike.count({\n    where: {\n      AND: {\n        videoId: {\n          equals: req.params.videoId,\n        },\n        like: {\n          equals: -1,\n        },\n      },\n    },\n  });\n\n  const views = await prisma.view.count({\n    where: {\n      videoId: {\n        equals: video.id,\n      },\n    },\n  });\n\n  const subscribersCount = await prisma.subscription.count({\n    where: {\n      subscribedToId: {\n        equals: video.userId,\n      },\n    },\n  });\n\n  video.commentsCount = video.comments.length;\n  video.isLiked = Boolean(isLiked);\n  video.isDisliked = Boolean(isDisliked);\n  video.likesCount = likesCount;\n  video.dislikesCount = dislikesCount;\n  video.isVideoMine = isVideoMine;\n  video.views = views;\n  video.isSubscribed = Boolean(isSubscribed);\n  video.isViewed = Boolean(isViewed);\n  video.subscribersCount = subscribersCount;\n\n  res.status(200).json({ video });\n}\n\nasync function deleteVideo(req, res) {\n  const video = await prisma.video.findUnique({\n    where: {\n      id: req.params.videoId,\n    },\n    select: {\n      userId: true,\n    },\n  });\n\n  if (req.user.id !== video.userId) {\n    return res.status(401).send(\"You are not authorized to delete this video\");\n  }\n\n  await prisma.view.deleteMany({\n    where: {\n      videoId: {\n        equals: req.params.videoId,\n      },\n    },\n  });\n\n  await prisma.videoLike.deleteMany({\n    where: {\n      videoId: {\n        equals: req.params.videoId,\n      },\n    },\n  });\n\n  await prisma.comment.deleteMany({\n    where: {\n      videoId: {\n        equals: req.params.videoId,\n      },\n    },\n  });\n\n  await prisma.video.delete({\n    where: {\n      id: req.params.videoId,\n    },\n  });\n\n  res.status(200).json({});\n}\n\nexport { getVideoRoutes };\n"
      ]
    },
    "sourceType": "script",
    "mtime": 1611420432000
  },
  "{\"sourceRoot\":\"/Users/egor/Dev/ytclone/1/server/src/middleware/\",\"caller\":{\"name\":\"@babel/register\"},\"cwd\":\"/Users/egor/Dev/ytclone/1\",\"filename\":\"/Users/egor/Dev/ytclone/1/server/src/middleware/error.js\",\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"/Users/egor/Dev/ytclone/1\",\"plugins\":[{\"key\":\"syntax-numeric-separator\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"proposal-logical-assignment-operators\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"AssignmentExpression\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-nullish-coalescing-operator\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-optional-chaining\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-json-strings\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-optional-catch-binding\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-async-generators\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-object-rest-spread\",\"visitor\":{\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"transform-modules-commonjs\",\"visitor\":{\"CallExpression\":{\"enter\":[null]},\"Program\":{\"exit\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"proposal-dynamic-import\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"Program\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"proposal-export-namespace-from\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"ExportNamedDeclaration\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}}],\"presets\":[]}:7.12.10": {
    "metadata": {},
    "options": {
      "sourceRoot": "/Users/egor/Dev/ytclone/1/server/src/middleware/",
      "caller": {
        "name": "@babel/register"
      },
      "cwd": "/Users/egor/Dev/ytclone/1",
      "filename": "/Users/egor/Dev/ytclone/1/server/src/middleware/error.js",
      "cloneInputAst": true,
      "babelrc": false,
      "configFile": false,
      "envName": "development",
      "root": "/Users/egor/Dev/ytclone/1",
      "sourceMaps": "both",
      "ast": false,
      "passPerPreset": false,
      "plugins": [
        {
          "key": "syntax-numeric-separator",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "proposal-logical-assignment-operators",
          "visitor": {
            "_exploded": {},
            "_verified": {},
            "AssignmentExpression": {
              "enter": [
                null
              ]
            }
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-nullish-coalescing-operator",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-optional-chaining",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-json-strings",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-optional-catch-binding",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-async-generators",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-object-rest-spread",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "transform-modules-commonjs",
          "visitor": {
            "CallExpression": {
              "enter": [
                null
              ]
            },
            "Program": {
              "exit": [
                null
              ]
            },
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "proposal-dynamic-import",
          "visitor": {
            "_exploded": {},
            "_verified": {},
            "Program": {
              "enter": [
                null
              ]
            }
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "proposal-export-namespace-from",
          "visitor": {
            "_exploded": {},
            "_verified": {},
            "ExportNamedDeclaration": {
              "enter": [
                null
              ]
            }
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        }
      ],
      "presets": [],
      "parserOpts": {
        "sourceType": "module",
        "sourceFileName": "/Users/egor/Dev/ytclone/1/server/src/middleware/error.js",
        "plugins": [
          "numericSeparator",
          "logicalAssignment",
          "nullishCoalescingOperator",
          "optionalChaining",
          "jsonStrings",
          "optionalCatchBinding",
          "asyncGenerators",
          "objectRestSpread",
          "dynamicImport",
          "exportNamespaceFrom"
        ]
      },
      "generatorOpts": {
        "filename": "/Users/egor/Dev/ytclone/1/server/src/middleware/error.js",
        "comments": true,
        "compact": "auto",
        "sourceMaps": "both",
        "sourceRoot": "/Users/egor/Dev/ytclone/1/server/src/middleware/",
        "sourceFileName": "error.js"
      }
    },
    "ast": null,
    "code": "\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.errorMiddleware = errorMiddleware;\nexports.setupCloseOnExit = setupCloseOnExit;\n\nvar _loglevel = _interopRequireDefault(require(\"loglevel\"));\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n// Middleware that will help us catch generic express-related errors\nfunction errorMiddleware(error, req, res, next) {\n  if (res.headersSent) {\n    next(error);\n  } else {\n    _loglevel.default.error(error);\n\n    res.status(error.statusCode || 500);\n    res.json({\n      message: error.message,\n      ...(process.env.NODE_ENV === \"production\" ? null : {\n        stack: error.stack\n      })\n    });\n  }\n} // This closes the server in the event of an error so\n// that our requests do not hang\n\n\nfunction setupCloseOnExit(server) {\n  async function exitHandler(options = {}) {\n    await server.close().then(() => {\n      _loglevel.default.info(\"Server successfully closed\");\n    }).catch(error => {\n      _loglevel.default.warn(\"Something went wrong closing the server\", error.stack);\n    });\n    if (options.exit) process.exit();\n  } // Do something when app is closing\n\n\n  process.on(\"exit\", exitHandler); // Catches ctrl+c event\n\n  process.on(\"SIGINT\", exitHandler.bind(null, {\n    exit: true\n  })); // Catches \"kill pid\" (for example: nodemon restart)\n\n  process.on(\"SIGUSR1\", exitHandler.bind(null, {\n    exit: true\n  }));\n  process.on(\"SIGUSR2\", exitHandler.bind(null, {\n    exit: true\n  })); // Catches uncaught exceptions\n\n  process.on(\"uncaughtException\", exitHandler.bind(null, {\n    exit: true\n  }));\n}\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImVycm9yLmpzIl0sIm5hbWVzIjpbImVycm9yTWlkZGxld2FyZSIsImVycm9yIiwicmVxIiwicmVzIiwibmV4dCIsImhlYWRlcnNTZW50IiwibG9nZ2VyIiwic3RhdHVzIiwic3RhdHVzQ29kZSIsImpzb24iLCJtZXNzYWdlIiwicHJvY2VzcyIsImVudiIsIk5PREVfRU5WIiwic3RhY2siLCJzZXR1cENsb3NlT25FeGl0Iiwic2VydmVyIiwiZXhpdEhhbmRsZXIiLCJvcHRpb25zIiwiY2xvc2UiLCJ0aGVuIiwiaW5mbyIsImNhdGNoIiwid2FybiIsImV4aXQiLCJvbiIsImJpbmQiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBQUE7Ozs7QUFFQTtBQUNBLFNBQVNBLGVBQVQsQ0FBeUJDLEtBQXpCLEVBQWdDQyxHQUFoQyxFQUFxQ0MsR0FBckMsRUFBMENDLElBQTFDLEVBQWdEO0FBQzlDLE1BQUlELEdBQUcsQ0FBQ0UsV0FBUixFQUFxQjtBQUNuQkQsSUFBQUEsSUFBSSxDQUFDSCxLQUFELENBQUo7QUFDRCxHQUZELE1BRU87QUFDTEssc0JBQU9MLEtBQVAsQ0FBYUEsS0FBYjs7QUFDQUUsSUFBQUEsR0FBRyxDQUFDSSxNQUFKLENBQVdOLEtBQUssQ0FBQ08sVUFBTixJQUFvQixHQUEvQjtBQUNBTCxJQUFBQSxHQUFHLENBQUNNLElBQUosQ0FBUztBQUNQQyxNQUFBQSxPQUFPLEVBQUVULEtBQUssQ0FBQ1MsT0FEUjtBQUVQLFVBQUlDLE9BQU8sQ0FBQ0MsR0FBUixDQUFZQyxRQUFaLEtBQXlCLFlBQXpCLEdBQ0EsSUFEQSxHQUVBO0FBQUVDLFFBQUFBLEtBQUssRUFBRWIsS0FBSyxDQUFDYTtBQUFmLE9BRko7QUFGTyxLQUFUO0FBTUQ7QUFDRixDLENBRUQ7QUFDQTs7O0FBQ0EsU0FBU0MsZ0JBQVQsQ0FBMEJDLE1BQTFCLEVBQWtDO0FBQ2hDLGlCQUFlQyxXQUFmLENBQTJCQyxPQUFPLEdBQUcsRUFBckMsRUFBeUM7QUFDdkMsVUFBTUYsTUFBTSxDQUNURyxLQURHLEdBRUhDLElBRkcsQ0FFRSxNQUFNO0FBQ1ZkLHdCQUFPZSxJQUFQLENBQVksNEJBQVo7QUFDRCxLQUpHLEVBS0hDLEtBTEcsQ0FLSXJCLEtBQUQsSUFBVztBQUNoQkssd0JBQU9pQixJQUFQLENBQVkseUNBQVosRUFBdUR0QixLQUFLLENBQUNhLEtBQTdEO0FBQ0QsS0FQRyxDQUFOO0FBUUEsUUFBSUksT0FBTyxDQUFDTSxJQUFaLEVBQWtCYixPQUFPLENBQUNhLElBQVI7QUFDbkIsR0FYK0IsQ0FZaEM7OztBQUNBYixFQUFBQSxPQUFPLENBQUNjLEVBQVIsQ0FBVyxNQUFYLEVBQW1CUixXQUFuQixFQWJnQyxDQWNoQzs7QUFDQU4sRUFBQUEsT0FBTyxDQUFDYyxFQUFSLENBQVcsUUFBWCxFQUFxQlIsV0FBVyxDQUFDUyxJQUFaLENBQWlCLElBQWpCLEVBQXVCO0FBQUVGLElBQUFBLElBQUksRUFBRTtBQUFSLEdBQXZCLENBQXJCLEVBZmdDLENBZ0JoQzs7QUFDQWIsRUFBQUEsT0FBTyxDQUFDYyxFQUFSLENBQVcsU0FBWCxFQUFzQlIsV0FBVyxDQUFDUyxJQUFaLENBQWlCLElBQWpCLEVBQXVCO0FBQUVGLElBQUFBLElBQUksRUFBRTtBQUFSLEdBQXZCLENBQXRCO0FBQ0FiLEVBQUFBLE9BQU8sQ0FBQ2MsRUFBUixDQUFXLFNBQVgsRUFBc0JSLFdBQVcsQ0FBQ1MsSUFBWixDQUFpQixJQUFqQixFQUF1QjtBQUFFRixJQUFBQSxJQUFJLEVBQUU7QUFBUixHQUF2QixDQUF0QixFQWxCZ0MsQ0FtQmhDOztBQUNBYixFQUFBQSxPQUFPLENBQUNjLEVBQVIsQ0FBVyxtQkFBWCxFQUFnQ1IsV0FBVyxDQUFDUyxJQUFaLENBQWlCLElBQWpCLEVBQXVCO0FBQUVGLElBQUFBLElBQUksRUFBRTtBQUFSLEdBQXZCLENBQWhDO0FBQ0QiLCJzb3VyY2VSb290IjoiL1VzZXJzL2Vnb3IvRGV2L3l0Y2xvbmUvMS9zZXJ2ZXIvc3JjL21pZGRsZXdhcmUvIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGxvZ2dlciBmcm9tIFwibG9nbGV2ZWxcIjtcblxuLy8gTWlkZGxld2FyZSB0aGF0IHdpbGwgaGVscCB1cyBjYXRjaCBnZW5lcmljIGV4cHJlc3MtcmVsYXRlZCBlcnJvcnNcbmZ1bmN0aW9uIGVycm9yTWlkZGxld2FyZShlcnJvciwgcmVxLCByZXMsIG5leHQpIHtcbiAgaWYgKHJlcy5oZWFkZXJzU2VudCkge1xuICAgIG5leHQoZXJyb3IpO1xuICB9IGVsc2Uge1xuICAgIGxvZ2dlci5lcnJvcihlcnJvcik7XG4gICAgcmVzLnN0YXR1cyhlcnJvci5zdGF0dXNDb2RlIHx8IDUwMCk7XG4gICAgcmVzLmpzb24oe1xuICAgICAgbWVzc2FnZTogZXJyb3IubWVzc2FnZSxcbiAgICAgIC4uLihwcm9jZXNzLmVudi5OT0RFX0VOViA9PT0gXCJwcm9kdWN0aW9uXCJcbiAgICAgICAgPyBudWxsXG4gICAgICAgIDogeyBzdGFjazogZXJyb3Iuc3RhY2sgfSksXG4gICAgfSk7XG4gIH1cbn1cblxuLy8gVGhpcyBjbG9zZXMgdGhlIHNlcnZlciBpbiB0aGUgZXZlbnQgb2YgYW4gZXJyb3Igc29cbi8vIHRoYXQgb3VyIHJlcXVlc3RzIGRvIG5vdCBoYW5nXG5mdW5jdGlvbiBzZXR1cENsb3NlT25FeGl0KHNlcnZlcikge1xuICBhc3luYyBmdW5jdGlvbiBleGl0SGFuZGxlcihvcHRpb25zID0ge30pIHtcbiAgICBhd2FpdCBzZXJ2ZXJcbiAgICAgIC5jbG9zZSgpXG4gICAgICAudGhlbigoKSA9PiB7XG4gICAgICAgIGxvZ2dlci5pbmZvKFwiU2VydmVyIHN1Y2Nlc3NmdWxseSBjbG9zZWRcIik7XG4gICAgICB9KVxuICAgICAgLmNhdGNoKChlcnJvcikgPT4ge1xuICAgICAgICBsb2dnZXIud2FybihcIlNvbWV0aGluZyB3ZW50IHdyb25nIGNsb3NpbmcgdGhlIHNlcnZlclwiLCBlcnJvci5zdGFjayk7XG4gICAgICB9KTtcbiAgICBpZiAob3B0aW9ucy5leGl0KSBwcm9jZXNzLmV4aXQoKTtcbiAgfVxuICAvLyBEbyBzb21ldGhpbmcgd2hlbiBhcHAgaXMgY2xvc2luZ1xuICBwcm9jZXNzLm9uKFwiZXhpdFwiLCBleGl0SGFuZGxlcik7XG4gIC8vIENhdGNoZXMgY3RybCtjIGV2ZW50XG4gIHByb2Nlc3Mub24oXCJTSUdJTlRcIiwgZXhpdEhhbmRsZXIuYmluZChudWxsLCB7IGV4aXQ6IHRydWUgfSkpO1xuICAvLyBDYXRjaGVzIFwia2lsbCBwaWRcIiAoZm9yIGV4YW1wbGU6IG5vZGVtb24gcmVzdGFydClcbiAgcHJvY2Vzcy5vbihcIlNJR1VTUjFcIiwgZXhpdEhhbmRsZXIuYmluZChudWxsLCB7IGV4aXQ6IHRydWUgfSkpO1xuICBwcm9jZXNzLm9uKFwiU0lHVVNSMlwiLCBleGl0SGFuZGxlci5iaW5kKG51bGwsIHsgZXhpdDogdHJ1ZSB9KSk7XG4gIC8vIENhdGNoZXMgdW5jYXVnaHQgZXhjZXB0aW9uc1xuICBwcm9jZXNzLm9uKFwidW5jYXVnaHRFeGNlcHRpb25cIiwgZXhpdEhhbmRsZXIuYmluZChudWxsLCB7IGV4aXQ6IHRydWUgfSkpO1xufVxuXG5leHBvcnQgeyBlcnJvck1pZGRsZXdhcmUsIHNldHVwQ2xvc2VPbkV4aXQgfTtcbiJdfQ==",
    "map": {
      "version": 3,
      "sources": [
        "error.js"
      ],
      "names": [
        "errorMiddleware",
        "error",
        "req",
        "res",
        "next",
        "headersSent",
        "logger",
        "status",
        "statusCode",
        "json",
        "message",
        "process",
        "env",
        "NODE_ENV",
        "stack",
        "setupCloseOnExit",
        "server",
        "exitHandler",
        "options",
        "close",
        "then",
        "info",
        "catch",
        "warn",
        "exit",
        "on",
        "bind"
      ],
      "mappings": ";;;;;;;;AAAA;;;;AAEA;AACA,SAASA,eAAT,CAAyBC,KAAzB,EAAgCC,GAAhC,EAAqCC,GAArC,EAA0CC,IAA1C,EAAgD;AAC9C,MAAID,GAAG,CAACE,WAAR,EAAqB;AACnBD,IAAAA,IAAI,CAACH,KAAD,CAAJ;AACD,GAFD,MAEO;AACLK,sBAAOL,KAAP,CAAaA,KAAb;;AACAE,IAAAA,GAAG,CAACI,MAAJ,CAAWN,KAAK,CAACO,UAAN,IAAoB,GAA/B;AACAL,IAAAA,GAAG,CAACM,IAAJ,CAAS;AACPC,MAAAA,OAAO,EAAET,KAAK,CAACS,OADR;AAEP,UAAIC,OAAO,CAACC,GAAR,CAAYC,QAAZ,KAAyB,YAAzB,GACA,IADA,GAEA;AAAEC,QAAAA,KAAK,EAAEb,KAAK,CAACa;AAAf,OAFJ;AAFO,KAAT;AAMD;AACF,C,CAED;AACA;;;AACA,SAASC,gBAAT,CAA0BC,MAA1B,EAAkC;AAChC,iBAAeC,WAAf,CAA2BC,OAAO,GAAG,EAArC,EAAyC;AACvC,UAAMF,MAAM,CACTG,KADG,GAEHC,IAFG,CAEE,MAAM;AACVd,wBAAOe,IAAP,CAAY,4BAAZ;AACD,KAJG,EAKHC,KALG,CAKIrB,KAAD,IAAW;AAChBK,wBAAOiB,IAAP,CAAY,yCAAZ,EAAuDtB,KAAK,CAACa,KAA7D;AACD,KAPG,CAAN;AAQA,QAAII,OAAO,CAACM,IAAZ,EAAkBb,OAAO,CAACa,IAAR;AACnB,GAX+B,CAYhC;;;AACAb,EAAAA,OAAO,CAACc,EAAR,CAAW,MAAX,EAAmBR,WAAnB,EAbgC,CAchC;;AACAN,EAAAA,OAAO,CAACc,EAAR,CAAW,QAAX,EAAqBR,WAAW,CAACS,IAAZ,CAAiB,IAAjB,EAAuB;AAAEF,IAAAA,IAAI,EAAE;AAAR,GAAvB,CAArB,EAfgC,CAgBhC;;AACAb,EAAAA,OAAO,CAACc,EAAR,CAAW,SAAX,EAAsBR,WAAW,CAACS,IAAZ,CAAiB,IAAjB,EAAuB;AAAEF,IAAAA,IAAI,EAAE;AAAR,GAAvB,CAAtB;AACAb,EAAAA,OAAO,CAACc,EAAR,CAAW,SAAX,EAAsBR,WAAW,CAACS,IAAZ,CAAiB,IAAjB,EAAuB;AAAEF,IAAAA,IAAI,EAAE;AAAR,GAAvB,CAAtB,EAlBgC,CAmBhC;;AACAb,EAAAA,OAAO,CAACc,EAAR,CAAW,mBAAX,EAAgCR,WAAW,CAACS,IAAZ,CAAiB,IAAjB,EAAuB;AAAEF,IAAAA,IAAI,EAAE;AAAR,GAAvB,CAAhC;AACD",
      "sourceRoot": "/Users/egor/Dev/ytclone/1/server/src/middleware/",
      "sourcesContent": [
        "import logger from \"loglevel\";\n\n// Middleware that will help us catch generic express-related errors\nfunction errorMiddleware(error, req, res, next) {\n  if (res.headersSent) {\n    next(error);\n  } else {\n    logger.error(error);\n    res.status(error.statusCode || 500);\n    res.json({\n      message: error.message,\n      ...(process.env.NODE_ENV === \"production\"\n        ? null\n        : { stack: error.stack }),\n    });\n  }\n}\n\n// This closes the server in the event of an error so\n// that our requests do not hang\nfunction setupCloseOnExit(server) {\n  async function exitHandler(options = {}) {\n    await server\n      .close()\n      .then(() => {\n        logger.info(\"Server successfully closed\");\n      })\n      .catch((error) => {\n        logger.warn(\"Something went wrong closing the server\", error.stack);\n      });\n    if (options.exit) process.exit();\n  }\n  // Do something when app is closing\n  process.on(\"exit\", exitHandler);\n  // Catches ctrl+c event\n  process.on(\"SIGINT\", exitHandler.bind(null, { exit: true }));\n  // Catches \"kill pid\" (for example: nodemon restart)\n  process.on(\"SIGUSR1\", exitHandler.bind(null, { exit: true }));\n  process.on(\"SIGUSR2\", exitHandler.bind(null, { exit: true }));\n  // Catches uncaught exceptions\n  process.on(\"uncaughtException\", exitHandler.bind(null, { exit: true }));\n}\n\nexport { errorMiddleware, setupCloseOnExit };\n"
      ]
    },
    "sourceType": "script",
    "mtime": 1611368296000
  },
  "{\"sourceRoot\":\"/Users/egor/Dev/ytclone/1/server/src/\",\"caller\":{\"name\":\"@babel/register\"},\"cwd\":\"/Users/egor/Dev/ytclone/1\",\"filename\":\"/Users/egor/Dev/ytclone/1/server/src/start.js\",\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"/Users/egor/Dev/ytclone/1\",\"plugins\":[{\"key\":\"syntax-numeric-separator\",\"visitor\":{},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"proposal-logical-assignment-operators\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"AssignmentExpression\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-nullish-coalescing-operator\",\"visitor\":{},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-optional-chaining\",\"visitor\":{},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-json-strings\",\"visitor\":{},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-optional-catch-binding\",\"visitor\":{},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-async-generators\",\"visitor\":{},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"syntax-object-rest-spread\",\"visitor\":{},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"transform-modules-commonjs\",\"visitor\":{\"CallExpression\":{\"enter\":[null]},\"Program\":{\"exit\":[null]},\"_exploded\":true,\"_verified\":true},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"proposal-dynamic-import\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"Program\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}},{\"key\":\"proposal-export-namespace-from\",\"visitor\":{\"_exploded\":{},\"_verified\":{},\"ExportNamedDeclaration\":{\"enter\":[null]}},\"options\":{\"spec\":false,\"loose\":false,\"useBuiltIns\":false}}],\"presets\":[]}:7.12.10": {
    "metadata": {},
    "options": {
      "sourceRoot": "/Users/egor/Dev/ytclone/1/server/src/",
      "caller": {
        "name": "@babel/register"
      },
      "cwd": "/Users/egor/Dev/ytclone/1",
      "filename": "/Users/egor/Dev/ytclone/1/server/src/start.js",
      "cloneInputAst": true,
      "babelrc": false,
      "configFile": false,
      "envName": "development",
      "root": "/Users/egor/Dev/ytclone/1",
      "sourceMaps": "both",
      "ast": false,
      "passPerPreset": false,
      "plugins": [
        {
          "key": "syntax-numeric-separator",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "proposal-logical-assignment-operators",
          "visitor": {
            "_exploded": {},
            "_verified": {},
            "AssignmentExpression": {
              "enter": [
                null
              ]
            }
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-nullish-coalescing-operator",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-optional-chaining",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-json-strings",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-optional-catch-binding",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-async-generators",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "syntax-object-rest-spread",
          "visitor": {
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "transform-modules-commonjs",
          "visitor": {
            "CallExpression": {
              "enter": [
                null
              ]
            },
            "Program": {
              "exit": [
                null
              ]
            },
            "_exploded": true,
            "_verified": true
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "proposal-dynamic-import",
          "visitor": {
            "_exploded": {},
            "_verified": {},
            "Program": {
              "enter": [
                null
              ]
            }
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        },
        {
          "key": "proposal-export-namespace-from",
          "visitor": {
            "_exploded": {},
            "_verified": {},
            "ExportNamedDeclaration": {
              "enter": [
                null
              ]
            }
          },
          "options": {
            "spec": false,
            "loose": false,
            "useBuiltIns": false
          }
        }
      ],
      "presets": [],
      "parserOpts": {
        "sourceType": "module",
        "sourceFileName": "/Users/egor/Dev/ytclone/1/server/src/start.js",
        "plugins": [
          "numericSeparator",
          "logicalAssignment",
          "nullishCoalescingOperator",
          "optionalChaining",
          "jsonStrings",
          "optionalCatchBinding",
          "asyncGenerators",
          "objectRestSpread",
          "dynamicImport",
          "exportNamespaceFrom"
        ]
      },
      "generatorOpts": {
        "filename": "/Users/egor/Dev/ytclone/1/server/src/start.js",
        "comments": true,
        "compact": "auto",
        "sourceMaps": "both",
        "sourceRoot": "/Users/egor/Dev/ytclone/1/server/src/",
        "sourceFileName": "start.js"
      }
    },
    "ast": null,
    "code": "\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.startServer = startServer;\n\nvar _express = _interopRequireDefault(require(\"express\"));\n\nrequire(\"express-async-errors\");\n\nvar _path = _interopRequireDefault(require(\"path\"));\n\nvar _cors = _interopRequireDefault(require(\"cors\"));\n\nvar _loglevel = _interopRequireDefault(require(\"loglevel\"));\n\nvar _morgan = _interopRequireDefault(require(\"morgan\"));\n\nvar _dotenv = _interopRequireDefault(require(\"dotenv\"));\n\nvar _cookieParser = _interopRequireDefault(require(\"cookie-parser\"));\n\nvar _routes = require(\"./routes\");\n\nvar _error = require(\"./middleware/error\");\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n// Import this module to handle errors when using async functions for our route handlers\n_dotenv.default.config();\n\nfunction startServer({\n  port = process.env.PORT\n} = {}) {\n  const app = (0, _express.default)();\n  app.use((0, _morgan.default)(\"dev\"));\n  app.use((0, _cors.default)());\n  app.use((0, _cookieParser.default)());\n  app.use(_express.default.json()); // all API routes are prefixed with /api/v1\n\n  app.use(\"/api/v1\", (0, _routes.getRoutes)()); // Generic error handler if errors are missed by 'express-async-errors' middleware\n\n  app.use(_error.errorMiddleware); // When our project is pushed to production, we will serve // the react app using express.static() middleware\n\n  if (process.env.NODE_ENV === \"production\") {\n    app.use(_express.default.static(_path.default.resolve(__dirname, \"../client/build\"))); // Any request not caught by our API will be routed\n    // to our built react app\n\n    app.get(\"*\", function (req, res) {\n      res.sendFile(_path.default.resolve(__dirname, \"../client/build\", \"index.html\"));\n    });\n  } // This block of code is made to reliably start and close our express app\n  // It is written as a promise, which can be more easily tested\n\n\n  return new Promise(resolve => {\n    const server = app.listen(port, () => {\n      _loglevel.default.info(`Listening on port ${server.address().port}`);\n\n      const originalClose = server.close.bind(server);\n\n      server.close = () => {\n        return new Promise(resolveClose => {\n          originalClose(resolveClose);\n        });\n      }; // This function properly closes the server when the program exits\n\n\n      (0, _error.setupCloseOnExit)(server);\n      resolve(server);\n    });\n  });\n}\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInN0YXJ0LmpzIl0sIm5hbWVzIjpbImRvdGVudiIsImNvbmZpZyIsInN0YXJ0U2VydmVyIiwicG9ydCIsInByb2Nlc3MiLCJlbnYiLCJQT1JUIiwiYXBwIiwidXNlIiwiZXhwcmVzcyIsImpzb24iLCJlcnJvck1pZGRsZXdhcmUiLCJOT0RFX0VOViIsInN0YXRpYyIsInBhdGgiLCJyZXNvbHZlIiwiX19kaXJuYW1lIiwiZ2V0IiwicmVxIiwicmVzIiwic2VuZEZpbGUiLCJQcm9taXNlIiwic2VydmVyIiwibGlzdGVuIiwibG9nZ2VyIiwiaW5mbyIsImFkZHJlc3MiLCJvcmlnaW5hbENsb3NlIiwiY2xvc2UiLCJiaW5kIiwicmVzb2x2ZUNsb3NlIl0sIm1hcHBpbmdzIjoiOzs7Ozs7O0FBQUE7O0FBRUE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBRUE7O0FBQ0E7Ozs7QUFWQTtBQVlBQSxnQkFBT0MsTUFBUDs7QUFFQSxTQUFTQyxXQUFULENBQXFCO0FBQUVDLEVBQUFBLElBQUksR0FBR0MsT0FBTyxDQUFDQyxHQUFSLENBQVlDO0FBQXJCLElBQThCLEVBQW5ELEVBQXVEO0FBQ3JELFFBQU1DLEdBQUcsR0FBRyx1QkFBWjtBQUNBQSxFQUFBQSxHQUFHLENBQUNDLEdBQUosQ0FBUSxxQkFBTyxLQUFQLENBQVI7QUFDQUQsRUFBQUEsR0FBRyxDQUFDQyxHQUFKLENBQVEsb0JBQVI7QUFDQUQsRUFBQUEsR0FBRyxDQUFDQyxHQUFKLENBQVEsNEJBQVI7QUFDQUQsRUFBQUEsR0FBRyxDQUFDQyxHQUFKLENBQVFDLGlCQUFRQyxJQUFSLEVBQVIsRUFMcUQsQ0FNckQ7O0FBQ0FILEVBQUFBLEdBQUcsQ0FBQ0MsR0FBSixDQUFRLFNBQVIsRUFBbUIsd0JBQW5CLEVBUHFELENBU3JEOztBQUNBRCxFQUFBQSxHQUFHLENBQUNDLEdBQUosQ0FBUUcsc0JBQVIsRUFWcUQsQ0FZckQ7O0FBQ0EsTUFBSVAsT0FBTyxDQUFDQyxHQUFSLENBQVlPLFFBQVosS0FBeUIsWUFBN0IsRUFBMkM7QUFDekNMLElBQUFBLEdBQUcsQ0FBQ0MsR0FBSixDQUFRQyxpQkFBUUksTUFBUixDQUFlQyxjQUFLQyxPQUFMLENBQWFDLFNBQWIsRUFBd0IsaUJBQXhCLENBQWYsQ0FBUixFQUR5QyxDQUd6QztBQUNBOztBQUNBVCxJQUFBQSxHQUFHLENBQUNVLEdBQUosQ0FBUSxHQUFSLEVBQWEsVUFBVUMsR0FBVixFQUFlQyxHQUFmLEVBQW9CO0FBQy9CQSxNQUFBQSxHQUFHLENBQUNDLFFBQUosQ0FBYU4sY0FBS0MsT0FBTCxDQUFhQyxTQUFiLEVBQXdCLGlCQUF4QixFQUEyQyxZQUEzQyxDQUFiO0FBQ0QsS0FGRDtBQUdELEdBckJvRCxDQXVCckQ7QUFDQTs7O0FBQ0EsU0FBTyxJQUFJSyxPQUFKLENBQWFOLE9BQUQsSUFBYTtBQUM5QixVQUFNTyxNQUFNLEdBQUdmLEdBQUcsQ0FBQ2dCLE1BQUosQ0FBV3BCLElBQVgsRUFBaUIsTUFBTTtBQUNwQ3FCLHdCQUFPQyxJQUFQLENBQWEscUJBQW9CSCxNQUFNLENBQUNJLE9BQVAsR0FBaUJ2QixJQUFLLEVBQXZEOztBQUVBLFlBQU13QixhQUFhLEdBQUdMLE1BQU0sQ0FBQ00sS0FBUCxDQUFhQyxJQUFiLENBQWtCUCxNQUFsQixDQUF0Qjs7QUFDQUEsTUFBQUEsTUFBTSxDQUFDTSxLQUFQLEdBQWUsTUFBTTtBQUNuQixlQUFPLElBQUlQLE9BQUosQ0FBYVMsWUFBRCxJQUFrQjtBQUNuQ0gsVUFBQUEsYUFBYSxDQUFDRyxZQUFELENBQWI7QUFDRCxTQUZNLENBQVA7QUFHRCxPQUpELENBSm9DLENBU3BDOzs7QUFDQSxtQ0FBaUJSLE1BQWpCO0FBQ0FQLE1BQUFBLE9BQU8sQ0FBQ08sTUFBRCxDQUFQO0FBQ0QsS0FaYyxDQUFmO0FBYUQsR0FkTSxDQUFQO0FBZUQiLCJzb3VyY2VSb290IjoiL1VzZXJzL2Vnb3IvRGV2L3l0Y2xvbmUvMS9zZXJ2ZXIvc3JjLyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBleHByZXNzIGZyb20gXCJleHByZXNzXCI7XG4vLyBJbXBvcnQgdGhpcyBtb2R1bGUgdG8gaGFuZGxlIGVycm9ycyB3aGVuIHVzaW5nIGFzeW5jIGZ1bmN0aW9ucyBmb3Igb3VyIHJvdXRlIGhhbmRsZXJzXG5pbXBvcnQgXCJleHByZXNzLWFzeW5jLWVycm9yc1wiO1xuaW1wb3J0IHBhdGggZnJvbSBcInBhdGhcIjtcbmltcG9ydCBjb3JzIGZyb20gXCJjb3JzXCI7XG5pbXBvcnQgbG9nZ2VyIGZyb20gXCJsb2dsZXZlbFwiO1xuaW1wb3J0IG1vcmdhbiBmcm9tIFwibW9yZ2FuXCI7XG5pbXBvcnQgZG90ZW52IGZyb20gXCJkb3RlbnZcIjtcbmltcG9ydCBjb29raWVQYXJzZXIgZnJvbSBcImNvb2tpZS1wYXJzZXJcIjtcblxuaW1wb3J0IHsgZ2V0Um91dGVzIH0gZnJvbSBcIi4vcm91dGVzXCI7XG5pbXBvcnQgeyBlcnJvck1pZGRsZXdhcmUsIHNldHVwQ2xvc2VPbkV4aXQgfSBmcm9tIFwiLi9taWRkbGV3YXJlL2Vycm9yXCI7XG5cbmRvdGVudi5jb25maWcoKTtcblxuZnVuY3Rpb24gc3RhcnRTZXJ2ZXIoeyBwb3J0ID0gcHJvY2Vzcy5lbnYuUE9SVCB9ID0ge30pIHtcbiAgY29uc3QgYXBwID0gZXhwcmVzcygpO1xuICBhcHAudXNlKG1vcmdhbihcImRldlwiKSk7XG4gIGFwcC51c2UoY29ycygpKTtcbiAgYXBwLnVzZShjb29raWVQYXJzZXIoKSk7XG4gIGFwcC51c2UoZXhwcmVzcy5qc29uKCkpO1xuICAvLyBhbGwgQVBJIHJvdXRlcyBhcmUgcHJlZml4ZWQgd2l0aCAvYXBpL3YxXG4gIGFwcC51c2UoXCIvYXBpL3YxXCIsIGdldFJvdXRlcygpKTtcblxuICAvLyBHZW5lcmljIGVycm9yIGhhbmRsZXIgaWYgZXJyb3JzIGFyZSBtaXNzZWQgYnkgJ2V4cHJlc3MtYXN5bmMtZXJyb3JzJyBtaWRkbGV3YXJlXG4gIGFwcC51c2UoZXJyb3JNaWRkbGV3YXJlKTtcblxuICAvLyBXaGVuIG91ciBwcm9qZWN0IGlzIHB1c2hlZCB0byBwcm9kdWN0aW9uLCB3ZSB3aWxsIHNlcnZlIC8vIHRoZSByZWFjdCBhcHAgdXNpbmcgZXhwcmVzcy5zdGF0aWMoKSBtaWRkbGV3YXJlXG4gIGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViA9PT0gXCJwcm9kdWN0aW9uXCIpIHtcbiAgICBhcHAudXNlKGV4cHJlc3Muc3RhdGljKHBhdGgucmVzb2x2ZShfX2Rpcm5hbWUsIFwiLi4vY2xpZW50L2J1aWxkXCIpKSk7XG5cbiAgICAvLyBBbnkgcmVxdWVzdCBub3QgY2F1Z2h0IGJ5IG91ciBBUEkgd2lsbCBiZSByb3V0ZWRcbiAgICAvLyB0byBvdXIgYnVpbHQgcmVhY3QgYXBwXG4gICAgYXBwLmdldChcIipcIiwgZnVuY3Rpb24gKHJlcSwgcmVzKSB7XG4gICAgICByZXMuc2VuZEZpbGUocGF0aC5yZXNvbHZlKF9fZGlybmFtZSwgXCIuLi9jbGllbnQvYnVpbGRcIiwgXCJpbmRleC5odG1sXCIpKTtcbiAgICB9KTtcbiAgfVxuXG4gIC8vIFRoaXMgYmxvY2sgb2YgY29kZSBpcyBtYWRlIHRvIHJlbGlhYmx5IHN0YXJ0IGFuZCBjbG9zZSBvdXIgZXhwcmVzcyBhcHBcbiAgLy8gSXQgaXMgd3JpdHRlbiBhcyBhIHByb21pc2UsIHdoaWNoIGNhbiBiZSBtb3JlIGVhc2lseSB0ZXN0ZWRcbiAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7XG4gICAgY29uc3Qgc2VydmVyID0gYXBwLmxpc3Rlbihwb3J0LCAoKSA9PiB7XG4gICAgICBsb2dnZXIuaW5mbyhgTGlzdGVuaW5nIG9uIHBvcnQgJHtzZXJ2ZXIuYWRkcmVzcygpLnBvcnR9YCk7XG5cbiAgICAgIGNvbnN0IG9yaWdpbmFsQ2xvc2UgPSBzZXJ2ZXIuY2xvc2UuYmluZChzZXJ2ZXIpO1xuICAgICAgc2VydmVyLmNsb3NlID0gKCkgPT4ge1xuICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmVDbG9zZSkgPT4ge1xuICAgICAgICAgIG9yaWdpbmFsQ2xvc2UocmVzb2x2ZUNsb3NlKTtcbiAgICAgICAgfSk7XG4gICAgICB9O1xuICAgICAgLy8gVGhpcyBmdW5jdGlvbiBwcm9wZXJseSBjbG9zZXMgdGhlIHNlcnZlciB3aGVuIHRoZSBwcm9ncmFtIGV4aXRzXG4gICAgICBzZXR1cENsb3NlT25FeGl0KHNlcnZlcik7XG4gICAgICByZXNvbHZlKHNlcnZlcik7XG4gICAgfSk7XG4gIH0pO1xufVxuXG5leHBvcnQgeyBzdGFydFNlcnZlciB9O1xuIl19",
    "map": {
      "version": 3,
      "sources": [
        "start.js"
      ],
      "names": [
        "dotenv",
        "config",
        "startServer",
        "port",
        "process",
        "env",
        "PORT",
        "app",
        "use",
        "express",
        "json",
        "errorMiddleware",
        "NODE_ENV",
        "static",
        "path",
        "resolve",
        "__dirname",
        "get",
        "req",
        "res",
        "sendFile",
        "Promise",
        "server",
        "listen",
        "logger",
        "info",
        "address",
        "originalClose",
        "close",
        "bind",
        "resolveClose"
      ],
      "mappings": ";;;;;;;AAAA;;AAEA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AAEA;;AACA;;;;AAVA;AAYAA,gBAAOC,MAAP;;AAEA,SAASC,WAAT,CAAqB;AAAEC,EAAAA,IAAI,GAAGC,OAAO,CAACC,GAAR,CAAYC;AAArB,IAA8B,EAAnD,EAAuD;AACrD,QAAMC,GAAG,GAAG,uBAAZ;AACAA,EAAAA,GAAG,CAACC,GAAJ,CAAQ,qBAAO,KAAP,CAAR;AACAD,EAAAA,GAAG,CAACC,GAAJ,CAAQ,oBAAR;AACAD,EAAAA,GAAG,CAACC,GAAJ,CAAQ,4BAAR;AACAD,EAAAA,GAAG,CAACC,GAAJ,CAAQC,iBAAQC,IAAR,EAAR,EALqD,CAMrD;;AACAH,EAAAA,GAAG,CAACC,GAAJ,CAAQ,SAAR,EAAmB,wBAAnB,EAPqD,CASrD;;AACAD,EAAAA,GAAG,CAACC,GAAJ,CAAQG,sBAAR,EAVqD,CAYrD;;AACA,MAAIP,OAAO,CAACC,GAAR,CAAYO,QAAZ,KAAyB,YAA7B,EAA2C;AACzCL,IAAAA,GAAG,CAACC,GAAJ,CAAQC,iBAAQI,MAAR,CAAeC,cAAKC,OAAL,CAAaC,SAAb,EAAwB,iBAAxB,CAAf,CAAR,EADyC,CAGzC;AACA;;AACAT,IAAAA,GAAG,CAACU,GAAJ,CAAQ,GAAR,EAAa,UAAUC,GAAV,EAAeC,GAAf,EAAoB;AAC/BA,MAAAA,GAAG,CAACC,QAAJ,CAAaN,cAAKC,OAAL,CAAaC,SAAb,EAAwB,iBAAxB,EAA2C,YAA3C,CAAb;AACD,KAFD;AAGD,GArBoD,CAuBrD;AACA;;;AACA,SAAO,IAAIK,OAAJ,CAAaN,OAAD,IAAa;AAC9B,UAAMO,MAAM,GAAGf,GAAG,CAACgB,MAAJ,CAAWpB,IAAX,EAAiB,MAAM;AACpCqB,wBAAOC,IAAP,CAAa,qBAAoBH,MAAM,CAACI,OAAP,GAAiBvB,IAAK,EAAvD;;AAEA,YAAMwB,aAAa,GAAGL,MAAM,CAACM,KAAP,CAAaC,IAAb,CAAkBP,MAAlB,CAAtB;;AACAA,MAAAA,MAAM,CAACM,KAAP,GAAe,MAAM;AACnB,eAAO,IAAIP,OAAJ,CAAaS,YAAD,IAAkB;AACnCH,UAAAA,aAAa,CAACG,YAAD,CAAb;AACD,SAFM,CAAP;AAGD,OAJD,CAJoC,CASpC;;;AACA,mCAAiBR,MAAjB;AACAP,MAAAA,OAAO,CAACO,MAAD,CAAP;AACD,KAZc,CAAf;AAaD,GAdM,CAAP;AAeD",
      "sourceRoot": "/Users/egor/Dev/ytclone/1/server/src/",
      "sourcesContent": [
        "import express from \"express\";\n// Import this module to handle errors when using async functions for our route handlers\nimport \"express-async-errors\";\nimport path from \"path\";\nimport cors from \"cors\";\nimport logger from \"loglevel\";\nimport morgan from \"morgan\";\nimport dotenv from \"dotenv\";\nimport cookieParser from \"cookie-parser\";\n\nimport { getRoutes } from \"./routes\";\nimport { errorMiddleware, setupCloseOnExit } from \"./middleware/error\";\n\ndotenv.config();\n\nfunction startServer({ port = process.env.PORT } = {}) {\n  const app = express();\n  app.use(morgan(\"dev\"));\n  app.use(cors());\n  app.use(cookieParser());\n  app.use(express.json());\n  // all API routes are prefixed with /api/v1\n  app.use(\"/api/v1\", getRoutes());\n\n  // Generic error handler if errors are missed by 'express-async-errors' middleware\n  app.use(errorMiddleware);\n\n  // When our project is pushed to production, we will serve // the react app using express.static() middleware\n  if (process.env.NODE_ENV === \"production\") {\n    app.use(express.static(path.resolve(__dirname, \"../client/build\")));\n\n    // Any request not caught by our API will be routed\n    // to our built react app\n    app.get(\"*\", function (req, res) {\n      res.sendFile(path.resolve(__dirname, \"../client/build\", \"index.html\"));\n    });\n  }\n\n  // This block of code is made to reliably start and close our express app\n  // It is written as a promise, which can be more easily tested\n  return new Promise((resolve) => {\n    const server = app.listen(port, () => {\n      logger.info(`Listening on port ${server.address().port}`);\n\n      const originalClose = server.close.bind(server);\n      server.close = () => {\n        return new Promise((resolveClose) => {\n          originalClose(resolveClose);\n        });\n      };\n      // This function properly closes the server when the program exits\n      setupCloseOnExit(server);\n      resolve(server);\n    });\n  });\n}\n\nexport { startServer };\n"
      ]
    },
    "sourceType": "script",
    "mtime": 1611368296000
  }
}